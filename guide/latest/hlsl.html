<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HLSL in Vulkan :: Vulkan Documentation Project Demo</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">Vulkan Documentation Project Demo</a>
      <div class="navbar-item">
        <img alt="Vulkan White Label" src="../../_/Vulkan_White_Dec16.svg" height="100%" />
      </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label for="search-input"></label><input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../spec/latest/chapters/introduction.html">Vulkan 1.3</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../guide/latest/index.html">Vulkan Guide</a>
          </div>
        </div>
            <!--
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tools</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">TBD</a>
          </div>
        </div>
            -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tutorial</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../tutorial/latest/index.html">Vulkan Tutorial</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Samples</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../samples/latest/README.html">Vulkan Samples</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Help</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://khr.io/khrdiscord">Khronos Discord</a>
          </div>
        </div>
            <!--
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
            -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="guide" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Vulkan Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Vulkan Guide</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Logistics Overview</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="what_is_vulkan.html">What is Vulkan?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="what_vulkan_can_do.html">What Vulkan Can Do</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="vulkan_spec.html">Vulkan Specification</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="platforms.html">Platforms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="checking_for_support.html">Checking For Vulkan Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="versions.html">Versions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="vulkan_release_summary.html">Vulkan Release Summary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="what_is_spirv.html">What is SPIR-V</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="portability_initiative.html">Portability Initiative</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="vulkan_cts.html">Vulkan CTS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="development_tools.html">Development Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="validation_overview.html">Vulkan Validation Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="decoder_ring.html">Vulkan Decoder Ring</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Using Vulkan</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="loader.html">Loader</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="layers.html">Layers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="querying_extensions_features.html">Querying Properties, Extensions, Features, Limits, and Formats</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="enabling_extensions.html">Enabling Extensions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="enabling_features.html">Enabling Features</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spirv_extensions.html">Using SPIR-V Extensions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="formats.html">Formats</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="queues.html">Queues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="wsi.html">Window System Integration (WSI)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="pnext_and_stype.html">pNext and sType</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="synchronization.html">Synchronization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/VK_KHR_synchronization2.html">VK_KHR_synchronization2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="memory_allocation.html">Memory Allocation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sparse_resources.html">Sparse Resources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="protected.html">Protected Memory</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="pipeline_cache.html">Pipeline Cache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="threading.html">Threading</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="depth.html">Depth</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mapping_data_to_shaders.html">Mapping Data to Shaders</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="vertex_input_data_processing.html">Vertex Input Data Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="descriptor_dynamic_offset.html">Descriptor Dynamic Offset</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="push_constants.html">Push Constants</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="robustness.html">Robustness</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="dynamic_state.html">Pipeline Dynamic State</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="subgroups.html">Subgroups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="shader_memory_layout.html">Shader Memory Layout</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="atomics.html">Atomics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="common_pitfalls.html">Common Pitfalls for New Vulkan Developers</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="hlsl.html">HLSL in Vulkan</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">When and Why to use Extensions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/cleanup.html">Cleanup Extensions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/device_groups.html">Device Groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/external.html">External Memory and Synchronization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/ray_tracing.html">Ray Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/shader_features.html">Shader Features</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/translation_layer_extensions.html">Translation Layer Extensions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/VK_EXT_descriptor_indexing.html">VK_EXT_descriptor_indexing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/VK_EXT_inline_uniform_block.html">VK_EXT_inline_uniform_block</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/VK_EXT_memory_priority.html">VK_EXT_memory_priority</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/VK_KHR_descriptor_update_template.html">VK_KHR_descriptor_update_template</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/VK_KHR_draw_indirect_count.html">VK_KHR_draw_indirect_count</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/VK_KHR_image_format_list.html">VK_KHR_image_format_list</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/VK_KHR_imageless_framebuffer.html">VK_KHR_imageless_framebuffer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/VK_KHR_sampler_ycbcr_conversion.html">VK_KHR_sampler_ycbcr_conversion</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extensions/VK_KHR_shader_subgroup_uniform_control_flow.html">VK_KHR_shader_subgroup_uniform_control_flow</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Vulkan Guide</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../tutorial/latest/00_Introduction.html">Khronos Vulkan Tutorial</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../tutorial/latest/00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Vulkan Guide</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../spec/latest/index.html">Vulkan Specification and Proposals</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../spec/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../spec/latest/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Vulkan Guide</a></li>
    <li>Using Vulkan</li>
    <li><a href="hlsl.html">HLSL in Vulkan</a></li>
  </ul>
</nav>
    <!--
  <div class="edit-this-page"><a href="https://github.com/KhronosGroup/Vulkan-Guide/edit/main/antora/modules/ROOT/pages/hlsl.adoc">Edit this Page</a></div>
      -->
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">HLSL in Vulkan</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Vulkan does not directly consume shaders in a human-readable text format, but instead uses <a href="what_is_spirv.html" class="xref page">SPIR-V</a> as an intermediate representation. This opens the option to use shader languages other than e.g. GLSL, as long as they can target the Vulkan SPIR-V environment.</p>
</div>
<div class="paragraph">
<p>One such language is the High Level Shading Language (HLSL) by Microsoft, used by DirectX. Thanks to <a href="https://www.khronos.org/blog/hlsl-first-class-vulkan-shading-language">recent additions to Vulkan 1.2</a> it is now considered a first class shading language for Vulkan that can be used just as easily as GLSL.</p>
</div>
<div class="paragraph">
<p>With <a href="https://github.com/microsoft/DirectXShaderCompiler/blob/main/docs/SPIR-V.rst#unsupported-hlsl-features">a few exceptions</a>, all Vulkan features and shader stages available with GLSL can be used with HLSL too, including recent Vulkan additions like hardware accelerated ray tracing. On the other hand, HLSL to SPIR-V supports Vulkan exclusive features that are not (yet) available in DirectX.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/what_is_spirv_dxc.png" alt="what_is_spriv_dxc.png">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="applications-pov"><a class="anchor" href="#applications-pov"></a>From the application&#8217;s point-of-view</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From the application&#8217;s point-of-view, using HLSL is exactly the same as using GLSL. As the application always consumes shaders in the SPIR-V format, the only difference is in the tooling to generate the SPIR-V shaders from the desired shading language.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hlsl-spirv-mapping-manual"><a class="anchor" href="#hlsl-spirv-mapping-manual"></a>HLSL to SPIR-V feature mapping manual</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A great starting point on using HLSL in Vulkan via SPIR-V is the <a href="https://github.com/microsoft/DirectXShaderCompiler/blob/main/docs/SPIR-V.rst">HLSL to SPIR-V feature mapping manual</a>. It contains detailed information on semantics, syntax, supported features and extensions and much more and is a must-read. The <a href="decoder_ring.html" class="xref page">decoder ring</a> also has a translation table for concepts and terms used in Vulkan and DirectX.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vk-namespace"><a class="anchor" href="#vk-namespace"></a>The Vulkan HLSL namespace</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To make HLSL compatible with Vulkan, an <a href="https://github.com/microsoft/DirectXShaderCompiler/blob/main/docs/SPIR-V.rst#the-implicit-vk-namespace)">implicit namespace</a> has been introduced that provides an interface for for Vulkan-specific features.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="syntax-comparison"><a class="anchor" href="#syntax-comparison"></a>Syntax comparison</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Similar to regular programming languages, HLSL and GLSL differ in their syntax. While GLSL is more procedural (like C), HLSL is more object-oriented (like C++).</p>
</div>
<div class="paragraph">
<p>Here is the same shader written in both languages to give quick comparison on how they basically differ, including the aforementioned namespace that e.g. adds explicit locations:</p>
</div>
<div class="sect2">
<h3 id="_glsl"><a class="anchor" href="#_glsl"></a>GLSL</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-glsl hljs" data-lang="glsl">#version 450

layout (location = 0) in vec3 inPosition;
layout (location = 1) in vec3 inColor;

layout (binding = 0) uniform UBO
{
	mat4 projectionMatrix;
	mat4 modelMatrix;
	mat4 viewMatrix;
} ubo;

layout (location = 0) out vec3 outColor;

void main()
{
	outColor = inColor * float(gl_VertexIndex);
	gl_Position = ubo.projectionMatrix * ubo.viewMatrix * ubo.modelMatrix * vec4(inPosition.xyz, 1.0);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hlsl"><a class="anchor" href="#_hlsl"></a>HLSL</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hlsl hljs" data-lang="hlsl">struct VSInput
{
[[vk::location(0)]] float3 Position : POSITION0;
[[vk::location(1)]] float3 Color : COLOR0;
};

struct UBO
{
	float4x4 projectionMatrix;
	float4x4 modelMatrix;
	float4x4 viewMatrix;
};

cbuffer ubo : register(b0, space0) { UBO ubo; }

struct VSOutput
{
	float4 Pos : SV_POSITION;
[[vk::location(0)]] float3 Color : COLOR0;
};

VSOutput main(VSInput input, uint VertexIndex : SV_VertexID)
{
	VSOutput output = (VSOutput)0;
	output.Color = input.Color * float(VertexIndex);
	output.Position = mul(ubo.projectionMatrix, mul(ubo.viewMatrix, mul(ubo.modelMatrix, float4(input.Position.xyz, 1.0))));
	return output;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aside from the syntax differences, built-ins use HLSL names. E.g. <code>gl_vertex</code> becomes <code>VertexIndex</code> in HLSL. A list of GLSL to HLSL built-in mappings can be found <a href="https://anteru.net/blog/2016/mapping-between-HLSL-and-GLSL/">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="DirectXShaderCompiler"><a class="anchor" href="#DirectXShaderCompiler"></a>DirectXShaderCompiler (DXC)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As is the case with GLSL to SPIR-V, to use HLSL with Vulkan, a shader compiler is required. Whereas <a href="https://github.com/KhronosGroup/glslang">glslang</a> is the reference GLSL to SPIR-V compiler, the <a href="https://github.com/microsoft/DirectXShaderCompiler">DirectXShaderCompiler</a> (DXC) is the reference HLSL to SPIR-V compiler. Thanks to open source contributions, the SPIR-V backend of DXC is now supported and enabled in official release builds and can be used out-of-the box. While other shader compiling tools like <a href="https://github.com/KhronosGroup/glslang/wiki/HLSL-FAQ">glslang</a> also offer HLSL support, DXC has the most complete and up-to-date support and is the recommended way of generating SPIR-V from HLSL.</p>
</div>
<div class="sect2">
<h3 id="_where_to_get"><a class="anchor" href="#_where_to_get"></a>Where to get</h3>
<div class="paragraph">
<p>The <a href="https://vulkan.lunarg.com/">LunarG Vulkan SDK</a> includes pre-compiled DXC binaries, libraries and headers to get you started. If you&#8217;re looking for the latest releases, check the <a href="https://github.com/microsoft/DirectXShaderCompiler/releases">official DXC repository</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_offline_compilation_using_the_stand_alone_compiler"><a class="anchor" href="#_offline_compilation_using_the_stand_alone_compiler"></a>Offline compilation using the stand-alone compiler</h3>
<div class="paragraph">
<p>Compiling a shader offline via the pre-compiled dxc binary is similar to compiling with glslang:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">dxc.exe -spirv -T vs_6_0 -E main .\triangle.vert -Fo .\triangle.vert.spv</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-T</code> selects the profile to compile the shader against (<code>vs_6_0</code> = Vertex shader model 6, <code>ps_6_0</code> = Pixel/fragment shader model 6, etc.).</p>
</div>
<div class="paragraph">
<p><code>-E</code> selects the main entry point for the shader.</p>
</div>
<div class="paragraph">
<p>Extensions are implicitly enabled based on feature usage, but can also be explicitly specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">dxc.exe -spirv -T vs_6_1 -E main .\input.vert -Fo .\output.vert.spv -fspv-extension=SPV_EXT_descriptor_indexing</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting SPIR-V can then be directly loaded, same as SPIR-V generated from GLSL.</p>
</div>
</div>
<div class="sect2">
<h3 id="_runtime_compilation_using_the_library"><a class="anchor" href="#_runtime_compilation_using_the_library"></a>Runtime compilation using the library</h3>
<div class="paragraph">
<p>DXC can also be integrated into a Vulkan application using the DirectX Compiler API. This allows for runtime compilation of shaders. Doing so requires you to include the <code>dxcapi.h</code> header and link against the <code>dxcompiler</code> library. The easiest way is using the dynamic library and distributing it with your application (e.g. <code>dxcompiler.dll</code> on Windows).</p>
</div>
<div class="paragraph">
<p>Compiling HLSL to SPIR-V at runtime then is pretty straight-forward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cpp hljs" data-lang="cpp">#include "include/dxc/dxcapi.h"

...

HRESULT hres;

// Initialize DXC library
CComPtr&lt;IDxcLibrary&gt; library;
hres = DxcCreateInstance(CLSID_DxcLibrary, IID_PPV_ARGS(&amp;library));
if (FAILED(hres)) {
	throw std::runtime_error("Could not init DXC Library");
}

// Initialize DXC compiler
CComPtr&lt;IDxcCompiler3&gt; compiler;
hres = DxcCreateInstance(CLSID_DxcCompiler, IID_PPV_ARGS(&amp;compiler));
if (FAILED(hres)) {
	throw std::runtime_error("Could not init DXC Compiler");
}

// Initialize DXC utility
CComPtr&lt;IDxcUtils&gt; utils;
hres = DxcCreateInstance(CLSID_DxcUtils, IID_PPV_ARGS(&amp;utils));
if (FAILED(hres)) {
	throw std::runtime_error("Could not init DXC Utiliy");
}

// Load the HLSL text shader from disk
uint32_t codePage = DXC_CP_ACP;
CComPtr&lt;IDxcBlobEncoding&gt; sourceBlob;
hres = utils-&gt;LoadFile(filename.c_str(), &amp;codePage, &amp;sourceBlob);
if (FAILED(hres)) {
	throw std::runtime_error("Could not load shader file");
}

// Select target profile based on shader file extension
LPCWSTR targetProfile{};
size_t idx = filename.rfind('.');
if (idx != std::string::npos) {
	std::wstring extension = filename.substr(idx + 1);
	if (extension == L"vert") {
		targetProfile = L"vs_6_1";
	}
	if (extension == L"frag") {
		targetProfile = L"ps_6_1";
	}
	// Mapping for other file types go here (cs_x_y, lib_x_y, etc.)
}

// Configure the compiler arguments for compiling the HLSL shader to SPIR-V
std::vector&lt;LPCWSTR&gt; arguments = {
	// (Optional) name of the shader file to be displayed e.g. in an error message
	filename.c_str(),
	// Shader main entry point
	L"-E", L"main",
	// Shader target profile
	L"-T", targetProfile,
	// Compile to SPIRV
	L"-spirv"
};

// Compile shader
DxcBuffer buffer{};
buffer.Encoding = DXC_CP_ACP;
buffer.Ptr = sourceBlob-&gt;GetBufferPointer();
buffer.Size = sourceBlob-&gt;GetBufferSize();

CComPtr&lt;IDxcResult&gt; result{ nullptr };
hres = compiler-&gt;Compile(
	&amp;buffer,
	arguments.data(),
	(uint32_t)arguments.size(),
	nullptr,
	IID_PPV_ARGS(&amp;result));

if (SUCCEEDED(hres)) {
	result-&gt;GetStatus(&amp;hres);
}

// Output error if compilation failed
if (FAILED(hres) &amp;&amp; (result)) {
	CComPtr&lt;IDxcBlobEncoding&gt; errorBlob;
	hres = result-&gt;GetErrorBuffer(&amp;errorBlob);
	if (SUCCEEDED(hres) &amp;&amp; errorBlob) {
		std::cerr &lt;&lt; "Shader compilation failed :\n\n" &lt;&lt; (const char*)errorBlob-&gt;GetBufferPointer();
		throw std::runtime_error("Compilation failed");
	}
}

// Get compilation result
CComPtr&lt;IDxcBlob&gt; code;
result-&gt;GetResult(&amp;code);

// Create a Vulkan shader module from the compilation result
VkShaderModuleCreateInfo shaderModuleCI{};
shaderModuleCI.sType = VK_STRUCTURE_TYPE_SHADER_MODULE_CREATE_INFO;
shaderModuleCI.codeSize = code-&gt;GetBufferSize();
shaderModuleCI.pCode = (uint32_t*)code-&gt;GetBufferPointer();
VkShaderModule shaderModule;
vkCreateShaderModule(device, &amp;shaderModuleCI, nullptr, &amp;shaderModule);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_vulkan_shader_stage_to_hlsl_target_shader_profile_mapping"><a class="anchor" href="#_vulkan_shader_stage_to_hlsl_target_shader_profile_mapping"></a>Vulkan shader stage to HLSL target shader profile mapping</h3>
<div class="paragraph">
<p>When compiling HLSL with DXC you need to select a target shader profile. The name for a profile consists of the shader type and the desired shader model.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Vulkan shader stage</th>
<th class="tableblock halign-left valign-top">HLSL target shader profile</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_SHADER_STAGE_VERTEX_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_SHADER_STAGE_TESSELLATION_CONTROL_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hull shader in HLSL terminology</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_SHADER_STAGE_TESSELLATION_EVALUATION_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain shader in HLSL terminology</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_SHADER_STAGE_GEOMETRY_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_SHADER_STAGE_FRAGMENT_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ps</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pixel shader in HLSL terminology</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_SHADER_STAGE_COMPUTE_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_SHADER_STAGE_RAYGEN_BIT_KHR</code>,
<code>VK_SHADER_STAGE_ANY_HIT_BIT_KHR</code>,
<code>VK_SHADER_STAGE_CLOSEST_HIT_BIT_KHR</code>,
<code>VK_SHADER_STAGE_MISS_BIT_KHR</code>,
<code>VK_SHADER_STAGE_INTERSECTION_BIT_KHR</code>,
<code>VK_SHADER_STAGE_CALLABLE_BIT_KHR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lib</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All raytracing related shaders are built using the <code>lib</code> shader target profile and must use at least shader model 6.3 (e.g. <code>lib_6_3</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_SHADER_STAGE_TASK_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>as</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amplification shader in HLSL terminology. Must use at least shader model 6.5 (e.g. <code>as_6_5</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_SHADER_STAGE_MESH_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Must use at least shader model 6.5 (e.g. <code>ms_6_5</code>).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>So if you for example you want to compile a compute shader targeting shader model 6.6 features, the target shader profile would be <code>cs_6_6</code>. For a ray tracing any hit shader it would be <code>lib_6_3</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_shader_model_coverage"><a class="anchor" href="#_shader_model_coverage"></a>Shader model coverage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>DirectX and HLSL use a fixed shader model notion to describe the supported feature set. This is different from Vulkan and SPIR-V&#8217;s flexible extension based way of adding features to shaders. The following table tries to list Vulkan&#8217;s coverage for the HLSL shader models without guarantee of completeness:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Shader models</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Shader Model</th>
<th class="tableblock halign-left valign-top">Supported</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shader Model 5.1 and below</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✔</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Excluding features without Vulkan equivalent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/microsoft/DirectXShaderCompiler/wiki/Shader-Model-6.0">Shader Model 6.0</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✔</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wave intrinsics, 64-bit integers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/microsoft/DirectXShaderCompiler/wiki/Shader-Model-6.1">Shader Model 6.1</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✔</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SV_ViewID, SV_Barycentrics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/microsoft/DirectXShaderCompiler/wiki/Shader-Model-6.2">Shader Model 6.2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✔</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16-bit types, Denorm mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/microsoft/DirectXShaderCompiler/wiki/Shader-Model-6.3">Shader Model 6.3</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✔</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware accelerated ray tracing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/microsoft/DirectXShaderCompiler/wiki/Shader-Model-6.4">Shader Model 6.4</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✔</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shader integer dot product, SV_ShadingRate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/microsoft/DirectXShaderCompiler/wiki/Shader-Model-6.5">Shader Model 6.5</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌ (partially)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DXR1.1 (KHR ray tracing), Mesh and Amplification shaders, additional Wave intrinsics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/microsoft/DirectXShaderCompiler/wiki/Shader-Model-6.6">Shader Model 6.6</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌ (partially)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VK_NV_compute_shader_derivatives, VK_KHR_shader_atomic_int64</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
    <!--
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
    -->
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
