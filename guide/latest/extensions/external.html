<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>External Memory and Synchronization :: Vulkan Documentation Project Demo</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Vulkan Documentation Project Demo</a>
      <div class="navbar-item">
        <img alt="Vulkan White Label" src="../../../_/Vulkan_White_Dec16.svg" height="100%" />
      </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label for="search-input"></label><input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../spec/latest/chapters/introduction.html">Vulkan 1.3</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../guide/latest/index.html">Vulkan Guide</a>
          </div>
        </div>
            <!--
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tools</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">TBD</a>
          </div>
        </div>
            -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tutorial</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../tutorial/latest/index.html">Vulkan Tutorial</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Samples</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../samples/latest/README.html">Vulkan Samples</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Help</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://khr.io/khrdiscord">Khronos Discord</a>
          </div>
        </div>
            <!--
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
            -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="guide" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Vulkan Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Vulkan Guide</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Logistics Overview</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what_is_vulkan.html">What is Vulkan?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what_vulkan_can_do.html">What Vulkan Can Do</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vulkan_spec.html">Vulkan Specification</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../platforms.html">Platforms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../checking_for_support.html">Checking For Vulkan Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../versions.html">Versions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vulkan_release_summary.html">Vulkan Release Summary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what_is_spirv.html">What is SPIR-V</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../portability_initiative.html">Portability Initiative</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vulkan_cts.html">Vulkan CTS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development_tools.html">Development Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../validation_overview.html">Vulkan Validation Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../decoder_ring.html">Vulkan Decoder Ring</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Using Vulkan</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../loader.html">Loader</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../layers.html">Layers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../querying_extensions_features.html">Querying Properties, Extensions, Features, Limits, and Formats</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enabling_extensions.html">Enabling Extensions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enabling_features.html">Enabling Features</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spirv_extensions.html">Using SPIR-V Extensions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../formats.html">Formats</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queues.html">Queues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../wsi.html">Window System Integration (WSI)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pnext_and_stype.html">pNext and sType</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../synchronization.html">Synchronization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_synchronization2.html">VK_KHR_synchronization2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../memory_allocation.html">Memory Allocation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sparse_resources.html">Sparse Resources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../protected.html">Protected Memory</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pipeline_cache.html">Pipeline Cache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../threading.html">Threading</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../depth.html">Depth</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mapping_data_to_shaders.html">Mapping Data to Shaders</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vertex_input_data_processing.html">Vertex Input Data Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../descriptor_dynamic_offset.html">Descriptor Dynamic Offset</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../push_constants.html">Push Constants</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../robustness.html">Robustness</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dynamic_state.html">Pipeline Dynamic State</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../subgroups.html">Subgroups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../shader_memory_layout.html">Shader Memory Layout</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../atomics.html">Atomics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../common_pitfalls.html">Common Pitfalls for New Vulkan Developers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hlsl.html">HLSL in Vulkan</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">When and Why to use Extensions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cleanup.html">Cleanup Extensions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="device_groups.html">Device Groups</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="external.html">External Memory and Synchronization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ray_tracing.html">Ray Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="shader_features.html">Shader Features</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="translation_layer_extensions.html">Translation Layer Extensions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_descriptor_indexing.html">VK_EXT_descriptor_indexing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_inline_uniform_block.html">VK_EXT_inline_uniform_block</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_memory_priority.html">VK_EXT_memory_priority</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_descriptor_update_template.html">VK_KHR_descriptor_update_template</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_draw_indirect_count.html">VK_KHR_draw_indirect_count</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_image_format_list.html">VK_KHR_image_format_list</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_imageless_framebuffer.html">VK_KHR_imageless_framebuffer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_sampler_ycbcr_conversion.html">VK_KHR_sampler_ycbcr_conversion</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_subgroup_uniform_control_flow.html">VK_KHR_shader_subgroup_uniform_control_flow</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Vulkan Guide</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../tutorial/latest/00_Introduction.html">Khronos Vulkan Tutorial</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tutorial/latest/00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Vulkan Guide</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../samples/latest/README.html">Vulkan Samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/latest/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../spec/latest/index.html">Vulkan Specification and Proposals</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../spec/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../spec/latest/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Vulkan Guide</a></li>
    <li>When and Why to use Extensions</li>
    <li><a href="external.html">External Memory and Synchronization</a></li>
  </ul>
</nav>
    <!--
  <div class="edit-this-page"><a href="https://github.com/KhronosGroup/Vulkan-Guide/edit/main/antora/modules/ROOT/pages/extensions/external.adoc">Edit this Page</a></div>
      -->
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">External Memory and Synchronization</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes not everything an application does related to the GPU is done in Vulkan. There are various situations where memory is written or read outside the scope of Vulkan. To support these use cases a set of external memory and synchronization functions was created</p>
</div>
<div class="paragraph">
<p>The list of extensions involved are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_KHR_external_fence</code></p>
<div class="ulist">
<ul>
<li>
<p>Promoted to core in 1.1</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>VK_KHR_external_fence_capabilities</code></p>
<div class="ulist">
<ul>
<li>
<p>Promoted to core in 1.1</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>VK_KHR_external_memory</code></p>
<div class="ulist">
<ul>
<li>
<p>Promoted to core in 1.1</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>VK_KHR_external_memory_capabilities</code></p>
<div class="ulist">
<ul>
<li>
<p>Promoted to core in 1.1</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>VK_KHR_external_semaphore</code></p>
<div class="ulist">
<ul>
<li>
<p>Promoted to core in 1.1</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>VK_KHR_external_semaphore_capabilities</code></p>
<div class="ulist">
<ul>
<li>
<p>Promoted to core in 1.1</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>VK_KHR_external_fence_fd</code></p>
</li>
<li>
<p><code>VK_KHR_external_fence_win32</code></p>
</li>
<li>
<p><code>VK_KHR_external_memory_fd</code></p>
</li>
<li>
<p><code>VK_KHR_external_memory_win32</code></p>
</li>
<li>
<p><code>VK_KHR_external_semaphore_fd</code></p>
</li>
<li>
<p><code>VK_KHR_external_semaphore_win32</code></p>
</li>
<li>
<p><code>VK_ANDROID_external_memory_android_hardware_buffer</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This seems like a lot so let&#8217;s break it down little by little.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_capabilities"><a class="anchor" href="#_capabilities"></a>Capabilities</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>VK_KHR_external_fence_capabilities</code>, <code>VK_KHR_external_semaphore_capabilities</code>, and <code>VK_KHR_external_memory_capabilities</code> are simply just ways to query information about what external support an implementation provides.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_memory_vs_synchronization"><a class="anchor" href="#_memory_vs_synchronization"></a>Memory vs Synchronization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is a set of extensions to handle the importing/exporting of just the memory itself. The other set extensions are for the synchronization primitives (<code>VkFence</code> and <code>VkSemaphore</code>) used to control internal Vulkan commands. It is common practice that for each piece of memory imported/exported there is also a matching fence/semaphore to manage the memory access.</p>
</div>
<div class="sect2">
<h3 id="_memory"><a class="anchor" href="#_memory"></a>Memory</h3>
<div class="paragraph">
<p>The <code>VK_KHR_external_memory</code> extension is mainly to provide the <code>VkExternalMemoryHandleTypeFlagBits</code> enum which describes the type of memory being used externally.</p>
</div>
<div class="paragraph">
<p>There are currently 3 supported ways to import/export memory</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_KHR_external_memory_fd</code> for memory in a POSIX file descriptor</p>
</li>
<li>
<p><code>VK_KHR_external_memory_win32</code> for memory in a Windows handle</p>
</li>
<li>
<p><code>VK_ANDROID_external_memory_android_hardware_buffer</code> for memory in a AHardwareBuffer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these methods has their own detailed descriptions about limitations, requirements, ownership, etc.</p>
</div>
<div class="sect3">
<h4 id="_importing_memory"><a class="anchor" href="#_importing_memory"></a>Importing Memory</h4>
<div class="paragraph">
<p>To import memory, there is a <code>VkImport*Info</code> struct provided by the given external memory extension. This is passed into <code>vkAllocateMemory</code> where Vulkan will now have a <code>VkDeviceMemory</code> handle that maps to the imported memory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_exporting_memory"><a class="anchor" href="#_exporting_memory"></a>Exporting Memory</h4>
<div class="paragraph">
<p>To export memory, there is a <code>VkGetMemory*</code> function provided by the given external memory extension. This function will take in a <code>VkDeviceMemory</code> handle and then map that to the extension exposed object.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_synchronization"><a class="anchor" href="#_synchronization"></a>Synchronization</h3>
<div class="paragraph">
<p>External synchronization can be used in Vulkan for both <code>VkFence</code> and <code>VkSemaphores</code>. There is almost no difference between the two with regards to how it is used to import and export them.</p>
</div>
<div class="paragraph">
<p>The <code>VK_KHR_external_fence</code> and <code>VK_KHR_external_semaphore</code> extension both expose a <code>Vk*ImportFlagBits</code> enum and <code>VkExport*CreateInfo</code> struct to describe the type a synchronization being imported/exported.</p>
</div>
<div class="paragraph">
<p>There are currently 2 supported ways to import/export synchronization</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_KHR_external_fence_fd</code> / <code>VK_KHR_external_semaphore_fd</code></p>
</li>
<li>
<p><code>VK_KHR_external_fence_win32</code> / <code>VK_KHR_external_semaphore_win32</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each extension explains how it manages ownership of the synchronization primitives.</p>
</div>
<div class="sect3">
<h4 id="_importing_and_exporting_synchronization_primitives"><a class="anchor" href="#_importing_and_exporting_synchronization_primitives"></a>Importing and Exporting Synchronization Primitives</h4>
<div class="paragraph">
<p>There is a <code>VkImport*</code> function for importing and a <code>VkGet*</code> function for exporting. These both take the <code>VkFence</code>/<code>VkSemaphores</code> handle passed in along with the extension&#8217;s method of defining the external synchronization object.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example"><a class="anchor" href="#_example"></a>Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here is a simple diagram showing the timeline of events between Vulkan and some other API talking to the GPU. This is used to represent a common use case for these external memory and synchronization extensions.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/extensions/external_example.png" alt="external_example.png">
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
    <!--
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
    -->
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
