<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Vulkan Documentation Project Demo</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">Vulkan Documentation Project Demo</a>
      <div class="navbar-item">
        <img alt="Vulkan White Label" src="../../../../_/Vulkan_White_Dec16.svg" height="100%" />
      </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label for="search-input"></label><input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../spec/latest/chapters/introduction.html">Vulkan 1.3</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../guide/latest/index.html">Vulkan Guide</a>
          </div>
        </div>
            <!--
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tools</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">TBD</a>
          </div>
        </div>
            -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tutorial</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../tutorial/latest/index.html">Vulkan Tutorial</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Samples</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../samples/latest/README.html">Vulkan Samples</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Help</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://khr.io/khrdiscord">Khronos Discord</a>
          </div>
        </div>
            <!--
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
            -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="tutorial" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../00_Introduction.html">Khronos Vulkan Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../00_Introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../01_Overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../02_Development_environment.html">Development environment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../00_Setup/00_Base_code.html">Drawing a triangle</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../00_Setup/00_Base_code.html">Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../00_Setup/00_Base_code.html">Base Code</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../00_Setup/01_Instance.html">Instance</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../00_Setup/02_Validation_layers.html">Validation layers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../00_Setup/03_Physical_devices_and_queue_families.html">Physical devices and queue families</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../00_Setup/04_Logical_device_and_queues.html">Logical device and queues</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../01_Presentation/00_Window_surface.html">Presentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../01_Presentation/00_Window_surface.html">Window surface</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../01_Presentation/01_Swap_chain.html">Swap chain</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../01_Presentation/02_Image_views.html">Image views</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../02_Graphics_pipeline_basics/00_Introduction.html">Graphics pipeline basics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../02_Graphics_pipeline_basics/00_Introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../02_Graphics_pipeline_basics/01_Shader_modules.html">Shader modules</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../02_Graphics_pipeline_basics/02_Fixed_functions.html">Fixed functions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../02_Graphics_pipeline_basics/03_Render_passes.html">Render passes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../02_Graphics_pipeline_basics/04_Conclusion.html">Conclusion</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="00_Framebuffers.html">Drawing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="00_Framebuffers.html">Framebuffers</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="01_Command_buffers.html">Command buffers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="02_Rendering_and_presentation.html">Rendering and presentation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03_Frames_in_flight.html">Frames in flight</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04_Swap_chain_recreation.html">Swap chain recreation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../04_Vertex_buffers/00_Vertex_input_description.html">Vertex buffers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../04_Vertex_buffers/00_Vertex_input_description.html">Vertex input description</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../04_Vertex_buffers/01_Vertex_buffer_creation.html">Vertex buffer creation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../04_Vertex_buffers/02_Staging_buffer.html">Staging buffer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../04_Vertex_buffers/03_Index_buffer.html">Index buffer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../05_Uniform_buffers/00_Descriptor_layout_and_buffer.html">Uniform buffers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../05_Uniform_buffers/00_Descriptor_layout_and_buffer.html">Descriptor layout and buffer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../05_Uniform_buffers/01_Descriptor_pool_and_sets.html">Descriptor pool and sets</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../06_Texture_mapping/00_Images.html">Texture mapping</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../06_Texture_mapping/00_Images.html">Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../06_Texture_mapping/01_Image_view_and_sampler.html">Image view and sampler</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../06_Texture_mapping/02_Combined_image_sampler.html">Combined image sampler</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../07_Depth_buffering.html">Depth buffering</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../08_Loading_models.html">Loading models</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../09_Generating_Mipmaps.html">Generating Mipmaps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../10_Multisampling.html">Multisampling</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../11_Compute_Shader.html">Compute Shader</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../90_FAQ.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Khronos Vulkan Tutorial</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../00_Introduction.html">Khronos Vulkan Tutorial</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../guide/latest/index.html">Vulkan Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../spec/latest/index.html">Vulkan Specification and Proposals</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../spec/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../spec/latest/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../00_Introduction.html">Khronos Vulkan Tutorial</a></li>
    <li><a href="../00_Setup/00_Base_code.html">Drawing a triangle</a></li>
    <li><a href="00_Framebuffers.html">Drawing</a></li>
    <li><a href="01_Command_buffers.html">Command buffers</a></li>
  </ul>
</nav>
    <!--
  <div class="edit-this-page"><a href="https://github.com/KhronosGroup/Vulkan-Tutorial/edit/main/antora/modules/ROOT/pages/03_Drawing_a_triangle/03_Drawing/01_Command_buffers.adoc">Edit this Page</a></div>
      -->
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="paragraph">
<p>Commands in Vulkan, like drawing operations and memory transfers, are not executed directly using function calls.
You have to record all of the operations you want to perform in command buffer objects.
The advantage of this is that when we are ready to tell the Vulkan what we want to do, all of the commands are submitted together and Vulkan can more efficiently process the commands since all of them are available together.
In addition, this allows command recording to happen in multiple threads if so desired.</p>
</div>
<div class="sect1">
<h2 id="_command_pools"><a class="anchor" href="#_command_pools"></a>Command pools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have to create a command pool before we can create command buffers.
Command pools manage the memory that is used to store the buffers and command buffers are allocated from them.
Add a new class member to store a <code>VkCommandPool</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">VkCommandPool commandPool;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then create a new function <code>createCommandPool</code> and call it from <code>initVulkan</code> after the framebuffers were created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">void initVulkan() {
    createInstance();
    setupDebugMessenger();
    createSurface();
    pickPhysicalDevice();
    createLogicalDevice();
    createSwapChain();
    createImageViews();
    createRenderPass();
    createGraphicsPipeline();
    createFramebuffers();
    createCommandPool();
}

...

void createCommandPool() {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Command pool creation only takes two parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">QueueFamilyIndices queueFamilyIndices = findQueueFamilies(physicalDevice);

VkCommandPoolCreateInfo poolInfo{};
poolInfo.sType = VK_STRUCTURE_TYPE_COMMAND_POOL_CREATE_INFO;
poolInfo.flags = VK_COMMAND_POOL_CREATE_RESET_COMMAND_BUFFER_BIT;
poolInfo.queueFamilyIndex = queueFamilyIndices.graphicsFamily.value();</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two possible flags for command pools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_COMMAND_POOL_CREATE_TRANSIENT_BIT</code>: Hint that command buffers are rerecorded with new commands very often (may change memory allocation behavior)</p>
</li>
<li>
<p><code>VK_COMMAND_POOL_CREATE_RESET_COMMAND_BUFFER_BIT</code>: Allow command buffers to be rerecorded individually, without this flag they all have to be reset together</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will be recording a command buffer every frame, so we want to be able to reset and rerecord over it.
Thus, we need to set the <code>VK_COMMAND_POOL_CREATE_RESET_COMMAND_BUFFER_BIT</code> flag bit for our command pool.</p>
</div>
<div class="paragraph">
<p>Command buffers are executed by submitting them on one of the device queues, like the graphics and presentation queues we retrieved.
Each command pool can only allocate command buffers that are submitted on a single type of queue.
We&#8217;re going to record commands for drawing, which is why we&#8217;ve chosen the graphics queue family.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">if (vkCreateCommandPool(device, &amp;poolInfo, nullptr, &amp;commandPool) != VK_SUCCESS) {
    throw std::runtime_error("failed to create command pool!");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finish creating the command pool using the <code>vkCreateCommandPool</code> function.
It doesn&#8217;t have any special parameters.
Commands will be used throughout the program to draw things on the screen, so the pool should only be destroyed at the end:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">void cleanup() {
    vkDestroyCommandPool(device, commandPool, nullptr);

    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_command_buffer_allocation"><a class="anchor" href="#_command_buffer_allocation"></a>Command buffer allocation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can now start allocating command buffers.</p>
</div>
<div class="paragraph">
<p>Create a <code>VkCommandBuffer</code> object as a class member.
Command buffers will be automatically freed when their command pool is destroyed, so we don&#8217;t need explicit cleanup.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">VkCommandBuffer commandBuffer;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll now start working on a <code>createCommandBuffer</code> function to allocate a single command buffer from the command pool.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">void initVulkan() {
    createInstance();
    setupDebugMessenger();
    createSurface();
    pickPhysicalDevice();
    createLogicalDevice();
    createSwapChain();
    createImageViews();
    createRenderPass();
    createGraphicsPipeline();
    createFramebuffers();
    createCommandPool();
    createCommandBuffer();
}

...

void createCommandBuffer() {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Command buffers are allocated with the <code>vkAllocateCommandBuffers</code> function, which takes a <code>VkCommandBufferAllocateInfo</code> struct as parameter that specifies the command pool and number of buffers to allocate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">VkCommandBufferAllocateInfo allocInfo{};
allocInfo.sType = VK_STRUCTURE_TYPE_COMMAND_BUFFER_ALLOCATE_INFO;
allocInfo.commandPool = commandPool;
allocInfo.level = VK_COMMAND_BUFFER_LEVEL_PRIMARY;
allocInfo.commandBufferCount = 1;

if (vkAllocateCommandBuffers(device, &amp;allocInfo, &amp;commandBuffer) != VK_SUCCESS) {
    throw std::runtime_error("failed to allocate command buffers!");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>level</code> parameter specifies if the allocated command buffers are primary or secondary command buffers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_COMMAND_BUFFER_LEVEL_PRIMARY</code>: Can be submitted to a queue for execution, but cannot be called from other command buffers.</p>
</li>
<li>
<p><code>VK_COMMAND_BUFFER_LEVEL_SECONDARY</code>: Cannot be submitted directly, but can be called from primary command buffers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We won&#8217;t make use of the secondary command buffer functionality here, but you can imagine that it&#8217;s helpful to reuse common operations from primary command buffers.</p>
</div>
<div class="paragraph">
<p>Since we are only allocating one command buffer, the <code>commandBufferCount</code> parameter is just one.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_command_buffer_recording"><a class="anchor" href="#_command_buffer_recording"></a>Command buffer recording</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ll now start working on the <code>recordCommandBuffer</code> function that writes the commands we want to execute into a command buffer.
The <code>VkCommandBuffer</code> used will be passed in as a parameter, as well as the index of the current swapchain image we want to write to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">void recordCommandBuffer(VkCommandBuffer commandBuffer, uint32_t imageIndex) {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We always begin recording a command buffer by calling <code>vkBeginCommandBuffer</code> with a small <code>VkCommandBufferBeginInfo</code> structure as argument that specifies some details about the usage of this specific command buffer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">VkCommandBufferBeginInfo beginInfo{};
beginInfo.sType = VK_STRUCTURE_TYPE_COMMAND_BUFFER_BEGIN_INFO;
beginInfo.flags = 0; // Optional
beginInfo.pInheritanceInfo = nullptr; // Optional

if (vkBeginCommandBuffer(commandBuffer, &amp;beginInfo) != VK_SUCCESS) {
    throw std::runtime_error("failed to begin recording command buffer!");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>flags</code> parameter specifies how we&#8217;re going to use the command buffer.
The following values are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_COMMAND_BUFFER_USAGE_ONE_TIME_SUBMIT_BIT</code>: The command buffer will be rerecorded right after executing it once.</p>
</li>
<li>
<p><code>VK_COMMAND_BUFFER_USAGE_RENDER_PASS_CONTINUE_BIT</code>: This is a secondary command buffer that will be entirely within a single render pass.</p>
</li>
<li>
<p><code>VK_COMMAND_BUFFER_USAGE_SIMULTANEOUS_USE_BIT</code>: The command buffer can be resubmitted while it is also already pending execution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>None of these flags are applicable for us right now.</p>
</div>
<div class="paragraph">
<p>The <code>pInheritanceInfo</code> parameter is only relevant for secondary command buffers.
It specifies which state to inherit from the calling primary command buffers.</p>
</div>
<div class="paragraph">
<p>If the command buffer was already recorded once, then a call to <code>vkBeginCommandBuffer</code> will implicitly reset it.
It&#8217;s not possible to append commands to a buffer at a later time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_starting_a_render_pass"><a class="anchor" href="#_starting_a_render_pass"></a>Starting a render pass</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Drawing starts by beginning the render pass with <code>vkCmdBeginRenderPass</code>.
The render pass is configured using some parameters in a <code>VkRenderPassBeginInfo</code> struct.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">VkRenderPassBeginInfo renderPassInfo{};
renderPassInfo.sType = VK_STRUCTURE_TYPE_RENDER_PASS_BEGIN_INFO;
renderPassInfo.renderPass = renderPass;
renderPassInfo.framebuffer = swapChainFramebuffers[imageIndex];</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first parameters are the render pass itself and the attachments to bind.
We created a framebuffer for each swap chain image where it is specified as a color attachment.
Thus we need to bind the framebuffer for the swapchain image we want to draw to.
Using the imageIndex parameter which was passed in, we can pick the right framebuffer for the current swapchain image.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">renderPassInfo.renderArea.offset = {0, 0};
renderPassInfo.renderArea.extent = swapChainExtent;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next two parameters define the size of the render area.
The render area defines where shader loads and stores will take place.
The pixels outside this region will have undefined values.
It should match the size of the attachments for best performance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">VkClearValue clearColor = {{{0.0f, 0.0f, 0.0f, 1.0f}}};
renderPassInfo.clearValueCount = 1;
renderPassInfo.pClearValues = &amp;clearColor;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last two parameters define the clear values to use for <code>VK_ATTACHMENT_LOAD_OP_CLEAR</code>, which we used as load operation for the color attachment.
I&#8217;ve defined the clear color to simply be black with 100% opacity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">vkCmdBeginRenderPass(commandBuffer, &amp;renderPassInfo, VK_SUBPASS_CONTENTS_INLINE);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The render pass can now begin.
All of the functions that record commands can be recognized by their <code>vkCmd</code> prefix.
They all return <code>void</code>, so there will be no error handling until we&#8217;ve finished recording.</p>
</div>
<div class="paragraph">
<p>The first parameter for every command is always the command buffer to record the command to.
The second parameter specifies the details of the render pass we&#8217;ve just provided.
The final parameter controls how the drawing commands within the render pass will be provided.
It can have one of two values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUBPASS_CONTENTS_INLINE</code>: The render pass commands will be embedded in the primary command buffer itself and no secondary command buffers will be executed.</p>
</li>
<li>
<p><code>VK_SUBPASS_CONTENTS_SECONDARY_COMMAND_BUFFERS</code>: The render pass commands will be executed from secondary command buffers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will not be using secondary command buffers, so we&#8217;ll go with the first option.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_drawing_commands"><a class="anchor" href="#_basic_drawing_commands"></a>Basic drawing commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can now bind the graphics pipeline:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">vkCmdBindPipeline(commandBuffer, VK_PIPELINE_BIND_POINT_GRAPHICS, graphicsPipeline);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second parameter specifies if the pipeline object is a graphics or compute pipeline.
We&#8217;ve now told Vulkan which operations to execute in the graphics pipeline and which attachment to use in the fragment shader.</p>
</div>
<div class="paragraph">
<p>As noted in the <a href="../02_Graphics_pipeline_basics/02_Fixed_functions.md#dynamic-state">fixed functions chapter</a>,  we did specify viewport and scissor state for this pipeline to be dynamic.
So we need to set them in the command buffer before issuing our draw command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">VkViewport viewport{};
viewport.x = 0.0f;
viewport.y = 0.0f;
viewport.width = static_cast&lt;float&gt;(swapChainExtent.width);
viewport.height = static_cast&lt;float&gt;(swapChainExtent.height);
viewport.minDepth = 0.0f;
viewport.maxDepth = 1.0f;
vkCmdSetViewport(commandBuffer, 0, 1, &amp;viewport);

VkRect2D scissor{};
scissor.offset = {0, 0};
scissor.extent = swapChainExtent;
vkCmdSetScissor(commandBuffer, 0, 1, &amp;scissor);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are ready to issue the draw command for the triangle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">vkCmdDraw(commandBuffer, 3, 1, 0, 0);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The actual <code>vkCmdDraw</code> function is a bit anticlimactic, but it&#8217;s so simple because of all the information we specified in advance.
It has the following parameters, aside from the command buffer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>vertexCount</code>: Even though we don&#8217;t have a vertex buffer, we technically still have 3 vertices to draw.</p>
</li>
<li>
<p><code>instanceCount</code>: Used for instanced rendering, use <code>1</code> if you&#8217;re not doing that.</p>
</li>
<li>
<p><code>firstVertex</code>: Used as an offset into the vertex buffer, defines the lowest value of <code>gl_VertexIndex</code>.</p>
</li>
<li>
<p><code>firstInstance</code>: Used as an offset for instanced rendering, defines the lowest value of <code>gl_InstanceIndex</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_finishing_up"><a class="anchor" href="#_finishing_up"></a>Finishing up</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The render pass can now be ended:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">vkCmdEndRenderPass(commandBuffer);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we&#8217;ve finished recording the command buffer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">if (vkEndCommandBuffer(commandBuffer) != VK_SUCCESS) {
    throw std::runtime_error("failed to record command buffer!");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the next chapter we&#8217;ll write the code for the main loop, which will acquire an image from the swap chain, record and execute a command buffer, then return the finished image to the swap chain.</p>
</div>
<div class="paragraph">
<p><a href="../../_attachments/14_command_buffers.cpp">C&#43;&#43; code</a> / <a href="../../_attachments/09_shader_base.vert">Vertex shader</a> / <a href="../../_attachments/09_shader_base.frag">Fragment shader</a></p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
    <!--
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
    -->
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
  </body>
</html>
