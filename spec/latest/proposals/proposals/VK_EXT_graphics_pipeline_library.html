<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VK_EXT_graphics_pipeline_library :: Vulkan Documentation Project Demo</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">Vulkan Documentation Project Demo</a>
      <div class="navbar-item">
        <img alt="Vulkan White Label" src="../../../../_/Vulkan_White_Dec16.svg" height="100%" />
      </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label for="search-input"></label><input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../spec/latest/chapters/introduction.html">Vulkan 1.3</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../guide/latest/index.html">Vulkan Guide</a>
          </div>
        </div>
            <!--
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tools</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">TBD</a>
          </div>
        </div>
            -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tutorial</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../tutorial/latest/index.html">Vulkan Tutorial</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Samples</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../samples/latest/README.html">Vulkan Samples</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Help</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://khr.io/khrdiscord">Khronos Discord</a>
          </div>
        </div>
            <!--
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
            -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="spec" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Vulkan Specification and Proposals</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/fundamentals.html">Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/initialization.html">Initialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/devsandqueues.html">Devices and Queues</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/cmdbuffers.html">Command Buffers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/synchronization.html">Synchronization and Cache Control</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/renderpass.html">Render Pass</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/shaders.html">Shaders</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/pipelines.html">Pipelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/memory.html">Memory Allocation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/resources.html">Resource Creation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/samplers.html">Samplers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/descriptorsets.html">Resource Descriptors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/interfaces.html">Shader Interfaces</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/textures.html">Image Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/fragmentdensitymapops.html">Fragment Density Map Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/queries.html">Queries</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/clears.html">Clear Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/copies.html">Copy Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/drawing.html">Drawing Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/fxvertex.html">Fixed-Function Vertex Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/tessellation.html">Tessellation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/geometry.html">Geometry Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_NV_mesh_shader/mesh.html">Mesh Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_HUAWEI_cluster_culling_shader/clusterculling.html">Cluster Culling Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/vertexpostproc.html">Fixed-Function Vertex Post-Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/primsrast.html">Rasterization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/fragops.html">Fragment Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/framebuffer.html">The Framebuffer</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/dispatch.html">Dispatching Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_NV_device_generated_commands/generatedcommands.html">Device-Generated Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/sparsemem.html">Sparse Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_KHR_surface/wsi.html">Window System Integration (WSI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_KHR_deferred_host_operations/deferred_host_operations.html">Deferred Host Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_EXT_private_data.html">Private Data</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/accelstructures.html">Acceleration Structures</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_EXT_opacity_micromap/micromaps.html">Micromap</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/raytraversal.html">Ray Traversal</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/raytracing.html">Ray Tracing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_NV_memory_decompression.html">Memory Decompression</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/video_extensions.html">Video Coding</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_NV_optical_flow/optical_flow.html">Optical Flow</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/extensions.html">Extending Vulkan</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/limits.html">Limits</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/formats.html">Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/capabilities.html">Additional Capabilities</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/debugging.html">Debugging</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/spirvenv.html">Vulkan Environment for SPIR-V</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/memorymodel.html">Memory Model</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/compressedtex.html">Compressed Image Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/versions.html">Core Revisions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/extensions.html">Layers &amp; Extensions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/roadmap.html">Vulkan Roadmap Milestones</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/boilerplate.html">API Boilerplate</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/invariance.html">Invariance</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/glossary.html">Lexicon</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/credits.html">Credits (Informative)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Vulkan Proposals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Vulkan Roadmap</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Roadmap.html">Vulkan Roadmap</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extension Proposals</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_AMD_shader_early_and_late_fragment_tests.html">VK_AMD_shader_early_and_late_fragment_tests</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_attachment_feedback_loop_layout.html">VK_EXT_attachment_feedback_loop_layout</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="VK_EXT_graphics_pipeline_library.html">VK_EXT_graphics_pipeline_library</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_image_2d_array_of_3d.html">VK_EXT_image_2d_array_of_3d</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_image_compression_control.html">VK_EXT_image_compression_control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_metal_objects.html">VK_EXT_metal_objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_multisampled_render_to_single_sampled.html">VK_EXT_multisampled_render_to_single_sampled</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_non_seamless_cube_map.html">VK_EXT_non_seamless_cube_map</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_primitives_generated_query.html">VK_EXT_primitives_generated_query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_rasterization_order_attachment_access.html">VK_EXT_rasterization_order_attachment_access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_shader_module_identifier.html">VK_EXT_shader_module_identifier</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_subpass_merge_feedback.html">VK_EXT_subpass_merge_feedback</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_GOOGLE_surfaceless_query.html">VK_GOOGLE_surfaceless_query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_HUAWEI_invocation_mask.html">VK_HUAWEI_invocation_mask</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_dynamic_rendering.html">VK_KHR_dynamic_rendering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_fragment_shader_barycentric.html">VK_KHR_fragment_shader_barycentric</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_fragment_shading_rate.html">VK_KHR_fragment_shading_rate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_integer_dot_product.html">VK_KHR_shader_integer_dot_product</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_QCOM_image_processing.html">VK_QCOM_image_processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_QCOM_tile_properties.html">VK_QCOM_tile_properties</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extension Proposal Template</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="template.html">Proposal Template</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Vulkan Specification and Proposals</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../../tutorial/latest/00_Introduction.html">Khronos Vulkan Tutorial</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../tutorial/latest/00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../guide/latest/index.html">Vulkan Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../samples/latest/README.html">Vulkan Samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../samples/latest/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../index.html">Vulkan Specification and Proposals</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Vulkan Specification and Proposals</a></li>
    <li>Extension Proposals</li>
    <li><a href="VK_EXT_graphics_pipeline_library.html">VK_EXT_graphics_pipeline_library</a></li>
  </ul>
</nav>
    <!--
  <div class="edit-this-page"><a href="https://github.com/KhronosGroup/Vulkan-Docs/edit/main/antora/modules/proposals/pages/proposals/VK_EXT_graphics_pipeline_library.adoc">Edit this Page</a></div>
      -->
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">VK_EXT_graphics_pipeline_library</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_problem_statement">1. Problem Statement</a></li>
<li><a href="#_solution_space">2. Solution Space</a></li>
<li><a href="#_proposal">3. Proposal</a>
<ul class="sectlevel2">
<li><a href="#_prior_art_vk_ext_pipeline_library">3.1. Prior Art: VK_EXT_pipeline_library</a></li>
<li><a href="#_features">3.2. Features</a></li>
<li><a href="#_properties">3.3. Properties</a></li>
<li><a href="#_dividing_up_the_graphics_state">3.4. Dividing up the graphics state</a></li>
<li><a href="#_pipeline_layouts">3.5. Pipeline Layouts</a></li>
<li><a href="#_linking">3.6. Linking</a></li>
<li><a href="#_deprecating_shader_modules">3.7. Deprecating shader modules</a></li>
</ul>
</li>
<li><a href="#_examples">4. Examples</a>
<ul class="sectlevel2">
<li><a href="#_compilation">4.1. Compilation</a></li>
<li><a href="#_linking_2">4.2. Linking</a></li>
</ul>
</li>
<li><a href="#_issues">5. Issues</a>
<ul class="sectlevel2">
<li><a href="#_resolved_should_the_pre_rasterization_stages_be_separated">5.1. RESOLVED: Should the pre-rasterization stages be separated?</a></li>
<li><a href="#_resolved_what_is_the_expected_usage_model">5.2. RESOLVED: What is the expected usage model?</a></li>
<li><a href="#_resolved_why_is_there_suggested_behavior_for_the_implementation_of_pipeline_caches_instead_of_letting_the_caching_be_driven_by_the_application">5.3. RESOLVED: Why is there suggested behavior for the implementation of pipeline caches instead of letting the caching be driven by the application?</a></li>
<li><a href="#_resolved_what_are_the_downsides_to_using_unoptimized_pipelines">5.4. RESOLVED: What are the downsides to using unoptimized pipelines?</a></li>
<li><a href="#_resolved_are_there_any_interactions_with_specialization_constants">5.5. RESOLVED: Are there any interactions with specialization constants?</a></li>
<li><a href="#_resolved_are_there_any_interface_matching_requirements_that_will_need_to_change_like_ssos_in_opengles">5.6. RESOLVED: Are there any interface matching requirements that will need to change, like SSOs in OpenGL/ES?</a></li>
<li><a href="#_resolved_should_we_allow_passing_spir_v_directly_into_pipeline_creation">5.7. RESOLVED: Should we allow passing SPIR-V directly into pipeline creation?</a></li>
<li><a href="#_resolved_should_we_advertise_a_property_for_free_link_vs_fast_link">5.8. RESOLVED: Should we advertise a property for “free link” vs. “fast link”?</a></li>
<li><a href="#_resolved_does_anyone_need_the_depthstencil_format_to_be_provided_with_the_depth_bias_state">5.9. RESOLVED: Does anyone need the depth/stencil format to be provided with the depth bias state?</a></li>
<li><a href="#_resolved_with_the_recommendation_to_create_an_optimized_pipeline_as_well_as_a_fast_linked_pipeline_will_this_lead_to_additional_memory_consumption">5.10. RESOLVED: With the recommendation to create an optimized pipeline as well as a fast linked pipeline, will this lead to additional memory consumption?</a></li>
<li><a href="#_resolved_should_the_link_time_optimization_bits_apply_to_other_pipeline_libraries_e_g_ray_tracing">5.11. RESOLVED: Should the link time optimization bits apply to other pipeline libraries (e.g. ray tracing)?</a></li>
<li><a href="#_resolved_does_the_shader_module_deprecation_apply_to_other_pipelines">5.12. RESOLVED: Does the shader module deprecation apply to other pipelines?</a></li>
<li><a href="#_resolved_should_vkpipelinedepthstencilstatecreateinfo_be_part_of_the_fragment_shader_state_or_fragment_output_interface_state">5.13. RESOLVED: Should <code>VkPipelineDepthStencilStateCreateInfo</code> be part of the fragment shader state or fragment output interface state?</a></li>
<li><a href="#_resolved_should_vkpipelinemultisamplestatecreateinfo_be_required_even_when_the_fragment_shader_does_not_make_use_of_multisampling_shader_features">5.14. RESOLVED: Should <code>VkPipelineMultisampleStateCreateInfo</code> be required, even when the fragment shader does not make use of multisampling shader features?</a></li>
<li><a href="#_resolved_should_vkpipelinemultisamplestatecreateinfo_be_part_of_the_fragment_output_interface_instead">5.15. RESOLVED: Should <code>VkPipelineMultisampleStateCreateInfo</code> be part of the fragment output interface instead?</a></li>
<li><a href="#_resolved_should_we_add_an_explicit_result_code_to_pipeline_creation_to_indicate_that_a_pipeline_compiled_with_link_time_optimization_has_been_returned">5.16. RESOLVED: Should we add an explicit result code to pipeline creation to indicate that a pipeline compiled with link time optimization has been returned?</a></li>
<li><a href="#_resolved_can_pipeline_caches_return_optimized_pipelines_without_the_vk_pipeline_layout_create_independent_sets_bit_ext_set">5.17. RESOLVED: Can pipeline caches return optimized pipelines without the <code>VK_PIPELINE_LAYOUT_CREATE_INDEPENDENT_SETS_BIT_EXT</code> set?</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document outlines a proposal to allow partial compilation of portions
of pipelines, improving the performance of pipeline compilation for
applications that have large numbers of materials, large amounts of
dynamic state, or continuously stream in new material definitions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_problem_statement"><a class="anchor" href="#_problem_statement"></a>1. Problem Statement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The original promise of monolithic pipelines in Vulkan was to enable
developers to construct all their state up front, avoiding the driver doing
dynamic compilation and patching shaders implicitly when recording draw
calls, resulting in unexpected hitches.</p>
</div>
<div class="paragraph">
<p>The reality however is that for many game engines, requiring most of this state up front
either fails to eliminate hitching,
or requires precompiling so many state combinations that the size of the
pipeline cache is nearly unmanageable.</p>
</div>
<div class="paragraph">
<p>Games engines are typically still managing enormous sets of state and
shader combinations, and this is not a purely technical problem.
It is still expected and encouraged that developers will limit the number
of these, but it doesn’t change the fact that at least in the
short-to-mid-term, developers are having real problems that can’t be solved by
telling them to reduce the number of pipelines.</p>
</div>
<div class="paragraph">
<p>This proposal does not aim to fully solve these issues, but instead provides
a key piece of infrastructure required to solve it.
The main aim of this proposal is to reduce the cost of loading novel state
and shader combinations within the rendering loop, thus avoiding hitching.</p>
</div>
<div class="paragraph">
<p>An additional constraint to be aware of is that any solution should not
regress the intended wins from moving to pipeline objects – there should be
no need for late-compilation or patching that is performed <strong>implicitly</strong> by
the implementation.
An expectation of any solution here is that GPU performance may suffer
due to sub-optimal linking, and the solution should provide a way to mitigate this.
Explicit late compilation or patching may be acceptable, but it should be
simple to perform, and applications should have control over when and how
it is done.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_solution_space"><a class="anchor" href="#_solution_space"></a>2. Solution Space</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following options have been considered:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Handle this inside the implementation</p>
</li>
<li>
<p>Additional dynamic state</p>
</li>
<li>
<p>Separately compiled pipeline/state blobs</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Handling this inside the implementation would potentially solve the problem
for the class of apps that have this issue.
However, it takes the choice of fast-linking vs. whole program optimization
away from the application.
It also means fighting with drivers and performance guidelines to hit the
right usage to trigger it on each implementation.</p>
</div>
<div class="paragraph">
<p>As for dynamic state, it is likely that the list of state that is fully dynamic
across implementations has been all but exhausted at this point.
While vendors can choose to expose additional dynamic state as they see
fit, solving this problem portably needs a different solution.
Vendors trying to implement state that isn’t dynamic as if it were dynamic
will end up doing implicit work at command recording time, leading
inevitably to implicit compilation or patching of shaders – which is
undesirable.</p>
</div>
<div class="paragraph">
<p>Separately compiling chunks of state (e.g. individual shaders, vertex
inputs, render passes) allows for applications to individually compile
these chunks as they show up.
Enough information should be given in this early step that linking these
chunks together later has significant cost savings and can be done at record time
if necessary.
Implementations could “cheat” at separate chunk compilation by exposing
this extension by keeping the create information until the final link
step and compiling everything at once then.
In general it is desirable for implementations to avoid late compilation, but this
does allow the extension to be implemented more widely (including via a software layer),
providing better consistency for developers.
Explicitly advertising this detail could allow developers to make better
choices about how and when these pipelines are compiled.</p>
</div>
<div class="paragraph">
<p>This proposal focuses on option 3 – providing applications with the ability
to separately compile state chunks and later link them together.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proposal"><a class="anchor" href="#_proposal"></a>3. Proposal</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_prior_art_vk_ext_pipeline_library"><a class="anchor" href="#_prior_art_vk_ext_pipeline_library"></a>3.1. Prior Art: VK_EXT_pipeline_library</h3>
<div class="paragraph">
<p>For <a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VK_KHR_ray_tracing.html">VK_KHR_ray_tracing</a>, pipelines
contain a significant number of shaders - making monolithic compilation
very slow.
<a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VK_KHR_pipeline_library.html">VK_KHR_pipeline_library</a> allowed
applications to create partial pipelines (pipeline libraries) containing
only a subset of the final shaders.
These pipeline libraries can be linked together to form a final executable.
Ray pipelines were relatively straightforward as only shaders are linked,
and there’s no “state” for ray shaders beyond the shader groups.</p>
</div>
<div class="paragraph">
<p>Graphics pipelines by comparison contain a lot of static state that needs
to be separated carefully, retaining any “interface” information.
However, this extension reuses the same underlying mechanism.</p>
</div>
</div>
<div class="sect2">
<h3 id="_features"><a class="anchor" href="#_features"></a>3.2. Features</h3>
<div class="paragraph">
<p>The following feature is exposed by this extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkPhysicalDeviceGraphicsPipelineLibraryFeaturesEXT {
    VkStructureType    sType;
    void*              pNext;
    VkBool32           graphicsPipelineLibrary;
} VkPhysicalDeviceGraphicsPipelineLibraryFeaturesEXT;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>graphicsPipelineLibrary</code> is the core feature enabling this
functionality.</p>
</div>
</div>
<div class="sect2">
<h3 id="_properties"><a class="anchor" href="#_properties"></a>3.3. Properties</h3>
<div class="paragraph">
<p>The following properties are exposed by this extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkPhysicalDeviceGraphicsPipelineLibraryPropertiesEXT {
    VkStructure sType;
    void*       pNext;
    VkBool32    graphicsPipelineLibraryFastLinking;
    VkBool32    graphicsPipelineLibraryIndependentInterpolationDecoration;
} VkPhysicalDeviceGraphicsPipelineLibraryPropertiesEXT;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>graphicsPipelineLibraryFastLinking</code> indicates whether the cost of
linking pipelines without <code>VK_PIPELINE_CREATE_LINK_TIME_OPTIMIZATION_BIT_EXT</code>
is comparable to recording a command in a command buffer, such that
applications can link pipelines on demand while recording commands.
If this property is not supported, linking should still be cheaper than
a full pipeline compilation.</p>
</div>
<div class="paragraph">
<p>If <code>graphicsPipelineLibraryIndependentInterpolationDecoration</code> is not
supported, applications must provide matching interpolation decorations in
both the last geometry stage and the fragment stage; if it is supported,
any geometry stage decorations are ignored.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dividing_up_the_graphics_state"><a class="anchor" href="#_dividing_up_the_graphics_state"></a>3.4. Dividing up the graphics state</h3>
<div class="paragraph">
<p>Four sets of state that have been identified as often recombined by
applications are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Vertex Input Interface</p>
</li>
<li>
<p>Pre-rasterization</p>
</li>
<li>
<p>Post-rasterization</p>
</li>
<li>
<p>Fragment Output Interface (including blend state)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The intent is to allow each of those to be independently compiled as far as
possible, along with relevant pieces of state that may need to match for
the final linked pipeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkGraphicsPipelineLibraryCreateInfoEXT {
    VkStructureType                      sType;
    void*                                pNext;
    VkGraphicsPipelineLibraryFlagsEXT    flags;
} VkGraphicsPipelineLibraryCreateInfoEXT;

typedef enum VkGraphicsPipelineLibraryFlagBitsEXT {
    VK_GRAPHICS_PIPELINE_LIBRARY_VERTEX_INPUT_INTERFACE_BIT_EXT = 0x00000001,
    VK_GRAPHICS_PIPELINE_LIBRARY_PRE_RASTERIZATION_SHADERS_BIT_EXT = 0x00000002,
    VK_GRAPHICS_PIPELINE_LIBRARY_FRAGMENT_SHADER_BIT_EXT = 0x00000004,
    VK_GRAPHICS_PIPELINE_LIBRARY_FRAGMENT_OUTPUT_INTERFACE_BIT_EXT = 0x00000008,
} VkGraphicsPipelineLibraryFlagBitsEXT;

typedef VkFlags VkGraphicsPipelineLibraryFlagsEXT;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pipeline libraries are created for the parts specified, and any parameters
required to create a library with those parts must be provided.</p>
</div>
<div class="paragraph">
<p>For all pipeline libraries
<a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineCache.html">VkPipelineCache</a>, <code>basePipelineHandle</code>,
<code>basePipelineIndex</code>,
<a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineCreationFeedbackCreateInfo.html">VkPipelineCreationFeedbackCreateInfo</a>,
and
<a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineCompilerControlCreateInfoAMD.html">VkPipelineCompilerControlCreateInfoAMD</a>
parameters are independently consumed and do not need to match between
libraries or for any final pipeline.
<a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineCreateFlags.html">VkPipelineCreateFlags</a> are also
independent, though <code>VK_PIPELINE_CREATE_LIBRARY_BIT_KHR</code> is required for
all pipeline libraries.
Only dynamic states that affect state consumed by a library are used,
other dynamic states are ignored and play no part in linked pipelines.
Where multiple pipeline libraries are built with the same required piece of
state, those states must match exactly when linked together.</p>
</div>
<div class="paragraph">
<p>The subset of
<a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkGraphicsPipelineCreateInfo.html">VkGraphicsPipelineCreateInfo</a>
used to compile each kind of pipeline library is listed in the following
sections, along with any pitfalls, quirks, or interactions that need
calling out.
Any state not explicitly listed for a particular library part will be
ignored when compiling that part.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>There is no change to dynamic state, so if state can be made dynamic, it
doesn’t need to be present when compiling a pipeline library part if it is
specified as dynamic.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The following section is a complete list only at time of writing - see the
specification for a more up-to-date list.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_vertex_input_interface"><a class="anchor" href="#_vertex_input_interface"></a>3.4.1. Vertex Input Interface</h4>
<div class="paragraph">
<p>A vertex input interface library is defined by the following state:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineVertexInputStateCreateInfo.html">VkPipelineVertexInputStateCreateInfo</a></p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineInputAssemblyStateCreateInfo.html">VkPipelineInputAssemblyStateCreateInfo</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_pre_rasterization_shaders"><a class="anchor" href="#_pre_rasterization_shaders"></a>3.4.2. Pre-Rasterization Shaders</h4>
<div class="paragraph">
<p>A pre-rasterization shader library is defined by the following state:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A valid <a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineShaderStageCreateInfo.html">VkPipelineShaderStageCreateInfo</a>
for each pre-rasterization shader stage used</p>
</li>
<li>
<p>Within the <a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineLayout.html">VkPipelineLayout</a>, all
descriptor sets with pre-rasterization shader bindings if
<code>VK_PIPELINE_LAYOUT_CREATE_INDEPENDENT_SETS_BIT_EXT</code> was specified.</p>
<div class="ulist">
<ul>
<li>
<p>If <code>VK_PIPELINE_LAYOUT_CREATE_INDEPENDENT_SETS_BIT_EXT</code> was not specified,
the full pipeline layout must be specified.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineViewportStateCreateInfo.html">VkPipelineViewportStateCreateInfo</a></p>
<div class="ulist">
<ul>
<li>
<p>However, all the functionality in that structure is dynamic other than
the flags, and this extension allows the structure to be omitted such
that it is as-if it was zero-initialized.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineRasterizationStateCreateInfo.html">VkPipelineRasterizationStateCreateInfo</a></p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineTessellationStateCreateInfo.html">VkPipelineTessellationStateCreateInfo</a>
is required if tessellation stages are included.</p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkRenderPass.html">VkRenderPass</a> and <code>subpass</code> parameter</p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineRenderingCreateInfo.html">VkPipelineRenderingCreateInfo</a> for the <code>viewMask</code> parameter - formats are ignored.</p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineDiscardRectangleStateCreateInfoEXT.html">VkPipelineDiscardRectangleStateCreateInfoEXT</a></p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineFragmentShadingRateStateCreateInfoKHR.html">VkPipelineFragmentShadingRateStateCreateInfoKHR</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_fragment_shader"><a class="anchor" href="#_fragment_shader"></a>3.4.3. Fragment Shader</h4>
<div class="paragraph">
<p>A fragment shader library is defined by the following state:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A valid <a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineShaderStageCreateInfo.html">VkPipelineShaderStageCreateInfo</a>
for the fragment shader stage.</p>
</li>
<li>
<p>Within the <a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineLayout.html">VkPipelineLayout</a>, all
descriptor sets with fragment shader bindings if
<code>VK_PIPELINE_LAYOUT_CREATE_INDEPENDENT_SETS_BIT_EXT</code> was specified.</p>
<div class="ulist">
<ul>
<li>
<p>If <code>VK_PIPELINE_LAYOUT_CREATE_INDEPENDENT_SETS_BIT_EXT</code> was not specified,
the full pipeline layout must be specified.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineMultisampleStateCreateInfo.html">VkPipelineMultisampleStateCreateInfo</a>
if sample shading is enabled or <code>renderpass</code> is not <code>VK_NULL_HANDLE</code>.</p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineDepthStencilStateCreateInfo.html">VkPipelineDepthStencilStateCreateInfo</a></p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkRenderPass.html">VkRenderPass</a> and <code>subpass</code> parameter</p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineRenderingCreateInfo.html">VkPipelineRenderingCreateInfo</a> for the <code>viewMask</code> parameter - formats are ignored.</p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineFragmentShadingRateStateCreateInfoKHR.html">VkPipelineFragmentShadingRateStateCreateInfoKHR</a></p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineFragmentShadingRateEnumStateCreateInfoNV.html">VkPipelineFragmentShadingRateEnumStateCreateInfoNV</a></p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineRepresentativeFragmentTestStateCreateInfoNV.html">VkPipelineRepresentativeFragmentTestStateCreateInfoNV</a></p>
</li>
<li>
<p>Inclusion/omission of the
<code>VK_PIPELINE_RASTERIZATION_STATE_CREATE_FRAGMENT_SHADING_RATE_ATTACHMENT_BIT_KHR</code>
flag</p>
</li>
<li>
<p>Inclusion/omission of the
<code>VK_PIPELINE_RASTERIZATION_STATE_CREATE_FRAGMENT_DENSITY_MAP_ATTACHMENT_BIT_EXT</code>
flag</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_fragment_output_interface"><a class="anchor" href="#_fragment_output_interface"></a>3.4.4. Fragment Output Interface</h4>
<div class="paragraph">
<p>A fragment output interface library is defined by the following state:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineColorBlendStateCreateInfo.html">VkPipelineColorBlendStateCreateInfo</a></p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineMultisampleStateCreateInfo.html">VkPipelineMultisampleStateCreateInfo</a></p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkRenderPass.html">VkRenderPass</a> and <code>subpass</code> parameter</p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineRenderingCreateInfo.html">VkPipelineRenderingCreateInfo</a></p>
</li>
<li>
<p><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkAttachmentSampleCountInfoAMD.html">VkAttachmentSampleCountInfoAMD/NV</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_interactions_with_extensions"><a class="anchor" href="#_interactions_with_extensions"></a>3.4.5. Interactions with extensions</h4>
<div class="paragraph">
<p>The required structures for each pipeline subset include anything in the <code>pNext</code>
chains of the listed structures; any extensions to these structures are thus
implicitly accounted for unless otherwise stated.
includes anything in the <code>pNext</code> chains of those structures, so any
extensions that extend these structures will be automatically accounted for.
If any extension allows parts of
<a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkGraphicsPipelineCreateInfo.html">VkGraphicsPipelineCreateInfo</a>
to be ignored, by default that part of the state will also be ignored when
using graphics pipeline libraries.
Any extension that extends the base
<a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkGraphicsPipelineCreateInfo.html">VkGraphicsPipelineCreateInfo</a>
directly, or otherwise differs from the above implicit interactions, will
need an explicit interaction.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pipeline_layouts"><a class="anchor" href="#_pipeline_layouts"></a>3.5. Pipeline Layouts</h3>
<div class="paragraph">
<p>To allow descriptor sets to be independently specified for each of the two shader library types, a new pipeline layout create flag is added:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef enum VkPipelineLayoutCreateFlagBits {
    VK_PIPELINE_LAYOUT_CREATE_INDEPENDENT_SETS_BIT_EXT = 0x00000002
} VkPipelineLayoutCreateFlagBits;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When specified, fragment and pre-rasterization shader pipeline libraries only need to specify the descriptor sets used by that library.
Descriptor set layouts unused by a library may be set to <code>VK_NULL_HANDLE</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_linking"><a class="anchor" href="#_linking"></a>3.6. Linking</h3>
<div class="paragraph">
<p>Linking is performed by including the existing
<a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineLibraryCreateInfoKHR.html">VkPipelineLibraryCreateInfoKHR</a> structure in the pNext chain of
<a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkGraphicsPipelineCreateInfo.html">VkGraphicsPipelineCreateInfo</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkPipelineLibraryCreateInfoKHR {
    VkStructureType      sType;
    const void*          pNext;
    uint32_t             libraryCount;
    const VkPipeline*    pLibraries;
} VkPipelineLibraryCreateInfoKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Libraries can be linked into other libraries recursively while there are
still state blobs that can be linked together.
E.g an application could create a library for the vertex input interface
and pre-rasterization shaders separately, then link them into a new
library.</p>
</div>
<div class="paragraph">
<p>A newly created graphics pipeline consists of the parts defined by
linked libraries, plus those defined by
<a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkGraphicsPipelineLibraryCreateInfoEXT.html">VkGraphicsPipelineLibraryCreateInfoEXT</a>.
Parts specified in the pipeline must not overlap those defined by
libraries, and similarly multiple libraries must not provide the same
parts.
Any state required by multiple parts must match.</p>
</div>
<div class="paragraph">
<p>Graphics pipelines that contain a full set of libraries are executable, may
not be used for further linking, and must not have the
<code>VK_PIPELINE_CREATE_LIBRARY_BIT_KHR</code> set.
Graphics pipelines that contain only a subset of stages are not executable,
may be used for further linking, and must have
<code>VK_PIPELINE_CREATE_LIBRARY_BIT_KHR</code> set.</p>
</div>
<div class="paragraph">
<p>If <code>rasterizerDiscardEnable</code> is enabled, the complete set of parts does
not include fragment shader or fragment output interface
libraries.</p>
</div>
<div class="paragraph">
<p>Two additional bits control how linking is performed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_PIPELINE_CREATE_RETAIN_LINK_TIME_OPTIMIZATION_INFO_BIT_EXT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_CREATE_LINK_TIME_OPTIMIZATION_BIT_EXT</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>VK_PIPELINE_CREATE_LINK_TIME_OPTIMIZATION_BIT_EXT</code> allows applications
to specify that linking should perform an optimization pass; when this bit
is specified, additional optimizations will be performed at link time, and
the resulting pipeline should perform equivalently to a pipeline created
monolithically.</p>
</div>
<div class="paragraph">
<p>To perform link time optimizations,
<code>VK_PIPELINE_CREATE_RETAIN_LINK_TIME_OPTIMIZATION_INFO_BIT_EXT</code> must be
specified on all pipeline libraries that are being linked together.
Implementations should retain any additional information needed to perform
optimizations at the final link step when this bit is present.</p>
</div>
<div class="paragraph">
<p>If the application created the final linked pipeline with pipeline layouts
including the <code>VK_PIPELINE_LAYOUT_CREATE_INDEPENDENT_SETS_BIT_EXT</code> flag,
the final linked pipeline layout is the union of the layouts provided for
shader stages.
However, in the specific case that a final link is being performed between
stages and <code>VK_PIPELINE_CREATE_LINK_TIME_OPTIMIZATION_BIT_EXT</code> is specified,
the application can override the pipeline layout with one that is compatible
with that union but does not have the
<code>VK_PIPELINE_LAYOUT_CREATE_INDEPENDENT_SETS_BIT_EXT</code> flag set, allowing a
more optimal pipeline layout to be used when generating the final pipeline.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deprecating_shader_modules"><a class="anchor" href="#_deprecating_shader_modules"></a>3.7. Deprecating shader modules</h3>
<div class="paragraph">
<p>To make single-shader compilation consistent, shader modules will be
deprecated by allowing <a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkShaderModuleCreateInfo.html">VkShaderModuleCreateInfo</a> to be chained to
<a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineShaderStageCreateInfo.html">VkPipelineShaderStageCreateInfo</a>, and allowing the
<a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkShaderModule.html">VkShaderModule</a> to be <a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VK_NULL_HANDLE.html">VK_NULL_HANDLE</a> in this case.
Applications can continue to use shader modules as they are not
being removed; but it’s strongly recommended to not use them.
The primary reason for this would be to allow bypassing what is in many
cases a useless copy, along with potential wasted storage if they are
retained.
There have been previous efforts to allow shader modules to be precompiled
in some way, but this functionality is now being made available in a more
reliable and portably agreed way, negating the need to focus efforts in
this area moving forward.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples"><a class="anchor" href="#_examples"></a>4. Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_compilation"><a class="anchor" href="#_compilation"></a>4.1. Compilation</h3>
<div class="paragraph">
<p>Initial compilation can now be organised into separate chunks, allowing
consistent earlier compilation for applications that have this information
available separately, and potentially allows more multithreading
opportunities for applications that do not.</p>
</div>
<div class="paragraph">
<p>Below is an example of the information needed to compile a vertex shader:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">VkPipeline createVertexShader(
    VkDevice device,
    const uint32_t* pShader,
    size_t shaderSize,
    VkPipelineCache vertexShaderCache,
    VkPipelineLayout layout)
{
    VkShaderModuleCreateInfo shaderModuleCreateInfo{};
    shaderModuleCreateInfo.sType = VK_STRUCTURE_TYPE_SHADER_MODULE_CREATE_INFO;
    shaderModuleCreateInfo.codeSize = shaderSize;
    shaderModuleCreateInfo.pCode = pShader;

    VkGraphicsPipelineLibraryCreateInfoEXT libraryInfo{};
    libraryInfo.sType = VK_STRUCTURE_TYPE_GRAPHICS_PIPELINE_LIBRARY_CREATE_INFO_EXT;
    libraryInfo.flags = VK_GRAPHICS_PIPELINE_LIBRARY_PRE_RASTERIZATION_SHADERS_BIT_EXT;

    VkPipelineShaderStageCreateInfo stageCreateInfo{};
    stageCreateInfo.sType = VK_STRUCTURE_TYPE_PIPELINE_SHADER_STAGE_CREATE_INFO;
    stageCreateInfo.pNext = &amp;shaderModuleCreateInfo;
    stageCreateInfo.stage = VK_SHADER_STAGE_VERTEX_BIT;
    stageCreateInfo.pName = "main";

    VkDynamicState vertexDynamicStates[2] = {
        VK_DYNAMIC_STATE_VIEWPORT_WITH_COUNT_EXT,
        VK_DYNAMIC_STATE_SCISSOR_WITH_COUNT_EXT };

    VkPipelineDynamicStateCreateInfo dynamicInfo{};
    dynamicInfo.sType = VK_STRUCTURE_TYPE_PIPELINE_DYNAMIC_STATE_CREATE_INFO;
    dynamicInfo.dynamicStateCount = 2;
    dynamicInfo.pDynamicStates = vertexDynamicStates;

    VkGraphicsPipelineCreateInfo vertexShaderCreateInfo{};
    vertexShaderCreateInfo.sType = VK_STRUCTURE_TYPE_GRAPHICS_PIPELINE_CREATE_INFO;
    vertexShaderCreateInfo.pNext = &amp;libraryInfo;
    vertexShaderCreateInfo.flags = VK_PIPELINE_CREATE_LIBRARY_BIT_KHR |
        VK_PIPELINE_CREATE_RETAIN_LINK_TIME_OPTIMIZATION_INFO_BIT_EXT;
    vertexShaderCreateInfo.stageCount = 1;
    vertexShaderCreateInfo.pStages = &amp;stageCreateInfo;
    vertexShaderCreateInfo.layout = layout;
    vertexShaderCreateInfo.pDynamicState = &amp;dynamicInfo;

    VkPipeline vertexShader;
    vkCreateGraphicsPipelines(
        device, vertexShaderCache, 1, &amp;vertexShaderCreateInfo, NULL, &amp;vertexShader);

    return vertexShader;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>This example makes use of
<a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VK_KHR_dynamic_rendering.html">VK_KHR_dynamic_rendering</a> to
avoid render pass interactions.
If that extension is not available, a render pass object and the
corresponding subpass will also need to be provided.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_linking_2"><a class="anchor" href="#_linking_2"></a>4.2. Linking</h3>
<div class="paragraph">
<p>Linking is relatively straightforward - pipeline libraries in, executable
pipeline out, with the option of optimizing the pipeline or not.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">VkPipeline linkExecutable(
    VkDevice device,
    VkPipeline* pLibraries,
    size_t libraryCount,
    VkPipelineCache executableCache,
    bool optimized)
{
    VkPipelineLibraryCreateInfoKHR linkingInfo{};
    linkingInfo.sType = VK_STRUCTURE_TYPE_PIPELINE_LIBRARY_CREATE_INFO_KHR;
    linkingInfo.libraryCount = libraryCount;
    linkingInfo.pLibraries = pLibraries;

    VkGraphicsPipelineCreateInfo executablePipelineCreateInfo{};
    executablePipelineCreateInfo.sType = VK_STRUCTURE_TYPE_GRAPHICS_PIPELINE_CREATE_INFO;
    executablePipelineCreateInfo.pNext = &amp;linkingInfo;
    executablePipelineCreateInfo.flags |= optimized ?
        VK_PIPELINE_CREATE_LINK_TIME_OPTIMIZATION_BIT_EXT : 0;

    VkPipeline executable = VK_NULL_HANDLE;

    vkCreateGraphicsPipelines(
        device, executableCache, 1, &amp; executablePipelineCreateInfo, NULL, &amp;executable);

    return executable;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The behavior of the pipeline cache in this scenario is subject to specific
behavior depending on implementation properties and whether fast or
optimized linking is being used.
This is spelled out in the spec, but summarised briefly again here:</p>
</div>
<div class="paragraph">
<p>If fast linking is being performed, the implementation should only lookup
into the cache if it is expected that will be faster than linking.
If linking is faster, then the cache lookup and any writes to the cache should be skipped.
The aim of this is to ensure that fast linking is always as fast as
possible.
If a cache lookup is performed, optimized pipelines in the cache should be
returned preferentially to any fast-linked pipelines.</p>
</div>
<div class="paragraph">
<p>If optimized linking is being performed, the implementation should not
generate a hit on a suboptimal fast linked pipeline, instead creating a new
pipeline and corresponding cache entry.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_issues"><a class="anchor" href="#_issues"></a>5. Issues</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_resolved_should_the_pre_rasterization_stages_be_separated"><a class="anchor" href="#_resolved_should_the_pre_rasterization_stages_be_separated"></a>5.1. RESOLVED: Should the pre-rasterization stages be separated?</h3>
<div class="paragraph">
<p>While splitting the geometry stages may be possible, it’s a significant
amount of additional work for many vendors, the advantage for most
developers is unclear, and it would be difficult to make some of the
guarantees in this extension.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_what_is_the_expected_usage_model"><a class="anchor" href="#_resolved_what_is_the_expected_usage_model"></a>5.2. RESOLVED: What is the expected usage model?</h3>
<div class="paragraph">
<p>When a novel shader/stage combination is seen that requires compilation, it
should be compiled into a separate pipeline library as early as possible;
this should be possible alongside usual material/object loading
(e.g. texture/mesh streaming).
If an application has its own material cache, the library should be cached
there.
Applications should still use pipeline caches to amortize compilation
across similar stage blobs but should avoid mixing different stage types in
the same <a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineCache.html">VkPipelineCache</a>, to avoid unnecessary lookup overhead.</p>
</div>
<div class="paragraph">
<p>Basic linking should then be done as early as the application is able.
Applications should ideally store/cache this pipeline with relevant objects.
Using a <a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VkPipelineCache.html">VkPipelineCache</a> for this suboptimal pipeline is recommended;
implementations where this would provide no benefit should ignore the cache
lookup request for fast linking.</p>
</div>
<div class="paragraph">
<p>Once a basic link is done, the application should schedule a task for a
separate thread to create an optimized pipeline.
This should use pipeline caches in the same manner as existing monolithic
compilation, sharing this cache with fast-linked pipelines.
Implementations should prefer returning optimized pipelines from these
caches.
Applications should switch to the optimized pipeline as soon as they are
available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_why_is_there_suggested_behavior_for_the_implementation_of_pipeline_caches_instead_of_letting_the_caching_be_driven_by_the_application"><a class="anchor" href="#_resolved_why_is_there_suggested_behavior_for_the_implementation_of_pipeline_caches_instead_of_letting_the_caching_be_driven_by_the_application"></a>5.3. RESOLVED: Why is there suggested behavior for the implementation of pipeline caches instead of letting the caching be driven by the application?</h3>
<div class="paragraph">
<p>Work to change the way pipelines are cached is ongoing; to avoid scope creep
the minimum set of features required to ensure things worked were added.
A future extension may change how a lot of this works, so it was undesirable to
design something that would be thrown away later.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_what_are_the_downsides_to_using_unoptimized_pipelines"><a class="anchor" href="#_resolved_what_are_the_downsides_to_using_unoptimized_pipelines"></a>5.4. RESOLVED: What are the downsides to using unoptimized pipelines?</h3>
<div class="paragraph">
<p>A fast-linked pipeline may have a significant device performance penalty
compared to the final pipeline on some implementations.
Some vendors may have a negligible performance penalty; others will have
performance penalties differing based on which shader stages are compiled
together.
A rough estimate given by vendors is that it could be as bad as a 50%
penalty in the general case, with outliers performing even worse.</p>
</div>
<div class="paragraph">
<p>As general advice, applications should be aiming to keep the amount of work
in each frame performed by unoptimized pipelines relatively low (&lt;10%);
profiling may be necessary to identify problematic areas.
Developers are strongly encouraged create optimized pipelines as soon as
they are able to replace the linked pipeline.
Relying completely on fast linked pipelines could result in unacceptable
performance degradation on some implementations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_are_there_any_interactions_with_specialization_constants"><a class="anchor" href="#_resolved_are_there_any_interactions_with_specialization_constants"></a>5.5. RESOLVED: Are there any interactions with specialization constants?</h3>
<div class="paragraph">
<p>No. This extension doesn’t change how specialization constants work – they
work as they do for existing pipelines.
If they’re provided, implementations are free to specialize the pipeline or
not, and cache pipelines that are specialized, unspecialized, or both.
Specialization constants must be provided alongside the shader stages using
them and cannot be provided at link time.
This may be something we want to address in a future extension.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_are_there_any_interface_matching_requirements_that_will_need_to_change_like_ssos_in_opengles"><a class="anchor" href="#_resolved_are_there_any_interface_matching_requirements_that_will_need_to_change_like_ssos_in_opengles"></a>5.6. RESOLVED: Are there any interface matching requirements that will need to change, like SSOs in OpenGL/ES?</h3>
<div class="paragraph">
<p>Some implementations require the interpolation decorations in the last
geometry shader stage if pipeline libraries are used, and this is
advertised by the
<code>graphicsPipelineLibraryIndependentInterpolationDecoration</code> property.
It is expected that these implementations are serving markets where OpenGL
ES is dominant, where this requirement was never dropped for separate
shader objects, unlike OpenGL.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_we_allow_passing_spir_v_directly_into_pipeline_creation"><a class="anchor" href="#_resolved_should_we_allow_passing_spir_v_directly_into_pipeline_creation"></a>5.7. RESOLVED: Should we allow passing SPIR-V directly into pipeline creation?</h3>
<div class="paragraph">
<p>Yes. This simplifies compilation, avoids an unnecessary copy, and brings developers and implementations onto the same page.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_we_advertise_a_property_for_free_link_vs_fast_link"><a class="anchor" href="#_resolved_should_we_advertise_a_property_for_free_link_vs_fast_link"></a>5.8. RESOLVED: Should we advertise a property for “free link” vs. “fast link”?</h3>
<div class="paragraph">
<p>Yes, as developers may want to adjust the way they manage pipelines.
If linking is more or less free, the expectation is that applications may
link pipelines on demand when recording draw calls.
If linking is going to take more time, they may try to more aggressively
pre-cache pipelines.
This has been added as the <code>graphicsPipelineLibraryFastLinking</code>
property.</p>
</div>
<div class="paragraph">
<p>Implementation and developer guidance is that if this feature bit is
advertised, applications should be able to link on demand, so the cost of
linking should be comparable to recording commands in a command buffer.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_does_anyone_need_the_depthstencil_format_to_be_provided_with_the_depth_bias_state"><a class="anchor" href="#_resolved_does_anyone_need_the_depthstencil_format_to_be_provided_with_the_depth_bias_state"></a>5.9. RESOLVED: Does anyone need the depth/stencil format to be provided with the depth bias state?</h3>
<div class="paragraph">
<p>The depth format affects how depth bias is applied, but these are currently provided in separate parts of the pipeline.
Nobody has claimed this to be a problem.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_with_the_recommendation_to_create_an_optimized_pipeline_as_well_as_a_fast_linked_pipeline_will_this_lead_to_additional_memory_consumption"><a class="anchor" href="#_resolved_with_the_recommendation_to_create_an_optimized_pipeline_as_well_as_a_fast_linked_pipeline_will_this_lead_to_additional_memory_consumption"></a>5.10. RESOLVED: With the recommendation to create an optimized pipeline as well as a fast linked pipeline, will this lead to additional memory consumption?</h3>
<div class="paragraph">
<p>Caches containing pipeline libraries will necessarily increase the total memory consumption of compiled pipelines, as applications will generally try to keep these available while pipeline could be streamed in/out.
Implementations may be able to use data in the library caches for the final pipelines in some circumstances, which could help mitigate it - but this is not guaranteed and will vary by vendor.</p>
</div>
<div class="paragraph">
<p>Fast-linked pipelines should not contribute to the total memory consumption if applications destroy the fast-linked pipeline once an optimized version exists.</p>
</div>
<div class="paragraph">
<p>Improvements to pipeline caches allowing selective eviction of individual caches could help with memory management here, but as this intersects with other known pipeline cache problems, this should be dealt with in a separate extension.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_the_link_time_optimization_bits_apply_to_other_pipeline_libraries_e_g_ray_tracing"><a class="anchor" href="#_resolved_should_the_link_time_optimization_bits_apply_to_other_pipeline_libraries_e_g_ray_tracing"></a>5.11. RESOLVED: Should the link time optimization bits apply to other pipeline libraries (e.g. ray tracing)?</h3>
<div class="paragraph">
<p>Yes, but it will not necessarily be subject to the same quality guarantees. Ray tracing pipeline libraries were not designed with this directly in mind, so while implementations should make use of these bits as best they can, it is not possible to make the same quality guarantees as for graphics pipelines.</p>
</div>
<div class="paragraph">
<p>Any future extensions using the pipeline library interface should be aware of these interactions and try to follow the intent of these bits as much as possible.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_does_the_shader_module_deprecation_apply_to_other_pipelines"><a class="anchor" href="#_resolved_does_the_shader_module_deprecation_apply_to_other_pipelines"></a>5.12. RESOLVED: Does the shader module deprecation apply to other pipelines?</h3>
<div class="paragraph">
<p>Yes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_vkpipelinedepthstencilstatecreateinfo_be_part_of_the_fragment_shader_state_or_fragment_output_interface_state"><a class="anchor" href="#_resolved_should_vkpipelinedepthstencilstatecreateinfo_be_part_of_the_fragment_shader_state_or_fragment_output_interface_state"></a>5.13. RESOLVED: Should <code>VkPipelineDepthStencilStateCreateInfo</code> be part of the fragment shader state or fragment output interface state?</h3>
<div class="paragraph">
<p>Some vendors will make use of this information if it is available and would rather not see it move - however notably all of this state can be made dynamic. Applications wanting to avoid setting this state with the fragment shader library should use this dynamic state.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_vkpipelinemultisamplestatecreateinfo_be_required_even_when_the_fragment_shader_does_not_make_use_of_multisampling_shader_features"><a class="anchor" href="#_resolved_should_vkpipelinemultisamplestatecreateinfo_be_required_even_when_the_fragment_shader_does_not_make_use_of_multisampling_shader_features"></a>5.14. RESOLVED: Should <code>VkPipelineMultisampleStateCreateInfo</code> be required, even when the fragment shader does not make use of multisampling shader features?</h3>
<div class="paragraph">
<p>The fragment shader library only needs this information when sample shading is enabled.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_vkpipelinemultisamplestatecreateinfo_be_part_of_the_fragment_output_interface_instead"><a class="anchor" href="#_resolved_should_vkpipelinemultisamplestatecreateinfo_be_part_of_the_fragment_output_interface_instead"></a>5.15. RESOLVED: Should <code>VkPipelineMultisampleStateCreateInfo</code> be part of the fragment output interface instead?</h3>
<div class="paragraph">
<p>Moving it to the output interface removes the need to create multiple fragment shader libraries for different MSAA rates, which some applications do as a part of dynamic performance tuning.
This only works when used in conjunction with dynamic rendering; when render pass objects are used, the sample rate will effectively be sourced from any subpass attachments due to validation constraints.
This could be made to work with subpasses with no attachments, but the additional complexity of adding that path had no clear benefit, so is disallowed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_we_add_an_explicit_result_code_to_pipeline_creation_to_indicate_that_a_pipeline_compiled_with_link_time_optimization_has_been_returned"><a class="anchor" href="#_resolved_should_we_add_an_explicit_result_code_to_pipeline_creation_to_indicate_that_a_pipeline_compiled_with_link_time_optimization_has_been_returned"></a>5.16. RESOLVED: Should we add an explicit result code to pipeline creation to indicate that a pipeline compiled with link time optimization has been returned?</h3>
<div class="paragraph">
<p>No, as the complexity of handling this does not clearly translate to significant application wins.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_can_pipeline_caches_return_optimized_pipelines_without_the_vk_pipeline_layout_create_independent_sets_bit_ext_set"><a class="anchor" href="#_resolved_can_pipeline_caches_return_optimized_pipelines_without_the_vk_pipeline_layout_create_independent_sets_bit_ext_set"></a>5.17. RESOLVED: Can pipeline caches return optimized pipelines without the <code>VK_PIPELINE_LAYOUT_CREATE_INDEPENDENT_SETS_BIT_EXT</code> set?</h3>
<div class="paragraph">
<p>Not unconditionally - if an implementation does not do anything with that flag then yes, but there is a functional difference then it cannot. I.e. the same as other pipeline state.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
    <!--
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
    -->
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
  </body>
</html>
