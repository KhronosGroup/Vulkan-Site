<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Proposal: VK_EXT_frame_boundary :: Vulkan Documentation Project Demo</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../.."><img class="navbar-item" alt="Vulkan White Label" src="../../../../_/Vulkan_White_Dec16.svg" /></a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label for="search-input"></label><input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../spec/latest/chapters/introduction.html">Vulkan 1.3</a>
            <a class="navbar-item" href="https://registry.khronos.org/OpenGL/specs/gl/GLSLangSpec.4.60.html">GLSL</a>
            <a class="navbar-item" href="/guide/latest/hlsl.html">HLSL</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Education</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../guide/latest/index.html">Vulkan Guide</a>
            <a class="navbar-item" href="../../../../tutorial/latest/index.html">Vulkan Tutorial</a>
            <a class="navbar-item" href="../../../../samples/latest/README.html">Vulkan Samples</a>
            <a class="navbar-item" href="https://www.youtube.com/c/vulkan">YouTube</a>
            <a class="navbar-item" href="https://vulkan.org">More Info at Vulkan.org</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://reddit.com/r/vulkan">Reddit</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/vulkan">Stack Overflow</a>
            <a class="navbar-item" href="https://twitter.com/vulkanapi">X</a>
            <a class="navbar-item" href="https://fosstodon.org/@vulkan">Mastodon</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="spec" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Vulkan Specification and Proposals</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/fundamentals.html">Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/initialization.html">Initialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/devsandqueues.html">Devices and Queues</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/cmdbuffers.html">Command Buffers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/synchronization.html">Synchronization and Cache Control</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/renderpass.html">Render Pass</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/shaders.html">Shaders</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/pipelines.html">Pipelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/memory.html">Memory Allocation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/resources.html">Resource Creation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/samplers.html">Samplers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/descriptorsets.html">Resource Descriptors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/interfaces.html">Shader Interfaces</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/textures.html">Image Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/fragmentdensitymapops.html">Fragment Density Map Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/queries.html">Queries</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/clears.html">Clear Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/copies.html">Copy Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/drawing.html">Drawing Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/fxvertex.html">Fixed-Function Vertex Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/tessellation.html">Tessellation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/geometry.html">Geometry Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_NV_mesh_shader/mesh.html">Mesh Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_HUAWEI_cluster_culling_shader/clusterculling.html">Cluster Culling Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/vertexpostproc.html">Fixed-Function Vertex Post-Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/primsrast.html">Rasterization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/fragops.html">Fragment Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/framebuffer.html">The Framebuffer</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/dispatch.html">Dispatching Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_NV_device_generated_commands/generatedcommands.html">Device-Generated Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/sparsemem.html">Sparse Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_KHR_surface/wsi.html">Window System Integration (WSI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_KHR_deferred_host_operations/deferred_host_operations.html">Deferred Host Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_EXT_private_data.html">Private Data</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/accelstructures.html">Acceleration Structures</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_EXT_opacity_micromap/micromaps.html">Micromap</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/raytraversal.html">Ray Traversal</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/raytracing.html">Ray Tracing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_NV_memory_decompression.html">Memory Decompression</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/video_extensions.html">Video Coding</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/VK_NV_optical_flow/optical_flow.html">Optical Flow</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/extensions.html">Extending Vulkan</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/limits.html">Limits</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/formats.html">Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/capabilities.html">Additional Capabilities</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../chapters/debugging.html">Debugging</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/spirvenv.html">Vulkan Environment for SPIR-V</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/memorymodel.html">Memory Model</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/compressedtex.html">Compressed Image Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/versions.html">Core Revisions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/extensions.html">Layers &amp; Extensions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/roadmap.html">Vulkan Roadmap Milestones</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/boilerplate.html">API Boilerplate</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/invariance.html">Invariance</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/glossary.html">Lexicon</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/credits.html">Credits (Informative)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Vulkan Proposals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Vulkan Roadmap</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Roadmap.html">Vulkan Roadmap</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extension Proposals</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_AMD_shader_early_and_late_fragment_tests.html">VK_AMD_shader_early_and_late_fragment_tests</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_attachment_feedback_loop_layout.html">VK_EXT_attachment_feedback_loop_layout</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_graphics_pipeline_library.html">VK_EXT_graphics_pipeline_library</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_image_2d_array_of_3d.html">VK_EXT_image_2d_array_of_3d</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_image_compression_control.html">VK_EXT_image_compression_control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_metal_objects.html">VK_EXT_metal_objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_multisampled_render_to_single_sampled.html">VK_EXT_multisampled_render_to_single_sampled</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_non_seamless_cube_map.html">VK_EXT_non_seamless_cube_map</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_primitives_generated_query.html">VK_EXT_primitives_generated_query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_rasterization_order_attachment_access.html">VK_EXT_rasterization_order_attachment_access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_shader_module_identifier.html">VK_EXT_shader_module_identifier</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_subpass_merge_feedback.html">VK_EXT_subpass_merge_feedback</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_GOOGLE_surfaceless_query.html">VK_GOOGLE_surfaceless_query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_HUAWEI_invocation_mask.html">VK_HUAWEI_invocation_mask</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_dynamic_rendering.html">VK_KHR_dynamic_rendering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_fragment_shader_barycentric.html">VK_KHR_fragment_shader_barycentric</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_fragment_shading_rate.html">VK_KHR_fragment_shading_rate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_integer_dot_product.html">VK_KHR_shader_integer_dot_product</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_QCOM_image_processing.html">VK_QCOM_image_processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_QCOM_tile_properties.html">VK_QCOM_tile_properties</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extension Proposal Template</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="template.html">Proposal Template</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Vulkan Specification and Proposals</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../../tutorial/latest/00_Introduction.html">Khronos Vulkan Tutorial</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../tutorial/latest/00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../guide/latest/index.html">Vulkan Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../samples/latest/README.html">Vulkan Samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../samples/latest/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../index.html">Vulkan Specification and Proposals</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Vulkan Specification and Proposals</a></li>
    <li><a href="VK_EXT_frame_boundary.html">Proposal: <code>VK_EXT_frame_boundary</code></a></li>
  </ul>
</nav>
    <!--
  <div class="edit-this-page"><a href="https://github.com/KhronosGroup/Vulkan-Docs/edit/main/antora/modules/proposals/pages/proposals/VK_EXT_frame_boundary.adoc">Edit this Page</a></div>
      -->
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Proposal: <code>VK_EXT_frame_boundary</code></h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_problem_statement">Problem Statement</a>
<ul class="sectlevel2">
<li><a href="#_graphics_applications_bypassing_the_khronos_swapchain">Graphics applications bypassing the Khronos swapchain</a></li>
<li><a href="#_compute_only_applications">Compute-only applications</a></li>
<li><a href="#_overlapping_frames">Overlapping frames</a></li>
</ul>
</li>
<li><a href="#_solution_space">Solution Space</a></li>
<li><a href="#_proposal">Proposal</a>
<ul class="sectlevel2">
<li><a href="#_overview">Overview</a></li>
<li><a href="#_the_vkframeboundaryext_type">The <code>VkFrameBoundaryEXT</code> type</a></li>
<li><a href="#_validation">Validation</a></li>
</ul>
</li>
<li><a href="#_examples">Examples</a>
<ul class="sectlevel2">
<li><a href="#_compute_only">Compute-only</a></li>
<li><a href="#_graphics_sequential_frames_not_using_the_khr_swapchain">Graphics, sequential frames, not using the KHR swapchain</a></li>
<li><a href="#_overlapping_frames_with_wait_after_signal">Overlapping frames with wait-after-signal</a></li>
</ul>
</li>
<li><a href="#_issues">Issues</a>
<ul class="sectlevel2">
<li><a href="#_resolved_what_should_this_extension_be_named">RESOLVED: What should this extension be named?</a></li>
<li><a href="#_resolved_what_information_should_be_included_in_vkframeboundaryext">RESOLVED: What information should be included in VkFrameBoundaryEXT?</a></li>
<li><a href="#_resolved_how_should_frame_identifiers_be_validated">RESOLVED: How should frame identifiers be validated?</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><code>VK_EXT_frame_boundary</code> is a device extension that helps <strong>tools</strong> (such as
debuggers) to group queue submissions per frames in non-trivial scenarios,
typically when <code>vkQueuePresentKHR</code> is not a relevant frame boundary delimiter.</p>
</div>
<div class="paragraph">
<p>See also the discussion in <a href="https://gitlab.khronos.org/vulkan/vulkan/-/issues/2436" class="bare">https://gitlab.khronos.org/vulkan/vulkan/-/issues/2436</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_problem_statement"><a class="anchor" href="#_problem_statement"></a>Problem Statement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Various Vulkan tools (e.g. debuggers) use a layer to monitor all Vulkan
commands, and need to know where a frame starts and ends. In general,
<code>vkQueuePresentKHR</code> is a natural frame boundary delimiter: a frame is made by
all commands between two <code>vkQueuePresentKHR</code>. However, there are scenarios where
<code>vkQueuePresentKHR</code> is not a suitable frame boundary delimiter. The
<code>VK_EXT_frame_boundary</code> device extension lets application developers indicate to
tools where the frames start and end.</p>
</div>
<div class="paragraph">
<p>Note: here, &#8220;frame&#8221; is understood as &#8220;a unit of workload that spans one or more
queue submissions&#8221;. The notion of frame is application-dependent. In graphical
applications, a frame is typically the work needed to render into the image that
is eventually presented. In a compute-only application, a frame could be a set
of compute kernels dispatches that treat one unit of work.</p>
</div>
<div class="paragraph">
<p>There are a number of cases where <code>vkQueuePresentKHR</code> is not a suitable frame
boundary delimiter.</p>
</div>
<div class="sect2">
<h3 id="_graphics_applications_bypassing_the_khronos_swapchain"><a class="anchor" href="#_graphics_applications_bypassing_the_khronos_swapchain"></a>Graphics applications bypassing the Khronos swapchain</h3>
<div class="paragraph">
<p>Graphics applications are not tied to use the Khronos swapchain, and they may
interact directly with a platform presentation engine. In this case, they will
not call <code>vkQueuePresentKHR</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_compute_only_applications"><a class="anchor" href="#_compute_only_applications"></a>Compute-only applications</h3>
<div class="paragraph">
<p>Compute-only applications typically do not interact with a presentation engine at
all, so they would not call <code>vkQueuePresentKHR</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_overlapping_frames"><a class="anchor" href="#_overlapping_frames"></a>Overlapping frames</h3>
<div class="paragraph">
<p>A graphics application may pipeline its frame preparation such that work for
different frames is being submitted in an interleaved way, a scenario we call
here &#8220;overlapping frames&#8221;.</p>
</div>
<div class="paragraph">
<p>For instance, consider a graphics app where each frame is executed via two
<code>vkQueueSubmit</code> followed by a <code>vkQueuePresentKHR</code>, and frame preparation is
pipelined, such that the serialized commands look like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>vkQueueSubmit();     // 1st submit of Frame N
vkQueueSubmit();     // 2nd submit of Frame N-1
vkQueuePresentKHR(); // present Frame N-1
vkQueueSubmit();     // 1st submit of Frame N+1
vkQueueSubmit();     // 2nd submit of Frame N
vkQueuePresentKHR(); // present Frame N</pre>
</div>
</div>
<div class="paragraph">
<p>Here, relying on <code>vkQueuePresentKHR</code> as a frame boundary delimiter would lead to
the erroneous grouping of queue submissions of different frames as the work of a
single frame.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_solution_space"><a class="anchor" href="#_solution_space"></a>Solution Space</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Debug utilities: existing debug utilities let us tag Vulkan objects, could we
use that to identify which work belongs to which frame? We can think of
tagging the command buffers submitted with a frame identifier. However some
command buffers may be used concurrently by several frames, so that is not a
viable approach. In the same vein, queue debug label regions are not
satisfactory since they cannot handle overlapping frames.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>What we need is a way to associate a frame identifier to the one or more queue
submissions that submit the work for this frame. This is what the
VK_EXT_frame_boundary extension does.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proposal"><a class="anchor" href="#_proposal"></a>Proposal</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h3>
<div class="paragraph">
<p>We want applications to be able to group queue submissions by frames. To this
aim, we let applications tag queue submissions with a <code>uint64_t</code> frame
identifier. However, this is not sufficient: given that a frame may span more
than one queue submissions, in order to know when a frame ends, tools also need
to know which queue submission is the last one for a given frame. So in addition
to the frame identifier, we also want to be able to tag queue submissions with a
&#8220;frame end&#8221; flag, to mark the last submission for a given frame identifier.</p>
</div>
<div class="paragraph">
<p>There is one clarification left to do: the &#8220;frame end&#8221; submission is the
&#8220;logical last&#8221; queue submission, but in the presence of timeline semaphores it
may not be the last one to be submitted. Since timeline semaphores permit queue
submissions to wait on semaphores whose signal is not yet submitted, the
semaphore meant to be the last part of work for a given frame may not be the
last one to be submitted. In this context, we want to mark the &#8220;frame end&#8221;
submission as the one that is logically the last submission for the frame: if
this submission waits on semaphores whose signal is not yet submitted, then all
subsequent submissions with the same frame identifier until the submission that
signals these semaphores are also associated to that frame.</p>
</div>
<div class="paragraph">
<p>To illustrate this on a small example, considering serialized Vulkan commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>// At this point, the latest signal of timeline semaphore TLS set its value to 1

// Logical last submission for frame N, wait on TLS value 2
vkQueueSubmit( frameID:N, frameEnd, wait:TLS(2) )

// The actual final submission, which unblocks the previous one, is also part
// of the work for frame N, even if in submit order it comes after the frameEnd
// submission.
vkQueueSubmit( frameID:N, signal:TLS(2) )</pre>
</div>
</div>
<div class="paragraph">
<p>So we want a way to tag queue submissions with a <code>uint64_t</code> frame identifier,
and a frameEnd flag. To this aim, the <code>VK_EXT_frame_boundary</code> device extension
defines the new <code>VkFrameBoundaryEXT</code> type that is meant to be passed in queue
submission pNext chains.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_vkframeboundaryext_type"><a class="anchor" href="#_the_vkframeboundaryext_type"></a>The <code>VkFrameBoundaryEXT</code> type</h3>
<div class="paragraph">
<p>The <code>VK_EXT_frame_boundary</code> device extension defines a new
<code>VkFrameBoundaryEXT</code> type that is meant to be added to pNext chains of queue
submissions, such as <code>VkSubmitInfo</code>, <code>VkSubmitInfo2</code>, <code>VkBindSparseInfo</code>
or <code>VkPresentInfoKHR</code>. This type looks like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>// Flags
typedef enum VkFrameBoundaryFlagBitsEXT {
  VK_FRAME_BOUNDARY_FRAME_END_BIT_EXT = 0x00000001,
} VkFrameBoundaryFlagBitsEXT;
typedef VkFlags VkFrameBoundaryFlagsEXT;

// VkFrameBoundaryEXT can be passed in any queue submission's pNext chain
typedef struct VkFrameBoundaryEXT {
    VkStructureType              sType;
    const void*                  pNext;

    // Necessary members:
    // flags is necessary to mark the last submission of a frame
    VkFrameBoundaryFlagsEXT      flags;
    // frameID is necessary to disambiguate overlapping frames
    uint64_t                     frameID;

    // Extra members: provide a list of objects which  No need to pass the layout as
    // trace-replay tools will track the layout anyway.
    uint32_t                     imageCount;
    const VkImage*               pImages;
    uint32_t                     bufferCount;
    const VkBuffer*              pBuffers;

    // Extra info can be passed with an arbitrary tag payload, typically
    // a tool-specific struct.
    uint64_t                     tagName;
    size_t                       tagSize;
    const void*                  pTag;
} VkFrameBoundaryEXT;</pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>flags</code> provides a way to tag submissions with a frameEnd flag.</p>
</li>
<li>
<p><code>frameID</code> provides a way to tag submissions with a frame identifier.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In addition to these two necessary members, we have a few extras:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a list of VkImage: this makes this extension as expressive as
<code>vkQueuePresentKHR</code>, the classic frame boundary delimiter. For the classic
frame-oriented graphics workloads, it is convenient to have a list of images
storing the final frame renderings. We do not need the image layout as the
trace-replay tools would have to track image layout already anyway.</p>
</li>
<li>
<p>a list of VkBuffer: which allows applications that do not produce their
final result as an image (eg. compute applications) to provide the final
result of the frame.</p>
</li>
<li>
<p>a way to attach a binary payload: this can be used to pass tool-specific
extra information.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_validation"><a class="anchor" href="#_validation"></a>Validation</h3>
<div class="paragraph">
<p>Since the concept of a frame is application dependent, there is no way to
validate relevant use of frame identifier. As such there is no restrictions
imposed on frame identifiers and is the responsibility of the application
to use them in a relevant way.</p>
</div>
<div class="paragraph">
<p>In practice it is advised that applications use a single monotonically
increasing counter to base their frame identifiers on and not to reuse
identifiers between separate frames.</p>
</div>
<div class="paragraph">
<p>However, there is no way for the validation layer to detect an application
not adhering to these rules, since the validation layer has no idea which
submissions should be grouped together, so a valid grouping like this might
be flagged as invalid because of the application using wait before signal:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>vkQueueSubmit( frame:0 ) // start of a frame
vkQueueSubmit( frame:0 ) // part of the frame
vkQueueSubmit( frame:0, frameEnd, wait:TLS(42) ) // logical end, waiting on a not-yet-signaled TLS
vkQueueSubmit( frame:0, signal:TLS(42) ) // this is still part of the current frame, after the frameEnd marker.</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples"><a class="anchor" href="#_examples"></a>Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_compute_only"><a class="anchor" href="#_compute_only"></a>Compute-only</h3>
<div class="paragraph">
<p>Compute-only that want to split their work into frames can do so with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>vkQueueSubmit( frame:N )           // Zero or more submits for frame N
vkQueueSubmit( frame:N, frameEnd ) // Last submit for frame N

vkQueueSubmit( frame:N+1 )           // Zero or more submits for frame N+1
vkQueueSubmit( frame:N+1, frameEnd ) // Last submit for frame N+1</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_graphics_sequential_frames_not_using_the_khr_swapchain"><a class="anchor" href="#_graphics_sequential_frames_not_using_the_khr_swapchain"></a>Graphics, sequential frames, not using the KHR swapchain</h3>
<div class="paragraph">
<p>A graphics application that prepare frames in sequence (as opposed to
overlapping frames), but makes no use of the KHR swapchain, can group
submissions with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>vkQueueSubmit( frame:N ) // Zero or more submits for frame N
vkQueueSubmit( frame:N, frameEnd, imageCount:1, pImages:0x12345 ) // Last submit for frame N
// here code that passes pImages to the presentation engine

vkQueueSubmit( frame:N+1 )           // Zero or more submits for frame N+1
vkQueueSubmit( frame:N+1, frameEnd, imageCount:1, pImages:0x54321 ) // Last submit for frame N+1
// here code that passes pImages to the presentation engine</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_overlapping_frames_with_wait_after_signal"><a class="anchor" href="#_overlapping_frames_with_wait_after_signal"></a>Overlapping frames with wait-after-signal</h3>
<div class="paragraph">
<p>A graphics application with overlapping frames and wait-after-signal (that may
be due to multithreading, here we look at a serialized view of Vulkan commands),
can group queue submissions per frame with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>vkQueueSubmit( frame:N ); // 1st submit of frame N

vkQueueSubmit( frame:N-1 ); // Some other submissions for an other frame
vkQueueSubmit( frame:N+1 ); // Some other submissions for an other frame

// 2nd submit of frame N, logically the last one, but waits on a TLS not yet
// signalled for that value
vkQueueSubmit( frame:N, frameEnd, wait:TLS(42) );

vkQueueSubmit( frame:... ); // Some other submissions for other frames

// 3rd submit of frame N, not the logical last one, but the last one in submit
// order (here serialized) since it signals the TLS on which the logical last
// submission waits
vkQueueSubmit( frame:N, signal:TLS(42) );</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_issues"><a class="anchor" href="#_issues"></a>Issues</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_resolved_what_should_this_extension_be_named"><a class="anchor" href="#_resolved_what_should_this_extension_be_named"></a>RESOLVED: What should this extension be named?</h3>
<div class="paragraph">
<p>VK_EXT_frame_boundary.</p>
</div>
<div class="paragraph">
<p>&#8220;Frame&#8221; is still the best word to convey the meaning of &#8220;a unit of workload
spanning one or more queue submissions&#8221;. &#8220;Boundary&#8221; might be seen as too
specific since this can be seen more generally as tagging queue submissions
with frame identifiers, but really the goal of this tagging is precisely to
know when a frame starts and ends, i.e. to know its boundaries.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_what_information_should_be_included_in_vkframeboundaryext"><a class="anchor" href="#_resolved_what_information_should_be_included_in_vkframeboundaryext"></a>RESOLVED: What information should be included in VkFrameBoundaryEXT?</h3>
<div class="paragraph">
<p>Beyond the necessary flags and frameID, we keep only a list of objects that
contain the end result of the frame, and a binary blob where other extra info
can be provided.</p>
</div>
<div class="paragraph">
<p>The list of VkImage and VkBuffer objects allow the application to provide the
end result of the frame. There is no need to provide extra information about
the object like the layout of these images since capture-replay tools would
track the Vulkan state whilst the application is running.</p>
</div>
<div class="paragraph">
<p>The list of VkImage lets this extension be as expressive as
<code>vkQueuePresentKHR</code>, which has a list of swapchain images.</p>
</div>
<div class="paragraph">
<p>A binary blob (called &#8220;tag&#8221; to be homogeneous with
VkDebugUtilsObjectTagInfoEXT), allows tools to define their own data containing
any extra information that is required and update this without having to change
the Vulkan specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_how_should_frame_identifiers_be_validated"><a class="anchor" href="#_resolved_how_should_frame_identifiers_be_validated"></a>RESOLVED: How should frame identifiers be validated?</h3>
<div class="paragraph">
<p>Do not impose conditions on frame identifiers.</p>
</div>
<div class="paragraph">
<p>Frame identifiers are just a way to indicate to tools how to group queue
submissions, and that there is no ground to impose any kind of monotonic
increase. Frame identifiers may be reused and the application is responsible to
reuse them in a &#8220;safe&#8221; way. In practice it is advised that applications do not
reuse frame identifiers, but if the application is not careful when reusing
frame identifiers, it only makes a difference for tools, so it should not have
a semantic impact.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
    <!--
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
    -->
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
  </body>
</html>
