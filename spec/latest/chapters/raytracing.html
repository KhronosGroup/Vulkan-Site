<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ray Tracing :: Vulkan Documentation Project</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../_/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../_/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../_/img/favicon-16x16.png">
    <link rel="manifest" href="../../../_/static/site.webmanifest">
    <link rel="mask-icon" href="../../../_/img/safari-pinned-tab.svg" color="#a41e22">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../.."><img class="navbar-item" alt="Vulkan White Label" src="../../../_/Vulkan_Docs.svg" /></a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field has-filter">
          <label for="search-input"></label>
          <input id="search-input" type="text" placeholder="Search the docs">
          <label class="filter checkbox">
            <input type="checkbox" data-facet-filter="component:spec" checked> In this component
          </label>
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../spec/latest/chapters/introduction.html">Vulkan 1.3</a>
            <a class="navbar-item" href="https://registry.khronos.org/OpenGL/specs/gl/GLSLangSpec.4.60.html">GLSL</a>
            <a class="navbar-item" href="../../../guide/latest/hlsl.html">HLSL</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Education</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../features/latest/features/index.html">Vulkan Feature Descriptions</a>
            <a class="navbar-item" href="../../../guide/latest/index.html">Vulkan Guide</a>
            <a class="navbar-item" href="../../../samples/latest/README.html">Vulkan Samples</a>
            <a class="navbar-item" href="../../../tutorial/latest/index.html">Vulkan Tutorial</a>
            <a class="navbar-item" href="https://www.youtube.com/c/vulkan">YouTube</a>
            <a class="navbar-item" href="https://vulkan.org">More Info at Vulkan.org</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Feedback</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://github.com/KhronosGroup/Vulkan-Site/issues/new/choose" target="_blank">Report a Problem</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://reddit.com/r/vulkan">Reddit</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/vulkan">Stack Overflow</a>
            <a class="navbar-item" href="https://fosstodon.org/@vulkan">Mastodon</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="spec" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Vulkan Specification</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fundamentals.html">Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="initialization.html">Initialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="devsandqueues.html">Devices and Queues</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cmdbuffers.html">Command Buffers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="synchronization.html">Synchronization and Cache Control</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="renderpass.html">Render Pass</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="shaders.html">Shaders</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pipelines.html">Pipelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="memory.html">Memory Allocation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="resources.html">Resource Creation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="samplers.html">Samplers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="descriptorsets.html">Resource Descriptors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="interfaces.html">Shader Interfaces</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="textures.html">Image Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fragmentdensitymapops.html">Fragment Density Map Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="queries.html">Queries</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="clears.html">Clear Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="copies.html">Copy Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="drawing.html">Drawing Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fxvertex.html">Fixed-Function Vertex Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tessellation.html">Tessellation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="geometry.html">Geometry Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_mesh_shader/mesh.html">Mesh Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_HUAWEI_cluster_culling_shader/clusterculling.html">Cluster Culling Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="vertexpostproc.html">Fixed-Function Vertex Post-Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="primsrast.html">Rasterization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fragops.html">Fragment Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="framebuffer.html">The Framebuffer</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="dispatch.html">Dispatching Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="device_generated_commands/generatedcommands.html">Device-Generated Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="sparsemem.html">Sparse Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_KHR_surface/wsi.html">Window System Integration (WSI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_KHR_deferred_host_operations/deferred_host_operations.html">Deferred Host Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_EXT_private_data.html">Private Data</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="accelstructures.html">Acceleration Structures</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_EXT_opacity_micromap/micromaps.html">Micromap</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="raytraversal.html">Ray Traversal</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="raytracing.html">Ray Tracing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_memory_decompression.html">Memory Decompression</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="videocoding.html">Video Coding</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_optical_flow/optical_flow.html">Optical Flow</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="executiongraphs.html">Execution Graphs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extensions.html">Extending Vulkan</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="limits.html">Limits</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="formats.html">Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="capabilities.html">Additional Capabilities</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="debugging.html">Debugging</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/spirvenv.html">Vulkan Environment for SPIR-V</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/memorymodel.html">Memory Model</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/compressedtex.html">Compressed Image Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/versions.html">Core Revisions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/extensions.html">Layers &amp; Extensions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/roadmap.html">Vulkan Roadmap Milestones</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/boilerplate.html">API Boilerplate</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/invariance.html">Invariance</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/glossary.html">Lexicon</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/credits.html">Credits (Informative)</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Vulkan Specification</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../tutorial/latest/00_Introduction.html">Khronos Vulkan Tutorial</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tutorial/latest/00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../features/latest/features/index.html">Vulkan Feature Descriptions</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../features/latest/features/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../guide/latest/index.html">Vulkan Guide</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../samples/latest/README.html">Vulkan Samples</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/latest/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../index.html">Vulkan Specification</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Vulkan Specification</a></li>
    <li><a href="raytracing.html">Ray Tracing</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Ray Tracing</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Ray tracing uses a separate rendering pipeline from both the graphics and
compute pipelines (see <a href="pipelines.html#pipelines-ray-tracing" class="xref page">Ray Tracing Pipeline</a>).</p>
</div>
<div id="fig-raypipe" class="imageblock text-center">
<div class="content">
<img src="../_images/ray_tracing_execution.svg" alt="ray tracing execution">
</div>
<div class="title">Figure 1. Ray tracing pipeline execution</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Caption</div>
<div class="paragraph">
<p>Interaction between the different shader stages in the ray tracing pipeline</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Within the ray tracing pipeline, a <a href="../appendices/glossary.html#glossary-pipeline-trace-ray" class="xref page">pipeline trace ray</a> instruction <strong>can</strong> be called to perform a <a href="raytraversal.html#ray-traversal" class="xref page">ray traversal</a> that invokes the various ray tracing shader stages during its
execution.
The relationship between the ray tracing pipeline object and the geometries
present in the acceleration structure traversed is passed into the ray
tracing command in a <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> object known as a <em>shader binding
table</em>.
<code>OpExecuteCallableKHR</code> can also be used in ray tracing pipelines to
invoke a <a href="shaders.html#shaders-callable" class="xref page">callable shader</a>.</p>
</div>
<div class="paragraph">
<p>During execution, control alternates between scheduling and other
operations.
The scheduling functionality is implementation-specific and is responsible
for workload execution.
The shader stages are programmable.
<a href="raytraversal.html#ray-traversal" class="xref page"><em>Traversal</em></a>, which refers to the process of traversing
acceleration structures to find potential intersections of rays with
geometry, is fixed function.</p>
</div>
<div class="paragraph">
<p>The programmable portions of the pipeline are exposed in a single-ray
programming model, with each invocation handling one ray at a time.
Memory operations <strong>can</strong> be synchronized using standard memory barriers.
The <code>Workgroup</code> scope and variables with a storage class of
<code>Workgroup</code> <strong>must</strong> not be used in the ray tracing pipeline.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ray-tracing-shader-call"><a class="anchor" href="#ray-tracing-shader-call"></a>Shader Call Instructions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>shader call</em> is an instruction which <strong>may</strong> cause execution to continue
elsewhere by creating one or more invocations that execute a different
shader stage.</p>
</div>
<div class="paragraph">
<p>The following table lists all shader call instructions and which stages each
one <strong>can</strong> directly call.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">Intersection</th>
<th class="tableblock halign-left valign-top">Any-Hit</th>
<th class="tableblock halign-left valign-top">Closest Hit</th>
<th class="tableblock halign-left valign-top">Miss</th>
<th class="tableblock halign-left valign-top">Callable</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpTraceRayKHR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpTraceRayMotionNV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpReportIntersectionKHR</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpExecuteCallableKHR</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpHitObjectTraceRayNV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpHitObjectTraceRayMotionNV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpHitObjectExecuteShaderNV</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The invocations created by shader call instructions are grouped into
subgroups by the implementation.
Those subgroups <strong>may</strong> be unrelated to the subgroup of the parent invocation.</p>
</div>
<div id="ray-tracing-recursion-depth" class="paragraph">
<p><em>Pipeline trace ray instructions</em> <strong>can</strong> be used recursively; invoked shaders
<strong>can</strong> themselves execute pipeline trace ray instructions, to a maximum depth
defined by the
<a href="limits.html#limits-maxRecursionDepth" class="xref page"><code>maxRecursionDepth</code></a> or
<a href="limits.html#limits-maxRayRecursionDepth" class="xref page"><code>maxRayRecursionDepth</code></a> limit.</p>
</div>
<div class="paragraph">
<p>Shaders directly invoked from the API always have a recursion depth of 0;
each shader executed by a pipeline trace ray instruction has a recursion
depth one higher than the recursion depth of the shader which invoked it.
Applications <strong>must</strong> not invoke a shader with a recursion depth greater than
the value of
<code>maxRecursionDepth</code> or
<code>maxPipelineRayRecursionDepth</code> specified in the pipeline.</p>
</div>
<div class="paragraph">
<p>There is no explicit recursion limit for other shader call instructions
which may recurse (e.g. <code>OpExecuteCallableKHR</code>) but there is an upper
bound determined by the <a href="#ray-tracing-pipeline-stack">stack size</a>.</p>
</div>
<div id="ray-tracing-repack" class="paragraph">
<p>An <em>invocation repack instruction</em> is a ray tracing instruction where the
implementation <strong>may</strong> change the set of invocations that are executing.
When a repack instruction is encountered, the invocation is suspended and a
new invocation begins and executes the instruction.
After executing the repack instruction (which <strong>may</strong> result in other ray
tracing shader stages executing) the new invocation ends and the original
invocation is resumed, but it <strong>may</strong> be resumed in a different subgroup or at
a different <code>SubgroupLocalInvocationId</code> within the same subgroup.
When a subset of invocations in a subgroup execute the invocation repack
instruction, those that do not execute it remain in the same subgroup at the
same <code>SubgroupLocalInvocationId</code>.</p>
</div>
<div class="paragraph">
<p>The <code>OpTraceRayKHR</code>,
<code>OpTraceRayMotionNV</code>,
<code>OpReorderThreadWithHintNV</code>, <code>OpReorderThreadWithHitObjectNV</code>,
<code>OpReportIntersectionKHR</code>, and <code>OpExecuteCallableKHR</code> instructions are
invocation repack instructions.</p>
</div>
<div class="paragraph">
<p>The invocations that are executing before a shader call instruction, after
the instruction, or are created by the instruction, are
<a href="../appendices/memorymodel.html#shader-call-related" class="xref page">shader-call-related</a>.</p>
</div>
<div class="paragraph">
<p>If the implementation changes the composition of subgroups, the values of
<code>SubgroupSize</code>, <code>SubgroupLocalInvocationId</code>,
<code>SMIDNV</code>, <code>WarpIDNV</code>,
and builtin variables that are derived from them (<code>SubgroupEqMask</code>,
<code>SubgroupGeMask</code>, <code>SubgroupGtMask</code>, <code>SubgroupLeMask</code>,
<code>SubgroupLtMask</code>) <strong>must</strong> be changed accordingly by the invocation repack
instruction.
The application <strong>must</strong> use <a href="../appendices/spirvenv.html#builtin-volatile-semantics" class="xref page"><code>Volatile</code> semantics</a> on these <code>BuiltIn</code> variables when used in the ray generation,
closest hit, miss, intersection, and callable shaders.
Similarly, the application <strong>must</strong> use <code>Volatile</code> semantics on any
<code>RayTmaxKHR</code> decorated <code>Builtin</code> used in an intersection shader.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="shaders.html#shaders-group-operations" class="xref page">Subgroup operations</a> are permitted in the
programmable ray tracing shader stages.
However, shader call instructions place a bound on where results of subgroup
instructions or subgroup-scoped instructions that execute the dynamic
instance of that instruction are potentially valid.
For example, care <strong>must</strong> be taken when using the result of a ballot operation
that was computed before an invocation repack instruction, after that repack
instruction.
The ballot <strong>may</strong> be incorrect as the set of invocations could have changed.</p>
</div>
<div class="paragraph">
<p>While the <code>SubgroupSize</code> built-in is required to be declared
<code>Volatile</code>, its value will never change unless
<code>VK_PIPELINE_SHADER_STAGE_CREATE_ALLOW_VARYING_SUBGROUP_SIZE_BIT</code> is set
on pipeline creation, as without that bit set, its value is required to
match that of <a href="limits.html#VkPhysicalDeviceSubgroupProperties" class="xref page">VkPhysicalDeviceSubgroupProperties</a>::<code>subgroupSize</code>.</p>
</div>
<div class="paragraph">
<p>For clock operations, the value of a <code>Subgroup</code> scoped
<code>OpReadClockKHR</code> read before the dynamic instance of a repack instruction
<strong>should</strong> not be compared to the result of that clock instruction after the
repack instruction.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a ray tracing shader executes a dynamic instance of an invocation
repack instruction which results in another ray tracing shader being
invoked, their instructions are related by
<a href="../appendices/memorymodel.html#shader-call-order" class="xref page">shader-call-order</a>.</p>
</div>
<div class="paragraph">
<p>For ray tracing invocations that are
<a href="../appendices/memorymodel.html#shader-call-related" class="xref page">shader-call-related</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../appendices/memorymodel.html#memory-model-memory-operation" class="xref page">memory operations</a> on
    <code>StorageBuffer</code>, <code>Image</code>, and <code>ShaderRecordBufferKHR</code> storage
    classes <strong>can</strong> be synchronized using the
<code>ShaderCallKHR</code>
    scope.</p>
</li>
<li>
<p>the <code>CallableDataKHR</code>, <code>IncomingCallableDataKHR</code>,
<code>RayPayloadKHR</code>, <code>HitAttributeKHR</code>, and <code>IncomingRayPayloadKHR</code>
storage classes are <a href="../appendices/memorymodel.html#memory-model-shader-io" class="xref page">system-synchronized</a> and
no application availability and visibility operations are required.</p>
</li>
<li>
<p>memory operations within a single invocation before and after the shader
call instruction are ordered by
<a href="../appendices/memorymodel.html#memory-model-program-order" class="xref page">program-order</a> and do not require explicit
synchronization.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ray-tracing-commands"><a class="anchor" href="#ray-tracing-commands"></a>Ray Tracing Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Ray tracing commands</em> provoke work in the ray tracing pipeline.
Ray tracing commands are recorded into a command buffer and when executed by
a queue will produce work that executes according to the currently bound ray
tracing pipeline.
A ray tracing pipeline <strong>must</strong> be bound to a command buffer before any ray
tracing commands are recorded in that command buffer.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To dispatch ray tracing use:</p>
</div>
<div id="vkCmdTraceRaysNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
void vkCmdTraceRaysNV(
    VkCommandBuffer                             commandBuffer,
    VkBuffer                                    raygenShaderBindingTableBuffer,
    VkDeviceSize                                raygenShaderBindingOffset,
    VkBuffer                                    missShaderBindingTableBuffer,
    VkDeviceSize                                missShaderBindingOffset,
    VkDeviceSize                                missShaderBindingStride,
    VkBuffer                                    hitShaderBindingTableBuffer,
    VkDeviceSize                                hitShaderBindingOffset,
    VkDeviceSize                                hitShaderBindingStride,
    VkBuffer                                    callableShaderBindingTableBuffer,
    VkDeviceSize                                callableShaderBindingOffset,
    VkDeviceSize                                callableShaderBindingStride,
    uint32_t                                    width,
    uint32_t                                    height,
    uint32_t                                    depth);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>raygenShaderBindingTableBuffer</code> is the buffer object that holds the
shader binding table data for the ray generation shader stage.</p>
</li>
<li>
<p><code>raygenShaderBindingOffset</code> is the offset in bytes (relative to
<code>raygenShaderBindingTableBuffer</code>) of the ray generation shader being
used for the trace.</p>
</li>
<li>
<p><code>missShaderBindingTableBuffer</code> is the buffer object that holds the
shader binding table data for the miss shader stage.</p>
</li>
<li>
<p><code>missShaderBindingOffset</code> is the offset in bytes (relative to
<code>missShaderBindingTableBuffer</code>) of the miss shader being used for
the trace.</p>
</li>
<li>
<p><code>missShaderBindingStride</code> is the size in bytes of each shader
binding table record in <code>missShaderBindingTableBuffer</code>.</p>
</li>
<li>
<p><code>hitShaderBindingTableBuffer</code> is the buffer object that holds the
shader binding table data for the hit shader stages.</p>
</li>
<li>
<p><code>hitShaderBindingOffset</code> is the offset in bytes (relative to
<code>hitShaderBindingTableBuffer</code>) of the hit shader group being used
for the trace.</p>
</li>
<li>
<p><code>hitShaderBindingStride</code> is the size in bytes of each shader binding
table record in <code>hitShaderBindingTableBuffer</code>.</p>
</li>
<li>
<p><code>callableShaderBindingTableBuffer</code> is the buffer object that holds
the shader binding table data for the callable shader stage.</p>
</li>
<li>
<p><code>callableShaderBindingOffset</code> is the offset in bytes (relative to
<code>callableShaderBindingTableBuffer</code>) of the callable shader being
used for the trace.</p>
</li>
<li>
<p><code>callableShaderBindingStride</code> is the size in bytes of each shader
binding table record in <code>callableShaderBindingTableBuffer</code>.</p>
</li>
<li>
<p><code>width</code> is the width of the ray trace query dimensions.</p>
</li>
<li>
<p><code>height</code> is height of the ray trace query dimensions.</p>
</li>
<li>
<p><code>depth</code> is depth of the ray trace query dimensions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the command is executed, a ray generation group of <span class="eq"><code>width</code>
× <code>height</code> × <code>depth</code></span> rays is assembled.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-magFilter-04553" href="#VUID-vkCmdTraceRaysNV-magFilter-04553"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-magFilter-04553</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>magFilter</code> or <code>minFilter</code>
equal to <code>VK_FILTER_LINEAR</code>,
<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE</code>,
and <code>compareEnable</code> equal to <code>VK_FALSE</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-magFilter-09598" href="#VUID-vkCmdTraceRaysNV-magFilter-09598"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-magFilter-09598</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>magFilter</code> or <code>minFilter</code>
equal to <code>VK_FILTER_LINEAR</code> and <code>reductionMode</code> equal to either
<code>VK_SAMPLER_REDUCTION_MODE_MIN</code> or
<code>VK_SAMPLER_REDUCTION_MODE_MAX</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_MINMAX_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-mipmapMode-04770" href="#VUID-vkCmdTraceRaysNV-mipmapMode-04770"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-mipmapMode-04770</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>mipmapMode</code> equal to
<code>VK_SAMPLER_MIPMAP_MODE_LINEAR</code>,
<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE</code>,
and <code>compareEnable</code> equal to <code>VK_FALSE</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-mipmapMode-09599" href="#VUID-vkCmdTraceRaysNV-mipmapMode-09599"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-mipmapMode-09599</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>mipmapMode</code> equal to
<code>VK_SAMPLER_MIPMAP_MODE_LINEAR</code> and <code>reductionMode</code> equal to
either <code>VK_SAMPLER_REDUCTION_MODE_MIN</code> or
<code>VK_SAMPLER_REDUCTION_MODE_MAX</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_MINMAX_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-unnormalizedCoordinates-09635" href="#VUID-vkCmdTraceRaysNV-unnormalizedCoordinates-09635"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-unnormalizedCoordinates-09635</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>unnormalizedCoordinates</code> equal to
<code>VK_TRUE</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this
command, then the image view&#8217;s <code>levelCount</code> and <code>layerCount</code>
<strong>must</strong> be 1</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-unnormalizedCoordinates-09636" href="#VUID-vkCmdTraceRaysNV-unnormalizedCoordinates-09636"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-unnormalizedCoordinates-09636</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>unnormalizedCoordinates</code> equal to
<code>VK_TRUE</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this
command, then the image view&#8217;s <code>viewType</code> <strong>must</strong> be
<code>VK_IMAGE_VIEW_TYPE_1D</code> or <code>VK_IMAGE_VIEW_TYPE_2D</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-06479" href="#VUID-vkCmdTraceRaysNV-None-06479"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-06479</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is sampled with
<a href="textures.html#textures-depth-compare-operation" class="xref page">depth comparison</a>, the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_SAMPLED_IMAGE_DEPTH_COMPARISON_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-02691" href="#VUID-vkCmdTraceRaysNV-None-02691"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-02691</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is accessed using atomic operations as a result
of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_STORAGE_IMAGE_ATOMIC_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-07888" href="#VUID-vkCmdTraceRaysNV-None-07888"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-07888</span><br>

If a <code>VK_DESCRIPTOR_TYPE_STORAGE_TEXEL_BUFFER</code> descriptor is
accessed using atomic operations as a result of this command, then the
storage texel buffer&#8217;s <a href="resources.html#resources-buffer-view-format-features" class="xref page">format    features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_STORAGE_TEXEL_BUFFER_ATOMIC_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-02692" href="#VUID-vkCmdTraceRaysNV-None-02692"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-02692</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_CUBIC_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-02693" href="#VUID-vkCmdTraceRaysNV-None-02693"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-02693</span><br>

If
the <a href="../appendices/extensions.html#VK_EXT_filter_cubic" class="xref page">VK_EXT_filter_cubic</a> extension is not enabled and
any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command, it <strong>must</strong> not have a <a href="resources.html#VkImageViewType" class="xref page">VkImageViewType</a> of
<code>VK_IMAGE_VIEW_TYPE_3D</code>, <code>VK_IMAGE_VIEW_TYPE_CUBE</code>, or
<code>VK_IMAGE_VIEW_TYPE_CUBE_ARRAY</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-filterCubic-02694" href="#VUID-vkCmdTraceRaysNV-filterCubic-02694"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-filterCubic-02694</span><br>

Any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command <strong>must</strong> have a <a href="resources.html#VkImageViewType" class="xref page">VkImageViewType</a> and format
that supports cubic filtering, as specified by
<a href="capabilities.html#VkFilterCubicImageViewImageFormatPropertiesEXT" class="xref page">VkFilterCubicImageViewImageFormatPropertiesEXT</a>::<code>filterCubic</code>
returned by <a href="capabilities.html#vkGetPhysicalDeviceImageFormatProperties2" class="xref page">vkGetPhysicalDeviceImageFormatProperties2</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-filterCubicMinmax-02695" href="#VUID-vkCmdTraceRaysNV-filterCubicMinmax-02695"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-filterCubicMinmax-02695</span><br>

Any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with <code>VK_FILTER_CUBIC_EXT</code> with
a reduction mode of either <code>VK_SAMPLER_REDUCTION_MODE_MIN</code> or
<code>VK_SAMPLER_REDUCTION_MODE_MAX</code> as a result of this command <strong>must</strong>
have a <a href="resources.html#VkImageViewType" class="xref page">VkImageViewType</a> and format that supports cubic filtering
together with minmax filtering, as specified by
<a href="capabilities.html#VkFilterCubicImageViewImageFormatPropertiesEXT" class="xref page">VkFilterCubicImageViewImageFormatPropertiesEXT</a>::<code>filterCubicMinmax</code>
returned by <a href="capabilities.html#vkGetPhysicalDeviceImageFormatProperties2" class="xref page">vkGetPhysicalDeviceImageFormatProperties2</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-cubicRangeClamp-09212" href="#VUID-vkCmdTraceRaysNV-cubicRangeClamp-09212"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-cubicRangeClamp-09212</span><br>

If the <a href="features.html#features-filter-cubic-range-clamp" class="xref page"><code>cubicRangeClamp</code></a>
feature is not enabled, then any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with
<code>VK_FILTER_CUBIC_EXT</code> as a result of this command <strong>must</strong> not have a
<a href="samplers.html#VkSamplerReductionModeCreateInfo" class="xref page">VkSamplerReductionModeCreateInfo</a>::<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE_RANGECLAMP_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-reductionMode-09213" href="#VUID-vkCmdTraceRaysNV-reductionMode-09213"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-reductionMode-09213</span><br>

Any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with a
<a href="samplers.html#VkSamplerReductionModeCreateInfo" class="xref page">VkSamplerReductionModeCreateInfo</a>::<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE_RANGECLAMP_QCOM</code> as a
result of this command <strong>must</strong> sample with <code>VK_FILTER_CUBIC_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-selectableCubicWeights-09214" href="#VUID-vkCmdTraceRaysNV-selectableCubicWeights-09214"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-selectableCubicWeights-09214</span><br>

If the <a href="features.html#features-filter-cubic-weight-selection" class="xref page">    <code>selectableCubicWeights</code></a> feature is not enabled, then any
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command <strong>must</strong> have
<a href="samplers.html#VkSamplerCubicWeightsCreateInfoQCOM" class="xref page">VkSamplerCubicWeightsCreateInfoQCOM</a>::<code>cubicWeights</code> equal to
<code>VK_CUBIC_FILTER_WEIGHTS_CATMULL_ROM_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-flags-02696" href="#VUID-vkCmdTraceRaysNV-flags-02696"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-flags-02696</span><br>

Any <a href="resources.html#VkImage" class="xref page">VkImage</a> created with a <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>::<code>flags</code>
containing <code>VK_IMAGE_CREATE_CORNER_SAMPLED_BIT_NV</code> sampled as a
result of this command <strong>must</strong> only be sampled using a
<a href="samplers.html#VkSamplerAddressMode" class="xref page">VkSamplerAddressMode</a> of
<code>VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_EDGE</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpTypeImage-07027" href="#VUID-vkCmdTraceRaysNV-OpTypeImage-07027"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpTypeImage-07027</span><br>

For any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being written as a storage image where the
image format field of the <code>OpTypeImage</code> is <code>Unknown</code>, the view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_WRITE_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpTypeImage-07028" href="#VUID-vkCmdTraceRaysNV-OpTypeImage-07028"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpTypeImage-07028</span><br>

For any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being read as a storage image where the image
format field of the <code>OpTypeImage</code> is <code>Unknown</code>, the view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_READ_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpTypeImage-07029" href="#VUID-vkCmdTraceRaysNV-OpTypeImage-07029"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpTypeImage-07029</span><br>

For any <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> being written as a storage texel buffer where
the image format field of the <code>OpTypeImage</code> is <code>Unknown</code>, the
view&#8217;s <a href="formats.html#VkFormatProperties3" class="xref page">buffer features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_WRITE_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpTypeImage-07030" href="#VUID-vkCmdTraceRaysNV-OpTypeImage-07030"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpTypeImage-07030</span><br>

Any <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> being read as a storage texel buffer where the
image format field of the <code>OpTypeImage</code> is <code>Unknown</code> then the
view&#8217;s <a href="formats.html#VkFormatProperties3" class="xref page">buffer features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_READ_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08600" href="#VUID-vkCmdTraceRaysNV-None-08600"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08600</span><br>

For each set <em>n</em> that is statically used by <a href="shaders.html#shaders-binding" class="xref page">a bound    shader</a>, a descriptor set <strong>must</strong> have been bound to <em>n</em> at the same
pipeline bind point, with a <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> that is compatible
for set <em>n</em>, with the <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> used to create the current
<a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a>
or the <a href="descriptorsets.html#VkDescriptorSetLayout" class="xref page">VkDescriptorSetLayout</a> array used to create the current
<a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a>
, as described in <a href="descriptorsets.html#descriptorsets-compatibility" class="xref page">Pipeline Layout Compatibility</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08601" href="#VUID-vkCmdTraceRaysNV-None-08601"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08601</span><br>

For each push constant that is statically used by <a href="shaders.html#shaders-binding" class="xref page">a    bound shader</a>, a push constant value <strong>must</strong> have been set for the same
pipeline bind point, with a <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> that is compatible
for push constants, with the <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> used to create the
current <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a>
or the <a href="descriptorsets.html#VkDescriptorSetLayout" class="xref page">VkDescriptorSetLayout</a> array used to create the current
<a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a>
, as described in <a href="descriptorsets.html#descriptorsets-compatibility" class="xref page">Pipeline Layout Compatibility</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-10068" href="#VUID-vkCmdTraceRaysNV-None-10068"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-10068</span><br>

For each array of resources that is used by <a href="shaders.html#shaders-binding" class="xref page">a bound    shader</a>, the indices used to access members of the array <strong>must</strong> be less
than the descriptor count for the identified binding in the descriptor
sets used by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-maintenance4-08602" href="#VUID-vkCmdTraceRaysNV-maintenance4-08602"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-maintenance4-08602</span><br>

If the <a href="features.html#features-maintenance4" class="xref page"><code>maintenance4</code></a> feature is not
enabled, then for each push constant that is statically used by
<a href="shaders.html#shaders-binding" class="xref page">a bound shader</a>, a push constant value <strong>must</strong> have
been set for the same pipeline bind point, with a <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a>
that is compatible for push constants, with the <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a>
used to create the current <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a>
or the <a href="descriptorsets.html#VkDescriptorSetLayout" class="xref page">VkDescriptorSetLayout</a> and <a href="descriptorsets.html#VkPushConstantRange" class="xref page">VkPushConstantRange</a> arrays
used to create the current <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a>
, as described in <a href="descriptorsets.html#descriptorsets-compatibility" class="xref page">Pipeline Layout Compatibility</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08114" href="#VUID-vkCmdTraceRaysNV-None-08114"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08114</span><br>

Descriptors in each bound descriptor set, specified via
<a href="descriptorsets.html#vkCmdBindDescriptorSets" class="xref page">vkCmdBindDescriptorSets</a>, <strong>must</strong> be valid as described by
<a href="descriptorsets.html#descriptor-validity" class="xref page">descriptor validity</a> if they are statically used
by
the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline bind point used by this
command and the bound <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> was not created with
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08115" href="#VUID-vkCmdTraceRaysNV-None-08115"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08115</span><br>

If the descriptors used by the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline
bind point were specified via <a href="descriptorsets.html#vkCmdBindDescriptorSets" class="xref page">vkCmdBindDescriptorSets</a>, the bound
<a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> <strong>must</strong> have been created without
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08116" href="#VUID-vkCmdTraceRaysNV-None-08116"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08116</span><br>

Descriptors in bound descriptor buffers, specified via
<a href="descriptorsets.html#vkCmdSetDescriptorBufferOffsetsEXT" class="xref page">vkCmdSetDescriptorBufferOffsetsEXT</a>, <strong>must</strong> be valid if they are
dynamically used by the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline bind
point used by this command and the bound <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> was created
with <code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08604" href="#VUID-vkCmdTraceRaysNV-None-08604"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08604</span><br>

Descriptors in bound descriptor buffers, specified via
<a href="descriptorsets.html#vkCmdSetDescriptorBufferOffsetsEXT" class="xref page">vkCmdSetDescriptorBufferOffsetsEXT</a>, <strong>must</strong> be valid if they are
dynamically used by any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding
to the pipeline bind point used by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08117" href="#VUID-vkCmdTraceRaysNV-None-08117"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08117</span><br>

If the descriptors used by the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline
bind point were specified via <a href="descriptorsets.html#vkCmdSetDescriptorBufferOffsetsEXT" class="xref page">vkCmdSetDescriptorBufferOffsetsEXT</a>,
the bound <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> <strong>must</strong> have been created with
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08119" href="#VUID-vkCmdTraceRaysNV-None-08119"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08119</span><br>

If a descriptor is dynamically used with a <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> created with
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code>, the descriptor
memory <strong>must</strong> be resident</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08605" href="#VUID-vkCmdTraceRaysNV-None-08605"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08605</span><br>

If a descriptor is dynamically used with a <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> created
with a <code>VkDescriptorSetLayout</code> that was created with
<code>VK_DESCRIPTOR_SET_LAYOUT_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code>, the
descriptor memory <strong>must</strong> be resident</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08606" href="#VUID-vkCmdTraceRaysNV-None-08606"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08606</span><br>

If the <a href="features.html#features-shaderObject" class="xref page"><code>shaderObject</code></a> feature is not
enabled, a
valid pipeline <strong>must</strong> be bound to the pipeline bind point used by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08608" href="#VUID-vkCmdTraceRaysNV-None-08608"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08608</span><br>

If a pipeline is bound to the pipeline bind point used by this command,
there
<strong>must</strong> not have been any calls to dynamic state setting commands for any
state specified statically in the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the
pipeline bind point used by this command, since that pipeline was bound</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08609" href="#VUID-vkCmdTraceRaysNV-None-08609"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08609</span><br>

If the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind point used by
this command
or any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding to the pipeline
bind point used by this command
accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> object that uses unnormalized coordinates,
that sampler <strong>must</strong> not be used to sample from any <a href="resources.html#VkImage" class="xref page">VkImage</a> with a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> of the type <code>VK_IMAGE_VIEW_TYPE_3D</code>,
<code>VK_IMAGE_VIEW_TYPE_CUBE</code>, <code>VK_IMAGE_VIEW_TYPE_1D_ARRAY</code>,
<code>VK_IMAGE_VIEW_TYPE_2D_ARRAY</code> or
<code>VK_IMAGE_VIEW_TYPE_CUBE_ARRAY</code>, in any shader stage</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08610" href="#VUID-vkCmdTraceRaysNV-None-08610"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08610</span><br>

If the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind point used by
this command
or any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding to the pipeline
bind point used by this command
accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> object that uses unnormalized coordinates,
that sampler <strong>must</strong> not be used with any of the SPIR-V <code>OpImageSample*</code>
or <code>OpImageSparseSample*</code> instructions with <code>ImplicitLod</code>, <code>Dref</code>
or <code>Proj</code> in their name, in any shader stage</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08611" href="#VUID-vkCmdTraceRaysNV-None-08611"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08611</span><br>

If the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind point used by
this command
or any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding to the pipeline
bind point used by this command
accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> object that uses unnormalized coordinates,
that sampler <strong>must</strong> not be used with any of the SPIR-V <code>OpImageSample*</code>
or <code>OpImageSparseSample*</code> instructions that includes a LOD bias or any
offset values, in any shader stage</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08607" href="#VUID-vkCmdTraceRaysNV-None-08607"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08607</span><br>

If the <a href="features.html#features-shaderObject" class="xref page"><code>shaderObject</code></a> feature is enabled,
either a valid pipeline <strong>must</strong> be bound to the pipeline bind point used
by this command, or a valid combination of valid and
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> shader objects <strong>must</strong> be bound to every supported
shader stage corresponding to the pipeline bind point used by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-uniformBuffers-06935" href="#VUID-vkCmdTraceRaysNV-uniformBuffers-06935"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-uniformBuffers-06935</span><br>

If any stage of the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind
point used by this command accesses a uniform buffer,
and that stage was created without enabling either
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_EXT</code> or
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_2_EXT</code>
for <code>uniformBuffers</code>,
and the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a>
feature is not enabled, that stage <strong>must</strong> not access values outside of
the range of the buffer as specified in the descriptor set bound to the
same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08612" href="#VUID-vkCmdTraceRaysNV-None-08612"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08612</span><br>

If the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a> feature
is not enabled, and any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding
to the pipeline bind point used by this command accesses a uniform
buffer, it <strong>must</strong> not access values outside of the range of the buffer as
specified in the descriptor set bound to the same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-storageBuffers-06936" href="#VUID-vkCmdTraceRaysNV-storageBuffers-06936"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-storageBuffers-06936</span><br>

If any stage of the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind
point used by this command accesses a storage buffer,
and that stage was created without enabling either
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_EXT</code> or
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_2_EXT</code>
for <code>storageBuffers</code>,
and the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a>
feature is not enabled, that stage <strong>must</strong> not access values outside of
the range of the buffer as specified in the descriptor set bound to the
same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-08613" href="#VUID-vkCmdTraceRaysNV-None-08613"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-08613</span><br>

If the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a> feature
is not enabled, and any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding
to the pipeline bind point used by this command accesses a storage
buffer, it <strong>must</strong> not access values outside of the range of the buffer as
specified in the descriptor set bound to the same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-commandBuffer-02707" href="#VUID-vkCmdTraceRaysNV-commandBuffer-02707"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-commandBuffer-02707</span><br>

If <code>commandBuffer</code> is an unprotected command buffer and
<a href="devsandqueues.html#limits-protectedNoFault" class="xref page"><code>protectedNoFault</code></a> is not supported,
any resource accessed by <a href="shaders.html#shaders-binding" class="xref page">bound shaders</a> <strong>must</strong> not be
a protected resource</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-06550" href="#VUID-vkCmdTraceRaysNV-None-06550"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-06550</span><br>

If <a href="shaders.html#shaders-binding" class="xref page">a bound shader</a> accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> or
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> object that enables
<a href="samplers.html#samplers-YCbCr-conversion" class="xref page">sampler Y′C<sub>B</sub>C<sub>R</sub> conversion</a>, that object
<strong>must</strong> only be used with <code>OpImageSample*</code> or <code>OpImageSparseSample*</code>
instructions</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-ConstOffset-06551" href="#VUID-vkCmdTraceRaysNV-ConstOffset-06551"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-ConstOffset-06551</span><br>

If <a href="shaders.html#shaders-binding" class="xref page">a bound shader</a> accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> or
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> object that enables
<a href="samplers.html#samplers-YCbCr-conversion" class="xref page">sampler Y′C<sub>B</sub>C<sub>R</sub> conversion</a>, that object
<strong>must</strong> not use the <code>ConstOffset</code> and <code>Offset</code> operands</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-viewType-07752" href="#VUID-vkCmdTraceRaysNV-viewType-07752"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-viewType-07752</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is accessed as a result of this command, then the
image view&#8217;s <code>viewType</code> <strong>must</strong> match the <code>Dim</code> operand of the
<code>OpTypeImage</code> as described in <a href="../appendices/spirvenv.html#spirvenv-image-dimensions" class="xref page">Compatibility Between SPIR-V Image Dimensions and Vulkan ImageView Types</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-format-07753" href="#VUID-vkCmdTraceRaysNV-format-07753"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-format-07753</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is accessed as a result of this command, then the
<a href="formats.html#formats-numericformat" class="xref page">numeric type</a> of the image view&#8217;s <code>format</code>
and the <code>Sampled</code> <code>Type</code> operand of the <code>OpTypeImage</code> <strong>must</strong>
match</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpImageWrite-08795" href="#VUID-vkCmdTraceRaysNV-OpImageWrite-08795"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpImageWrite-08795</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a>
created with a format other than <code>VK_FORMAT_A8_UNORM_KHR</code>
is accessed using <code>OpImageWrite</code> as a result of this command, then
the <code>Type</code> of the <code>Texel</code> operand of that instruction <strong>must</strong> have
at least as many components as the image view&#8217;s format</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpImageWrite-08796" href="#VUID-vkCmdTraceRaysNV-OpImageWrite-08796"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpImageWrite-08796</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> created with the format
<code>VK_FORMAT_A8_UNORM_KHR</code> is accessed using <code>OpImageWrite</code> as a
result of this command, then the <code>Type</code> of the <code>Texel</code> operand of
that instruction <strong>must</strong> have four components</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpImageWrite-04469" href="#VUID-vkCmdTraceRaysNV-OpImageWrite-04469"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpImageWrite-04469</span><br>

If a <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> is accessed using <code>OpImageWrite</code> as a result
of this command, then the <code>Type</code> of the <code>Texel</code> operand of that
instruction <strong>must</strong> have at least as many components as the buffer view&#8217;s
format</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-SampledType-04470" href="#VUID-vkCmdTraceRaysNV-SampledType-04470"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-SampledType-04470</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a 64-bit component
width is accessed as a result of this command, the <code>SampledType</code> of
the <code>OpTypeImage</code> operand of that instruction <strong>must</strong> have a <code>Width</code>
of 64</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-SampledType-04471" href="#VUID-vkCmdTraceRaysNV-SampledType-04471"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-SampledType-04471</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a component width
less than 64-bit is accessed as a result of this command, the
<code>SampledType</code> of the <code>OpTypeImage</code> operand of that instruction
<strong>must</strong> have a <code>Width</code> of 32</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-SampledType-04472" href="#VUID-vkCmdTraceRaysNV-SampledType-04472"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-SampledType-04472</span><br>

If a <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a 64-bit
component width is accessed as a result of this command, the
<code>SampledType</code> of the <code>OpTypeImage</code> operand of that instruction
<strong>must</strong> have a <code>Width</code> of 64</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-SampledType-04473" href="#VUID-vkCmdTraceRaysNV-SampledType-04473"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-SampledType-04473</span><br>

If a <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a component width
less than 64-bit is accessed as a result of this command, the
<code>SampledType</code> of the <code>OpTypeImage</code> operand of that instruction
<strong>must</strong> have a <code>Width</code> of 32</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-sparseImageInt64Atomics-04474" href="#VUID-vkCmdTraceRaysNV-sparseImageInt64Atomics-04474"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-sparseImageInt64Atomics-04474</span><br>

If the <a href="features.html#features-sparseImageInt64Atomics" class="xref page">    <code>sparseImageInt64Atomics</code></a> feature is not enabled, <a href="resources.html#VkImage" class="xref page">VkImage</a>
objects created with the <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code> flag
<strong>must</strong> not be accessed by atomic instructions through an <code>OpTypeImage</code>
with a <code>SampledType</code> with a <code>Width</code> of 64 by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-sparseImageInt64Atomics-04475" href="#VUID-vkCmdTraceRaysNV-sparseImageInt64Atomics-04475"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-sparseImageInt64Atomics-04475</span><br>

If the <a href="features.html#features-sparseImageInt64Atomics" class="xref page">    <code>sparseImageInt64Atomics</code></a> feature is not enabled, <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a>
objects created with the <code>VK_BUFFER_CREATE_SPARSE_RESIDENCY_BIT</code>
flag <strong>must</strong> not be accessed by atomic instructions through an
<code>OpTypeImage</code> with a <code>SampledType</code> with a <code>Width</code> of 64 by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpImageWeightedSampleQCOM-06971" href="#VUID-vkCmdTraceRaysNV-OpImageWeightedSampleQCOM-06971"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpImageWeightedSampleQCOM-06971</span><br>

If <code>OpImageWeightedSampleQCOM</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a>
as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_WEIGHT_SAMPLED_IMAGE_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpImageWeightedSampleQCOM-06972" href="#VUID-vkCmdTraceRaysNV-OpImageWeightedSampleQCOM-06972"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpImageWeightedSampleQCOM-06972</span><br>

If <code>OpImageWeightedSampleQCOM</code> uses a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a sample
weight image as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_WEIGHT_IMAGE_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpImageBoxFilterQCOM-06973" href="#VUID-vkCmdTraceRaysNV-OpImageBoxFilterQCOM-06973"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpImageBoxFilterQCOM-06973</span><br>

If <code>OpImageBoxFilterQCOM</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a
result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BOX_FILTER_SAMPLED_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpImageBlockMatchSSDQCOM-06974" href="#VUID-vkCmdTraceRaysNV-OpImageBlockMatchSSDQCOM-06974"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpImageBlockMatchSSDQCOM-06974</span><br>

If <code>OpImageBlockMatchSSDQCOM</code> is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BLOCK_MATCHING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpImageBlockMatchSADQCOM-06975" href="#VUID-vkCmdTraceRaysNV-OpImageBlockMatchSADQCOM-06975"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpImageBlockMatchSADQCOM-06975</span><br>

If <code>OpImageBlockMatchSADQCOM</code> is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BLOCK_MATCHING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpImageBlockMatchSADQCOM-06976" href="#VUID-vkCmdTraceRaysNV-OpImageBlockMatchSADQCOM-06976"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpImageBlockMatchSADQCOM-06976</span><br>

If <code>OpImageBlockMatchSADQCOM</code> or OpImageBlockMatchSSDQCOM is used to
read from a reference image as result of this command, then the
specified reference coordinates <strong>must</strong> not fail
<a href="textures.html#textures-integer-coordinate-validation" class="xref page">integer texel coordinate    validation</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpImageWeightedSampleQCOM-06977" href="#VUID-vkCmdTraceRaysNV-OpImageWeightedSampleQCOM-06977"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpImageWeightedSampleQCOM-06977</span><br>

If <code>OpImageWeightedSampleQCOM</code>, <code>OpImageBoxFilterQCOM</code>,
<code>OpImageBlockMatchWindowSSDQCOM</code>,
<code>OpImageBlockMatchWindowSADQCOM</code>,
<code>OpImageBlockMatchGatherSSDQCOM</code>,
<code>OpImageBlockMatchGatherSADQCOM</code>,
<code>OpImageBlockMatchSSDQCOM</code>, or <code>OpImageBlockMatchSADQCOM</code> uses a
<a href="samplers.html#VkSampler" class="xref page">VkSampler</a> as a result of this command, then the sampler <strong>must</strong> have
been created with <code>VK_SAMPLER_CREATE_IMAGE_PROCESSING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpImageWeightedSampleQCOM-06978" href="#VUID-vkCmdTraceRaysNV-OpImageWeightedSampleQCOM-06978"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpImageWeightedSampleQCOM-06978</span><br>

If any command other than <code>OpImageWeightedSampleQCOM</code>,
<code>OpImageBoxFilterQCOM</code>,
<code>OpImageBlockMatchWindowSSDQCOM</code>,
<code>OpImageBlockMatchWindowSADQCOM</code>,
<code>OpImageBlockMatchGatherSSDQCOM</code>,
<code>OpImageBlockMatchGatherSADQCOM</code>,
<code>OpImageBlockMatchSSDQCOM</code>, or <code>OpImageBlockMatchSADQCOM</code> uses a
<a href="samplers.html#VkSampler" class="xref page">VkSampler</a> as a result of this command, then the sampler <strong>must</strong> not
have been created with <code>VK_SAMPLER_CREATE_IMAGE_PROCESSING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpImageBlockMatchWindow-09215" href="#VUID-vkCmdTraceRaysNV-OpImageBlockMatchWindow-09215"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpImageBlockMatchWindow-09215</span><br>

If a <code>OpImageBlockMatchWindow*QCOM</code> or
<code>OpImageBlockMatchGather*QCOM</code> instruction is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BLOCK_MATCHING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpImageBlockMatchWindow-09216" href="#VUID-vkCmdTraceRaysNV-OpImageBlockMatchWindow-09216"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpImageBlockMatchWindow-09216</span><br>

If a <code>OpImageBlockMatchWindow*QCOM</code> or
<code>OpImageBlockMatchGather*QCOM</code> instruction is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
format <strong>must</strong> be a single-component format</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-OpImageBlockMatchWindow-09217" href="#VUID-vkCmdTraceRaysNV-OpImageBlockMatchWindow-09217"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-OpImageBlockMatchWindow-09217</span><br>

If a <code>OpImageBlockMatchWindow*QCOM</code> or
<code>OpImageBlockMatchGather*QCOM</code> read from a reference image as result
of this command, then the specified reference coordinates <strong>must</strong> not fail
<a href="textures.html#textures-integer-coordinate-validation" class="xref page">integer texel coordinate    validation</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-07288" href="#VUID-vkCmdTraceRaysNV-None-07288"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-07288</span><br>

Any shader invocation executed by this command <strong>must</strong>
<a href="shaders.html#shaders-termination" class="xref page">terminate</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-09600" href="#VUID-vkCmdTraceRaysNV-None-09600"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-09600</span><br>

If a descriptor with type equal to any of
<code>VK_DESCRIPTOR_TYPE_SAMPLE_WEIGHT_IMAGE_QCOM</code>,
<code>VK_DESCRIPTOR_TYPE_BLOCK_MATCH_IMAGE_QCOM</code>,
<code>VK_DESCRIPTOR_TYPE_SAMPLED_IMAGE</code>,
<code>VK_DESCRIPTOR_TYPE_STORAGE_IMAGE</code>, or
<code>VK_DESCRIPTOR_TYPE_INPUT_ATTACHMENT</code> is accessed as a result of
this command, the image subresource identified by that descriptor <strong>must</strong>
be in the image layout identified when the descriptor was written</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-03429" href="#VUID-vkCmdTraceRaysNV-None-03429"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-03429</span><br>

Any shader group handle referenced by this call <strong>must</strong> have been queried
from the currently bound ray tracing pipeline</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-None-09458" href="#VUID-vkCmdTraceRaysNV-None-09458"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-None-09458</span><br>

If the bound ray tracing pipeline state was created with the
<code>VK_DYNAMIC_STATE_RAY_TRACING_PIPELINE_STACK_SIZE_KHR</code> dynamic state
enabled then <a href="pipelines.html#vkCmdSetRayTracingPipelineStackSizeKHR" class="xref page">vkCmdSetRayTracingPipelineStackSizeKHR</a> <strong>must</strong> have
been called in the current command buffer prior to this trace command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-commandBuffer-04624" href="#VUID-vkCmdTraceRaysNV-commandBuffer-04624"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-commandBuffer-04624</span><br>

<code>commandBuffer</code> <strong>must</strong> not be a protected command buffer</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-maxRecursionDepth-03625" href="#VUID-vkCmdTraceRaysNV-maxRecursionDepth-03625"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-maxRecursionDepth-03625</span><br>

This command <strong>must</strong> not cause a pipeline trace ray instruction to be
executed from a shader invocation with a <a href="#ray-tracing-recursion-depth">    recursion depth</a> greater than the value of <code>maxRecursionDepth</code> used
to create the bound ray tracing pipeline</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-raygenShaderBindingTableBuffer-04042" href="#VUID-vkCmdTraceRaysNV-raygenShaderBindingTableBuffer-04042"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-raygenShaderBindingTableBuffer-04042</span><br>

If <code>raygenShaderBindingTableBuffer</code> is non-sparse then it <strong>must</strong> be
bound completely and contiguously to a single <code>VkDeviceMemory</code>
object</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-raygenShaderBindingOffset-02455" href="#VUID-vkCmdTraceRaysNV-raygenShaderBindingOffset-02455"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-raygenShaderBindingOffset-02455</span><br>

<code>raygenShaderBindingOffset</code> <strong>must</strong> be less than the size of
<code>raygenShaderBindingTableBuffer</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-raygenShaderBindingOffset-02456" href="#VUID-vkCmdTraceRaysNV-raygenShaderBindingOffset-02456"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-raygenShaderBindingOffset-02456</span><br>

<code>raygenShaderBindingOffset</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPropertiesNV</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-missShaderBindingTableBuffer-04043" href="#VUID-vkCmdTraceRaysNV-missShaderBindingTableBuffer-04043"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-missShaderBindingTableBuffer-04043</span><br>

If <code>missShaderBindingTableBuffer</code> is non-sparse then it <strong>must</strong> be
bound completely and contiguously to a single <code>VkDeviceMemory</code>
object</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-missShaderBindingOffset-02457" href="#VUID-vkCmdTraceRaysNV-missShaderBindingOffset-02457"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-missShaderBindingOffset-02457</span><br>

<code>missShaderBindingOffset</code> <strong>must</strong> be less than the size of
<code>missShaderBindingTableBuffer</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-missShaderBindingOffset-02458" href="#VUID-vkCmdTraceRaysNV-missShaderBindingOffset-02458"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-missShaderBindingOffset-02458</span><br>

<code>missShaderBindingOffset</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPropertiesNV</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-hitShaderBindingTableBuffer-04044" href="#VUID-vkCmdTraceRaysNV-hitShaderBindingTableBuffer-04044"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-hitShaderBindingTableBuffer-04044</span><br>

If <code>hitShaderBindingTableBuffer</code> is non-sparse then it <strong>must</strong> be
bound completely and contiguously to a single <code>VkDeviceMemory</code>
object</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-hitShaderBindingOffset-02459" href="#VUID-vkCmdTraceRaysNV-hitShaderBindingOffset-02459"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-hitShaderBindingOffset-02459</span><br>

<code>hitShaderBindingOffset</code> <strong>must</strong> be less than the size of
<code>hitShaderBindingTableBuffer</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-hitShaderBindingOffset-02460" href="#VUID-vkCmdTraceRaysNV-hitShaderBindingOffset-02460"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-hitShaderBindingOffset-02460</span><br>

<code>hitShaderBindingOffset</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPropertiesNV</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-callableShaderBindingTableBuffer-04045" href="#VUID-vkCmdTraceRaysNV-callableShaderBindingTableBuffer-04045"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-callableShaderBindingTableBuffer-04045</span><br>

If <code>callableShaderBindingTableBuffer</code> is non-sparse then it <strong>must</strong> be
bound completely and contiguously to a single <code>VkDeviceMemory</code>
object</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-callableShaderBindingOffset-02461" href="#VUID-vkCmdTraceRaysNV-callableShaderBindingOffset-02461"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-callableShaderBindingOffset-02461</span><br>

<code>callableShaderBindingOffset</code> <strong>must</strong> be less than the size of
<code>callableShaderBindingTableBuffer</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-callableShaderBindingOffset-02462" href="#VUID-vkCmdTraceRaysNV-callableShaderBindingOffset-02462"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-callableShaderBindingOffset-02462</span><br>

<code>callableShaderBindingOffset</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPropertiesNV</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-missShaderBindingStride-02463" href="#VUID-vkCmdTraceRaysNV-missShaderBindingStride-02463"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-missShaderBindingStride-02463</span><br>

<code>missShaderBindingStride</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPropertiesNV</code>::<code>shaderGroupHandleSize</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-hitShaderBindingStride-02464" href="#VUID-vkCmdTraceRaysNV-hitShaderBindingStride-02464"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-hitShaderBindingStride-02464</span><br>

<code>hitShaderBindingStride</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPropertiesNV</code>::<code>shaderGroupHandleSize</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-callableShaderBindingStride-02465" href="#VUID-vkCmdTraceRaysNV-callableShaderBindingStride-02465"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-callableShaderBindingStride-02465</span><br>

<code>callableShaderBindingStride</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPropertiesNV</code>::<code>shaderGroupHandleSize</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-missShaderBindingStride-02466" href="#VUID-vkCmdTraceRaysNV-missShaderBindingStride-02466"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-missShaderBindingStride-02466</span><br>

<code>missShaderBindingStride</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceRayTracingPropertiesNV</code>::<code>maxShaderGroupStride</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-hitShaderBindingStride-02467" href="#VUID-vkCmdTraceRaysNV-hitShaderBindingStride-02467"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-hitShaderBindingStride-02467</span><br>

<code>hitShaderBindingStride</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceRayTracingPropertiesNV</code>::<code>maxShaderGroupStride</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-callableShaderBindingStride-02468" href="#VUID-vkCmdTraceRaysNV-callableShaderBindingStride-02468"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-callableShaderBindingStride-02468</span><br>

<code>callableShaderBindingStride</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceRayTracingPropertiesNV</code>::<code>maxShaderGroupStride</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-width-02469" href="#VUID-vkCmdTraceRaysNV-width-02469"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-width-02469</span><br>

<code>width</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupCount</code>[0]</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-height-02470" href="#VUID-vkCmdTraceRaysNV-height-02470"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-height-02470</span><br>

<code>height</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupCount</code>[1]</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-depth-02471" href="#VUID-vkCmdTraceRaysNV-depth-02471"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-depth-02471</span><br>

<code>depth</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupCount</code>[2]</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-commandBuffer-parameter" href="#VUID-vkCmdTraceRaysNV-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-raygenShaderBindingTableBuffer-parameter" href="#VUID-vkCmdTraceRaysNV-raygenShaderBindingTableBuffer-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-raygenShaderBindingTableBuffer-parameter</span><br>
 <code>raygenShaderBindingTableBuffer</code> <strong>must</strong> be a valid <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-missShaderBindingTableBuffer-parameter" href="#VUID-vkCmdTraceRaysNV-missShaderBindingTableBuffer-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-missShaderBindingTableBuffer-parameter</span><br>
 If <code>missShaderBindingTableBuffer</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>missShaderBindingTableBuffer</code> <strong>must</strong> be a valid <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-hitShaderBindingTableBuffer-parameter" href="#VUID-vkCmdTraceRaysNV-hitShaderBindingTableBuffer-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-hitShaderBindingTableBuffer-parameter</span><br>
 If <code>hitShaderBindingTableBuffer</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>hitShaderBindingTableBuffer</code> <strong>must</strong> be a valid <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-callableShaderBindingTableBuffer-parameter" href="#VUID-vkCmdTraceRaysNV-callableShaderBindingTableBuffer-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-callableShaderBindingTableBuffer-parameter</span><br>
 If <code>callableShaderBindingTableBuffer</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>callableShaderBindingTableBuffer</code> <strong>must</strong> be a valid <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-commandBuffer-recording" href="#VUID-vkCmdTraceRaysNV-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-commandBuffer-cmdpool" href="#VUID-vkCmdTraceRaysNV-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-renderpass" href="#VUID-vkCmdTraceRaysNV-renderpass"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-videocoding" href="#VUID-vkCmdTraceRaysNV-videocoding"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysNV-commonparent" href="#VUID-vkCmdTraceRaysNV-commonparent"></a> <span class="vuid">VUID-vkCmdTraceRaysNV-commonparent</span><br>
 Each of <code>callableShaderBindingTableBuffer</code>, <code>commandBuffer</code>, <code>hitShaderBindingTableBuffer</code>, <code>missShaderBindingTableBuffer</code>, and <code>raygenShaderBindingTableBuffer</code> that are valid handles of non-ignored parameters <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To dispatch ray tracing use:</p>
</div>
<div id="vkCmdTraceRaysKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_ray_tracing_pipeline
void vkCmdTraceRaysKHR(
    VkCommandBuffer                             commandBuffer,
    const VkStridedDeviceAddressRegionKHR*      pRaygenShaderBindingTable,
    const VkStridedDeviceAddressRegionKHR*      pMissShaderBindingTable,
    const VkStridedDeviceAddressRegionKHR*      pHitShaderBindingTable,
    const VkStridedDeviceAddressRegionKHR*      pCallableShaderBindingTable,
    uint32_t                                    width,
    uint32_t                                    height,
    uint32_t                                    depth);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pRaygenShaderBindingTable</code> is a
<a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a> that holds the shader binding
table data for the ray generation shader stage.</p>
</li>
<li>
<p><code>pMissShaderBindingTable</code> is a <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a>
that holds the shader binding table data for the miss shader stage.</p>
</li>
<li>
<p><code>pHitShaderBindingTable</code> is a <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a>
that holds the shader binding table data for the hit shader stage.</p>
</li>
<li>
<p><code>pCallableShaderBindingTable</code> is a
<a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a> that holds the shader binding
table data for the callable shader stage.</p>
</li>
<li>
<p><code>width</code> is the width of the ray trace query dimensions.</p>
</li>
<li>
<p><code>height</code> is height of the ray trace query dimensions.</p>
</li>
<li>
<p><code>depth</code> is depth of the ray trace query dimensions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the command is executed, a ray generation group of <span class="eq"><code>width</code>
× <code>height</code> × <code>depth</code></span> rays is assembled.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-magFilter-04553" href="#VUID-vkCmdTraceRaysKHR-magFilter-04553"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-magFilter-04553</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>magFilter</code> or <code>minFilter</code>
equal to <code>VK_FILTER_LINEAR</code>,
<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE</code>,
and <code>compareEnable</code> equal to <code>VK_FALSE</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-magFilter-09598" href="#VUID-vkCmdTraceRaysKHR-magFilter-09598"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-magFilter-09598</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>magFilter</code> or <code>minFilter</code>
equal to <code>VK_FILTER_LINEAR</code> and <code>reductionMode</code> equal to either
<code>VK_SAMPLER_REDUCTION_MODE_MIN</code> or
<code>VK_SAMPLER_REDUCTION_MODE_MAX</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_MINMAX_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-mipmapMode-04770" href="#VUID-vkCmdTraceRaysKHR-mipmapMode-04770"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-mipmapMode-04770</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>mipmapMode</code> equal to
<code>VK_SAMPLER_MIPMAP_MODE_LINEAR</code>,
<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE</code>,
and <code>compareEnable</code> equal to <code>VK_FALSE</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-mipmapMode-09599" href="#VUID-vkCmdTraceRaysKHR-mipmapMode-09599"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-mipmapMode-09599</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>mipmapMode</code> equal to
<code>VK_SAMPLER_MIPMAP_MODE_LINEAR</code> and <code>reductionMode</code> equal to
either <code>VK_SAMPLER_REDUCTION_MODE_MIN</code> or
<code>VK_SAMPLER_REDUCTION_MODE_MAX</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_MINMAX_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-unnormalizedCoordinates-09635" href="#VUID-vkCmdTraceRaysKHR-unnormalizedCoordinates-09635"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-unnormalizedCoordinates-09635</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>unnormalizedCoordinates</code> equal to
<code>VK_TRUE</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this
command, then the image view&#8217;s <code>levelCount</code> and <code>layerCount</code>
<strong>must</strong> be 1</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-unnormalizedCoordinates-09636" href="#VUID-vkCmdTraceRaysKHR-unnormalizedCoordinates-09636"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-unnormalizedCoordinates-09636</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>unnormalizedCoordinates</code> equal to
<code>VK_TRUE</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this
command, then the image view&#8217;s <code>viewType</code> <strong>must</strong> be
<code>VK_IMAGE_VIEW_TYPE_1D</code> or <code>VK_IMAGE_VIEW_TYPE_2D</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-06479" href="#VUID-vkCmdTraceRaysKHR-None-06479"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-06479</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is sampled with
<a href="textures.html#textures-depth-compare-operation" class="xref page">depth comparison</a>, the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_SAMPLED_IMAGE_DEPTH_COMPARISON_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-02691" href="#VUID-vkCmdTraceRaysKHR-None-02691"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-02691</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is accessed using atomic operations as a result
of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_STORAGE_IMAGE_ATOMIC_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-07888" href="#VUID-vkCmdTraceRaysKHR-None-07888"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-07888</span><br>

If a <code>VK_DESCRIPTOR_TYPE_STORAGE_TEXEL_BUFFER</code> descriptor is
accessed using atomic operations as a result of this command, then the
storage texel buffer&#8217;s <a href="resources.html#resources-buffer-view-format-features" class="xref page">format    features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_STORAGE_TEXEL_BUFFER_ATOMIC_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-02692" href="#VUID-vkCmdTraceRaysKHR-None-02692"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-02692</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_CUBIC_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-02693" href="#VUID-vkCmdTraceRaysKHR-None-02693"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-02693</span><br>

If
the <a href="../appendices/extensions.html#VK_EXT_filter_cubic" class="xref page">VK_EXT_filter_cubic</a> extension is not enabled and
any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command, it <strong>must</strong> not have a <a href="resources.html#VkImageViewType" class="xref page">VkImageViewType</a> of
<code>VK_IMAGE_VIEW_TYPE_3D</code>, <code>VK_IMAGE_VIEW_TYPE_CUBE</code>, or
<code>VK_IMAGE_VIEW_TYPE_CUBE_ARRAY</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-filterCubic-02694" href="#VUID-vkCmdTraceRaysKHR-filterCubic-02694"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-filterCubic-02694</span><br>

Any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command <strong>must</strong> have a <a href="resources.html#VkImageViewType" class="xref page">VkImageViewType</a> and format
that supports cubic filtering, as specified by
<a href="capabilities.html#VkFilterCubicImageViewImageFormatPropertiesEXT" class="xref page">VkFilterCubicImageViewImageFormatPropertiesEXT</a>::<code>filterCubic</code>
returned by <a href="capabilities.html#vkGetPhysicalDeviceImageFormatProperties2" class="xref page">vkGetPhysicalDeviceImageFormatProperties2</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-filterCubicMinmax-02695" href="#VUID-vkCmdTraceRaysKHR-filterCubicMinmax-02695"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-filterCubicMinmax-02695</span><br>

Any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with <code>VK_FILTER_CUBIC_EXT</code> with
a reduction mode of either <code>VK_SAMPLER_REDUCTION_MODE_MIN</code> or
<code>VK_SAMPLER_REDUCTION_MODE_MAX</code> as a result of this command <strong>must</strong>
have a <a href="resources.html#VkImageViewType" class="xref page">VkImageViewType</a> and format that supports cubic filtering
together with minmax filtering, as specified by
<a href="capabilities.html#VkFilterCubicImageViewImageFormatPropertiesEXT" class="xref page">VkFilterCubicImageViewImageFormatPropertiesEXT</a>::<code>filterCubicMinmax</code>
returned by <a href="capabilities.html#vkGetPhysicalDeviceImageFormatProperties2" class="xref page">vkGetPhysicalDeviceImageFormatProperties2</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-cubicRangeClamp-09212" href="#VUID-vkCmdTraceRaysKHR-cubicRangeClamp-09212"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-cubicRangeClamp-09212</span><br>

If the <a href="features.html#features-filter-cubic-range-clamp" class="xref page"><code>cubicRangeClamp</code></a>
feature is not enabled, then any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with
<code>VK_FILTER_CUBIC_EXT</code> as a result of this command <strong>must</strong> not have a
<a href="samplers.html#VkSamplerReductionModeCreateInfo" class="xref page">VkSamplerReductionModeCreateInfo</a>::<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE_RANGECLAMP_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-reductionMode-09213" href="#VUID-vkCmdTraceRaysKHR-reductionMode-09213"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-reductionMode-09213</span><br>

Any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with a
<a href="samplers.html#VkSamplerReductionModeCreateInfo" class="xref page">VkSamplerReductionModeCreateInfo</a>::<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE_RANGECLAMP_QCOM</code> as a
result of this command <strong>must</strong> sample with <code>VK_FILTER_CUBIC_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-selectableCubicWeights-09214" href="#VUID-vkCmdTraceRaysKHR-selectableCubicWeights-09214"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-selectableCubicWeights-09214</span><br>

If the <a href="features.html#features-filter-cubic-weight-selection" class="xref page">    <code>selectableCubicWeights</code></a> feature is not enabled, then any
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command <strong>must</strong> have
<a href="samplers.html#VkSamplerCubicWeightsCreateInfoQCOM" class="xref page">VkSamplerCubicWeightsCreateInfoQCOM</a>::<code>cubicWeights</code> equal to
<code>VK_CUBIC_FILTER_WEIGHTS_CATMULL_ROM_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-flags-02696" href="#VUID-vkCmdTraceRaysKHR-flags-02696"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-flags-02696</span><br>

Any <a href="resources.html#VkImage" class="xref page">VkImage</a> created with a <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>::<code>flags</code>
containing <code>VK_IMAGE_CREATE_CORNER_SAMPLED_BIT_NV</code> sampled as a
result of this command <strong>must</strong> only be sampled using a
<a href="samplers.html#VkSamplerAddressMode" class="xref page">VkSamplerAddressMode</a> of
<code>VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_EDGE</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpTypeImage-07027" href="#VUID-vkCmdTraceRaysKHR-OpTypeImage-07027"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpTypeImage-07027</span><br>

For any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being written as a storage image where the
image format field of the <code>OpTypeImage</code> is <code>Unknown</code>, the view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_WRITE_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpTypeImage-07028" href="#VUID-vkCmdTraceRaysKHR-OpTypeImage-07028"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpTypeImage-07028</span><br>

For any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being read as a storage image where the image
format field of the <code>OpTypeImage</code> is <code>Unknown</code>, the view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_READ_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpTypeImage-07029" href="#VUID-vkCmdTraceRaysKHR-OpTypeImage-07029"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpTypeImage-07029</span><br>

For any <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> being written as a storage texel buffer where
the image format field of the <code>OpTypeImage</code> is <code>Unknown</code>, the
view&#8217;s <a href="formats.html#VkFormatProperties3" class="xref page">buffer features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_WRITE_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpTypeImage-07030" href="#VUID-vkCmdTraceRaysKHR-OpTypeImage-07030"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpTypeImage-07030</span><br>

Any <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> being read as a storage texel buffer where the
image format field of the <code>OpTypeImage</code> is <code>Unknown</code> then the
view&#8217;s <a href="formats.html#VkFormatProperties3" class="xref page">buffer features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_READ_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08600" href="#VUID-vkCmdTraceRaysKHR-None-08600"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08600</span><br>

For each set <em>n</em> that is statically used by <a href="shaders.html#shaders-binding" class="xref page">a bound    shader</a>, a descriptor set <strong>must</strong> have been bound to <em>n</em> at the same
pipeline bind point, with a <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> that is compatible
for set <em>n</em>, with the <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> used to create the current
<a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a>
or the <a href="descriptorsets.html#VkDescriptorSetLayout" class="xref page">VkDescriptorSetLayout</a> array used to create the current
<a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a>
, as described in <a href="descriptorsets.html#descriptorsets-compatibility" class="xref page">Pipeline Layout Compatibility</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08601" href="#VUID-vkCmdTraceRaysKHR-None-08601"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08601</span><br>

For each push constant that is statically used by <a href="shaders.html#shaders-binding" class="xref page">a    bound shader</a>, a push constant value <strong>must</strong> have been set for the same
pipeline bind point, with a <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> that is compatible
for push constants, with the <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> used to create the
current <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a>
or the <a href="descriptorsets.html#VkDescriptorSetLayout" class="xref page">VkDescriptorSetLayout</a> array used to create the current
<a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a>
, as described in <a href="descriptorsets.html#descriptorsets-compatibility" class="xref page">Pipeline Layout Compatibility</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-10068" href="#VUID-vkCmdTraceRaysKHR-None-10068"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-10068</span><br>

For each array of resources that is used by <a href="shaders.html#shaders-binding" class="xref page">a bound    shader</a>, the indices used to access members of the array <strong>must</strong> be less
than the descriptor count for the identified binding in the descriptor
sets used by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-maintenance4-08602" href="#VUID-vkCmdTraceRaysKHR-maintenance4-08602"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-maintenance4-08602</span><br>

If the <a href="features.html#features-maintenance4" class="xref page"><code>maintenance4</code></a> feature is not
enabled, then for each push constant that is statically used by
<a href="shaders.html#shaders-binding" class="xref page">a bound shader</a>, a push constant value <strong>must</strong> have
been set for the same pipeline bind point, with a <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a>
that is compatible for push constants, with the <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a>
used to create the current <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a>
or the <a href="descriptorsets.html#VkDescriptorSetLayout" class="xref page">VkDescriptorSetLayout</a> and <a href="descriptorsets.html#VkPushConstantRange" class="xref page">VkPushConstantRange</a> arrays
used to create the current <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a>
, as described in <a href="descriptorsets.html#descriptorsets-compatibility" class="xref page">Pipeline Layout Compatibility</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08114" href="#VUID-vkCmdTraceRaysKHR-None-08114"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08114</span><br>

Descriptors in each bound descriptor set, specified via
<a href="descriptorsets.html#vkCmdBindDescriptorSets" class="xref page">vkCmdBindDescriptorSets</a>, <strong>must</strong> be valid as described by
<a href="descriptorsets.html#descriptor-validity" class="xref page">descriptor validity</a> if they are statically used
by
the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline bind point used by this
command and the bound <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> was not created with
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08115" href="#VUID-vkCmdTraceRaysKHR-None-08115"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08115</span><br>

If the descriptors used by the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline
bind point were specified via <a href="descriptorsets.html#vkCmdBindDescriptorSets" class="xref page">vkCmdBindDescriptorSets</a>, the bound
<a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> <strong>must</strong> have been created without
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08116" href="#VUID-vkCmdTraceRaysKHR-None-08116"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08116</span><br>

Descriptors in bound descriptor buffers, specified via
<a href="descriptorsets.html#vkCmdSetDescriptorBufferOffsetsEXT" class="xref page">vkCmdSetDescriptorBufferOffsetsEXT</a>, <strong>must</strong> be valid if they are
dynamically used by the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline bind
point used by this command and the bound <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> was created
with <code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08604" href="#VUID-vkCmdTraceRaysKHR-None-08604"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08604</span><br>

Descriptors in bound descriptor buffers, specified via
<a href="descriptorsets.html#vkCmdSetDescriptorBufferOffsetsEXT" class="xref page">vkCmdSetDescriptorBufferOffsetsEXT</a>, <strong>must</strong> be valid if they are
dynamically used by any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding
to the pipeline bind point used by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08117" href="#VUID-vkCmdTraceRaysKHR-None-08117"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08117</span><br>

If the descriptors used by the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline
bind point were specified via <a href="descriptorsets.html#vkCmdSetDescriptorBufferOffsetsEXT" class="xref page">vkCmdSetDescriptorBufferOffsetsEXT</a>,
the bound <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> <strong>must</strong> have been created with
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08119" href="#VUID-vkCmdTraceRaysKHR-None-08119"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08119</span><br>

If a descriptor is dynamically used with a <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> created with
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code>, the descriptor
memory <strong>must</strong> be resident</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08605" href="#VUID-vkCmdTraceRaysKHR-None-08605"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08605</span><br>

If a descriptor is dynamically used with a <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> created
with a <code>VkDescriptorSetLayout</code> that was created with
<code>VK_DESCRIPTOR_SET_LAYOUT_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code>, the
descriptor memory <strong>must</strong> be resident</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08606" href="#VUID-vkCmdTraceRaysKHR-None-08606"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08606</span><br>

If the <a href="features.html#features-shaderObject" class="xref page"><code>shaderObject</code></a> feature is not
enabled, a
valid pipeline <strong>must</strong> be bound to the pipeline bind point used by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08608" href="#VUID-vkCmdTraceRaysKHR-None-08608"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08608</span><br>

If a pipeline is bound to the pipeline bind point used by this command,
there
<strong>must</strong> not have been any calls to dynamic state setting commands for any
state specified statically in the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the
pipeline bind point used by this command, since that pipeline was bound</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08609" href="#VUID-vkCmdTraceRaysKHR-None-08609"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08609</span><br>

If the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind point used by
this command
or any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding to the pipeline
bind point used by this command
accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> object that uses unnormalized coordinates,
that sampler <strong>must</strong> not be used to sample from any <a href="resources.html#VkImage" class="xref page">VkImage</a> with a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> of the type <code>VK_IMAGE_VIEW_TYPE_3D</code>,
<code>VK_IMAGE_VIEW_TYPE_CUBE</code>, <code>VK_IMAGE_VIEW_TYPE_1D_ARRAY</code>,
<code>VK_IMAGE_VIEW_TYPE_2D_ARRAY</code> or
<code>VK_IMAGE_VIEW_TYPE_CUBE_ARRAY</code>, in any shader stage</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08610" href="#VUID-vkCmdTraceRaysKHR-None-08610"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08610</span><br>

If the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind point used by
this command
or any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding to the pipeline
bind point used by this command
accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> object that uses unnormalized coordinates,
that sampler <strong>must</strong> not be used with any of the SPIR-V <code>OpImageSample*</code>
or <code>OpImageSparseSample*</code> instructions with <code>ImplicitLod</code>, <code>Dref</code>
or <code>Proj</code> in their name, in any shader stage</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08611" href="#VUID-vkCmdTraceRaysKHR-None-08611"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08611</span><br>

If the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind point used by
this command
or any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding to the pipeline
bind point used by this command
accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> object that uses unnormalized coordinates,
that sampler <strong>must</strong> not be used with any of the SPIR-V <code>OpImageSample*</code>
or <code>OpImageSparseSample*</code> instructions that includes a LOD bias or any
offset values, in any shader stage</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08607" href="#VUID-vkCmdTraceRaysKHR-None-08607"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08607</span><br>

If the <a href="features.html#features-shaderObject" class="xref page"><code>shaderObject</code></a> feature is enabled,
either a valid pipeline <strong>must</strong> be bound to the pipeline bind point used
by this command, or a valid combination of valid and
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> shader objects <strong>must</strong> be bound to every supported
shader stage corresponding to the pipeline bind point used by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-uniformBuffers-06935" href="#VUID-vkCmdTraceRaysKHR-uniformBuffers-06935"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-uniformBuffers-06935</span><br>

If any stage of the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind
point used by this command accesses a uniform buffer,
and that stage was created without enabling either
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_EXT</code> or
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_2_EXT</code>
for <code>uniformBuffers</code>,
and the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a>
feature is not enabled, that stage <strong>must</strong> not access values outside of
the range of the buffer as specified in the descriptor set bound to the
same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08612" href="#VUID-vkCmdTraceRaysKHR-None-08612"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08612</span><br>

If the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a> feature
is not enabled, and any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding
to the pipeline bind point used by this command accesses a uniform
buffer, it <strong>must</strong> not access values outside of the range of the buffer as
specified in the descriptor set bound to the same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-storageBuffers-06936" href="#VUID-vkCmdTraceRaysKHR-storageBuffers-06936"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-storageBuffers-06936</span><br>

If any stage of the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind
point used by this command accesses a storage buffer,
and that stage was created without enabling either
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_EXT</code> or
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_2_EXT</code>
for <code>storageBuffers</code>,
and the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a>
feature is not enabled, that stage <strong>must</strong> not access values outside of
the range of the buffer as specified in the descriptor set bound to the
same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-08613" href="#VUID-vkCmdTraceRaysKHR-None-08613"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-08613</span><br>

If the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a> feature
is not enabled, and any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding
to the pipeline bind point used by this command accesses a storage
buffer, it <strong>must</strong> not access values outside of the range of the buffer as
specified in the descriptor set bound to the same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-commandBuffer-02707" href="#VUID-vkCmdTraceRaysKHR-commandBuffer-02707"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-commandBuffer-02707</span><br>

If <code>commandBuffer</code> is an unprotected command buffer and
<a href="devsandqueues.html#limits-protectedNoFault" class="xref page"><code>protectedNoFault</code></a> is not supported,
any resource accessed by <a href="shaders.html#shaders-binding" class="xref page">bound shaders</a> <strong>must</strong> not be
a protected resource</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-06550" href="#VUID-vkCmdTraceRaysKHR-None-06550"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-06550</span><br>

If <a href="shaders.html#shaders-binding" class="xref page">a bound shader</a> accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> or
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> object that enables
<a href="samplers.html#samplers-YCbCr-conversion" class="xref page">sampler Y′C<sub>B</sub>C<sub>R</sub> conversion</a>, that object
<strong>must</strong> only be used with <code>OpImageSample*</code> or <code>OpImageSparseSample*</code>
instructions</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-ConstOffset-06551" href="#VUID-vkCmdTraceRaysKHR-ConstOffset-06551"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-ConstOffset-06551</span><br>

If <a href="shaders.html#shaders-binding" class="xref page">a bound shader</a> accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> or
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> object that enables
<a href="samplers.html#samplers-YCbCr-conversion" class="xref page">sampler Y′C<sub>B</sub>C<sub>R</sub> conversion</a>, that object
<strong>must</strong> not use the <code>ConstOffset</code> and <code>Offset</code> operands</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-viewType-07752" href="#VUID-vkCmdTraceRaysKHR-viewType-07752"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-viewType-07752</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is accessed as a result of this command, then the
image view&#8217;s <code>viewType</code> <strong>must</strong> match the <code>Dim</code> operand of the
<code>OpTypeImage</code> as described in <a href="../appendices/spirvenv.html#spirvenv-image-dimensions" class="xref page">Compatibility Between SPIR-V Image Dimensions and Vulkan ImageView Types</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-format-07753" href="#VUID-vkCmdTraceRaysKHR-format-07753"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-format-07753</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is accessed as a result of this command, then the
<a href="formats.html#formats-numericformat" class="xref page">numeric type</a> of the image view&#8217;s <code>format</code>
and the <code>Sampled</code> <code>Type</code> operand of the <code>OpTypeImage</code> <strong>must</strong>
match</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpImageWrite-08795" href="#VUID-vkCmdTraceRaysKHR-OpImageWrite-08795"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpImageWrite-08795</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a>
created with a format other than <code>VK_FORMAT_A8_UNORM_KHR</code>
is accessed using <code>OpImageWrite</code> as a result of this command, then
the <code>Type</code> of the <code>Texel</code> operand of that instruction <strong>must</strong> have
at least as many components as the image view&#8217;s format</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpImageWrite-08796" href="#VUID-vkCmdTraceRaysKHR-OpImageWrite-08796"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpImageWrite-08796</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> created with the format
<code>VK_FORMAT_A8_UNORM_KHR</code> is accessed using <code>OpImageWrite</code> as a
result of this command, then the <code>Type</code> of the <code>Texel</code> operand of
that instruction <strong>must</strong> have four components</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpImageWrite-04469" href="#VUID-vkCmdTraceRaysKHR-OpImageWrite-04469"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpImageWrite-04469</span><br>

If a <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> is accessed using <code>OpImageWrite</code> as a result
of this command, then the <code>Type</code> of the <code>Texel</code> operand of that
instruction <strong>must</strong> have at least as many components as the buffer view&#8217;s
format</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-SampledType-04470" href="#VUID-vkCmdTraceRaysKHR-SampledType-04470"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-SampledType-04470</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a 64-bit component
width is accessed as a result of this command, the <code>SampledType</code> of
the <code>OpTypeImage</code> operand of that instruction <strong>must</strong> have a <code>Width</code>
of 64</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-SampledType-04471" href="#VUID-vkCmdTraceRaysKHR-SampledType-04471"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-SampledType-04471</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a component width
less than 64-bit is accessed as a result of this command, the
<code>SampledType</code> of the <code>OpTypeImage</code> operand of that instruction
<strong>must</strong> have a <code>Width</code> of 32</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-SampledType-04472" href="#VUID-vkCmdTraceRaysKHR-SampledType-04472"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-SampledType-04472</span><br>

If a <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a 64-bit
component width is accessed as a result of this command, the
<code>SampledType</code> of the <code>OpTypeImage</code> operand of that instruction
<strong>must</strong> have a <code>Width</code> of 64</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-SampledType-04473" href="#VUID-vkCmdTraceRaysKHR-SampledType-04473"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-SampledType-04473</span><br>

If a <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a component width
less than 64-bit is accessed as a result of this command, the
<code>SampledType</code> of the <code>OpTypeImage</code> operand of that instruction
<strong>must</strong> have a <code>Width</code> of 32</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-sparseImageInt64Atomics-04474" href="#VUID-vkCmdTraceRaysKHR-sparseImageInt64Atomics-04474"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-sparseImageInt64Atomics-04474</span><br>

If the <a href="features.html#features-sparseImageInt64Atomics" class="xref page">    <code>sparseImageInt64Atomics</code></a> feature is not enabled, <a href="resources.html#VkImage" class="xref page">VkImage</a>
objects created with the <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code> flag
<strong>must</strong> not be accessed by atomic instructions through an <code>OpTypeImage</code>
with a <code>SampledType</code> with a <code>Width</code> of 64 by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-sparseImageInt64Atomics-04475" href="#VUID-vkCmdTraceRaysKHR-sparseImageInt64Atomics-04475"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-sparseImageInt64Atomics-04475</span><br>

If the <a href="features.html#features-sparseImageInt64Atomics" class="xref page">    <code>sparseImageInt64Atomics</code></a> feature is not enabled, <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a>
objects created with the <code>VK_BUFFER_CREATE_SPARSE_RESIDENCY_BIT</code>
flag <strong>must</strong> not be accessed by atomic instructions through an
<code>OpTypeImage</code> with a <code>SampledType</code> with a <code>Width</code> of 64 by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpImageWeightedSampleQCOM-06971" href="#VUID-vkCmdTraceRaysKHR-OpImageWeightedSampleQCOM-06971"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpImageWeightedSampleQCOM-06971</span><br>

If <code>OpImageWeightedSampleQCOM</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a>
as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_WEIGHT_SAMPLED_IMAGE_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpImageWeightedSampleQCOM-06972" href="#VUID-vkCmdTraceRaysKHR-OpImageWeightedSampleQCOM-06972"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpImageWeightedSampleQCOM-06972</span><br>

If <code>OpImageWeightedSampleQCOM</code> uses a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a sample
weight image as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_WEIGHT_IMAGE_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpImageBoxFilterQCOM-06973" href="#VUID-vkCmdTraceRaysKHR-OpImageBoxFilterQCOM-06973"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpImageBoxFilterQCOM-06973</span><br>

If <code>OpImageBoxFilterQCOM</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a
result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BOX_FILTER_SAMPLED_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpImageBlockMatchSSDQCOM-06974" href="#VUID-vkCmdTraceRaysKHR-OpImageBlockMatchSSDQCOM-06974"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpImageBlockMatchSSDQCOM-06974</span><br>

If <code>OpImageBlockMatchSSDQCOM</code> is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BLOCK_MATCHING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpImageBlockMatchSADQCOM-06975" href="#VUID-vkCmdTraceRaysKHR-OpImageBlockMatchSADQCOM-06975"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpImageBlockMatchSADQCOM-06975</span><br>

If <code>OpImageBlockMatchSADQCOM</code> is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BLOCK_MATCHING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpImageBlockMatchSADQCOM-06976" href="#VUID-vkCmdTraceRaysKHR-OpImageBlockMatchSADQCOM-06976"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpImageBlockMatchSADQCOM-06976</span><br>

If <code>OpImageBlockMatchSADQCOM</code> or OpImageBlockMatchSSDQCOM is used to
read from a reference image as result of this command, then the
specified reference coordinates <strong>must</strong> not fail
<a href="textures.html#textures-integer-coordinate-validation" class="xref page">integer texel coordinate    validation</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpImageWeightedSampleQCOM-06977" href="#VUID-vkCmdTraceRaysKHR-OpImageWeightedSampleQCOM-06977"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpImageWeightedSampleQCOM-06977</span><br>

If <code>OpImageWeightedSampleQCOM</code>, <code>OpImageBoxFilterQCOM</code>,
<code>OpImageBlockMatchWindowSSDQCOM</code>,
<code>OpImageBlockMatchWindowSADQCOM</code>,
<code>OpImageBlockMatchGatherSSDQCOM</code>,
<code>OpImageBlockMatchGatherSADQCOM</code>,
<code>OpImageBlockMatchSSDQCOM</code>, or <code>OpImageBlockMatchSADQCOM</code> uses a
<a href="samplers.html#VkSampler" class="xref page">VkSampler</a> as a result of this command, then the sampler <strong>must</strong> have
been created with <code>VK_SAMPLER_CREATE_IMAGE_PROCESSING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpImageWeightedSampleQCOM-06978" href="#VUID-vkCmdTraceRaysKHR-OpImageWeightedSampleQCOM-06978"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpImageWeightedSampleQCOM-06978</span><br>

If any command other than <code>OpImageWeightedSampleQCOM</code>,
<code>OpImageBoxFilterQCOM</code>,
<code>OpImageBlockMatchWindowSSDQCOM</code>,
<code>OpImageBlockMatchWindowSADQCOM</code>,
<code>OpImageBlockMatchGatherSSDQCOM</code>,
<code>OpImageBlockMatchGatherSADQCOM</code>,
<code>OpImageBlockMatchSSDQCOM</code>, or <code>OpImageBlockMatchSADQCOM</code> uses a
<a href="samplers.html#VkSampler" class="xref page">VkSampler</a> as a result of this command, then the sampler <strong>must</strong> not
have been created with <code>VK_SAMPLER_CREATE_IMAGE_PROCESSING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpImageBlockMatchWindow-09215" href="#VUID-vkCmdTraceRaysKHR-OpImageBlockMatchWindow-09215"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpImageBlockMatchWindow-09215</span><br>

If a <code>OpImageBlockMatchWindow*QCOM</code> or
<code>OpImageBlockMatchGather*QCOM</code> instruction is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BLOCK_MATCHING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpImageBlockMatchWindow-09216" href="#VUID-vkCmdTraceRaysKHR-OpImageBlockMatchWindow-09216"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpImageBlockMatchWindow-09216</span><br>

If a <code>OpImageBlockMatchWindow*QCOM</code> or
<code>OpImageBlockMatchGather*QCOM</code> instruction is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
format <strong>must</strong> be a single-component format</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-OpImageBlockMatchWindow-09217" href="#VUID-vkCmdTraceRaysKHR-OpImageBlockMatchWindow-09217"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-OpImageBlockMatchWindow-09217</span><br>

If a <code>OpImageBlockMatchWindow*QCOM</code> or
<code>OpImageBlockMatchGather*QCOM</code> read from a reference image as result
of this command, then the specified reference coordinates <strong>must</strong> not fail
<a href="textures.html#textures-integer-coordinate-validation" class="xref page">integer texel coordinate    validation</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-07288" href="#VUID-vkCmdTraceRaysKHR-None-07288"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-07288</span><br>

Any shader invocation executed by this command <strong>must</strong>
<a href="shaders.html#shaders-termination" class="xref page">terminate</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-09600" href="#VUID-vkCmdTraceRaysKHR-None-09600"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-09600</span><br>

If a descriptor with type equal to any of
<code>VK_DESCRIPTOR_TYPE_SAMPLE_WEIGHT_IMAGE_QCOM</code>,
<code>VK_DESCRIPTOR_TYPE_BLOCK_MATCH_IMAGE_QCOM</code>,
<code>VK_DESCRIPTOR_TYPE_SAMPLED_IMAGE</code>,
<code>VK_DESCRIPTOR_TYPE_STORAGE_IMAGE</code>, or
<code>VK_DESCRIPTOR_TYPE_INPUT_ATTACHMENT</code> is accessed as a result of
this command, the image subresource identified by that descriptor <strong>must</strong>
be in the image layout identified when the descriptor was written</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-03429" href="#VUID-vkCmdTraceRaysKHR-None-03429"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-03429</span><br>

Any shader group handle referenced by this call <strong>must</strong> have been queried
from the currently bound ray tracing pipeline</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-None-09458" href="#VUID-vkCmdTraceRaysKHR-None-09458"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-None-09458</span><br>

If the bound ray tracing pipeline state was created with the
<code>VK_DYNAMIC_STATE_RAY_TRACING_PIPELINE_STACK_SIZE_KHR</code> dynamic state
enabled then <a href="pipelines.html#vkCmdSetRayTracingPipelineStackSizeKHR" class="xref page">vkCmdSetRayTracingPipelineStackSizeKHR</a> <strong>must</strong> have
been called in the current command buffer prior to this trace command</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-maxPipelineRayRecursionDepth-03679" href="#VUID-vkCmdTraceRaysKHR-maxPipelineRayRecursionDepth-03679"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-maxPipelineRayRecursionDepth-03679</span><br>

This command <strong>must</strong> not cause a shader call instruction to be executed
from a shader invocation with a <a href="#ray-tracing-recursion-depth">recursion    depth</a> greater than the value of <code>maxPipelineRayRecursionDepth</code>
used to create the bound ray tracing pipeline</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-commandBuffer-03635" href="#VUID-vkCmdTraceRaysKHR-commandBuffer-03635"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-commandBuffer-03635</span><br>

<code>commandBuffer</code> <strong>must</strong> not be a protected command buffer</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-size-04023" href="#VUID-vkCmdTraceRaysKHR-size-04023"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-size-04023</span><br>

The <code>size</code> member of <code>pRayGenShaderBindingTable</code> <strong>must</strong> be equal
to its <code>stride</code> member</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pRayGenShaderBindingTable-03680" href="#VUID-vkCmdTraceRaysKHR-pRayGenShaderBindingTable-03680"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pRayGenShaderBindingTable-03680</span><br>

If the buffer from which <code>pRayGenShaderBindingTable-&gt;deviceAddress</code> was queried
is non-sparse then it <strong>must</strong> be bound completely and contiguously to a
single <code>VkDeviceMemory</code> object</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pRayGenShaderBindingTable-03681" href="#VUID-vkCmdTraceRaysKHR-pRayGenShaderBindingTable-03681"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pRayGenShaderBindingTable-03681</span><br>

The buffer from which the <code>pRayGenShaderBindingTable-&gt;deviceAddress</code> is queried
<strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_SHADER_BINDING_TABLE_BIT_KHR</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pRayGenShaderBindingTable-03682" href="#VUID-vkCmdTraceRaysKHR-pRayGenShaderBindingTable-03682"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pRayGenShaderBindingTable-03682</span><br>

<code>pRayGenShaderBindingTable-&gt;deviceAddress</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pMissShaderBindingTable-03683" href="#VUID-vkCmdTraceRaysKHR-pMissShaderBindingTable-03683"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pMissShaderBindingTable-03683</span><br>

If the buffer from which <code>pMissShaderBindingTable-&gt;deviceAddress</code> was queried is
non-sparse then it <strong>must</strong> be bound completely and contiguously to a
single <code>VkDeviceMemory</code> object</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pMissShaderBindingTable-03684" href="#VUID-vkCmdTraceRaysKHR-pMissShaderBindingTable-03684"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pMissShaderBindingTable-03684</span><br>

The buffer from which the <code>pMissShaderBindingTable-&gt;deviceAddress</code> is queried
<strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_SHADER_BINDING_TABLE_BIT_KHR</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pMissShaderBindingTable-03685" href="#VUID-vkCmdTraceRaysKHR-pMissShaderBindingTable-03685"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pMissShaderBindingTable-03685</span><br>

<code>pMissShaderBindingTable-&gt;deviceAddress</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-stride-03686" href="#VUID-vkCmdTraceRaysKHR-stride-03686"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-stride-03686</span><br>

<code>pMissShaderBindingTable-&gt;stride</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupHandleAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-stride-04029" href="#VUID-vkCmdTraceRaysKHR-stride-04029"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-stride-04029</span><br>

<code>pMissShaderBindingTable-&gt;stride</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>maxShaderGroupStride</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-03687" href="#VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-03687"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-03687</span><br>

If the buffer from which <code>pHitShaderBindingTable-&gt;deviceAddress</code> was queried is
non-sparse then it <strong>must</strong> be bound completely and contiguously to a
single <code>VkDeviceMemory</code> object</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-03688" href="#VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-03688"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-03688</span><br>

The buffer from which the <code>pHitShaderBindingTable-&gt;deviceAddress</code> is queried
<strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_SHADER_BINDING_TABLE_BIT_KHR</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-03689" href="#VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-03689"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-03689</span><br>

<code>pHitShaderBindingTable-&gt;deviceAddress</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-stride-03690" href="#VUID-vkCmdTraceRaysKHR-stride-03690"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-stride-03690</span><br>

<code>pHitShaderBindingTable-&gt;stride</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupHandleAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-stride-04035" href="#VUID-vkCmdTraceRaysKHR-stride-04035"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-stride-04035</span><br>

<code>pHitShaderBindingTable-&gt;stride</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>maxShaderGroupStride</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pCallableShaderBindingTable-03691" href="#VUID-vkCmdTraceRaysKHR-pCallableShaderBindingTable-03691"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pCallableShaderBindingTable-03691</span><br>

If the buffer from which <code>pCallableShaderBindingTable-&gt;deviceAddress</code> was queried
is non-sparse then it <strong>must</strong> be bound completely and contiguously to a
single <code>VkDeviceMemory</code> object</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pCallableShaderBindingTable-03692" href="#VUID-vkCmdTraceRaysKHR-pCallableShaderBindingTable-03692"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pCallableShaderBindingTable-03692</span><br>

The buffer from which the <code>pCallableShaderBindingTable-&gt;deviceAddress</code> is queried
<strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_SHADER_BINDING_TABLE_BIT_KHR</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pCallableShaderBindingTable-03693" href="#VUID-vkCmdTraceRaysKHR-pCallableShaderBindingTable-03693"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pCallableShaderBindingTable-03693</span><br>

<code>pCallableShaderBindingTable-&gt;deviceAddress</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-stride-03694" href="#VUID-vkCmdTraceRaysKHR-stride-03694"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-stride-03694</span><br>

<code>pCallableShaderBindingTable-&gt;stride</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupHandleAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-stride-04041" href="#VUID-vkCmdTraceRaysKHR-stride-04041"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-stride-04041</span><br>

<code>pCallableShaderBindingTable-&gt;stride</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>maxShaderGroupStride</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-flags-03696" href="#VUID-vkCmdTraceRaysKHR-flags-03696"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-flags-03696</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_CLOSEST_HIT_SHADERS_BIT_KHR</code>,
<code>pHitShaderBindingTable-&gt;deviceAddress</code> <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-flags-03697" href="#VUID-vkCmdTraceRaysKHR-flags-03697"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-flags-03697</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_INTERSECTION_SHADERS_BIT_KHR</code>,
<code>pHitShaderBindingTable-&gt;deviceAddress</code> <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-flags-03511" href="#VUID-vkCmdTraceRaysKHR-flags-03511"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-flags-03511</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_MISS_SHADERS_BIT_KHR</code>, the
shader group handle identified by <code>pMissShaderBindingTable-&gt;deviceAddress</code> <strong>must</strong>
not be zero</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-flags-03512" href="#VUID-vkCmdTraceRaysKHR-flags-03512"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-flags-03512</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_ANY_HIT_SHADERS_BIT_KHR</code>,
entries in the table identified by <code>pHitShaderBindingTable-&gt;deviceAddress</code>
accessed as a result of this command in order to execute an any-hit
shader <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-flags-03513" href="#VUID-vkCmdTraceRaysKHR-flags-03513"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-flags-03513</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_CLOSEST_HIT_SHADERS_BIT_KHR</code>,
entries in the table identified by <code>pHitShaderBindingTable-&gt;deviceAddress</code>
accessed as a result of this command in order to execute a closest hit
shader <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-flags-03514" href="#VUID-vkCmdTraceRaysKHR-flags-03514"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-flags-03514</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_INTERSECTION_SHADERS_BIT_KHR</code>,
entries in the table identified by <code>pHitShaderBindingTable-&gt;deviceAddress</code>
accessed as a result of this command in order to execute an intersection
shader <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-04735" href="#VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-04735"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-04735</span><br>

Any non-zero hit shader group entries in the table identified by
<code>pHitShaderBindingTable-&gt;deviceAddress</code> accessed by this call from a geometry
with a <code>geometryType</code> of <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code> <strong>must</strong>
have been created with
<code>VK_RAY_TRACING_SHADER_GROUP_TYPE_TRIANGLES_HIT_GROUP_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-04736" href="#VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-04736"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-04736</span><br>

Any non-zero hit shader group entries in the table identified by
<code>pHitShaderBindingTable-&gt;deviceAddress</code> accessed by this call from a geometry
with a <code>geometryType</code> of <code>VK_GEOMETRY_TYPE_AABBS_KHR</code> <strong>must</strong> have
been created with
<code>VK_RAY_TRACING_SHADER_GROUP_TYPE_PROCEDURAL_HIT_GROUP_KHR</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-width-03638" href="#VUID-vkCmdTraceRaysKHR-width-03638"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-width-03638</span><br>

<code>width</code> <strong>must</strong> be less than or equal to
<span class="eq"><code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupCount</code>[0]
× <code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupSize</code>[0]</span></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-height-03639" href="#VUID-vkCmdTraceRaysKHR-height-03639"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-height-03639</span><br>

<code>height</code> <strong>must</strong> be less than or equal to
<span class="eq"><code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupCount</code>[1]
× <code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupSize</code>[1]</span></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-depth-03640" href="#VUID-vkCmdTraceRaysKHR-depth-03640"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-depth-03640</span><br>

<code>depth</code> <strong>must</strong> be less than or equal to
<span class="eq"><code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupCount</code>[2]
× <code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupSize</code>[2]</span></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-width-03641" href="#VUID-vkCmdTraceRaysKHR-width-03641"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-width-03641</span><br>

<span class="eq"><code>width</code> × <code>height</code> × <code>depth</code></span> <strong>must</strong> be less
than or equal to
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>maxRayDispatchInvocationCount</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-commandBuffer-parameter" href="#VUID-vkCmdTraceRaysKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pRaygenShaderBindingTable-parameter" href="#VUID-vkCmdTraceRaysKHR-pRaygenShaderBindingTable-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pRaygenShaderBindingTable-parameter</span><br>
 <code>pRaygenShaderBindingTable</code> <strong>must</strong> be a valid pointer to a valid <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pMissShaderBindingTable-parameter" href="#VUID-vkCmdTraceRaysKHR-pMissShaderBindingTable-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pMissShaderBindingTable-parameter</span><br>
 <code>pMissShaderBindingTable</code> <strong>must</strong> be a valid pointer to a valid <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-parameter" href="#VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pHitShaderBindingTable-parameter</span><br>
 <code>pHitShaderBindingTable</code> <strong>must</strong> be a valid pointer to a valid <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-pCallableShaderBindingTable-parameter" href="#VUID-vkCmdTraceRaysKHR-pCallableShaderBindingTable-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-pCallableShaderBindingTable-parameter</span><br>
 <code>pCallableShaderBindingTable</code> <strong>must</strong> be a valid pointer to a valid <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-commandBuffer-recording" href="#VUID-vkCmdTraceRaysKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-commandBuffer-cmdpool" href="#VUID-vkCmdTraceRaysKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-renderpass" href="#VUID-vkCmdTraceRaysKHR-renderpass"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysKHR-videocoding" href="#VUID-vkCmdTraceRaysKHR-videocoding"></a> <span class="vuid">VUID-vkCmdTraceRaysKHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>When invocation mask image usage is enabled in the bound ray tracing
pipeline, the pipeline uses an invocation mask image specified by the
command:</p>
</div>
<div id="vkCmdBindInvocationMaskHUAWEI" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_HUAWEI_invocation_mask
void vkCmdBindInvocationMaskHUAWEI(
    VkCommandBuffer                             commandBuffer,
    VkImageView                                 imageView,
    VkImageLayout                               imageLayout);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded</p>
</li>
<li>
<p><code>imageView</code> is an image view handle specifying the invocation mask
image <code>imageView</code> <strong>may</strong> be <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, which is equivalent
to specifying a view of an image filled with ones value.</p>
</li>
<li>
<p><code>imageLayout</code> is the layout that the image subresources accessible
from <code>imageView</code> will be in when the invocation mask image is
accessed</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-None-04976" href="#VUID-vkCmdBindInvocationMaskHUAWEI-None-04976"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-None-04976</span><br>

The <a href="features.html#features-invocationMask" class="xref page"><code>invocationMask</code></a> feature <strong>must</strong> be
enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-imageView-04977" href="#VUID-vkCmdBindInvocationMaskHUAWEI-imageView-04977"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-imageView-04977</span><br>

If <code>imageView</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, it <strong>must</strong> be a valid
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> handle of type <code>VK_IMAGE_VIEW_TYPE_2D</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-imageView-04978" href="#VUID-vkCmdBindInvocationMaskHUAWEI-imageView-04978"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-imageView-04978</span><br>

If <code>imageView</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, it <strong>must</strong> have a format
of <code>VK_FORMAT_R8_UINT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-imageView-04979" href="#VUID-vkCmdBindInvocationMaskHUAWEI-imageView-04979"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-imageView-04979</span><br>

If <code>imageView</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, it <strong>must</strong> have been
created with <code>VK_IMAGE_USAGE_INVOCATION_MASK_BIT_HUAWEI</code> set</p>
</li>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-imageView-04980" href="#VUID-vkCmdBindInvocationMaskHUAWEI-imageView-04980"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-imageView-04980</span><br>

If <code>imageView</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>imageLayout</code> <strong>must</strong>
be <code>VK_IMAGE_LAYOUT_GENERAL</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-width-04981" href="#VUID-vkCmdBindInvocationMaskHUAWEI-width-04981"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-width-04981</span><br>

Thread mask image resolution <strong>must</strong> match the <code>width</code> and
<code>height</code> in <a href="#vkCmdTraceRaysKHR">vkCmdTraceRaysKHR</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-None-04982" href="#VUID-vkCmdBindInvocationMaskHUAWEI-None-04982"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-None-04982</span><br>

Each element in the invocation mask image <strong>must</strong> have the value <code>0</code> or
<code>1</code>.
The value 1 means the invocation is active</p>
</li>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-depth-04983" href="#VUID-vkCmdBindInvocationMaskHUAWEI-depth-04983"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-depth-04983</span><br>

<code>depth</code> in <a href="#vkCmdTraceRaysKHR">vkCmdTraceRaysKHR</a> <strong>must</strong> be 1</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-commandBuffer-parameter" href="#VUID-vkCmdBindInvocationMaskHUAWEI-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-imageView-parameter" href="#VUID-vkCmdBindInvocationMaskHUAWEI-imageView-parameter"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-imageView-parameter</span><br>
 If <code>imageView</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>imageView</code> <strong>must</strong> be a valid <a href="resources.html#VkImageView" class="xref page">VkImageView</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-imageLayout-parameter" href="#VUID-vkCmdBindInvocationMaskHUAWEI-imageLayout-parameter"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-imageLayout-parameter</span><br>
 <code>imageLayout</code> <strong>must</strong> be a valid <a href="resources.html#VkImageLayout" class="xref page">VkImageLayout</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-commandBuffer-recording" href="#VUID-vkCmdBindInvocationMaskHUAWEI-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-commandBuffer-cmdpool" href="#VUID-vkCmdBindInvocationMaskHUAWEI-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-renderpass" href="#VUID-vkCmdBindInvocationMaskHUAWEI-renderpass"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-videocoding" href="#VUID-vkCmdBindInvocationMaskHUAWEI-videocoding"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdBindInvocationMaskHUAWEI-commonparent" href="#VUID-vkCmdBindInvocationMaskHUAWEI-commonparent"></a> <span class="vuid">VUID-vkCmdBindInvocationMaskHUAWEI-commonparent</span><br>
 Both of <code>commandBuffer</code>, and <code>imageView</code> that are valid handles of non-ignored parameters <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To dispatch ray tracing, with some parameters sourced on the device, use:</p>
</div>
<div id="vkCmdTraceRaysIndirectKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_ray_tracing_pipeline
void vkCmdTraceRaysIndirectKHR(
    VkCommandBuffer                             commandBuffer,
    const VkStridedDeviceAddressRegionKHR*      pRaygenShaderBindingTable,
    const VkStridedDeviceAddressRegionKHR*      pMissShaderBindingTable,
    const VkStridedDeviceAddressRegionKHR*      pHitShaderBindingTable,
    const VkStridedDeviceAddressRegionKHR*      pCallableShaderBindingTable,
    VkDeviceAddress                             indirectDeviceAddress);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pRaygenShaderBindingTable</code> is a
<a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a> that holds the shader binding
table data for the ray generation shader stage.</p>
</li>
<li>
<p><code>pMissShaderBindingTable</code> is a <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a>
that holds the shader binding table data for the miss shader stage.</p>
</li>
<li>
<p><code>pHitShaderBindingTable</code> is a <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a>
that holds the shader binding table data for the hit shader stage.</p>
</li>
<li>
<p><code>pCallableShaderBindingTable</code> is a
<a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a> that holds the shader binding
table data for the callable shader stage.</p>
</li>
<li>
<p><code>indirectDeviceAddress</code> is a buffer device address which is a
pointer to a <a href="#VkTraceRaysIndirectCommandKHR">VkTraceRaysIndirectCommandKHR</a> structure containing
the trace ray parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>vkCmdTraceRaysIndirectKHR</code> behaves similarly to <a href="#vkCmdTraceRaysKHR">vkCmdTraceRaysKHR</a>
except that the ray trace query dimensions are read by the device from
<code>indirectDeviceAddress</code> during execution.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-magFilter-04553" href="#VUID-vkCmdTraceRaysIndirectKHR-magFilter-04553"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-magFilter-04553</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>magFilter</code> or <code>minFilter</code>
equal to <code>VK_FILTER_LINEAR</code>,
<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE</code>,
and <code>compareEnable</code> equal to <code>VK_FALSE</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-magFilter-09598" href="#VUID-vkCmdTraceRaysIndirectKHR-magFilter-09598"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-magFilter-09598</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>magFilter</code> or <code>minFilter</code>
equal to <code>VK_FILTER_LINEAR</code> and <code>reductionMode</code> equal to either
<code>VK_SAMPLER_REDUCTION_MODE_MIN</code> or
<code>VK_SAMPLER_REDUCTION_MODE_MAX</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_MINMAX_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-mipmapMode-04770" href="#VUID-vkCmdTraceRaysIndirectKHR-mipmapMode-04770"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-mipmapMode-04770</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>mipmapMode</code> equal to
<code>VK_SAMPLER_MIPMAP_MODE_LINEAR</code>,
<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE</code>,
and <code>compareEnable</code> equal to <code>VK_FALSE</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-mipmapMode-09599" href="#VUID-vkCmdTraceRaysIndirectKHR-mipmapMode-09599"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-mipmapMode-09599</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>mipmapMode</code> equal to
<code>VK_SAMPLER_MIPMAP_MODE_LINEAR</code> and <code>reductionMode</code> equal to
either <code>VK_SAMPLER_REDUCTION_MODE_MIN</code> or
<code>VK_SAMPLER_REDUCTION_MODE_MAX</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_MINMAX_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-unnormalizedCoordinates-09635" href="#VUID-vkCmdTraceRaysIndirectKHR-unnormalizedCoordinates-09635"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-unnormalizedCoordinates-09635</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>unnormalizedCoordinates</code> equal to
<code>VK_TRUE</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this
command, then the image view&#8217;s <code>levelCount</code> and <code>layerCount</code>
<strong>must</strong> be 1</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-unnormalizedCoordinates-09636" href="#VUID-vkCmdTraceRaysIndirectKHR-unnormalizedCoordinates-09636"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-unnormalizedCoordinates-09636</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>unnormalizedCoordinates</code> equal to
<code>VK_TRUE</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this
command, then the image view&#8217;s <code>viewType</code> <strong>must</strong> be
<code>VK_IMAGE_VIEW_TYPE_1D</code> or <code>VK_IMAGE_VIEW_TYPE_2D</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-06479" href="#VUID-vkCmdTraceRaysIndirectKHR-None-06479"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-06479</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is sampled with
<a href="textures.html#textures-depth-compare-operation" class="xref page">depth comparison</a>, the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_SAMPLED_IMAGE_DEPTH_COMPARISON_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-02691" href="#VUID-vkCmdTraceRaysIndirectKHR-None-02691"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-02691</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is accessed using atomic operations as a result
of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_STORAGE_IMAGE_ATOMIC_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-07888" href="#VUID-vkCmdTraceRaysIndirectKHR-None-07888"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-07888</span><br>

If a <code>VK_DESCRIPTOR_TYPE_STORAGE_TEXEL_BUFFER</code> descriptor is
accessed using atomic operations as a result of this command, then the
storage texel buffer&#8217;s <a href="resources.html#resources-buffer-view-format-features" class="xref page">format    features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_STORAGE_TEXEL_BUFFER_ATOMIC_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-02692" href="#VUID-vkCmdTraceRaysIndirectKHR-None-02692"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-02692</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_CUBIC_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-02693" href="#VUID-vkCmdTraceRaysIndirectKHR-None-02693"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-02693</span><br>

If
the <a href="../appendices/extensions.html#VK_EXT_filter_cubic" class="xref page">VK_EXT_filter_cubic</a> extension is not enabled and
any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command, it <strong>must</strong> not have a <a href="resources.html#VkImageViewType" class="xref page">VkImageViewType</a> of
<code>VK_IMAGE_VIEW_TYPE_3D</code>, <code>VK_IMAGE_VIEW_TYPE_CUBE</code>, or
<code>VK_IMAGE_VIEW_TYPE_CUBE_ARRAY</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-filterCubic-02694" href="#VUID-vkCmdTraceRaysIndirectKHR-filterCubic-02694"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-filterCubic-02694</span><br>

Any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command <strong>must</strong> have a <a href="resources.html#VkImageViewType" class="xref page">VkImageViewType</a> and format
that supports cubic filtering, as specified by
<a href="capabilities.html#VkFilterCubicImageViewImageFormatPropertiesEXT" class="xref page">VkFilterCubicImageViewImageFormatPropertiesEXT</a>::<code>filterCubic</code>
returned by <a href="capabilities.html#vkGetPhysicalDeviceImageFormatProperties2" class="xref page">vkGetPhysicalDeviceImageFormatProperties2</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-filterCubicMinmax-02695" href="#VUID-vkCmdTraceRaysIndirectKHR-filterCubicMinmax-02695"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-filterCubicMinmax-02695</span><br>

Any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with <code>VK_FILTER_CUBIC_EXT</code> with
a reduction mode of either <code>VK_SAMPLER_REDUCTION_MODE_MIN</code> or
<code>VK_SAMPLER_REDUCTION_MODE_MAX</code> as a result of this command <strong>must</strong>
have a <a href="resources.html#VkImageViewType" class="xref page">VkImageViewType</a> and format that supports cubic filtering
together with minmax filtering, as specified by
<a href="capabilities.html#VkFilterCubicImageViewImageFormatPropertiesEXT" class="xref page">VkFilterCubicImageViewImageFormatPropertiesEXT</a>::<code>filterCubicMinmax</code>
returned by <a href="capabilities.html#vkGetPhysicalDeviceImageFormatProperties2" class="xref page">vkGetPhysicalDeviceImageFormatProperties2</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-cubicRangeClamp-09212" href="#VUID-vkCmdTraceRaysIndirectKHR-cubicRangeClamp-09212"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-cubicRangeClamp-09212</span><br>

If the <a href="features.html#features-filter-cubic-range-clamp" class="xref page"><code>cubicRangeClamp</code></a>
feature is not enabled, then any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with
<code>VK_FILTER_CUBIC_EXT</code> as a result of this command <strong>must</strong> not have a
<a href="samplers.html#VkSamplerReductionModeCreateInfo" class="xref page">VkSamplerReductionModeCreateInfo</a>::<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE_RANGECLAMP_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-reductionMode-09213" href="#VUID-vkCmdTraceRaysIndirectKHR-reductionMode-09213"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-reductionMode-09213</span><br>

Any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with a
<a href="samplers.html#VkSamplerReductionModeCreateInfo" class="xref page">VkSamplerReductionModeCreateInfo</a>::<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE_RANGECLAMP_QCOM</code> as a
result of this command <strong>must</strong> sample with <code>VK_FILTER_CUBIC_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-selectableCubicWeights-09214" href="#VUID-vkCmdTraceRaysIndirectKHR-selectableCubicWeights-09214"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-selectableCubicWeights-09214</span><br>

If the <a href="features.html#features-filter-cubic-weight-selection" class="xref page">    <code>selectableCubicWeights</code></a> feature is not enabled, then any
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command <strong>must</strong> have
<a href="samplers.html#VkSamplerCubicWeightsCreateInfoQCOM" class="xref page">VkSamplerCubicWeightsCreateInfoQCOM</a>::<code>cubicWeights</code> equal to
<code>VK_CUBIC_FILTER_WEIGHTS_CATMULL_ROM_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-flags-02696" href="#VUID-vkCmdTraceRaysIndirectKHR-flags-02696"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-flags-02696</span><br>

Any <a href="resources.html#VkImage" class="xref page">VkImage</a> created with a <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>::<code>flags</code>
containing <code>VK_IMAGE_CREATE_CORNER_SAMPLED_BIT_NV</code> sampled as a
result of this command <strong>must</strong> only be sampled using a
<a href="samplers.html#VkSamplerAddressMode" class="xref page">VkSamplerAddressMode</a> of
<code>VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_EDGE</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpTypeImage-07027" href="#VUID-vkCmdTraceRaysIndirectKHR-OpTypeImage-07027"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpTypeImage-07027</span><br>

For any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being written as a storage image where the
image format field of the <code>OpTypeImage</code> is <code>Unknown</code>, the view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_WRITE_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpTypeImage-07028" href="#VUID-vkCmdTraceRaysIndirectKHR-OpTypeImage-07028"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpTypeImage-07028</span><br>

For any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being read as a storage image where the image
format field of the <code>OpTypeImage</code> is <code>Unknown</code>, the view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_READ_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpTypeImage-07029" href="#VUID-vkCmdTraceRaysIndirectKHR-OpTypeImage-07029"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpTypeImage-07029</span><br>

For any <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> being written as a storage texel buffer where
the image format field of the <code>OpTypeImage</code> is <code>Unknown</code>, the
view&#8217;s <a href="formats.html#VkFormatProperties3" class="xref page">buffer features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_WRITE_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpTypeImage-07030" href="#VUID-vkCmdTraceRaysIndirectKHR-OpTypeImage-07030"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpTypeImage-07030</span><br>

Any <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> being read as a storage texel buffer where the
image format field of the <code>OpTypeImage</code> is <code>Unknown</code> then the
view&#8217;s <a href="formats.html#VkFormatProperties3" class="xref page">buffer features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_READ_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08600" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08600"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08600</span><br>

For each set <em>n</em> that is statically used by <a href="shaders.html#shaders-binding" class="xref page">a bound    shader</a>, a descriptor set <strong>must</strong> have been bound to <em>n</em> at the same
pipeline bind point, with a <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> that is compatible
for set <em>n</em>, with the <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> used to create the current
<a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a>
or the <a href="descriptorsets.html#VkDescriptorSetLayout" class="xref page">VkDescriptorSetLayout</a> array used to create the current
<a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a>
, as described in <a href="descriptorsets.html#descriptorsets-compatibility" class="xref page">Pipeline Layout Compatibility</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08601" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08601"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08601</span><br>

For each push constant that is statically used by <a href="shaders.html#shaders-binding" class="xref page">a    bound shader</a>, a push constant value <strong>must</strong> have been set for the same
pipeline bind point, with a <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> that is compatible
for push constants, with the <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> used to create the
current <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a>
or the <a href="descriptorsets.html#VkDescriptorSetLayout" class="xref page">VkDescriptorSetLayout</a> array used to create the current
<a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a>
, as described in <a href="descriptorsets.html#descriptorsets-compatibility" class="xref page">Pipeline Layout Compatibility</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-10068" href="#VUID-vkCmdTraceRaysIndirectKHR-None-10068"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-10068</span><br>

For each array of resources that is used by <a href="shaders.html#shaders-binding" class="xref page">a bound    shader</a>, the indices used to access members of the array <strong>must</strong> be less
than the descriptor count for the identified binding in the descriptor
sets used by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-maintenance4-08602" href="#VUID-vkCmdTraceRaysIndirectKHR-maintenance4-08602"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-maintenance4-08602</span><br>

If the <a href="features.html#features-maintenance4" class="xref page"><code>maintenance4</code></a> feature is not
enabled, then for each push constant that is statically used by
<a href="shaders.html#shaders-binding" class="xref page">a bound shader</a>, a push constant value <strong>must</strong> have
been set for the same pipeline bind point, with a <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a>
that is compatible for push constants, with the <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a>
used to create the current <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a>
or the <a href="descriptorsets.html#VkDescriptorSetLayout" class="xref page">VkDescriptorSetLayout</a> and <a href="descriptorsets.html#VkPushConstantRange" class="xref page">VkPushConstantRange</a> arrays
used to create the current <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a>
, as described in <a href="descriptorsets.html#descriptorsets-compatibility" class="xref page">Pipeline Layout Compatibility</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08114" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08114"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08114</span><br>

Descriptors in each bound descriptor set, specified via
<a href="descriptorsets.html#vkCmdBindDescriptorSets" class="xref page">vkCmdBindDescriptorSets</a>, <strong>must</strong> be valid as described by
<a href="descriptorsets.html#descriptor-validity" class="xref page">descriptor validity</a> if they are statically used
by
the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline bind point used by this
command and the bound <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> was not created with
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08115" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08115"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08115</span><br>

If the descriptors used by the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline
bind point were specified via <a href="descriptorsets.html#vkCmdBindDescriptorSets" class="xref page">vkCmdBindDescriptorSets</a>, the bound
<a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> <strong>must</strong> have been created without
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08116" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08116"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08116</span><br>

Descriptors in bound descriptor buffers, specified via
<a href="descriptorsets.html#vkCmdSetDescriptorBufferOffsetsEXT" class="xref page">vkCmdSetDescriptorBufferOffsetsEXT</a>, <strong>must</strong> be valid if they are
dynamically used by the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline bind
point used by this command and the bound <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> was created
with <code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08604" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08604"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08604</span><br>

Descriptors in bound descriptor buffers, specified via
<a href="descriptorsets.html#vkCmdSetDescriptorBufferOffsetsEXT" class="xref page">vkCmdSetDescriptorBufferOffsetsEXT</a>, <strong>must</strong> be valid if they are
dynamically used by any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding
to the pipeline bind point used by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08117" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08117"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08117</span><br>

If the descriptors used by the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline
bind point were specified via <a href="descriptorsets.html#vkCmdSetDescriptorBufferOffsetsEXT" class="xref page">vkCmdSetDescriptorBufferOffsetsEXT</a>,
the bound <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> <strong>must</strong> have been created with
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08119" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08119"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08119</span><br>

If a descriptor is dynamically used with a <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> created with
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code>, the descriptor
memory <strong>must</strong> be resident</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08605" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08605"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08605</span><br>

If a descriptor is dynamically used with a <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> created
with a <code>VkDescriptorSetLayout</code> that was created with
<code>VK_DESCRIPTOR_SET_LAYOUT_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code>, the
descriptor memory <strong>must</strong> be resident</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08606" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08606"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08606</span><br>

If the <a href="features.html#features-shaderObject" class="xref page"><code>shaderObject</code></a> feature is not
enabled, a
valid pipeline <strong>must</strong> be bound to the pipeline bind point used by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08608" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08608"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08608</span><br>

If a pipeline is bound to the pipeline bind point used by this command,
there
<strong>must</strong> not have been any calls to dynamic state setting commands for any
state specified statically in the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the
pipeline bind point used by this command, since that pipeline was bound</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08609" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08609"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08609</span><br>

If the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind point used by
this command
or any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding to the pipeline
bind point used by this command
accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> object that uses unnormalized coordinates,
that sampler <strong>must</strong> not be used to sample from any <a href="resources.html#VkImage" class="xref page">VkImage</a> with a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> of the type <code>VK_IMAGE_VIEW_TYPE_3D</code>,
<code>VK_IMAGE_VIEW_TYPE_CUBE</code>, <code>VK_IMAGE_VIEW_TYPE_1D_ARRAY</code>,
<code>VK_IMAGE_VIEW_TYPE_2D_ARRAY</code> or
<code>VK_IMAGE_VIEW_TYPE_CUBE_ARRAY</code>, in any shader stage</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08610" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08610"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08610</span><br>

If the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind point used by
this command
or any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding to the pipeline
bind point used by this command
accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> object that uses unnormalized coordinates,
that sampler <strong>must</strong> not be used with any of the SPIR-V <code>OpImageSample*</code>
or <code>OpImageSparseSample*</code> instructions with <code>ImplicitLod</code>, <code>Dref</code>
or <code>Proj</code> in their name, in any shader stage</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08611" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08611"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08611</span><br>

If the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind point used by
this command
or any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding to the pipeline
bind point used by this command
accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> object that uses unnormalized coordinates,
that sampler <strong>must</strong> not be used with any of the SPIR-V <code>OpImageSample*</code>
or <code>OpImageSparseSample*</code> instructions that includes a LOD bias or any
offset values, in any shader stage</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08607" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08607"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08607</span><br>

If the <a href="features.html#features-shaderObject" class="xref page"><code>shaderObject</code></a> feature is enabled,
either a valid pipeline <strong>must</strong> be bound to the pipeline bind point used
by this command, or a valid combination of valid and
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> shader objects <strong>must</strong> be bound to every supported
shader stage corresponding to the pipeline bind point used by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-uniformBuffers-06935" href="#VUID-vkCmdTraceRaysIndirectKHR-uniformBuffers-06935"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-uniformBuffers-06935</span><br>

If any stage of the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind
point used by this command accesses a uniform buffer,
and that stage was created without enabling either
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_EXT</code> or
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_2_EXT</code>
for <code>uniformBuffers</code>,
and the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a>
feature is not enabled, that stage <strong>must</strong> not access values outside of
the range of the buffer as specified in the descriptor set bound to the
same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08612" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08612"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08612</span><br>

If the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a> feature
is not enabled, and any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding
to the pipeline bind point used by this command accesses a uniform
buffer, it <strong>must</strong> not access values outside of the range of the buffer as
specified in the descriptor set bound to the same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-storageBuffers-06936" href="#VUID-vkCmdTraceRaysIndirectKHR-storageBuffers-06936"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-storageBuffers-06936</span><br>

If any stage of the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind
point used by this command accesses a storage buffer,
and that stage was created without enabling either
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_EXT</code> or
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_2_EXT</code>
for <code>storageBuffers</code>,
and the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a>
feature is not enabled, that stage <strong>must</strong> not access values outside of
the range of the buffer as specified in the descriptor set bound to the
same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-08613" href="#VUID-vkCmdTraceRaysIndirectKHR-None-08613"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-08613</span><br>

If the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a> feature
is not enabled, and any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding
to the pipeline bind point used by this command accesses a storage
buffer, it <strong>must</strong> not access values outside of the range of the buffer as
specified in the descriptor set bound to the same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-02707" href="#VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-02707"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-02707</span><br>

If <code>commandBuffer</code> is an unprotected command buffer and
<a href="devsandqueues.html#limits-protectedNoFault" class="xref page"><code>protectedNoFault</code></a> is not supported,
any resource accessed by <a href="shaders.html#shaders-binding" class="xref page">bound shaders</a> <strong>must</strong> not be
a protected resource</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-06550" href="#VUID-vkCmdTraceRaysIndirectKHR-None-06550"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-06550</span><br>

If <a href="shaders.html#shaders-binding" class="xref page">a bound shader</a> accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> or
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> object that enables
<a href="samplers.html#samplers-YCbCr-conversion" class="xref page">sampler Y′C<sub>B</sub>C<sub>R</sub> conversion</a>, that object
<strong>must</strong> only be used with <code>OpImageSample*</code> or <code>OpImageSparseSample*</code>
instructions</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-ConstOffset-06551" href="#VUID-vkCmdTraceRaysIndirectKHR-ConstOffset-06551"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-ConstOffset-06551</span><br>

If <a href="shaders.html#shaders-binding" class="xref page">a bound shader</a> accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> or
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> object that enables
<a href="samplers.html#samplers-YCbCr-conversion" class="xref page">sampler Y′C<sub>B</sub>C<sub>R</sub> conversion</a>, that object
<strong>must</strong> not use the <code>ConstOffset</code> and <code>Offset</code> operands</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-viewType-07752" href="#VUID-vkCmdTraceRaysIndirectKHR-viewType-07752"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-viewType-07752</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is accessed as a result of this command, then the
image view&#8217;s <code>viewType</code> <strong>must</strong> match the <code>Dim</code> operand of the
<code>OpTypeImage</code> as described in <a href="../appendices/spirvenv.html#spirvenv-image-dimensions" class="xref page">Compatibility Between SPIR-V Image Dimensions and Vulkan ImageView Types</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-format-07753" href="#VUID-vkCmdTraceRaysIndirectKHR-format-07753"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-format-07753</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is accessed as a result of this command, then the
<a href="formats.html#formats-numericformat" class="xref page">numeric type</a> of the image view&#8217;s <code>format</code>
and the <code>Sampled</code> <code>Type</code> operand of the <code>OpTypeImage</code> <strong>must</strong>
match</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpImageWrite-08795" href="#VUID-vkCmdTraceRaysIndirectKHR-OpImageWrite-08795"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpImageWrite-08795</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a>
created with a format other than <code>VK_FORMAT_A8_UNORM_KHR</code>
is accessed using <code>OpImageWrite</code> as a result of this command, then
the <code>Type</code> of the <code>Texel</code> operand of that instruction <strong>must</strong> have
at least as many components as the image view&#8217;s format</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpImageWrite-08796" href="#VUID-vkCmdTraceRaysIndirectKHR-OpImageWrite-08796"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpImageWrite-08796</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> created with the format
<code>VK_FORMAT_A8_UNORM_KHR</code> is accessed using <code>OpImageWrite</code> as a
result of this command, then the <code>Type</code> of the <code>Texel</code> operand of
that instruction <strong>must</strong> have four components</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpImageWrite-04469" href="#VUID-vkCmdTraceRaysIndirectKHR-OpImageWrite-04469"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpImageWrite-04469</span><br>

If a <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> is accessed using <code>OpImageWrite</code> as a result
of this command, then the <code>Type</code> of the <code>Texel</code> operand of that
instruction <strong>must</strong> have at least as many components as the buffer view&#8217;s
format</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-SampledType-04470" href="#VUID-vkCmdTraceRaysIndirectKHR-SampledType-04470"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-SampledType-04470</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a 64-bit component
width is accessed as a result of this command, the <code>SampledType</code> of
the <code>OpTypeImage</code> operand of that instruction <strong>must</strong> have a <code>Width</code>
of 64</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-SampledType-04471" href="#VUID-vkCmdTraceRaysIndirectKHR-SampledType-04471"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-SampledType-04471</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a component width
less than 64-bit is accessed as a result of this command, the
<code>SampledType</code> of the <code>OpTypeImage</code> operand of that instruction
<strong>must</strong> have a <code>Width</code> of 32</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-SampledType-04472" href="#VUID-vkCmdTraceRaysIndirectKHR-SampledType-04472"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-SampledType-04472</span><br>

If a <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a 64-bit
component width is accessed as a result of this command, the
<code>SampledType</code> of the <code>OpTypeImage</code> operand of that instruction
<strong>must</strong> have a <code>Width</code> of 64</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-SampledType-04473" href="#VUID-vkCmdTraceRaysIndirectKHR-SampledType-04473"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-SampledType-04473</span><br>

If a <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a component width
less than 64-bit is accessed as a result of this command, the
<code>SampledType</code> of the <code>OpTypeImage</code> operand of that instruction
<strong>must</strong> have a <code>Width</code> of 32</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-sparseImageInt64Atomics-04474" href="#VUID-vkCmdTraceRaysIndirectKHR-sparseImageInt64Atomics-04474"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-sparseImageInt64Atomics-04474</span><br>

If the <a href="features.html#features-sparseImageInt64Atomics" class="xref page">    <code>sparseImageInt64Atomics</code></a> feature is not enabled, <a href="resources.html#VkImage" class="xref page">VkImage</a>
objects created with the <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code> flag
<strong>must</strong> not be accessed by atomic instructions through an <code>OpTypeImage</code>
with a <code>SampledType</code> with a <code>Width</code> of 64 by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-sparseImageInt64Atomics-04475" href="#VUID-vkCmdTraceRaysIndirectKHR-sparseImageInt64Atomics-04475"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-sparseImageInt64Atomics-04475</span><br>

If the <a href="features.html#features-sparseImageInt64Atomics" class="xref page">    <code>sparseImageInt64Atomics</code></a> feature is not enabled, <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a>
objects created with the <code>VK_BUFFER_CREATE_SPARSE_RESIDENCY_BIT</code>
flag <strong>must</strong> not be accessed by atomic instructions through an
<code>OpTypeImage</code> with a <code>SampledType</code> with a <code>Width</code> of 64 by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpImageWeightedSampleQCOM-06971" href="#VUID-vkCmdTraceRaysIndirectKHR-OpImageWeightedSampleQCOM-06971"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpImageWeightedSampleQCOM-06971</span><br>

If <code>OpImageWeightedSampleQCOM</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a>
as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_WEIGHT_SAMPLED_IMAGE_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpImageWeightedSampleQCOM-06972" href="#VUID-vkCmdTraceRaysIndirectKHR-OpImageWeightedSampleQCOM-06972"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpImageWeightedSampleQCOM-06972</span><br>

If <code>OpImageWeightedSampleQCOM</code> uses a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a sample
weight image as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_WEIGHT_IMAGE_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpImageBoxFilterQCOM-06973" href="#VUID-vkCmdTraceRaysIndirectKHR-OpImageBoxFilterQCOM-06973"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpImageBoxFilterQCOM-06973</span><br>

If <code>OpImageBoxFilterQCOM</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a
result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BOX_FILTER_SAMPLED_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchSSDQCOM-06974" href="#VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchSSDQCOM-06974"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchSSDQCOM-06974</span><br>

If <code>OpImageBlockMatchSSDQCOM</code> is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BLOCK_MATCHING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchSADQCOM-06975" href="#VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchSADQCOM-06975"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchSADQCOM-06975</span><br>

If <code>OpImageBlockMatchSADQCOM</code> is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BLOCK_MATCHING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchSADQCOM-06976" href="#VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchSADQCOM-06976"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchSADQCOM-06976</span><br>

If <code>OpImageBlockMatchSADQCOM</code> or OpImageBlockMatchSSDQCOM is used to
read from a reference image as result of this command, then the
specified reference coordinates <strong>must</strong> not fail
<a href="textures.html#textures-integer-coordinate-validation" class="xref page">integer texel coordinate    validation</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpImageWeightedSampleQCOM-06977" href="#VUID-vkCmdTraceRaysIndirectKHR-OpImageWeightedSampleQCOM-06977"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpImageWeightedSampleQCOM-06977</span><br>

If <code>OpImageWeightedSampleQCOM</code>, <code>OpImageBoxFilterQCOM</code>,
<code>OpImageBlockMatchWindowSSDQCOM</code>,
<code>OpImageBlockMatchWindowSADQCOM</code>,
<code>OpImageBlockMatchGatherSSDQCOM</code>,
<code>OpImageBlockMatchGatherSADQCOM</code>,
<code>OpImageBlockMatchSSDQCOM</code>, or <code>OpImageBlockMatchSADQCOM</code> uses a
<a href="samplers.html#VkSampler" class="xref page">VkSampler</a> as a result of this command, then the sampler <strong>must</strong> have
been created with <code>VK_SAMPLER_CREATE_IMAGE_PROCESSING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpImageWeightedSampleQCOM-06978" href="#VUID-vkCmdTraceRaysIndirectKHR-OpImageWeightedSampleQCOM-06978"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpImageWeightedSampleQCOM-06978</span><br>

If any command other than <code>OpImageWeightedSampleQCOM</code>,
<code>OpImageBoxFilterQCOM</code>,
<code>OpImageBlockMatchWindowSSDQCOM</code>,
<code>OpImageBlockMatchWindowSADQCOM</code>,
<code>OpImageBlockMatchGatherSSDQCOM</code>,
<code>OpImageBlockMatchGatherSADQCOM</code>,
<code>OpImageBlockMatchSSDQCOM</code>, or <code>OpImageBlockMatchSADQCOM</code> uses a
<a href="samplers.html#VkSampler" class="xref page">VkSampler</a> as a result of this command, then the sampler <strong>must</strong> not
have been created with <code>VK_SAMPLER_CREATE_IMAGE_PROCESSING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchWindow-09215" href="#VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchWindow-09215"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchWindow-09215</span><br>

If a <code>OpImageBlockMatchWindow*QCOM</code> or
<code>OpImageBlockMatchGather*QCOM</code> instruction is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BLOCK_MATCHING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchWindow-09216" href="#VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchWindow-09216"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchWindow-09216</span><br>

If a <code>OpImageBlockMatchWindow*QCOM</code> or
<code>OpImageBlockMatchGather*QCOM</code> instruction is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
format <strong>must</strong> be a single-component format</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchWindow-09217" href="#VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchWindow-09217"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-OpImageBlockMatchWindow-09217</span><br>

If a <code>OpImageBlockMatchWindow*QCOM</code> or
<code>OpImageBlockMatchGather*QCOM</code> read from a reference image as result
of this command, then the specified reference coordinates <strong>must</strong> not fail
<a href="textures.html#textures-integer-coordinate-validation" class="xref page">integer texel coordinate    validation</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-07288" href="#VUID-vkCmdTraceRaysIndirectKHR-None-07288"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-07288</span><br>

Any shader invocation executed by this command <strong>must</strong>
<a href="shaders.html#shaders-termination" class="xref page">terminate</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-09600" href="#VUID-vkCmdTraceRaysIndirectKHR-None-09600"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-09600</span><br>

If a descriptor with type equal to any of
<code>VK_DESCRIPTOR_TYPE_SAMPLE_WEIGHT_IMAGE_QCOM</code>,
<code>VK_DESCRIPTOR_TYPE_BLOCK_MATCH_IMAGE_QCOM</code>,
<code>VK_DESCRIPTOR_TYPE_SAMPLED_IMAGE</code>,
<code>VK_DESCRIPTOR_TYPE_STORAGE_IMAGE</code>, or
<code>VK_DESCRIPTOR_TYPE_INPUT_ATTACHMENT</code> is accessed as a result of
this command, the image subresource identified by that descriptor <strong>must</strong>
be in the image layout identified when the descriptor was written</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-03429" href="#VUID-vkCmdTraceRaysIndirectKHR-None-03429"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-03429</span><br>

Any shader group handle referenced by this call <strong>must</strong> have been queried
from the currently bound ray tracing pipeline</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-None-09458" href="#VUID-vkCmdTraceRaysIndirectKHR-None-09458"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-None-09458</span><br>

If the bound ray tracing pipeline state was created with the
<code>VK_DYNAMIC_STATE_RAY_TRACING_PIPELINE_STACK_SIZE_KHR</code> dynamic state
enabled then <a href="pipelines.html#vkCmdSetRayTracingPipelineStackSizeKHR" class="xref page">vkCmdSetRayTracingPipelineStackSizeKHR</a> <strong>must</strong> have
been called in the current command buffer prior to this trace command</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-maxPipelineRayRecursionDepth-03679" href="#VUID-vkCmdTraceRaysIndirectKHR-maxPipelineRayRecursionDepth-03679"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-maxPipelineRayRecursionDepth-03679</span><br>

This command <strong>must</strong> not cause a shader call instruction to be executed
from a shader invocation with a <a href="#ray-tracing-recursion-depth">recursion    depth</a> greater than the value of <code>maxPipelineRayRecursionDepth</code>
used to create the bound ray tracing pipeline</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-03635" href="#VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-03635"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-03635</span><br>

<code>commandBuffer</code> <strong>must</strong> not be a protected command buffer</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-size-04023" href="#VUID-vkCmdTraceRaysIndirectKHR-size-04023"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-size-04023</span><br>

The <code>size</code> member of <code>pRayGenShaderBindingTable</code> <strong>must</strong> be equal
to its <code>stride</code> member</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pRayGenShaderBindingTable-03680" href="#VUID-vkCmdTraceRaysIndirectKHR-pRayGenShaderBindingTable-03680"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pRayGenShaderBindingTable-03680</span><br>

If the buffer from which <code>pRayGenShaderBindingTable-&gt;deviceAddress</code> was queried
is non-sparse then it <strong>must</strong> be bound completely and contiguously to a
single <code>VkDeviceMemory</code> object</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pRayGenShaderBindingTable-03681" href="#VUID-vkCmdTraceRaysIndirectKHR-pRayGenShaderBindingTable-03681"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pRayGenShaderBindingTable-03681</span><br>

The buffer from which the <code>pRayGenShaderBindingTable-&gt;deviceAddress</code> is queried
<strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_SHADER_BINDING_TABLE_BIT_KHR</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pRayGenShaderBindingTable-03682" href="#VUID-vkCmdTraceRaysIndirectKHR-pRayGenShaderBindingTable-03682"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pRayGenShaderBindingTable-03682</span><br>

<code>pRayGenShaderBindingTable-&gt;deviceAddress</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pMissShaderBindingTable-03683" href="#VUID-vkCmdTraceRaysIndirectKHR-pMissShaderBindingTable-03683"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pMissShaderBindingTable-03683</span><br>

If the buffer from which <code>pMissShaderBindingTable-&gt;deviceAddress</code> was queried is
non-sparse then it <strong>must</strong> be bound completely and contiguously to a
single <code>VkDeviceMemory</code> object</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pMissShaderBindingTable-03684" href="#VUID-vkCmdTraceRaysIndirectKHR-pMissShaderBindingTable-03684"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pMissShaderBindingTable-03684</span><br>

The buffer from which the <code>pMissShaderBindingTable-&gt;deviceAddress</code> is queried
<strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_SHADER_BINDING_TABLE_BIT_KHR</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pMissShaderBindingTable-03685" href="#VUID-vkCmdTraceRaysIndirectKHR-pMissShaderBindingTable-03685"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pMissShaderBindingTable-03685</span><br>

<code>pMissShaderBindingTable-&gt;deviceAddress</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-stride-03686" href="#VUID-vkCmdTraceRaysIndirectKHR-stride-03686"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-stride-03686</span><br>

<code>pMissShaderBindingTable-&gt;stride</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupHandleAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-stride-04029" href="#VUID-vkCmdTraceRaysIndirectKHR-stride-04029"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-stride-04029</span><br>

<code>pMissShaderBindingTable-&gt;stride</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>maxShaderGroupStride</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-03687" href="#VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-03687"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-03687</span><br>

If the buffer from which <code>pHitShaderBindingTable-&gt;deviceAddress</code> was queried is
non-sparse then it <strong>must</strong> be bound completely and contiguously to a
single <code>VkDeviceMemory</code> object</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-03688" href="#VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-03688"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-03688</span><br>

The buffer from which the <code>pHitShaderBindingTable-&gt;deviceAddress</code> is queried
<strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_SHADER_BINDING_TABLE_BIT_KHR</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-03689" href="#VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-03689"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-03689</span><br>

<code>pHitShaderBindingTable-&gt;deviceAddress</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-stride-03690" href="#VUID-vkCmdTraceRaysIndirectKHR-stride-03690"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-stride-03690</span><br>

<code>pHitShaderBindingTable-&gt;stride</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupHandleAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-stride-04035" href="#VUID-vkCmdTraceRaysIndirectKHR-stride-04035"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-stride-04035</span><br>

<code>pHitShaderBindingTable-&gt;stride</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>maxShaderGroupStride</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pCallableShaderBindingTable-03691" href="#VUID-vkCmdTraceRaysIndirectKHR-pCallableShaderBindingTable-03691"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pCallableShaderBindingTable-03691</span><br>

If the buffer from which <code>pCallableShaderBindingTable-&gt;deviceAddress</code> was queried
is non-sparse then it <strong>must</strong> be bound completely and contiguously to a
single <code>VkDeviceMemory</code> object</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pCallableShaderBindingTable-03692" href="#VUID-vkCmdTraceRaysIndirectKHR-pCallableShaderBindingTable-03692"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pCallableShaderBindingTable-03692</span><br>

The buffer from which the <code>pCallableShaderBindingTable-&gt;deviceAddress</code> is queried
<strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_SHADER_BINDING_TABLE_BIT_KHR</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pCallableShaderBindingTable-03693" href="#VUID-vkCmdTraceRaysIndirectKHR-pCallableShaderBindingTable-03693"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pCallableShaderBindingTable-03693</span><br>

<code>pCallableShaderBindingTable-&gt;deviceAddress</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-stride-03694" href="#VUID-vkCmdTraceRaysIndirectKHR-stride-03694"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-stride-03694</span><br>

<code>pCallableShaderBindingTable-&gt;stride</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupHandleAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-stride-04041" href="#VUID-vkCmdTraceRaysIndirectKHR-stride-04041"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-stride-04041</span><br>

<code>pCallableShaderBindingTable-&gt;stride</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>maxShaderGroupStride</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-flags-03696" href="#VUID-vkCmdTraceRaysIndirectKHR-flags-03696"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-flags-03696</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_CLOSEST_HIT_SHADERS_BIT_KHR</code>,
<code>pHitShaderBindingTable-&gt;deviceAddress</code> <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-flags-03697" href="#VUID-vkCmdTraceRaysIndirectKHR-flags-03697"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-flags-03697</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_INTERSECTION_SHADERS_BIT_KHR</code>,
<code>pHitShaderBindingTable-&gt;deviceAddress</code> <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-flags-03511" href="#VUID-vkCmdTraceRaysIndirectKHR-flags-03511"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-flags-03511</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_MISS_SHADERS_BIT_KHR</code>, the
shader group handle identified by <code>pMissShaderBindingTable-&gt;deviceAddress</code> <strong>must</strong>
not be zero</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-flags-03512" href="#VUID-vkCmdTraceRaysIndirectKHR-flags-03512"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-flags-03512</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_ANY_HIT_SHADERS_BIT_KHR</code>,
entries in the table identified by <code>pHitShaderBindingTable-&gt;deviceAddress</code>
accessed as a result of this command in order to execute an any-hit
shader <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-flags-03513" href="#VUID-vkCmdTraceRaysIndirectKHR-flags-03513"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-flags-03513</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_CLOSEST_HIT_SHADERS_BIT_KHR</code>,
entries in the table identified by <code>pHitShaderBindingTable-&gt;deviceAddress</code>
accessed as a result of this command in order to execute a closest hit
shader <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-flags-03514" href="#VUID-vkCmdTraceRaysIndirectKHR-flags-03514"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-flags-03514</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_INTERSECTION_SHADERS_BIT_KHR</code>,
entries in the table identified by <code>pHitShaderBindingTable-&gt;deviceAddress</code>
accessed as a result of this command in order to execute an intersection
shader <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-04735" href="#VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-04735"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-04735</span><br>

Any non-zero hit shader group entries in the table identified by
<code>pHitShaderBindingTable-&gt;deviceAddress</code> accessed by this call from a geometry
with a <code>geometryType</code> of <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code> <strong>must</strong>
have been created with
<code>VK_RAY_TRACING_SHADER_GROUP_TYPE_TRIANGLES_HIT_GROUP_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-04736" href="#VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-04736"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-04736</span><br>

Any non-zero hit shader group entries in the table identified by
<code>pHitShaderBindingTable-&gt;deviceAddress</code> accessed by this call from a geometry
with a <code>geometryType</code> of <code>VK_GEOMETRY_TYPE_AABBS_KHR</code> <strong>must</strong> have
been created with
<code>VK_RAY_TRACING_SHADER_GROUP_TYPE_PROCEDURAL_HIT_GROUP_KHR</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-indirectDeviceAddress-03632" href="#VUID-vkCmdTraceRaysIndirectKHR-indirectDeviceAddress-03632"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-indirectDeviceAddress-03632</span><br>

If the buffer from which <code>indirectDeviceAddress</code> was queried is
non-sparse then it <strong>must</strong> be bound completely and contiguously to a
single <code>VkDeviceMemory</code> object</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-indirectDeviceAddress-03633" href="#VUID-vkCmdTraceRaysIndirectKHR-indirectDeviceAddress-03633"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-indirectDeviceAddress-03633</span><br>

The buffer from which <code>indirectDeviceAddress</code> was queried <strong>must</strong> have
been created with the <code>VK_BUFFER_USAGE_INDIRECT_BUFFER_BIT</code> bit set</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-indirectDeviceAddress-03634" href="#VUID-vkCmdTraceRaysIndirectKHR-indirectDeviceAddress-03634"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-indirectDeviceAddress-03634</span><br>

<code>indirectDeviceAddress</code> <strong>must</strong> be a multiple of <code>4</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-indirectDeviceAddress-03636" href="#VUID-vkCmdTraceRaysIndirectKHR-indirectDeviceAddress-03636"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-indirectDeviceAddress-03636</span><br>

All device addresses between <code>indirectDeviceAddress</code> and
<span class="eq"><code>indirectDeviceAddress</code> +  <code>sizeof</code>(<code>VkTraceRaysIndirectCommandKHR</code>) -
1</span> <strong>must</strong> be in the buffer device address range of the same buffer</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-rayTracingPipelineTraceRaysIndirect-03637" href="#VUID-vkCmdTraceRaysIndirectKHR-rayTracingPipelineTraceRaysIndirect-03637"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-rayTracingPipelineTraceRaysIndirect-03637</span><br>

The <a href="#features-rayTracingPipelineTraceRaysIndirect"><code>rayTracingPipelineTraceRaysIndirect</code></a> feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-rayTracingMotionBlurPipelineTraceRaysIndirect-04951" href="#VUID-vkCmdTraceRaysIndirectKHR-rayTracingMotionBlurPipelineTraceRaysIndirect-04951"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-rayTracingMotionBlurPipelineTraceRaysIndirect-04951</span><br>

If the bound ray tracing pipeline was created with
<code>VK_PIPELINE_CREATE_RAY_TRACING_ALLOW_MOTION_BIT_NV</code>
<code>VkPhysicalDeviceRayTracingMotionBlurFeaturesNV</code>::<code>rayTracingMotionBlurPipelineTraceRaysIndirect</code>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-parameter" href="#VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pRaygenShaderBindingTable-parameter" href="#VUID-vkCmdTraceRaysIndirectKHR-pRaygenShaderBindingTable-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pRaygenShaderBindingTable-parameter</span><br>
 <code>pRaygenShaderBindingTable</code> <strong>must</strong> be a valid pointer to a valid <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pMissShaderBindingTable-parameter" href="#VUID-vkCmdTraceRaysIndirectKHR-pMissShaderBindingTable-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pMissShaderBindingTable-parameter</span><br>
 <code>pMissShaderBindingTable</code> <strong>must</strong> be a valid pointer to a valid <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-parameter" href="#VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pHitShaderBindingTable-parameter</span><br>
 <code>pHitShaderBindingTable</code> <strong>must</strong> be a valid pointer to a valid <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-pCallableShaderBindingTable-parameter" href="#VUID-vkCmdTraceRaysIndirectKHR-pCallableShaderBindingTable-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-pCallableShaderBindingTable-parameter</span><br>
 <code>pCallableShaderBindingTable</code> <strong>must</strong> be a valid pointer to a valid <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-recording" href="#VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-cmdpool" href="#VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-renderpass" href="#VUID-vkCmdTraceRaysIndirectKHR-renderpass"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirectKHR-videocoding" href="#VUID-vkCmdTraceRaysIndirectKHR-videocoding"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirectKHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkTraceRaysIndirectCommandKHR</code> structure is defined as:</p>
</div>
<div id="VkTraceRaysIndirectCommandKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_ray_tracing_pipeline
typedef struct VkTraceRaysIndirectCommandKHR {
    uint32_t    width;
    uint32_t    height;
    uint32_t    depth;
} VkTraceRaysIndirectCommandKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>width</code> is the width of the ray trace query dimensions.</p>
</li>
<li>
<p><code>height</code> is height of the ray trace query dimensions.</p>
</li>
<li>
<p><code>depth</code> is depth of the ray trace query dimensions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The members of <code>VkTraceRaysIndirectCommandKHR</code> have the same meaning as
the similarly named parameters of <a href="#vkCmdTraceRaysKHR">vkCmdTraceRaysKHR</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommandKHR-width-03638" href="#VUID-VkTraceRaysIndirectCommandKHR-width-03638"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommandKHR-width-03638</span><br>

<code>width</code> <strong>must</strong> be less than or equal to
<span class="eq"><code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupCount</code>[0]
× <code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupSize</code>[0]</span></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommandKHR-height-03639" href="#VUID-VkTraceRaysIndirectCommandKHR-height-03639"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommandKHR-height-03639</span><br>

<code>height</code> <strong>must</strong> be less than or equal to
<span class="eq"><code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupCount</code>[1]
× <code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupSize</code>[1]</span></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommandKHR-depth-03640" href="#VUID-VkTraceRaysIndirectCommandKHR-depth-03640"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommandKHR-depth-03640</span><br>

<code>depth</code> <strong>must</strong> be less than or equal to
<span class="eq"><code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupCount</code>[2]
× <code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupSize</code>[2]</span></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommandKHR-width-03641" href="#VUID-VkTraceRaysIndirectCommandKHR-width-03641"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommandKHR-width-03641</span><br>

<span class="eq"><code>width</code> × <code>height</code> × <code>depth</code></span> <strong>must</strong> be less
than or equal to
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>maxRayDispatchInvocationCount</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To dispatch ray tracing, with some parameters sourced on the device, use:</p>
</div>
<div id="vkCmdTraceRaysIndirect2KHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_ray_tracing_maintenance1 with VK_KHR_ray_tracing_pipeline
void vkCmdTraceRaysIndirect2KHR(
    VkCommandBuffer                             commandBuffer,
    VkDeviceAddress                             indirectDeviceAddress);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>indirectDeviceAddress</code> is a buffer device address which is a
pointer to a <a href="#VkTraceRaysIndirectCommand2KHR">VkTraceRaysIndirectCommand2KHR</a> structure containing
the trace ray parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>vkCmdTraceRaysIndirect2KHR</code> behaves similarly to
<a href="#vkCmdTraceRaysIndirectKHR">vkCmdTraceRaysIndirectKHR</a> except that shader binding table parameters
as well as dispatch dimensions are read by the device from
<code>indirectDeviceAddress</code> during execution.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-magFilter-04553" href="#VUID-vkCmdTraceRaysIndirect2KHR-magFilter-04553"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-magFilter-04553</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>magFilter</code> or <code>minFilter</code>
equal to <code>VK_FILTER_LINEAR</code>,
<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE</code>,
and <code>compareEnable</code> equal to <code>VK_FALSE</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-magFilter-09598" href="#VUID-vkCmdTraceRaysIndirect2KHR-magFilter-09598"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-magFilter-09598</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>magFilter</code> or <code>minFilter</code>
equal to <code>VK_FILTER_LINEAR</code> and <code>reductionMode</code> equal to either
<code>VK_SAMPLER_REDUCTION_MODE_MIN</code> or
<code>VK_SAMPLER_REDUCTION_MODE_MAX</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_MINMAX_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-mipmapMode-04770" href="#VUID-vkCmdTraceRaysIndirect2KHR-mipmapMode-04770"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-mipmapMode-04770</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>mipmapMode</code> equal to
<code>VK_SAMPLER_MIPMAP_MODE_LINEAR</code>,
<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE</code>,
and <code>compareEnable</code> equal to <code>VK_FALSE</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-mipmapMode-09599" href="#VUID-vkCmdTraceRaysIndirect2KHR-mipmapMode-09599"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-mipmapMode-09599</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>mipmapMode</code> equal to
<code>VK_SAMPLER_MIPMAP_MODE_LINEAR</code> and <code>reductionMode</code> equal to
either <code>VK_SAMPLER_REDUCTION_MODE_MIN</code> or
<code>VK_SAMPLER_REDUCTION_MODE_MAX</code> is used to sample a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_MINMAX_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-unnormalizedCoordinates-09635" href="#VUID-vkCmdTraceRaysIndirect2KHR-unnormalizedCoordinates-09635"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-unnormalizedCoordinates-09635</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>unnormalizedCoordinates</code> equal to
<code>VK_TRUE</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this
command, then the image view&#8217;s <code>levelCount</code> and <code>layerCount</code>
<strong>must</strong> be 1</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-unnormalizedCoordinates-09636" href="#VUID-vkCmdTraceRaysIndirect2KHR-unnormalizedCoordinates-09636"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-unnormalizedCoordinates-09636</span><br>

If a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> created with <code>unnormalizedCoordinates</code> equal to
<code>VK_TRUE</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this
command, then the image view&#8217;s <code>viewType</code> <strong>must</strong> be
<code>VK_IMAGE_VIEW_TYPE_1D</code> or <code>VK_IMAGE_VIEW_TYPE_2D</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-06479" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-06479"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-06479</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is sampled with
<a href="textures.html#textures-depth-compare-operation" class="xref page">depth comparison</a>, the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_SAMPLED_IMAGE_DEPTH_COMPARISON_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-02691" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-02691"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-02691</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is accessed using atomic operations as a result
of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_STORAGE_IMAGE_ATOMIC_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-07888" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-07888"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-07888</span><br>

If a <code>VK_DESCRIPTOR_TYPE_STORAGE_TEXEL_BUFFER</code> descriptor is
accessed using atomic operations as a result of this command, then the
storage texel buffer&#8217;s <a href="resources.html#resources-buffer-view-format-features" class="xref page">format    features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_STORAGE_TEXEL_BUFFER_ATOMIC_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-02692" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-02692"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-02692</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_CUBIC_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-02693" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-02693"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-02693</span><br>

If
the <a href="../appendices/extensions.html#VK_EXT_filter_cubic" class="xref page">VK_EXT_filter_cubic</a> extension is not enabled and
any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command, it <strong>must</strong> not have a <a href="resources.html#VkImageViewType" class="xref page">VkImageViewType</a> of
<code>VK_IMAGE_VIEW_TYPE_3D</code>, <code>VK_IMAGE_VIEW_TYPE_CUBE</code>, or
<code>VK_IMAGE_VIEW_TYPE_CUBE_ARRAY</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-filterCubic-02694" href="#VUID-vkCmdTraceRaysIndirect2KHR-filterCubic-02694"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-filterCubic-02694</span><br>

Any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command <strong>must</strong> have a <a href="resources.html#VkImageViewType" class="xref page">VkImageViewType</a> and format
that supports cubic filtering, as specified by
<a href="capabilities.html#VkFilterCubicImageViewImageFormatPropertiesEXT" class="xref page">VkFilterCubicImageViewImageFormatPropertiesEXT</a>::<code>filterCubic</code>
returned by <a href="capabilities.html#vkGetPhysicalDeviceImageFormatProperties2" class="xref page">vkGetPhysicalDeviceImageFormatProperties2</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-filterCubicMinmax-02695" href="#VUID-vkCmdTraceRaysIndirect2KHR-filterCubicMinmax-02695"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-filterCubicMinmax-02695</span><br>

Any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with <code>VK_FILTER_CUBIC_EXT</code> with
a reduction mode of either <code>VK_SAMPLER_REDUCTION_MODE_MIN</code> or
<code>VK_SAMPLER_REDUCTION_MODE_MAX</code> as a result of this command <strong>must</strong>
have a <a href="resources.html#VkImageViewType" class="xref page">VkImageViewType</a> and format that supports cubic filtering
together with minmax filtering, as specified by
<a href="capabilities.html#VkFilterCubicImageViewImageFormatPropertiesEXT" class="xref page">VkFilterCubicImageViewImageFormatPropertiesEXT</a>::<code>filterCubicMinmax</code>
returned by <a href="capabilities.html#vkGetPhysicalDeviceImageFormatProperties2" class="xref page">vkGetPhysicalDeviceImageFormatProperties2</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-cubicRangeClamp-09212" href="#VUID-vkCmdTraceRaysIndirect2KHR-cubicRangeClamp-09212"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-cubicRangeClamp-09212</span><br>

If the <a href="features.html#features-filter-cubic-range-clamp" class="xref page"><code>cubicRangeClamp</code></a>
feature is not enabled, then any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with
<code>VK_FILTER_CUBIC_EXT</code> as a result of this command <strong>must</strong> not have a
<a href="samplers.html#VkSamplerReductionModeCreateInfo" class="xref page">VkSamplerReductionModeCreateInfo</a>::<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE_RANGECLAMP_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-reductionMode-09213" href="#VUID-vkCmdTraceRaysIndirect2KHR-reductionMode-09213"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-reductionMode-09213</span><br>

Any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with a
<a href="samplers.html#VkSamplerReductionModeCreateInfo" class="xref page">VkSamplerReductionModeCreateInfo</a>::<code>reductionMode</code> equal to
<code>VK_SAMPLER_REDUCTION_MODE_WEIGHTED_AVERAGE_RANGECLAMP_QCOM</code> as a
result of this command <strong>must</strong> sample with <code>VK_FILTER_CUBIC_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-selectableCubicWeights-09214" href="#VUID-vkCmdTraceRaysIndirect2KHR-selectableCubicWeights-09214"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-selectableCubicWeights-09214</span><br>

If the <a href="features.html#features-filter-cubic-weight-selection" class="xref page">    <code>selectableCubicWeights</code></a> feature is not enabled, then any
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> being sampled with <code>VK_FILTER_CUBIC_EXT</code> as a
result of this command <strong>must</strong> have
<a href="samplers.html#VkSamplerCubicWeightsCreateInfoQCOM" class="xref page">VkSamplerCubicWeightsCreateInfoQCOM</a>::<code>cubicWeights</code> equal to
<code>VK_CUBIC_FILTER_WEIGHTS_CATMULL_ROM_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-flags-02696" href="#VUID-vkCmdTraceRaysIndirect2KHR-flags-02696"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-flags-02696</span><br>

Any <a href="resources.html#VkImage" class="xref page">VkImage</a> created with a <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>::<code>flags</code>
containing <code>VK_IMAGE_CREATE_CORNER_SAMPLED_BIT_NV</code> sampled as a
result of this command <strong>must</strong> only be sampled using a
<a href="samplers.html#VkSamplerAddressMode" class="xref page">VkSamplerAddressMode</a> of
<code>VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_EDGE</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpTypeImage-07027" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpTypeImage-07027"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpTypeImage-07027</span><br>

For any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being written as a storage image where the
image format field of the <code>OpTypeImage</code> is <code>Unknown</code>, the view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_WRITE_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpTypeImage-07028" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpTypeImage-07028"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpTypeImage-07028</span><br>

For any <a href="resources.html#VkImageView" class="xref page">VkImageView</a> being read as a storage image where the image
format field of the <code>OpTypeImage</code> is <code>Unknown</code>, the view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_READ_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpTypeImage-07029" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpTypeImage-07029"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpTypeImage-07029</span><br>

For any <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> being written as a storage texel buffer where
the image format field of the <code>OpTypeImage</code> is <code>Unknown</code>, the
view&#8217;s <a href="formats.html#VkFormatProperties3" class="xref page">buffer features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_WRITE_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpTypeImage-07030" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpTypeImage-07030"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpTypeImage-07030</span><br>

Any <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> being read as a storage texel buffer where the
image format field of the <code>OpTypeImage</code> is <code>Unknown</code> then the
view&#8217;s <a href="formats.html#VkFormatProperties3" class="xref page">buffer features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_STORAGE_READ_WITHOUT_FORMAT_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08600" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08600"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08600</span><br>

For each set <em>n</em> that is statically used by <a href="shaders.html#shaders-binding" class="xref page">a bound    shader</a>, a descriptor set <strong>must</strong> have been bound to <em>n</em> at the same
pipeline bind point, with a <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> that is compatible
for set <em>n</em>, with the <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> used to create the current
<a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a>
or the <a href="descriptorsets.html#VkDescriptorSetLayout" class="xref page">VkDescriptorSetLayout</a> array used to create the current
<a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a>
, as described in <a href="descriptorsets.html#descriptorsets-compatibility" class="xref page">Pipeline Layout Compatibility</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08601" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08601"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08601</span><br>

For each push constant that is statically used by <a href="shaders.html#shaders-binding" class="xref page">a    bound shader</a>, a push constant value <strong>must</strong> have been set for the same
pipeline bind point, with a <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> that is compatible
for push constants, with the <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a> used to create the
current <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a>
or the <a href="descriptorsets.html#VkDescriptorSetLayout" class="xref page">VkDescriptorSetLayout</a> array used to create the current
<a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a>
, as described in <a href="descriptorsets.html#descriptorsets-compatibility" class="xref page">Pipeline Layout Compatibility</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-10068" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-10068"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-10068</span><br>

For each array of resources that is used by <a href="shaders.html#shaders-binding" class="xref page">a bound    shader</a>, the indices used to access members of the array <strong>must</strong> be less
than the descriptor count for the identified binding in the descriptor
sets used by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-maintenance4-08602" href="#VUID-vkCmdTraceRaysIndirect2KHR-maintenance4-08602"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-maintenance4-08602</span><br>

If the <a href="features.html#features-maintenance4" class="xref page"><code>maintenance4</code></a> feature is not
enabled, then for each push constant that is statically used by
<a href="shaders.html#shaders-binding" class="xref page">a bound shader</a>, a push constant value <strong>must</strong> have
been set for the same pipeline bind point, with a <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a>
that is compatible for push constants, with the <a href="descriptorsets.html#VkPipelineLayout" class="xref page">VkPipelineLayout</a>
used to create the current <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a>
or the <a href="descriptorsets.html#VkDescriptorSetLayout" class="xref page">VkDescriptorSetLayout</a> and <a href="descriptorsets.html#VkPushConstantRange" class="xref page">VkPushConstantRange</a> arrays
used to create the current <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a>
, as described in <a href="descriptorsets.html#descriptorsets-compatibility" class="xref page">Pipeline Layout Compatibility</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08114" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08114"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08114</span><br>

Descriptors in each bound descriptor set, specified via
<a href="descriptorsets.html#vkCmdBindDescriptorSets" class="xref page">vkCmdBindDescriptorSets</a>, <strong>must</strong> be valid as described by
<a href="descriptorsets.html#descriptor-validity" class="xref page">descriptor validity</a> if they are statically used
by
the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline bind point used by this
command and the bound <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> was not created with
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08115" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08115"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08115</span><br>

If the descriptors used by the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline
bind point were specified via <a href="descriptorsets.html#vkCmdBindDescriptorSets" class="xref page">vkCmdBindDescriptorSets</a>, the bound
<a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> <strong>must</strong> have been created without
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08116" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08116"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08116</span><br>

Descriptors in bound descriptor buffers, specified via
<a href="descriptorsets.html#vkCmdSetDescriptorBufferOffsetsEXT" class="xref page">vkCmdSetDescriptorBufferOffsetsEXT</a>, <strong>must</strong> be valid if they are
dynamically used by the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline bind
point used by this command and the bound <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> was created
with <code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08604" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08604"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08604</span><br>

Descriptors in bound descriptor buffers, specified via
<a href="descriptorsets.html#vkCmdSetDescriptorBufferOffsetsEXT" class="xref page">vkCmdSetDescriptorBufferOffsetsEXT</a>, <strong>must</strong> be valid if they are
dynamically used by any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding
to the pipeline bind point used by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08117" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08117"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08117</span><br>

If the descriptors used by the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> bound to the pipeline
bind point were specified via <a href="descriptorsets.html#vkCmdSetDescriptorBufferOffsetsEXT" class="xref page">vkCmdSetDescriptorBufferOffsetsEXT</a>,
the bound <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> <strong>must</strong> have been created with
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08119" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08119"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08119</span><br>

If a descriptor is dynamically used with a <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> created with
<code>VK_PIPELINE_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code>, the descriptor
memory <strong>must</strong> be resident</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08605" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08605"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08605</span><br>

If a descriptor is dynamically used with a <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> created
with a <code>VkDescriptorSetLayout</code> that was created with
<code>VK_DESCRIPTOR_SET_LAYOUT_CREATE_DESCRIPTOR_BUFFER_BIT_EXT</code>, the
descriptor memory <strong>must</strong> be resident</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08606" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08606"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08606</span><br>

If the <a href="features.html#features-shaderObject" class="xref page"><code>shaderObject</code></a> feature is not
enabled, a
valid pipeline <strong>must</strong> be bound to the pipeline bind point used by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08608" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08608"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08608</span><br>

If a pipeline is bound to the pipeline bind point used by this command,
there
<strong>must</strong> not have been any calls to dynamic state setting commands for any
state specified statically in the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the
pipeline bind point used by this command, since that pipeline was bound</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08609" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08609"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08609</span><br>

If the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind point used by
this command
or any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding to the pipeline
bind point used by this command
accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> object that uses unnormalized coordinates,
that sampler <strong>must</strong> not be used to sample from any <a href="resources.html#VkImage" class="xref page">VkImage</a> with a
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> of the type <code>VK_IMAGE_VIEW_TYPE_3D</code>,
<code>VK_IMAGE_VIEW_TYPE_CUBE</code>, <code>VK_IMAGE_VIEW_TYPE_1D_ARRAY</code>,
<code>VK_IMAGE_VIEW_TYPE_2D_ARRAY</code> or
<code>VK_IMAGE_VIEW_TYPE_CUBE_ARRAY</code>, in any shader stage</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08610" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08610"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08610</span><br>

If the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind point used by
this command
or any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding to the pipeline
bind point used by this command
accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> object that uses unnormalized coordinates,
that sampler <strong>must</strong> not be used with any of the SPIR-V <code>OpImageSample*</code>
or <code>OpImageSparseSample*</code> instructions with <code>ImplicitLod</code>, <code>Dref</code>
or <code>Proj</code> in their name, in any shader stage</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08611" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08611"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08611</span><br>

If the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind point used by
this command
or any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding to the pipeline
bind point used by this command
accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> object that uses unnormalized coordinates,
that sampler <strong>must</strong> not be used with any of the SPIR-V <code>OpImageSample*</code>
or <code>OpImageSparseSample*</code> instructions that includes a LOD bias or any
offset values, in any shader stage</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08607" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08607"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08607</span><br>

If the <a href="features.html#features-shaderObject" class="xref page"><code>shaderObject</code></a> feature is enabled,
either a valid pipeline <strong>must</strong> be bound to the pipeline bind point used
by this command, or a valid combination of valid and
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> shader objects <strong>must</strong> be bound to every supported
shader stage corresponding to the pipeline bind point used by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-uniformBuffers-06935" href="#VUID-vkCmdTraceRaysIndirect2KHR-uniformBuffers-06935"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-uniformBuffers-06935</span><br>

If any stage of the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind
point used by this command accesses a uniform buffer,
and that stage was created without enabling either
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_EXT</code> or
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_2_EXT</code>
for <code>uniformBuffers</code>,
and the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a>
feature is not enabled, that stage <strong>must</strong> not access values outside of
the range of the buffer as specified in the descriptor set bound to the
same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08612" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08612"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08612</span><br>

If the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a> feature
is not enabled, and any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding
to the pipeline bind point used by this command accesses a uniform
buffer, it <strong>must</strong> not access values outside of the range of the buffer as
specified in the descriptor set bound to the same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-storageBuffers-06936" href="#VUID-vkCmdTraceRaysIndirect2KHR-storageBuffers-06936"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-storageBuffers-06936</span><br>

If any stage of the <a href="pipelines.html#VkPipeline" class="xref page">VkPipeline</a> object bound to the pipeline bind
point used by this command accesses a storage buffer,
and that stage was created without enabling either
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_EXT</code> or
<code>VK_PIPELINE_ROBUSTNESS_BUFFER_BEHAVIOR_ROBUST_BUFFER_ACCESS_2_EXT</code>
for <code>storageBuffers</code>,
and the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a>
feature is not enabled, that stage <strong>must</strong> not access values outside of
the range of the buffer as specified in the descriptor set bound to the
same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-08613" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-08613"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-08613</span><br>

If the <a href="features.html#features-robustBufferAccess" class="xref page"><code>robustBufferAccess</code></a> feature
is not enabled, and any <a href="shaders.html#VkShaderEXT" class="xref page">VkShaderEXT</a> bound to a stage corresponding
to the pipeline bind point used by this command accesses a storage
buffer, it <strong>must</strong> not access values outside of the range of the buffer as
specified in the descriptor set bound to the same pipeline bind point</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-02707" href="#VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-02707"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-02707</span><br>

If <code>commandBuffer</code> is an unprotected command buffer and
<a href="devsandqueues.html#limits-protectedNoFault" class="xref page"><code>protectedNoFault</code></a> is not supported,
any resource accessed by <a href="shaders.html#shaders-binding" class="xref page">bound shaders</a> <strong>must</strong> not be
a protected resource</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-06550" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-06550"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-06550</span><br>

If <a href="shaders.html#shaders-binding" class="xref page">a bound shader</a> accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> or
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> object that enables
<a href="samplers.html#samplers-YCbCr-conversion" class="xref page">sampler Y′C<sub>B</sub>C<sub>R</sub> conversion</a>, that object
<strong>must</strong> only be used with <code>OpImageSample*</code> or <code>OpImageSparseSample*</code>
instructions</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-ConstOffset-06551" href="#VUID-vkCmdTraceRaysIndirect2KHR-ConstOffset-06551"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-ConstOffset-06551</span><br>

If <a href="shaders.html#shaders-binding" class="xref page">a bound shader</a> accesses a <a href="samplers.html#VkSampler" class="xref page">VkSampler</a> or
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> object that enables
<a href="samplers.html#samplers-YCbCr-conversion" class="xref page">sampler Y′C<sub>B</sub>C<sub>R</sub> conversion</a>, that object
<strong>must</strong> not use the <code>ConstOffset</code> and <code>Offset</code> operands</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-viewType-07752" href="#VUID-vkCmdTraceRaysIndirect2KHR-viewType-07752"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-viewType-07752</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is accessed as a result of this command, then the
image view&#8217;s <code>viewType</code> <strong>must</strong> match the <code>Dim</code> operand of the
<code>OpTypeImage</code> as described in <a href="../appendices/spirvenv.html#spirvenv-image-dimensions" class="xref page">Compatibility Between SPIR-V Image Dimensions and Vulkan ImageView Types</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-format-07753" href="#VUID-vkCmdTraceRaysIndirect2KHR-format-07753"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-format-07753</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> is accessed as a result of this command, then the
<a href="formats.html#formats-numericformat" class="xref page">numeric type</a> of the image view&#8217;s <code>format</code>
and the <code>Sampled</code> <code>Type</code> operand of the <code>OpTypeImage</code> <strong>must</strong>
match</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpImageWrite-08795" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpImageWrite-08795"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpImageWrite-08795</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a>
created with a format other than <code>VK_FORMAT_A8_UNORM_KHR</code>
is accessed using <code>OpImageWrite</code> as a result of this command, then
the <code>Type</code> of the <code>Texel</code> operand of that instruction <strong>must</strong> have
at least as many components as the image view&#8217;s format</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpImageWrite-08796" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpImageWrite-08796"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpImageWrite-08796</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> created with the format
<code>VK_FORMAT_A8_UNORM_KHR</code> is accessed using <code>OpImageWrite</code> as a
result of this command, then the <code>Type</code> of the <code>Texel</code> operand of
that instruction <strong>must</strong> have four components</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpImageWrite-04469" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpImageWrite-04469"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpImageWrite-04469</span><br>

If a <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> is accessed using <code>OpImageWrite</code> as a result
of this command, then the <code>Type</code> of the <code>Texel</code> operand of that
instruction <strong>must</strong> have at least as many components as the buffer view&#8217;s
format</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-SampledType-04470" href="#VUID-vkCmdTraceRaysIndirect2KHR-SampledType-04470"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-SampledType-04470</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a 64-bit component
width is accessed as a result of this command, the <code>SampledType</code> of
the <code>OpTypeImage</code> operand of that instruction <strong>must</strong> have a <code>Width</code>
of 64</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-SampledType-04471" href="#VUID-vkCmdTraceRaysIndirect2KHR-SampledType-04471"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-SampledType-04471</span><br>

If a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a component width
less than 64-bit is accessed as a result of this command, the
<code>SampledType</code> of the <code>OpTypeImage</code> operand of that instruction
<strong>must</strong> have a <code>Width</code> of 32</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-SampledType-04472" href="#VUID-vkCmdTraceRaysIndirect2KHR-SampledType-04472"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-SampledType-04472</span><br>

If a <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a 64-bit
component width is accessed as a result of this command, the
<code>SampledType</code> of the <code>OpTypeImage</code> operand of that instruction
<strong>must</strong> have a <code>Width</code> of 64</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-SampledType-04473" href="#VUID-vkCmdTraceRaysIndirect2KHR-SampledType-04473"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-SampledType-04473</span><br>

If a <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> with a <a href="formats.html#VkFormat" class="xref page">VkFormat</a> that has a component width
less than 64-bit is accessed as a result of this command, the
<code>SampledType</code> of the <code>OpTypeImage</code> operand of that instruction
<strong>must</strong> have a <code>Width</code> of 32</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-sparseImageInt64Atomics-04474" href="#VUID-vkCmdTraceRaysIndirect2KHR-sparseImageInt64Atomics-04474"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-sparseImageInt64Atomics-04474</span><br>

If the <a href="features.html#features-sparseImageInt64Atomics" class="xref page">    <code>sparseImageInt64Atomics</code></a> feature is not enabled, <a href="resources.html#VkImage" class="xref page">VkImage</a>
objects created with the <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code> flag
<strong>must</strong> not be accessed by atomic instructions through an <code>OpTypeImage</code>
with a <code>SampledType</code> with a <code>Width</code> of 64 by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-sparseImageInt64Atomics-04475" href="#VUID-vkCmdTraceRaysIndirect2KHR-sparseImageInt64Atomics-04475"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-sparseImageInt64Atomics-04475</span><br>

If the <a href="features.html#features-sparseImageInt64Atomics" class="xref page">    <code>sparseImageInt64Atomics</code></a> feature is not enabled, <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a>
objects created with the <code>VK_BUFFER_CREATE_SPARSE_RESIDENCY_BIT</code>
flag <strong>must</strong> not be accessed by atomic instructions through an
<code>OpTypeImage</code> with a <code>SampledType</code> with a <code>Width</code> of 64 by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpImageWeightedSampleQCOM-06971" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpImageWeightedSampleQCOM-06971"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpImageWeightedSampleQCOM-06971</span><br>

If <code>OpImageWeightedSampleQCOM</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a>
as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_WEIGHT_SAMPLED_IMAGE_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpImageWeightedSampleQCOM-06972" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpImageWeightedSampleQCOM-06972"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpImageWeightedSampleQCOM-06972</span><br>

If <code>OpImageWeightedSampleQCOM</code> uses a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a sample
weight image as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_WEIGHT_IMAGE_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpImageBoxFilterQCOM-06973" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpImageBoxFilterQCOM-06973"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpImageBoxFilterQCOM-06973</span><br>

If <code>OpImageBoxFilterQCOM</code> is used to sample a <a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a
result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BOX_FILTER_SAMPLED_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchSSDQCOM-06974" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchSSDQCOM-06974"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchSSDQCOM-06974</span><br>

If <code>OpImageBlockMatchSSDQCOM</code> is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BLOCK_MATCHING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchSADQCOM-06975" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchSADQCOM-06975"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchSADQCOM-06975</span><br>

If <code>OpImageBlockMatchSADQCOM</code> is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BLOCK_MATCHING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchSADQCOM-06976" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchSADQCOM-06976"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchSADQCOM-06976</span><br>

If <code>OpImageBlockMatchSADQCOM</code> or OpImageBlockMatchSSDQCOM is used to
read from a reference image as result of this command, then the
specified reference coordinates <strong>must</strong> not fail
<a href="textures.html#textures-integer-coordinate-validation" class="xref page">integer texel coordinate    validation</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpImageWeightedSampleQCOM-06977" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpImageWeightedSampleQCOM-06977"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpImageWeightedSampleQCOM-06977</span><br>

If <code>OpImageWeightedSampleQCOM</code>, <code>OpImageBoxFilterQCOM</code>,
<code>OpImageBlockMatchWindowSSDQCOM</code>,
<code>OpImageBlockMatchWindowSADQCOM</code>,
<code>OpImageBlockMatchGatherSSDQCOM</code>,
<code>OpImageBlockMatchGatherSADQCOM</code>,
<code>OpImageBlockMatchSSDQCOM</code>, or <code>OpImageBlockMatchSADQCOM</code> uses a
<a href="samplers.html#VkSampler" class="xref page">VkSampler</a> as a result of this command, then the sampler <strong>must</strong> have
been created with <code>VK_SAMPLER_CREATE_IMAGE_PROCESSING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpImageWeightedSampleQCOM-06978" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpImageWeightedSampleQCOM-06978"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpImageWeightedSampleQCOM-06978</span><br>

If any command other than <code>OpImageWeightedSampleQCOM</code>,
<code>OpImageBoxFilterQCOM</code>,
<code>OpImageBlockMatchWindowSSDQCOM</code>,
<code>OpImageBlockMatchWindowSADQCOM</code>,
<code>OpImageBlockMatchGatherSSDQCOM</code>,
<code>OpImageBlockMatchGatherSADQCOM</code>,
<code>OpImageBlockMatchSSDQCOM</code>, or <code>OpImageBlockMatchSADQCOM</code> uses a
<a href="samplers.html#VkSampler" class="xref page">VkSampler</a> as a result of this command, then the sampler <strong>must</strong> not
have been created with <code>VK_SAMPLER_CREATE_IMAGE_PROCESSING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchWindow-09215" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchWindow-09215"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchWindow-09215</span><br>

If a <code>OpImageBlockMatchWindow*QCOM</code> or
<code>OpImageBlockMatchGather*QCOM</code> instruction is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
<a href="resources.html#resources-image-view-format-features" class="xref page">format features</a> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_BLOCK_MATCHING_BIT_QCOM</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchWindow-09216" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchWindow-09216"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchWindow-09216</span><br>

If a <code>OpImageBlockMatchWindow*QCOM</code> or
<code>OpImageBlockMatchGather*QCOM</code> instruction is used to read from an
<a href="resources.html#VkImageView" class="xref page">VkImageView</a> as a result of this command, then the image view&#8217;s
format <strong>must</strong> be a single-component format</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchWindow-09217" href="#VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchWindow-09217"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-OpImageBlockMatchWindow-09217</span><br>

If a <code>OpImageBlockMatchWindow*QCOM</code> or
<code>OpImageBlockMatchGather*QCOM</code> read from a reference image as result
of this command, then the specified reference coordinates <strong>must</strong> not fail
<a href="textures.html#textures-integer-coordinate-validation" class="xref page">integer texel coordinate    validation</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-07288" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-07288"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-07288</span><br>

Any shader invocation executed by this command <strong>must</strong>
<a href="shaders.html#shaders-termination" class="xref page">terminate</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-09600" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-09600"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-09600</span><br>

If a descriptor with type equal to any of
<code>VK_DESCRIPTOR_TYPE_SAMPLE_WEIGHT_IMAGE_QCOM</code>,
<code>VK_DESCRIPTOR_TYPE_BLOCK_MATCH_IMAGE_QCOM</code>,
<code>VK_DESCRIPTOR_TYPE_SAMPLED_IMAGE</code>,
<code>VK_DESCRIPTOR_TYPE_STORAGE_IMAGE</code>, or
<code>VK_DESCRIPTOR_TYPE_INPUT_ATTACHMENT</code> is accessed as a result of
this command, the image subresource identified by that descriptor <strong>must</strong>
be in the image layout identified when the descriptor was written</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-03429" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-03429"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-03429</span><br>

Any shader group handle referenced by this call <strong>must</strong> have been queried
from the currently bound ray tracing pipeline</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-None-09458" href="#VUID-vkCmdTraceRaysIndirect2KHR-None-09458"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-None-09458</span><br>

If the bound ray tracing pipeline state was created with the
<code>VK_DYNAMIC_STATE_RAY_TRACING_PIPELINE_STACK_SIZE_KHR</code> dynamic state
enabled then <a href="pipelines.html#vkCmdSetRayTracingPipelineStackSizeKHR" class="xref page">vkCmdSetRayTracingPipelineStackSizeKHR</a> <strong>must</strong> have
been called in the current command buffer prior to this trace command</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-maxPipelineRayRecursionDepth-03679" href="#VUID-vkCmdTraceRaysIndirect2KHR-maxPipelineRayRecursionDepth-03679"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-maxPipelineRayRecursionDepth-03679</span><br>

This command <strong>must</strong> not cause a shader call instruction to be executed
from a shader invocation with a <a href="#ray-tracing-recursion-depth">recursion    depth</a> greater than the value of <code>maxPipelineRayRecursionDepth</code>
used to create the bound ray tracing pipeline</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-03635" href="#VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-03635"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-03635</span><br>

<code>commandBuffer</code> <strong>must</strong> not be a protected command buffer</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-indirectDeviceAddress-03632" href="#VUID-vkCmdTraceRaysIndirect2KHR-indirectDeviceAddress-03632"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-indirectDeviceAddress-03632</span><br>

If the buffer from which <code>indirectDeviceAddress</code> was queried is
non-sparse then it <strong>must</strong> be bound completely and contiguously to a
single <code>VkDeviceMemory</code> object</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-indirectDeviceAddress-03633" href="#VUID-vkCmdTraceRaysIndirect2KHR-indirectDeviceAddress-03633"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-indirectDeviceAddress-03633</span><br>

The buffer from which <code>indirectDeviceAddress</code> was queried <strong>must</strong> have
been created with the <code>VK_BUFFER_USAGE_INDIRECT_BUFFER_BIT</code> bit set</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-indirectDeviceAddress-03634" href="#VUID-vkCmdTraceRaysIndirect2KHR-indirectDeviceAddress-03634"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-indirectDeviceAddress-03634</span><br>

<code>indirectDeviceAddress</code> <strong>must</strong> be a multiple of <code>4</code></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-indirectDeviceAddress-03636" href="#VUID-vkCmdTraceRaysIndirect2KHR-indirectDeviceAddress-03636"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-indirectDeviceAddress-03636</span><br>

All device addresses between <code>indirectDeviceAddress</code> and
<span class="eq"><code>indirectDeviceAddress</code> +  <code>sizeof</code>(<code>VkTraceRaysIndirectCommand2KHR</code>) -
1</span> <strong>must</strong> be in the buffer device address range of the same buffer</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-rayTracingPipelineTraceRaysIndirect2-03637" href="#VUID-vkCmdTraceRaysIndirect2KHR-rayTracingPipelineTraceRaysIndirect2-03637"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-rayTracingPipelineTraceRaysIndirect2-03637</span><br>

The <a href="#features-rayTracingPipelineTraceRaysIndirect2"><code>rayTracingPipelineTraceRaysIndirect2</code></a> feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-rayTracingMotionBlurPipelineTraceRaysIndirect-04951" href="#VUID-vkCmdTraceRaysIndirect2KHR-rayTracingMotionBlurPipelineTraceRaysIndirect-04951"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-rayTracingMotionBlurPipelineTraceRaysIndirect-04951</span><br>

If the bound ray tracing pipeline was created with
<code>VK_PIPELINE_CREATE_RAY_TRACING_ALLOW_MOTION_BIT_NV</code>
<code>VkPhysicalDeviceRayTracingMotionBlurFeaturesNV</code>::<code>rayTracingMotionBlurPipelineTraceRaysIndirect</code>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-parameter" href="#VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-recording" href="#VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-cmdpool" href="#VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-renderpass" href="#VUID-vkCmdTraceRaysIndirect2KHR-renderpass"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdTraceRaysIndirect2KHR-videocoding" href="#VUID-vkCmdTraceRaysIndirect2KHR-videocoding"></a> <span class="vuid">VUID-vkCmdTraceRaysIndirect2KHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkTraceRaysIndirectCommand2KHR</code> structure is defined as:</p>
</div>
<div id="VkTraceRaysIndirectCommand2KHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_ray_tracing_maintenance1 with VK_KHR_ray_tracing_pipeline
typedef struct VkTraceRaysIndirectCommand2KHR {
    VkDeviceAddress    raygenShaderRecordAddress;
    VkDeviceSize       raygenShaderRecordSize;
    VkDeviceAddress    missShaderBindingTableAddress;
    VkDeviceSize       missShaderBindingTableSize;
    VkDeviceSize       missShaderBindingTableStride;
    VkDeviceAddress    hitShaderBindingTableAddress;
    VkDeviceSize       hitShaderBindingTableSize;
    VkDeviceSize       hitShaderBindingTableStride;
    VkDeviceAddress    callableShaderBindingTableAddress;
    VkDeviceSize       callableShaderBindingTableSize;
    VkDeviceSize       callableShaderBindingTableStride;
    uint32_t           width;
    uint32_t           height;
    uint32_t           depth;
} VkTraceRaysIndirectCommand2KHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>raygenShaderRecordAddress</code> is a <code>VkDeviceAddress</code> of the ray
generation shader binding table record used by this command.</p>
</li>
<li>
<p><code>raygenShaderRecordSize</code> is a <code>VkDeviceSize</code> number of bytes
corresponding to the ray generation shader binding table record at base
address <code>raygenShaderRecordAddress</code>.</p>
</li>
<li>
<p><code>missShaderBindingTableAddress</code> is a <code>VkDeviceAddress</code> of the
first record in the miss shader binding table used by this command.</p>
</li>
<li>
<p><code>missShaderBindingTableSize</code> is a <code>VkDeviceSize</code> number of
bytes corresponding to the total size of the miss shader binding table
at <code>missShaderBindingTableAddress</code> that may be accessed by this
command.</p>
</li>
<li>
<p><code>missShaderBindingTableStride</code> is a <code>VkDeviceSize</code> number of
bytes between records of the miss shader binding table.</p>
</li>
<li>
<p><code>hitShaderBindingTableAddress</code> is a <code>VkDeviceAddress</code> of the
first record in the hit shader binding table used by this command.</p>
</li>
<li>
<p><code>hitShaderBindingTableSize</code> is a <code>VkDeviceSize</code> number of
bytes corresponding to the total size of the hit shader binding table at
<code>hitShaderBindingTableAddress</code> that may be accessed by this command.</p>
</li>
<li>
<p><code>hitShaderBindingTableStride</code> is a <code>VkDeviceSize</code> number of
bytes between records of the hit shader binding table.</p>
</li>
<li>
<p><code>callableShaderBindingTableAddress</code> is a <code>VkDeviceAddress</code> of
the first record in the callable shader binding table used by this
command.</p>
</li>
<li>
<p><code>callableShaderBindingTableSize</code> is a <code>VkDeviceSize</code> number
of bytes corresponding to the total size of the callable shader binding
table at <code>callableShaderBindingTableAddress</code> that may be accessed by
this command.</p>
</li>
<li>
<p><code>callableShaderBindingTableStride</code> is a <code>VkDeviceSize</code> number
of bytes between records of the callable shader binding table.</p>
</li>
<li>
<p><code>width</code> is the width of the ray trace query dimensions.</p>
</li>
<li>
<p><code>height</code> is height of the ray trace query dimensions.</p>
</li>
<li>
<p><code>depth</code> is depth of the ray trace query dimensions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The members of <code>VkTraceRaysIndirectCommand2KHR</code> have the same meaning as
the similarly named parameters of <a href="#vkCmdTraceRaysKHR">vkCmdTraceRaysKHR</a>.</p>
</div>
<div class="paragraph">
<p>Indirect shader binding table buffer parameters <strong>must</strong> satisfy the same
memory alignment and binding requirements as their counterparts in
<a href="#vkCmdTraceRaysIndirectKHR">vkCmdTraceRaysIndirectKHR</a> and <a href="#vkCmdTraceRaysKHR">vkCmdTraceRaysKHR</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-pRayGenShaderBindingTable-03680" href="#VUID-VkTraceRaysIndirectCommand2KHR-pRayGenShaderBindingTable-03680"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-pRayGenShaderBindingTable-03680</span><br>

If the buffer from which <code>raygenShaderRecordAddress</code> was queried
is non-sparse then it <strong>must</strong> be bound completely and contiguously to a
single <code>VkDeviceMemory</code> object</p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-pRayGenShaderBindingTable-03681" href="#VUID-VkTraceRaysIndirectCommand2KHR-pRayGenShaderBindingTable-03681"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-pRayGenShaderBindingTable-03681</span><br>

The buffer from which the <code>raygenShaderRecordAddress</code> is queried
<strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_SHADER_BINDING_TABLE_BIT_KHR</code> usage flag</p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-pRayGenShaderBindingTable-03682" href="#VUID-VkTraceRaysIndirectCommand2KHR-pRayGenShaderBindingTable-03682"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-pRayGenShaderBindingTable-03682</span><br>

<code>raygenShaderRecordAddress</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-pMissShaderBindingTable-03683" href="#VUID-VkTraceRaysIndirectCommand2KHR-pMissShaderBindingTable-03683"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-pMissShaderBindingTable-03683</span><br>

If the buffer from which <code>missShaderBindingTableAddress</code> was queried is
non-sparse then it <strong>must</strong> be bound completely and contiguously to a
single <code>VkDeviceMemory</code> object</p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-pMissShaderBindingTable-03684" href="#VUID-VkTraceRaysIndirectCommand2KHR-pMissShaderBindingTable-03684"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-pMissShaderBindingTable-03684</span><br>

The buffer from which the <code>missShaderBindingTableAddress</code> is queried
<strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_SHADER_BINDING_TABLE_BIT_KHR</code> usage flag</p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-pMissShaderBindingTable-03685" href="#VUID-VkTraceRaysIndirectCommand2KHR-pMissShaderBindingTable-03685"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-pMissShaderBindingTable-03685</span><br>

<code>missShaderBindingTableAddress</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-stride-03686" href="#VUID-VkTraceRaysIndirectCommand2KHR-stride-03686"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-stride-03686</span><br>

<code>missShaderBindingTableStride</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupHandleAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-stride-04029" href="#VUID-VkTraceRaysIndirectCommand2KHR-stride-04029"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-stride-04029</span><br>

<code>missShaderBindingTableStride</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>maxShaderGroupStride</code></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-03687" href="#VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-03687"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-03687</span><br>

If the buffer from which <code>hitShaderBindingTableAddress</code> was queried is
non-sparse then it <strong>must</strong> be bound completely and contiguously to a
single <code>VkDeviceMemory</code> object</p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-03688" href="#VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-03688"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-03688</span><br>

The buffer from which the <code>hitShaderBindingTableAddress</code> is queried
<strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_SHADER_BINDING_TABLE_BIT_KHR</code> usage flag</p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-03689" href="#VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-03689"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-03689</span><br>

<code>hitShaderBindingTableAddress</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-stride-03690" href="#VUID-VkTraceRaysIndirectCommand2KHR-stride-03690"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-stride-03690</span><br>

<code>hitShaderBindingTableStride</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupHandleAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-stride-04035" href="#VUID-VkTraceRaysIndirectCommand2KHR-stride-04035"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-stride-04035</span><br>

<code>hitShaderBindingTableStride</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>maxShaderGroupStride</code></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-pCallableShaderBindingTable-03691" href="#VUID-VkTraceRaysIndirectCommand2KHR-pCallableShaderBindingTable-03691"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-pCallableShaderBindingTable-03691</span><br>

If the buffer from which <code>callableShaderBindingTableAddress</code> was queried
is non-sparse then it <strong>must</strong> be bound completely and contiguously to a
single <code>VkDeviceMemory</code> object</p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-pCallableShaderBindingTable-03692" href="#VUID-VkTraceRaysIndirectCommand2KHR-pCallableShaderBindingTable-03692"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-pCallableShaderBindingTable-03692</span><br>

The buffer from which the <code>callableShaderBindingTableAddress</code> is queried
<strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_SHADER_BINDING_TABLE_BIT_KHR</code> usage flag</p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-pCallableShaderBindingTable-03693" href="#VUID-VkTraceRaysIndirectCommand2KHR-pCallableShaderBindingTable-03693"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-pCallableShaderBindingTable-03693</span><br>

<code>callableShaderBindingTableAddress</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupBaseAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-stride-03694" href="#VUID-VkTraceRaysIndirectCommand2KHR-stride-03694"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-stride-03694</span><br>

<code>callableShaderBindingTableStride</code> <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>shaderGroupHandleAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-stride-04041" href="#VUID-VkTraceRaysIndirectCommand2KHR-stride-04041"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-stride-04041</span><br>

<code>callableShaderBindingTableStride</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>maxShaderGroupStride</code></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-flags-03696" href="#VUID-VkTraceRaysIndirectCommand2KHR-flags-03696"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-flags-03696</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_CLOSEST_HIT_SHADERS_BIT_KHR</code>,
<code>hitShaderBindingTableAddress</code> <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-flags-03697" href="#VUID-VkTraceRaysIndirectCommand2KHR-flags-03697"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-flags-03697</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_INTERSECTION_SHADERS_BIT_KHR</code>,
<code>hitShaderBindingTableAddress</code> <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-flags-03511" href="#VUID-VkTraceRaysIndirectCommand2KHR-flags-03511"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-flags-03511</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_MISS_SHADERS_BIT_KHR</code>, the
shader group handle identified by <code>missShaderBindingTableAddress</code> <strong>must</strong>
not be zero</p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-flags-03512" href="#VUID-VkTraceRaysIndirectCommand2KHR-flags-03512"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-flags-03512</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_ANY_HIT_SHADERS_BIT_KHR</code>,
entries in the table identified by <code>hitShaderBindingTableAddress</code>
accessed as a result of this command in order to execute an any-hit
shader <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-flags-03513" href="#VUID-VkTraceRaysIndirectCommand2KHR-flags-03513"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-flags-03513</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_CLOSEST_HIT_SHADERS_BIT_KHR</code>,
entries in the table identified by <code>hitShaderBindingTableAddress</code>
accessed as a result of this command in order to execute a closest hit
shader <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-flags-03514" href="#VUID-VkTraceRaysIndirectCommand2KHR-flags-03514"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-flags-03514</span><br>

If the currently bound ray tracing pipeline was created with <code>flags</code>
that included
<code>VK_PIPELINE_CREATE_RAY_TRACING_NO_NULL_INTERSECTION_SHADERS_BIT_KHR</code>,
entries in the table identified by <code>hitShaderBindingTableAddress</code>
accessed as a result of this command in order to execute an intersection
shader <strong>must</strong> not be zero</p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-04735" href="#VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-04735"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-04735</span><br>

Any non-zero hit shader group entries in the table identified by
<code>hitShaderBindingTableAddress</code> accessed by this call from a geometry
with a <code>geometryType</code> of <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code> <strong>must</strong>
have been created with
<code>VK_RAY_TRACING_SHADER_GROUP_TYPE_TRIANGLES_HIT_GROUP_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-04736" href="#VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-04736"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-pHitShaderBindingTable-04736</span><br>

Any non-zero hit shader group entries in the table identified by
<code>hitShaderBindingTableAddress</code> accessed by this call from a geometry
with a <code>geometryType</code> of <code>VK_GEOMETRY_TYPE_AABBS_KHR</code> <strong>must</strong> have
been created with
<code>VK_RAY_TRACING_SHADER_GROUP_TYPE_PROCEDURAL_HIT_GROUP_KHR</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-width-03638" href="#VUID-VkTraceRaysIndirectCommand2KHR-width-03638"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-width-03638</span><br>

<code>width</code> <strong>must</strong> be less than or equal to
<span class="eq"><code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupCount</code>[0]
× <code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupSize</code>[0]</span></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-height-03639" href="#VUID-VkTraceRaysIndirectCommand2KHR-height-03639"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-height-03639</span><br>

<code>height</code> <strong>must</strong> be less than or equal to
<span class="eq"><code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupCount</code>[1]
× <code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupSize</code>[1]</span></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-depth-03640" href="#VUID-VkTraceRaysIndirectCommand2KHR-depth-03640"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-depth-03640</span><br>

<code>depth</code> <strong>must</strong> be less than or equal to
<span class="eq"><code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupCount</code>[2]
× <code>VkPhysicalDeviceLimits</code>::<code>maxComputeWorkGroupSize</code>[2]</span></p>
</li>
<li>
<p><a id="VUID-VkTraceRaysIndirectCommand2KHR-width-03641" href="#VUID-VkTraceRaysIndirectCommand2KHR-width-03641"></a> <span class="vuid">VUID-VkTraceRaysIndirectCommand2KHR-width-03641</span><br>

<span class="eq"><code>width</code> × <code>height</code> × <code>depth</code></span> <strong>must</strong> be less
than or equal to
<code>VkPhysicalDeviceRayTracingPipelinePropertiesKHR</code>::<code>maxRayDispatchInvocationCount</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shader-binding-table"><a class="anchor" href="#shader-binding-table"></a>Shader Binding Table</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>shader binding table</em> is a resource which establishes the relationship
between the ray tracing pipeline and the acceleration structures that were
built for the ray tracing pipeline.
It indicates the shaders that operate on each geometry in an acceleration
structure.
In addition, it contains the resources accessed by each shader, including
indices of textures, buffer device addresses, and constants.
The application allocates and manages <em>shader binding tables</em> as
<a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> objects.</p>
</div>
<div class="paragraph">
<p>Each entry in the shader binding table consists of
<code>shaderGroupHandleSize</code> bytes of data, either as queried by
<a href="pipelines.html#vkGetRayTracingShaderGroupHandlesKHR" class="xref page">vkGetRayTracingShaderGroupHandlesKHR</a> to refer to those specified
shaders, or all zeros to refer to a zero shader group.
A zero shader group behaves as though it is a shader group consisting
entirely of <code>VK_SHADER_UNUSED_KHR</code>.
The remainder of the data specified by the stride is application-visible
data that can be referenced by a <code>ShaderRecordBufferKHR</code> block in the
shader.</p>
</div>
<div class="paragraph">
<p>The shader binding tables to use in a ray tracing pipeline are passed to the
<a href="#vkCmdTraceRaysNV">vkCmdTraceRaysNV</a>,
<a href="#vkCmdTraceRaysKHR">vkCmdTraceRaysKHR</a>, or <a href="#vkCmdTraceRaysIndirectKHR">vkCmdTraceRaysIndirectKHR</a> commands.
Shader binding tables are read-only in shaders that are executing on the ray
tracing pipeline.</p>
</div>
<div class="paragraph">
<p>Shader variables identified with the <code>ShaderRecordBufferKHR</code> storage
class are used to access the provided shader binding table.
Such variables <strong>must</strong> be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>typed as <code>OpTypeStruct</code>, or an array of this type,</p>
</li>
<li>
<p>identified with a <code>Block</code> decoration, and</p>
</li>
<li>
<p>laid out explicitly using the <code>Offset</code>, <code>ArrayStride</code>, and
<code>MatrixStride</code> decorations as specified in
<a href="interfaces.html#interfaces-resources-layout" class="xref page">Offset and Stride Assignment</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>Offset</code> decoration for any member of a <code>Block</code>-decorated variable
in the <code>ShaderRecordBufferKHR</code> storage class <strong>must</strong> not cause the space
required for that variable to extend outside the range <span class="eq">[0,
<code>maxStorageBufferRange</code>)</span>.</p>
</div>
<div class="paragraph">
<p>Accesses to the shader binding table from ray tracing pipelines <strong>must</strong> be
<a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_RAY_TRACING_SHADER_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_SHADER_READ_BIT</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because different shader record buffers can be associated with the same
shader, a shader variable with <code>ShaderRecordBufferKHR</code> storage class will
not be dynamically uniform if different invocations of the same shader can
reference different data in the shader record buffer, such as if the same
shader occurs twice in the shader binding table with a different shader
record buffer.
In this case, indexing resources based on values in the
<code>ShaderRecordBufferKHR</code> storage class, the index should be decorated as
<code>NonUniform</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="shader-binding-table-indexing-rules"><a class="anchor" href="#shader-binding-table-indexing-rules"></a>Indexing Rules</h3>
<div class="paragraph">
<p>In order to execute the correct shaders and access the correct resources
during a ray tracing dispatch, the implementation <strong>must</strong> be able to locate
shader binding table entries at various stages of execution.
This is accomplished by defining a set of indexing rules that compute shader
binding table record positions relative to the buffer&#8217;s base address in
memory.
The application <strong>must</strong> organize the contents of the shader binding table&#8217;s
memory in a way that application of the indexing rules will lead to correct
records.</p>
</div>
<div class="sect3">
<h4 id="_ray_generation_shaders"><a class="anchor" href="#_ray_generation_shaders"></a>Ray Generation Shaders</h4>
<div class="paragraph">
<p>Only one ray generation shader is executed per ray tracing dispatch.</p>
</div>
<div class="paragraph">
<p>For <a href="#vkCmdTraceRaysKHR">vkCmdTraceRaysKHR</a>, the location of the ray generation shader is
specified by the <code>pRaygenShaderBindingTable-&gt;deviceAddress</code> parameter&#8201;&#8212;&#8201;there is no indexing.
All data accessed <strong>must</strong> be less than <code>pRaygenShaderBindingTable-&gt;size</code>
bytes from <code>deviceAddress</code>.
<code>pRaygenShaderBindingTable-&gt;stride</code> is unused, and <strong>must</strong> be equal to
<code>pRaygenShaderBindingTable-&gt;size</code>.</p>
</div>
<div class="paragraph">
<p>For <a href="#vkCmdTraceRaysNV">vkCmdTraceRaysNV</a>, the location of the ray generation shader is
specified by the <code>raygenShaderBindingTableBuffer</code> and
<code>raygenShaderBindingOffset</code> parameters&#8201;&#8212;&#8201;there is no indexing.</p>
</div>
</div>
<div class="sect3">
<h4 id="shader-binding-table-hit-shader-indexing"><a class="anchor" href="#shader-binding-table-hit-shader-indexing"></a>Hit Shaders</h4>
<div class="paragraph">
<p>The base for the computation of intersection, any-hit, and closest hit
shader locations is the <code>instanceShaderBindingTableRecordOffset</code> value
stored with each instance of a top-level acceleration structure
(<a href="accelstructures.html#VkAccelerationStructureInstanceKHR" class="xref page">VkAccelerationStructureInstanceKHR</a>).
This value determines the beginning of the shader binding table records for
a given instance.</p>
</div>
<div class="paragraph">
<p>In the following rule, <code>geometryIndex</code> refers to the
<a href="accelstructures.html#acceleration-structure-geometry-index" class="xref page">geometry index</a> of the intersected
geometry within the instance.</p>
</div>
<div class="paragraph">
<p>The <code>sbtRecordOffset</code> and <code>sbtRecordStride</code> values are passed in as
parameters to
<code>traceNV</code>()
 or
<code>traceRayEXT</code>()
calls made in the shaders.
See Section 8.19 (Ray Tracing Functions) of the OpenGL Shading Language
Specification for more details.
In SPIR-V, these correspond to the <code>SBTOffset</code> and <code>SBTStride</code>
parameters to the <a href="../appendices/glossary.html#glossary-pipeline-trace-ray" class="xref page">pipeline trace ray</a>
instructions.</p>
</div>
<div class="paragraph">
<p>The result of this computation is then added to
<code>pHitShaderBindingTable-&gt;deviceAddress</code>, a device address passed to
<a href="#vkCmdTraceRaysKHR">vkCmdTraceRaysKHR</a>
, or
<code>hitShaderBindingOffset</code>, a base offset passed to <a href="#vkCmdTraceRaysNV">vkCmdTraceRaysNV</a>
.</p>
</div>
<div class="paragraph">
<p>For <a href="#vkCmdTraceRaysKHR">vkCmdTraceRaysKHR</a>, the complete rule to compute a hit shader
binding table record address in the <code>pHitShaderBindingTable</code> is:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>pHitShaderBindingTable-&gt;deviceAddress</code> + 
<code>pHitShaderBindingTable-&gt;stride</code> × (
<code>instanceShaderBindingTableRecordOffset</code> + 
<code>geometryIndex</code> × <code>sbtRecordStride</code> + 
<code>sbtRecordOffset</code> )</span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All data accessed <strong>must</strong> be less than <code>pHitShaderBindingTable-&gt;size</code>
bytes from the base address.</p>
</div>
<div class="paragraph">
<p>For <a href="#vkCmdTraceRaysNV">vkCmdTraceRaysNV</a>, the offset and stride come from direct
parameters, so the full rule to compute a hit shader binding table record
address in the <code>hitShaderBindingTableBuffer</code> is:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>hitShaderBindingOffset</code> + 
<code>hitShaderBindingStride</code> × (
<code>instanceShaderBindingTableRecordOffset</code> + 
<code>geometryIndex</code> × <code>sbtRecordStride</code> + 
<code>sbtRecordOffset</code> )</span></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_miss_shaders"><a class="anchor" href="#_miss_shaders"></a>Miss Shaders</h4>
<div class="paragraph">
<p>A miss shader is executed whenever a ray query fails to find an intersection
for the given scene geometry.
Multiple miss shaders <strong>may</strong> be executed throughout a ray tracing dispatch.</p>
</div>
<div class="paragraph">
<p>The base for the computation of miss shader locations is
<code>pMissShaderBindingTable-&gt;deviceAddress</code>, a device address passed into
<a href="#vkCmdTraceRaysKHR">vkCmdTraceRaysKHR</a>
, or
<code>missShaderBindingOffset</code>, a base offset passed into
<a href="#vkCmdTraceRaysNV">vkCmdTraceRaysNV</a>
.</p>
</div>
<div class="paragraph">
<p>The <code>missIndex</code> value is passed in as a parameter to
<code>traceNV</code>()
 or
<code>traceRayEXT</code>()
calls made in the shaders.
See Section 8.19 (Ray Tracing Functions) of the OpenGL Shading Language
Specification for more details.
In SPIR-V, this corresponds to the <code>MissIndex</code> parameter to the
<a href="../appendices/glossary.html#glossary-pipeline-trace-ray" class="xref page">pipeline trace ray</a> instructions.</p>
</div>
<div class="paragraph">
<p>For <a href="#vkCmdTraceRaysKHR">vkCmdTraceRaysKHR</a>, the complete rule to compute a miss shader
binding table record address in the <code>pMissShaderBindingTable</code> is:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>pMissShaderBindingTable-&gt;deviceAddress</code> + 
<code>pMissShaderBindingTable-&gt;stride</code> × <code>missIndex</code></span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All data accessed <strong>must</strong> be less than <code>pMissShaderBindingTable-&gt;size</code>
bytes from the base address.</p>
</div>
<div class="paragraph">
<p>For <a href="#vkCmdTraceRaysNV">vkCmdTraceRaysNV</a>, the offset and stride come from direct
parameters, so the full rule to compute a miss shader binding table record
address in the <code>missShaderBindingTableBuffer</code> is:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>missShaderBindingOffset</code> + 
<code>missShaderBindingStride</code> × <code>missIndex</code></span></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_callable_shaders"><a class="anchor" href="#_callable_shaders"></a>Callable Shaders</h4>
<div class="paragraph">
<p>A callable shader is executed when requested by a ray tracing shader.
Multiple callable shaders <strong>may</strong> be executed throughout a ray tracing
dispatch.</p>
</div>
<div class="paragraph">
<p>The base for the computation of callable shader locations is
<code>pCallableShaderBindingTable-&gt;deviceAddress</code>, a device address passed
into <a href="#vkCmdTraceRaysKHR">vkCmdTraceRaysKHR</a>
, or
<code>callableShaderBindingOffset</code>, a base offset passed into
<a href="#vkCmdTraceRaysNV">vkCmdTraceRaysNV</a>
.</p>
</div>
<div class="paragraph">
<p>The <code>sbtRecordIndex</code> value is passed in as a parameter to
<code>executeCallableNV</code>()
 or
<code>executeCallableEXT</code>()
calls made in the shaders.
See Section 8.19 (Ray Tracing Functions) of the OpenGL Shading Language
Specification for more details.
In SPIR-V, this corresponds to the <code>SBTIndex</code> parameter to the
<code>OpExecuteCallableNV</code>
 or
<code>OpExecuteCallableKHR</code>
instruction.</p>
</div>
<div class="paragraph">
<p>For <a href="#vkCmdTraceRaysKHR">vkCmdTraceRaysKHR</a>, the complete rule to compute a callable shader
binding table record address in the <code>pCallableShaderBindingTable</code> is:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>pCallableShaderBindingTable-&gt;deviceAddress</code> + 
<code>pCallableShaderBindingTable-&gt;stride</code> ×
<code>sbtRecordIndex</code></span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All data accessed <strong>must</strong> be less than <code>pCallableShaderBindingTable-&gt;size</code>
bytes from the base address.</p>
</div>
<div class="paragraph">
<p>For <a href="#vkCmdTraceRaysNV">vkCmdTraceRaysNV</a>, the offset and stride come from direct
parameters, so the full rule to compute a callable shader binding table
record address in the <code>callableShaderBindingTableBuffer</code> is:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>callableShaderBindingOffset</code> + 
<code>callableShaderBindingStride</code> × <code>sbtRecordIndex</code></span></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ray-tracing-pipeline-stack"><a class="anchor" href="#ray-tracing-pipeline-stack"></a>Ray Tracing Pipeline Stack</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ray tracing pipelines have a potentially large set of shaders which <strong>may</strong> be
invoked in various call chain combinations to perform ray tracing.
To store parameters for a given shader execution, an implementation <strong>may</strong> use
a stack of data in memory.
This stack <strong>must</strong> be sized to the sum of the stack sizes of all shaders in
any call chain executed by the application.</p>
</div>
<div class="paragraph">
<p>If the stack size is not set explicitly, the stack size for a pipeline is:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq">rayGenStackMax +  min(1,
<code>maxPipelineRayRecursionDepth</code>) ×
max(closestHitStackMax, missStackMax, intersectionStackMax
+  anyHitStackMax) +  max(0,
<code>maxPipelineRayRecursionDepth</code>-1) ×
max(closestHitStackMax, missStackMax) +  2 ×
callableStackMax</span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>where <span class="eq">rayGenStackMax</span>, <span class="eq">closestHitStackMax</span>, <span class="eq">missStackMax</span>,
<span class="eq">anyHitStackMax</span>, <span class="eq">intersectionStackMax</span>, and <span class="eq">callableStackMax</span>
are the maximum stack values queried by the respective shader stages for any
shaders in any shader groups defined by the pipeline.</p>
</div>
<div class="paragraph">
<p>This stack size is potentially significant, so an application <strong>may</strong> want to
provide a more accurate stack size after pipeline compilation.
The value that the application provides is the maximum value of the sum of
all shaders in a call chain across all possible call chains, taking into
account any application specific knowledge about the properties of the call
chains.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For example, if an application has two types of closest hit and miss shaders
that it can use but the first level of rays will only use the first kind
(possibly reflection) and the second level will only use the second kind
(occlusion or shadow ray, for example) then the application can compute the
stack size by something similar to:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>rayGenStack</code> +  max(<code>closestHit1Stack</code>,
<code>miss1Stack</code>) +  max(<code>closestHit2Stack</code>,
<code>miss2Stack</code>)</span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This is guaranteed to be no larger than the default stack size computation
which assumes that both call levels may be the larger of the two.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ray-tracing-capture-replay"><a class="anchor" href="#ray-tracing-capture-replay"></a>Ray Tracing Capture Replay</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a similar way to
<a href="features.html#features-bufferDeviceAddressCaptureReplay" class="xref page">bufferDeviceAddressCaptureReplay</a>,
the <a href="features.html#features-rayTracingPipelineShaderGroupHandleCaptureReplay" class="xref page"><code>rayTracingPipelineShaderGroupHandleCaptureReplay</code></a> feature allows the
querying of opaque data which <strong>can</strong> be used in a future replay.</p>
</div>
<div class="paragraph">
<p>During the capture phase, capture/replay tools are expected to query opaque
data for shader group handle replay using
<a href="pipelines.html#vkGetRayTracingCaptureReplayShaderGroupHandlesKHR" class="xref page">vkGetRayTracingCaptureReplayShaderGroupHandlesKHR</a>.</p>
</div>
<div class="paragraph">
<p>Providing the opaque data during replay, using
<a href="pipelines.html#VkRayTracingShaderGroupCreateInfoKHR" class="xref page">VkRayTracingShaderGroupCreateInfoKHR</a>::<code>pShaderGroupCaptureReplayHandle</code>
at pipeline creation time, causes the implementation to generate identical
shader group handles to those in the capture phase, allowing capture/replay
tools to reuse previously recorded shader binding table buffer contents or
to obtain the same handles by calling
<a href="pipelines.html#vkGetRayTracingCaptureReplayShaderGroupHandlesKHR" class="xref page">vkGetRayTracingCaptureReplayShaderGroupHandlesKHR</a> again.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ray-tracing-validation"><a class="anchor" href="#ray-tracing-validation"></a>Ray Tracing Validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ray tracing validation <strong>can</strong> help root cause application issues and improve
performance.
Unlike existing validation layers, ray tracing validation performs checks at
an implementation level, which helps identify potential problems that <strong>may</strong>
not be caught by the layer.</p>
</div>
<div class="paragraph">
<p>By enabling the <a href="features.html#features-rayTracingValidation" class="xref page">ray tracing validation feature</a>, warnings and errors <strong>can</strong> be delivered straight from a ray tracing
implementation to the application through a <a href="debugging.html#debugging-debug-messengers" class="xref page">messenger callback</a> registered with the implementation, where they <strong>can</strong> be
processed through existing application-side debugging or logging systems.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
