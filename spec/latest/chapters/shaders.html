<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Shaders :: Vulkan Documentation Project</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../_/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../_/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../_/img/favicon-16x16.png">
    <link rel="manifest" href="../../../_/static/site.webmanifest">
    <link rel="mask-icon" href="../../../_/img/safari-pinned-tab.svg" color="#a41e22">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../.."><img class="navbar-item" alt="Vulkan White Label" src="../../../_/Vulkan_Docs.svg" /></a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field has-filter">
          <label for="search-input"></label>
          <input id="search-input" type="text" placeholder="Search the docs">
          <label class="filter checkbox">
            <input type="checkbox" data-facet-filter="component:spec" checked> In this component
          </label>
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../spec/latest/chapters/introduction.html">Vulkan 1.3</a>
            <a class="navbar-item" href="https://registry.khronos.org/OpenGL/specs/gl/GLSLangSpec.4.60.html">GLSL</a>
            <a class="navbar-item" href="../../../guide/latest/hlsl.html">HLSL</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Education</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../features/latest/features/index.html">Vulkan Feature Descriptions</a>
            <a class="navbar-item" href="../../../guide/latest/index.html">Vulkan Guide</a>
            <a class="navbar-item" href="../../../samples/latest/README.html">Vulkan Samples</a>
            <a class="navbar-item" href="../../../tutorial/latest/index.html">Vulkan Tutorial</a>
            <a class="navbar-item" href="https://www.youtube.com/c/vulkan">YouTube</a>
            <a class="navbar-item" href="https://vulkan.org">More Info at Vulkan.org</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Feedback</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://github.com/KhronosGroup/Vulkan-Site/issues/new/choose" target="_blank">Report a Problem</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://reddit.com/r/vulkan">Reddit</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/vulkan">Stack Overflow</a>
            <a class="navbar-item" href="https://fosstodon.org/@vulkan">Mastodon</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="spec" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Vulkan Specification</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fundamentals.html">Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="initialization.html">Initialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="devsandqueues.html">Devices and Queues</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cmdbuffers.html">Command Buffers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="synchronization.html">Synchronization and Cache Control</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="renderpass.html">Render Pass</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="shaders.html">Shaders</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pipelines.html">Pipelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="memory.html">Memory Allocation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="resources.html">Resource Creation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="samplers.html">Samplers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="descriptorsets.html">Resource Descriptors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="interfaces.html">Shader Interfaces</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="textures.html">Image Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fragmentdensitymapops.html">Fragment Density Map Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="queries.html">Queries</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="clears.html">Clear Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="copies.html">Copy Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="drawing.html">Drawing Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fxvertex.html">Fixed-Function Vertex Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tessellation.html">Tessellation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="geometry.html">Geometry Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_mesh_shader/mesh.html">Mesh Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_HUAWEI_cluster_culling_shader/clusterculling.html">Cluster Culling Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="vertexpostproc.html">Fixed-Function Vertex Post-Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="primsrast.html">Rasterization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fragops.html">Fragment Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="framebuffer.html">The Framebuffer</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="dispatch.html">Dispatching Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="device_generated_commands/generatedcommands.html">Device-Generated Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="sparsemem.html">Sparse Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_KHR_surface/wsi.html">Window System Integration (WSI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_KHR_deferred_host_operations/deferred_host_operations.html">Deferred Host Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_EXT_private_data.html">Private Data</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="accelstructures.html">Acceleration Structures</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_EXT_opacity_micromap/micromaps.html">Micromap</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="raytraversal.html">Ray Traversal</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="raytracing.html">Ray Tracing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_memory_decompression.html">Memory Decompression</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="videocoding.html">Video Coding</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_optical_flow/optical_flow.html">Optical Flow</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="executiongraphs.html">Execution Graphs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extensions.html">Extending Vulkan</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="limits.html">Limits</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="formats.html">Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="capabilities.html">Additional Capabilities</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="debugging.html">Debugging</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/spirvenv.html">Vulkan Environment for SPIR-V</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/memorymodel.html">Memory Model</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/compressedtex.html">Compressed Image Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/versions.html">Core Revisions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/extensions.html">Layers &amp; Extensions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/roadmap.html">Vulkan Roadmap Milestones</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/boilerplate.html">API Boilerplate</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/invariance.html">Invariance</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/glossary.html">Lexicon</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/credits.html">Credits (Informative)</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Vulkan Specification</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../tutorial/latest/00_Introduction.html">Khronos Vulkan Tutorial</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tutorial/latest/00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../features/latest/features/index.html">Vulkan Feature Descriptions</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../features/latest/features/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../guide/latest/index.html">Vulkan Guide</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../samples/latest/README.html">Vulkan Samples</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/latest/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../index.html">Vulkan Specification</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Vulkan Specification</a></li>
    <li><a href="shaders.html">Shaders</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Shaders</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A shader specifies programmable operations that execute for each vertex,
control point, tessellated vertex, primitive, fragment, or workgroup in the
corresponding stage(s) of the graphics and compute pipelines.</p>
</div>
<div class="paragraph">
<p>Graphics pipelines include vertex shader execution as a result of
<a href="drawing.html#drawing" class="xref page">primitive assembly</a>, followed, if enabled, by tessellation
control and evaluation shaders operating on <a href="drawing.html#drawing-patch-lists" class="xref page">patches</a>,
geometry shaders, if enabled, operating on primitives, and fragment shaders,
if present, operating on fragments generated by <a href="primsrast.html#primsrast" class="xref page">Rasterization</a>.
In this specification, vertex, tessellation control, tessellation evaluation
and geometry shaders are collectively referred to as
<a href="pipelines.html#pipelines-graphics-subsets-pre-rasterization" class="xref page">pre-rasterization shader stage</a>s and occur in the logical pipeline before rasterization.
The fragment shader occurs logically after rasterization.</p>
</div>
<div class="paragraph">
<p>Only the compute shader stage is included in a compute pipeline.
Compute shaders operate on compute invocations in a workgroup.</p>
</div>
<div class="paragraph">
<p>Shaders <strong>can</strong> read from input variables, and read from and write to output
variables.
Input and output variables <strong>can</strong> be used to transfer data between shader
stages, or to allow the shader to interact with values that exist in the
execution environment.
Similarly, the execution environment provides constants describing
capabilities.</p>
</div>
<div class="paragraph">
<p>Shader variables are associated with execution environment-provided inputs
and outputs using <em>built-in</em> decorations in the shader.
The available decorations for each stage are documented in the following
subsections.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shader-modules"><a class="anchor" href="#shader-modules"></a>Shader Modules</h2>
<div class="sectionbody">
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><em>Shader modules</em> contain <em>shader code</em> and one or more entry points.
Shaders are selected from a shader module by specifying an entry point as
part of <a href="pipelines.html#pipelines" class="xref page">pipeline</a> creation.
The stages of a pipeline <strong>can</strong> use shaders that come from different modules.
The shader code defining a shader module <strong>must</strong> be in the SPIR-V format, as
described by the <a href="../appendices/spirvenv.html#spirvenv" class="xref page">Vulkan Environment for SPIR-V</a> appendix.</p>
</div>
<div class="paragraph">
<p>Shader modules are represented by <code>VkShaderModule</code> handles:</p>
</div>
<div id="VkShaderModule" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
VK_DEFINE_NON_DISPATCHABLE_HANDLE(VkShaderModule)</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To create a shader module, call:</p>
</div>
<div id="vkCreateShaderModule" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
VkResult vkCreateShaderModule(
    VkDevice                                    device,
    const VkShaderModuleCreateInfo*             pCreateInfo,
    const VkAllocationCallbacks*                pAllocator,
    VkShaderModule*                             pShaderModule);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that creates the shader module.</p>
</li>
<li>
<p><code>pCreateInfo</code> is a pointer to a <a href="#VkShaderModuleCreateInfo">VkShaderModuleCreateInfo</a>
structure.</p>
</li>
<li>
<p><code>pAllocator</code> controls host memory allocation as described in the
<a href="memory.html#memory-allocation" class="xref page">Memory Allocation</a> chapter.</p>
</li>
<li>
<p><code>pShaderModule</code> is a pointer to a <a href="#VkShaderModule">VkShaderModule</a> handle in
which the resulting shader module object is returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once a shader module has been created, any entry points it contains <strong>can</strong> be
used in pipeline shader stages as described in <a href="pipelines.html#pipelines-compute" class="xref page">Compute Pipelines</a> and <a href="pipelines.html#pipelines-graphics" class="xref page">Graphics Pipelines</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCreateShaderModule-pCreateInfo-06904" href="#VUID-vkCreateShaderModule-pCreateInfo-06904"></a> <span class="vuid">VUID-vkCreateShaderModule-pCreateInfo-06904</span><br>

If <code>pCreateInfo</code> is not <code>NULL</code>, <code>pCreateInfo-&gt;pNext</code> <strong>must</strong> be
<code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCreateShaderModule-device-parameter" href="#VUID-vkCreateShaderModule-device-parameter"></a> <span class="vuid">VUID-vkCreateShaderModule-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCreateShaderModule-pCreateInfo-parameter" href="#VUID-vkCreateShaderModule-pCreateInfo-parameter"></a> <span class="vuid">VUID-vkCreateShaderModule-pCreateInfo-parameter</span><br>
 <code>pCreateInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkShaderModuleCreateInfo">VkShaderModuleCreateInfo</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCreateShaderModule-pAllocator-parameter" href="#VUID-vkCreateShaderModule-pAllocator-parameter"></a> <span class="vuid">VUID-vkCreateShaderModule-pAllocator-parameter</span><br>
 If <code>pAllocator</code> is not <code>NULL</code>, <code>pAllocator</code> <strong>must</strong> be a valid pointer to a valid <a href="memory.html#VkAllocationCallbacks" class="xref page">VkAllocationCallbacks</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCreateShaderModule-pShaderModule-parameter" href="#VUID-vkCreateShaderModule-pShaderModule-parameter"></a> <span class="vuid">VUID-vkCreateShaderModule-pShaderModule-parameter</span><br>
 <code>pShaderModule</code> <strong>must</strong> be a valid pointer to a <a href="#VkShaderModule">VkShaderModule</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkShaderModuleCreateInfo</code> structure is defined as:</p>
</div>
<div id="VkShaderModuleCreateInfo" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkShaderModuleCreateInfo {
    VkStructureType              sType;
    const void*                  pNext;
    VkShaderModuleCreateFlags    flags;
    size_t                       codeSize;
    const uint32_t*              pCode;
} VkShaderModuleCreateInfo;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>flags</code> is reserved for future use.</p>
</li>
<li>
<p><code>codeSize</code> is the size, in bytes, of the code pointed to by
<code>pCode</code>.</p>
</li>
<li>
<p><code>pCode</code> is a pointer to code that is used to create the shader
module.
The type and format of the code is determined from the content of the
memory addressed by <code>pCode</code>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkShaderModuleCreateInfo-codeSize-08735" href="#VUID-VkShaderModuleCreateInfo-codeSize-08735"></a> <span class="vuid">VUID-VkShaderModuleCreateInfo-codeSize-08735</span><br>

 <code>codeSize</code> <strong>must</strong> be a multiple of 4</p>
</li>
<li>
<p><a id="VUID-VkShaderModuleCreateInfo-pCode-08736" href="#VUID-VkShaderModuleCreateInfo-pCode-08736"></a> <span class="vuid">VUID-VkShaderModuleCreateInfo-pCode-08736</span><br>

 <code>pCode</code> <strong>must</strong> point to valid SPIR-V code,
formatted and packed as described by the <a href="introduction.html#spirv-spec" class="xref page">Khronos SPIR-V     Specification</a></p>
</li>
<li>
<p><a id="VUID-VkShaderModuleCreateInfo-pCode-08737" href="#VUID-VkShaderModuleCreateInfo-pCode-08737"></a> <span class="vuid">VUID-VkShaderModuleCreateInfo-pCode-08737</span><br>

 <code>pCode</code> <strong>must</strong> adhere to the validation rules
described by the <a href="../appendices/spirvenv.html#spirvenv-module-validation" class="xref page">Validation Rules within a     Module</a> section of the <a href="../appendices/spirvenv.html#spirvenv-capabilities" class="xref page">SPIR-V Environment</a>
appendix</p>
</li>
<li>
<p><a id="VUID-VkShaderModuleCreateInfo-pCode-08738" href="#VUID-VkShaderModuleCreateInfo-pCode-08738"></a> <span class="vuid">VUID-VkShaderModuleCreateInfo-pCode-08738</span><br>

 <code>pCode</code> <strong>must</strong> declare the <code>Shader</code> capability
for SPIR-V code</p>
</li>
<li>
<p><a id="VUID-VkShaderModuleCreateInfo-pCode-08739" href="#VUID-VkShaderModuleCreateInfo-pCode-08739"></a> <span class="vuid">VUID-VkShaderModuleCreateInfo-pCode-08739</span><br>

 <code>pCode</code> <strong>must</strong> not declare any capability that is
not supported by the API, as described by the
<a href="../appendices/spirvenv.html#spirvenv-module-validation" class="xref page">Capabilities</a> section of the
<a href="../appendices/spirvenv.html#spirvenv-capabilities" class="xref page">SPIR-V Environment</a> appendix</p>
</li>
<li>
<p><a id="VUID-VkShaderModuleCreateInfo-pCode-08740" href="#VUID-VkShaderModuleCreateInfo-pCode-08740"></a> <span class="vuid">VUID-VkShaderModuleCreateInfo-pCode-08740</span><br>

 and <code>pCode</code> declares any of the capabilities
listed in the <a href="../appendices/spirvenv.html#spirvenv-capabilities-table" class="xref page">SPIR-V Environment</a>
appendix, one of the corresponding requirements <strong>must</strong> be satisfied</p>
</li>
<li>
<p><a id="VUID-VkShaderModuleCreateInfo-pCode-08741" href="#VUID-VkShaderModuleCreateInfo-pCode-08741"></a> <span class="vuid">VUID-VkShaderModuleCreateInfo-pCode-08741</span><br>

 <code>pCode</code> <strong>must</strong> not declare any SPIR-V extension
that is not supported by the API, as described by the
<a href="../appendices/spirvenv.html#spirvenv-extensions" class="xref page">Extension</a> section of the
<a href="../appendices/spirvenv.html#spirvenv-capabilities" class="xref page">SPIR-V Environment</a> appendix</p>
</li>
<li>
<p><a id="VUID-VkShaderModuleCreateInfo-pCode-08742" href="#VUID-VkShaderModuleCreateInfo-pCode-08742"></a> <span class="vuid">VUID-VkShaderModuleCreateInfo-pCode-08742</span><br>

 and <code>pCode</code> declares any of the SPIR-V extensions
listed in the <a href="../appendices/spirvenv.html#spirvenv-extensions-table" class="xref page">SPIR-V Environment</a>
appendix, one of the corresponding requirements <strong>must</strong> be satisfied</p>
</li>
<li>
<p><a id="VUID-VkShaderModuleCreateInfo-codeSize-01085" href="#VUID-VkShaderModuleCreateInfo-codeSize-01085"></a> <span class="vuid">VUID-VkShaderModuleCreateInfo-codeSize-01085</span><br>

<code>codeSize</code> <strong>must</strong> be greater than 0</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkShaderModuleCreateInfo-sType-sType" href="#VUID-VkShaderModuleCreateInfo-sType-sType"></a> <span class="vuid">VUID-VkShaderModuleCreateInfo-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_SHADER_MODULE_CREATE_INFO</code></p>
</li>
<li>
<p><a id="VUID-VkShaderModuleCreateInfo-flags-zerobitmask" href="#VUID-VkShaderModuleCreateInfo-flags-zerobitmask"></a> <span class="vuid">VUID-VkShaderModuleCreateInfo-flags-zerobitmask</span><br>
 <code>flags</code> <strong>must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkShaderModuleCreateInfo-pCode-parameter" href="#VUID-VkShaderModuleCreateInfo-pCode-parameter"></a> <span class="vuid">VUID-VkShaderModuleCreateInfo-pCode-parameter</span><br>
 <code>pCode</code> <strong>must</strong> be a valid pointer to an array of <span class="steminline"> <svg style="vertical-align: -0.781ex; overflow: visible;" xmlns="http://www.w3.org/2000/svg" width="6.86ex" height="2.8ex" role="img" focusable="false" viewBox="0 -892.5 3032.3 1237.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mtext" transform="translate(220,394) scale(0.707)"><path data-c="63" d="M370 305T349 305T313 320T297 358Q297 381 312 396Q317 401 317 402T307 404Q281 408 258 408Q209 408 178 376Q131 329 131 219Q131 137 162 90Q203 29 272 29Q313 29 338 55T374 117Q376 125 379 127T395 129H409Q415 123 415 120Q415 116 411 104T395 71T366 33T318 2T249 -11Q163 -11 99 53T34 214Q34 318 99 383T250 448T370 421T404 357Q404 334 387 320Z"></path><path data-c="6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" transform="translate(444,0)"></path><path data-c="64" d="M376 495Q376 511 376 535T377 568Q377 613 367 624T316 637H298V660Q298 683 300 683L310 684Q320 685 339 686T376 688Q393 689 413 690T443 693T454 694H457V390Q457 84 458 81Q461 61 472 55T517 46H535V0Q533 0 459 -5T380 -11H373V44L365 37Q307 -11 235 -11Q158 -11 96 50T34 215Q34 315 97 378T244 442Q319 442 376 393V495ZM373 342Q328 405 260 405Q211 405 173 369Q146 341 139 305T131 211Q131 155 138 120T173 59Q203 26 251 26Q322 26 373 103V342Z" transform="translate(944,0)"></path><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z" transform="translate(1500,0)"></path><path data-c="53" d="M55 507Q55 590 112 647T243 704H257Q342 704 405 641L426 672Q431 679 436 687T446 700L449 704Q450 704 453 704T459 705H463Q466 705 472 699V462L466 456H448Q437 456 435 459T430 479Q413 605 329 646Q292 662 254 662Q201 662 168 626T135 542Q135 508 152 480T200 435Q210 431 286 412T370 389Q427 367 463 314T500 191Q500 110 448 45T301 -21Q245 -21 201 -4T140 27L122 41Q118 36 107 21T87 -7T78 -21Q76 -22 68 -22H64Q61 -22 55 -16V101Q55 220 56 222Q58 227 76 227H89Q95 221 95 214Q95 182 105 151T139 90T205 42T305 24Q352 24 386 62T420 155Q420 198 398 233T340 281Q284 295 266 300Q261 301 239 306T206 314T174 325T141 343T112 367T85 402Q55 451 55 507Z" transform="translate(1944,0)"></path><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z" transform="translate(2500,0)"></path><path data-c="7A" d="M42 263Q44 270 48 345T53 423V431H393Q399 425 399 415Q399 403 398 402L381 378Q364 355 331 309T265 220L134 41L182 40H206Q254 40 283 46T331 77Q352 105 359 185L361 201Q361 202 381 202H401V196Q401 195 393 103T384 6V0H209L34 1L31 3Q28 8 28 17Q28 30 29 31T160 210T294 394H236Q169 393 152 388Q127 382 113 367Q89 344 82 264V255H42V263Z" transform="translate(2778,0)"></path><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z" transform="translate(3222,0)"></path></g><g data-mml-node="mn" transform="translate(1339.4,-345) scale(0.707)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><rect width="2792.3" height="60" x="120" y="220"></rect></g></g></g></svg> </span> <code>uint32_t</code> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkShaderModuleCreateFlags" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef VkFlags VkShaderModuleCreateFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkShaderModuleCreateFlags</code> is a bitmask type for setting a mask, but is
currently reserved for future use.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To destroy a shader module, call:</p>
</div>
<div id="vkDestroyShaderModule" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
void vkDestroyShaderModule(
    VkDevice                                    device,
    VkShaderModule                              shaderModule,
    const VkAllocationCallbacks*                pAllocator);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that destroys the shader module.</p>
</li>
<li>
<p><code>shaderModule</code> is the handle of the shader module to destroy.</p>
</li>
<li>
<p><code>pAllocator</code> controls host memory allocation as described in the
<a href="memory.html#memory-allocation" class="xref page">Memory Allocation</a> chapter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A shader module <strong>can</strong> be destroyed while pipelines created using its shaders
are still in use.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkDestroyShaderModule-shaderModule-01092" href="#VUID-vkDestroyShaderModule-shaderModule-01092"></a> <span class="vuid">VUID-vkDestroyShaderModule-shaderModule-01092</span><br>

If <code>VkAllocationCallbacks</code> were provided when <code>shaderModule</code> was
created, a compatible set of callbacks <strong>must</strong> be provided here</p>
</li>
<li>
<p><a id="VUID-vkDestroyShaderModule-shaderModule-01093" href="#VUID-vkDestroyShaderModule-shaderModule-01093"></a> <span class="vuid">VUID-vkDestroyShaderModule-shaderModule-01093</span><br>

If no <code>VkAllocationCallbacks</code> were provided when <code>shaderModule</code>
was created, <code>pAllocator</code> <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkDestroyShaderModule-device-parameter" href="#VUID-vkDestroyShaderModule-device-parameter"></a> <span class="vuid">VUID-vkDestroyShaderModule-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkDestroyShaderModule-shaderModule-parameter" href="#VUID-vkDestroyShaderModule-shaderModule-parameter"></a> <span class="vuid">VUID-vkDestroyShaderModule-shaderModule-parameter</span><br>
 If <code>shaderModule</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>shaderModule</code> <strong>must</strong> be a valid <a href="#VkShaderModule">VkShaderModule</a> handle</p>
</li>
<li>
<p><a id="VUID-vkDestroyShaderModule-pAllocator-parameter" href="#VUID-vkDestroyShaderModule-pAllocator-parameter"></a> <span class="vuid">VUID-vkDestroyShaderModule-pAllocator-parameter</span><br>
 If <code>pAllocator</code> is not <code>NULL</code>, <code>pAllocator</code> <strong>must</strong> be a valid pointer to a valid <a href="memory.html#VkAllocationCallbacks" class="xref page">VkAllocationCallbacks</a> structure</p>
</li>
<li>
<p><a id="VUID-vkDestroyShaderModule-shaderModule-parent" href="#VUID-vkDestroyShaderModule-shaderModule-parent"></a> <span class="vuid">VUID-vkDestroyShaderModule-shaderModule-parent</span><br>
 If <code>shaderModule</code> is a valid handle, it <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>shaderModule</code> <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-binding"><a class="anchor" href="#shaders-binding"></a>Binding Shaders</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before a shader can be used it <strong>must</strong> be first bound to the command buffer.</p>
</div>
<div class="paragraph">
<p>Calling <a href="pipelines.html#vkCmdBindPipeline" class="xref page">vkCmdBindPipeline</a> binds all stages corresponding to the
<a href="pipelines.html#VkPipelineBindPoint" class="xref page">VkPipelineBindPoint</a>.</p>
</div>
<div class="paragraph">
<p>The following table describes the relationship between shader stages and
pipeline bind points:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Shader stage</th>
<th class="tableblock halign-left valign-top">Pipeline bind point</th>
<th class="tableblock halign-left valign-top">behavior controlled</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>VK_SHADER_STAGE_VERTEX_BIT</code></p>
</li>
<li>
<p><code>VK_SHADER_STAGE_TESSELLATION_CONTROL_BIT</code></p>
</li>
<li>
<p><code>VK_SHADER_STAGE_TESSELLATION_EVALUATION_BIT</code></p>
</li>
<li>
<p><code>VK_SHADER_STAGE_GEOMETRY_BIT</code></p>
</li>
<li>
<p><code>VK_SHADER_STAGE_FRAGMENT_BIT</code></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_BIND_POINT_GRAPHICS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all <a href="drawing.html#drawing" class="xref page">drawing commands</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>VK_SHADER_STAGE_COMPUTE_BIT</code></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_BIND_POINT_COMPUTE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all <a href="dispatch.html#dispatch" class="xref page">dispatch commands</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="shaders-execution"><a class="anchor" href="#shaders-execution"></a>Shader Execution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At each stage of the pipeline, multiple invocations of a shader <strong>may</strong> execute
simultaneously.
Further, invocations of a single shader produced as the result of different
commands <strong>may</strong> execute simultaneously.
The relative execution order of invocations of the same shader type is
<strong>undefined</strong>.
Shader invocations <strong>may</strong> complete in a different order than that in which the
primitives they originated from were drawn or dispatched by the application.
However, fragment shader outputs are written to attachments in
<a href="primsrast.html#primsrast-order" class="xref page">rasterization order</a>.</p>
</div>
<div class="paragraph">
<p>The relative execution order of invocations of different shader types is
largely <strong>undefined</strong>.
However, when invoking a shader whose inputs are generated from a previous
pipeline stage, the shader invocations from the previous stage are
guaranteed to have executed far enough to generate input values for all
required inputs.</p>
</div>
<div class="sect2">
<h3 id="shaders-termination"><a class="anchor" href="#shaders-termination"></a>Shader Termination</h3>
<div class="paragraph">
<p>A shader invocation that is <em>terminated</em> has finished executing
instructions.</p>
</div>
<div class="paragraph">
<p>Executing <code>OpReturn</code> in the entry point, or executing
<code>OpTerminateInvocation</code> in any function will terminate an invocation.
Implementations <strong>may</strong> also terminate a shader invocation when <code>OpKill</code> is
executed in any function; otherwise it becomes a
<a href="#shaders-helper-invocations">helper invocation</a>.</p>
</div>
<div class="paragraph">
<p>In addition to the above conditions, <a href="#shaders-helper-invocations">helper invocations</a> <strong>may</strong> be terminated when all non-helper invocations in the same
<a href="#shaders-derivative-operations">derivative group</a> either terminate or
become <a href="#shaders-helper-invocations">helper invocations</a>.</p>
</div>
<div class="paragraph">
<p>A shader stage for a given command completes execution when all invocations
for that stage have terminated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>OpKill</code> will behave the same as either <code>OpTerminateInvocation</code> or
<code>OpDemoteToHelperInvocation</code> depending on the implementation.
It is recommended that shader authors use <code>OpTerminateInvocation</code> or
<code>OpDemoteToHelperInvocation</code> instead of <code>OpKill</code> whenever possible to
produce more predictable behavior.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-execution-memory-ordering"><a class="anchor" href="#shaders-execution-memory-ordering"></a>Shader Memory Access Ordering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The order in which image or buffer memory is read or written by shaders is
largely <strong>undefined</strong>.
For some shader types (vertex, tessellation evaluation, and in some cases,
fragment), even the number of shader invocations that <strong>may</strong> perform loads and
stores is <strong>undefined</strong>.</p>
</div>
<div class="paragraph">
<p>In particular, the following rules apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#shaders-vertex-execution">Vertex</a> and
<a href="#shaders-tessellation-evaluation-execution">tessellation evaluation</a>
shaders will be invoked at least once for each unique vertex, as defined
in those sections.</p>
</li>
<li>
<p><a href="fragops.html#fragops-shader" class="xref page">Fragment</a> shaders will be invoked zero or more times,
as defined in that section.</p>
</li>
<li>
<p>The relative execution order of invocations of the same shader type is
<strong>undefined</strong>.
A store issued by a shader when working on primitive B might complete
prior to a store for primitive A, even if primitive A is specified prior
to primitive B. This applies even to fragment shaders; while fragment
shader outputs are always written to the framebuffer in
<a href="primsrast.html#primsrast-order" class="xref page">rasterization order</a>, stores executed by fragment
shader invocations are not.</p>
</li>
<li>
<p>The relative execution order of invocations of different shader types is
largely <strong>undefined</strong>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The above limitations on shader invocation order make some forms of
synchronization between shader invocations within a single set of primitives
unimplementable.
For example, having one invocation poll memory written by another invocation
assumes that the other invocation has been launched and will complete its
writes in finite time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../appendices/memorymodel.html#memory-model" class="xref page">Memory Model</a> appendix defines the terminology and rules
for how to correctly communicate between shader invocations, such as when a
write is <a href="../appendices/memorymodel.html#memory-model-visible-to" class="xref page">Visible-To</a> a read, and what constitutes
a <a href="../appendices/memorymodel.html#memory-model-access-data-race" class="xref page">Data Race</a>.</p>
</div>
<div class="paragraph">
<p>Applications <strong>must</strong> not cause a data race.</p>
</div>
<div class="paragraph">
<p>The SPIR-V <strong>SubgroupMemory</strong>, <strong>CrossWorkgroupMemory</strong>, and
<strong>AtomicCounterMemory</strong> memory semantics are ignored.
Sequentially consistent atomics and barriers are not supported and
<strong>SequentiallyConsistent</strong> is treated as <strong>AcquireRelease</strong>.
<strong>SequentiallyConsistent</strong> <strong>should</strong> not be used.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-inputs"><a class="anchor" href="#shaders-inputs"></a>Shader Inputs and Outputs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Data is passed into and out of shaders using variables with input or output
storage class, respectively.
User-defined inputs and outputs are connected between stages by matching
their <code>Location</code> decorations.
Additionally, data <strong>can</strong> be provided by or communicated to special functions
provided by the execution environment using <code>BuiltIn</code> decorations.</p>
</div>
<div class="paragraph">
<p>In many cases, the same <code>BuiltIn</code> decoration <strong>can</strong> be used in multiple
shader stages with similar meaning.
The specific behavior of variables decorated as <code>BuiltIn</code> is documented
in the following sections.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-vertex"><a class="anchor" href="#shaders-vertex"></a>Vertex Shaders</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each vertex shader invocation operates on one vertex and its associated
<a href="fxvertex.html#fxvertex-attrib" class="xref page">vertex attribute</a> data, and outputs one vertex and
associated data.
Graphics pipelines <strong>must</strong> include a vertex shader, and the vertex shader
stage is always the first shader stage in the graphics pipeline.</p>
</div>
<div class="sect2">
<h3 id="shaders-vertex-execution"><a class="anchor" href="#shaders-vertex-execution"></a>Vertex Shader Execution</h3>
<div class="paragraph">
<p>A vertex shader <strong>must</strong> be executed at least once for each vertex specified by
a drawing command.
If the subpass includes multiple views in its view mask, the shader <strong>may</strong> be
invoked separately for each view.
During execution, the shader is presented with the index of the vertex and
instance for which it has been invoked.
Input variables declared in the vertex shader are filled by the
implementation with the values of vertex attributes associated with the
invocation being executed.</p>
</div>
<div class="paragraph">
<p>If the same vertex is specified multiple times in a drawing command (e.g. by
including the same index value multiple times in an index buffer) the
implementation <strong>may</strong> reuse the results of vertex shading if it can statically
determine that the vertex shader invocations will produce identical results.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is implementation-dependent when and if results of vertex shading are
reused, and thus how many times the vertex shader will be executed.
This is true also if the vertex shader contains stores or atomic operations
(see <a href="features.html#features-vertexPipelineStoresAndAtomics" class="xref page"><code>vertexPipelineStoresAndAtomics</code></a>).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-tessellation-control"><a class="anchor" href="#shaders-tessellation-control"></a>Tessellation Control Shaders</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The tessellation control shader is used to read an input patch provided by
the application and to produce an output patch.
Each tessellation control shader invocation operates on an input patch
(after all control points in the patch are processed by a vertex shader) and
its associated data, and outputs a single control point of the output patch
and its associated data, and <strong>can</strong> also output additional per-patch data.
The input patch is sized according to the <code>patchControlPoints</code> member of
<a href="tessellation.html#VkPipelineTessellationStateCreateInfo" class="xref page">VkPipelineTessellationStateCreateInfo</a>, as part of input assembly.</p>
</div>
<div class="paragraph">
<p>The size of the output patch is controlled by the <code>OpExecutionMode</code>
<code>OutputVertices</code> specified in the tessellation control or tessellation
evaluation shaders, which <strong>must</strong> be specified in at least one of the shaders.
The size of the input and output patches <strong>must</strong> each be greater than zero and
less than or equal to
<code>VkPhysicalDeviceLimits</code>::<code>maxTessellationPatchSize</code>.</p>
</div>
<div class="sect2">
<h3 id="shaders-tessellation-control-execution"><a class="anchor" href="#shaders-tessellation-control-execution"></a>Tessellation Control Shader Execution</h3>
<div class="paragraph">
<p>A tessellation control shader is invoked at least once for each <em>output</em>
vertex in a patch.
If the subpass includes multiple views in its view mask, the shader <strong>may</strong> be
invoked separately for each view.</p>
</div>
<div class="paragraph">
<p>Inputs to the tessellation control shader are generated by the vertex
shader.
Each invocation of the tessellation control shader <strong>can</strong> read the attributes
of any incoming vertices and their associated data.
The invocations corresponding to a given patch execute logically in
parallel, with <strong>undefined</strong> relative execution order.
However, the <code>OpControlBarrier</code> instruction <strong>can</strong> be used to provide
limited control of the execution order by synchronizing invocations within a
patch, effectively dividing tessellation control shader execution into a set
of phases.
Tessellation control shaders will read <strong>undefined</strong> values if one invocation
reads a per-vertex or per-patch output written by another invocation at any
point during the same phase, or if two invocations attempt to write
different values to the same per-patch output in a single phase.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-tessellation-evaluation"><a class="anchor" href="#shaders-tessellation-evaluation"></a>Tessellation Evaluation Shaders</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Tessellation Evaluation Shader operates on an input patch of control
points and their associated data, and a single input barycentric coordinate
indicating the invocation&#8217;s relative position within the subdivided patch,
and outputs a single vertex and its associated data.</p>
</div>
<div class="sect2">
<h3 id="shaders-tessellation-evaluation-execution"><a class="anchor" href="#shaders-tessellation-evaluation-execution"></a>Tessellation Evaluation Shader Execution</h3>
<div class="paragraph">
<p>A tessellation evaluation shader is invoked at least once for each unique
vertex generated by the tessellator.
If the subpass includes multiple views in its view mask, the shader <strong>may</strong> be
invoked separately for each view.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-geometry"><a class="anchor" href="#shaders-geometry"></a>Geometry Shaders</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The geometry shader operates on a group of vertices and their associated
data assembled from a single input primitive, and emits zero or more output
primitives and the group of vertices and their associated data required for
each output primitive.</p>
</div>
<div class="sect2">
<h3 id="shaders-geometry-execution"><a class="anchor" href="#shaders-geometry-execution"></a>Geometry Shader Execution</h3>
<div class="paragraph">
<p>A geometry shader is invoked at least once for each primitive produced by
the tessellation stages, or at least once for each primitive generated by
<a href="drawing.html#drawing" class="xref page">primitive assembly</a> when tessellation is not in use.
A shader can request that the geometry shader runs multiple
<a href="geometry.html#geometry-invocations" class="xref page">instances</a>.
A geometry shader is invoked at least once for each instance.
If the subpass includes multiple views in its view mask, the shader <strong>may</strong> be
invoked separately for each view.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-fragment"><a class="anchor" href="#shaders-fragment"></a>Fragment Shaders</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Fragment shaders are invoked as a <a href="fragops.html#fragops-shader" class="xref page">fragment operation</a> in
a graphics pipeline.
Each fragment shader invocation operates on a single fragment and its
associated data.
With few exceptions, fragment shaders do not have access to any data
associated with other fragments and are considered to execute in isolation
of fragment shader invocations associated with other fragments.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-compute"><a class="anchor" href="#shaders-compute"></a>Compute Shaders</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Compute shaders are invoked via <a href="dispatch.html#vkCmdDispatch" class="xref page">vkCmdDispatch</a> and
<a href="dispatch.html#vkCmdDispatchIndirect" class="xref page">vkCmdDispatchIndirect</a> commands.
In general, they have access to similar resources as shader stages executing
as part of a graphics pipeline.</p>
</div>
<div class="paragraph">
<p>Compute workloads are formed from groups of work items called workgroups and
processed by the compute shader in the current compute pipeline.
A workgroup is a collection of shader invocations that execute the same
shader, potentially in parallel.
Compute shaders execute in <em>global workgroups</em> which are divided into a
number of <em>local workgroups</em> with a size that <strong>can</strong> be set by assigning a
value to the <code>LocalSize</code>
or <code>LocalSizeId</code>
execution mode or via an object decorated by the <code>WorkgroupSize</code>
decoration.
An invocation within a local workgroup <strong>can</strong> share data with other members of
the local workgroup through shared variables and issue memory and control
flow barriers to synchronize with other members of the local workgroup.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-interpolation-decorations"><a class="anchor" href="#shaders-interpolation-decorations"></a>Interpolation Decorations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Variables in the <code>Input</code> storage class in a fragment shader&#8217;s interface
are interpolated from the values specified by the primitive being
rasterized.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Interpolation decorations can be present on input and output variables in
pre-rasterization shaders but have no effect on the interpolation performed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An undecorated input variable will be interpolated with perspective-correct
interpolation according to the primitive type being rasterized.
<a href="primsrast.html#line_perspective_interpolation" class="xref page">Lines</a> and
<a href="primsrast.html#triangle_perspective_interpolation" class="xref page">polygons</a> are interpolated in the same
way as the primitive&#8217;s clip coordinates.
If the <code>NoPerspective</code> decoration is present, linear interpolation is
instead used for <a href="primsrast.html#line_linear_interpolation" class="xref page">lines</a> and
<a href="primsrast.html#triangle_linear_interpolation" class="xref page">polygons</a>.
For points, as there is only a single vertex, input values are never
interpolated and instead take the value written for the single vertex.</p>
</div>
<div class="paragraph">
<p>If the <code>Flat</code> decoration is present on an input variable, the value is
not interpolated, and instead takes its value directly from the
<a href="vertexpostproc.html#vertexpostproc-flatshading" class="xref page">provoking vertex</a>.
Fragment shader inputs that are signed or unsigned integers, integer
vectors, or any double-precision floating-point type <strong>must</strong> be decorated with
<code>Flat</code>.</p>
</div>
<div class="paragraph">
<p>Interpolation of input variables is performed at an implementation-defined
position within the fragment area being shaded.
The position is further constrained as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the <code>Centroid</code> decoration is used, the interpolation position used
for the variable <strong>must</strong> also fall within the bounds of the primitive
being rasterized.</p>
</li>
<li>
<p>If the <code>Sample</code> decoration is used, the interpolation position used
for the variable <strong>must</strong> be at the position of the sample being shaded by
the current fragment shader invocation.</p>
</li>
<li>
<p>If a sample count of 1 is used, the interpolation position <strong>must</strong> be at
the center of the fragment area.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As <code>Centroid</code> restricts the possible interpolation position to the
covered area of the primitive, the position can be forced to vary between
neighboring fragments when it otherwise would not.
Derivatives calculated based on these differing locations can produce
inconsistent results compared to undecorated inputs.
It is recommended that input variables used in derivative calculations are
not decorated with <code>Centroid</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-staticuse"><a class="anchor" href="#shaders-staticuse"></a>Static Use</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A SPIR-V module declares a global object in memory using the <code>OpVariable</code>
instruction, which results in a pointer <code>x</code> to that object.
A specific entry point in a SPIR-V module is said to <em>statically use</em> that
object if that entry point&#8217;s call tree contains a function containing a
instruction with <code>x</code> as an <code>id</code> operand.
A shader entry point also <em>statically uses</em> any variables explicitly
declared in its interface.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-scope"><a class="anchor" href="#shaders-scope"></a>Scope</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>scope</em> describes a set of shader invocations, where each such set is a
<em>scope instance</em>.
Each invocation belongs to one or more scope instances, but belongs to no
more than one scope instance for each scope.</p>
</div>
<div class="paragraph">
<p>The operations available between invocations in a given scope instance vary,
with smaller scopes generally able to perform more operations, and with
greater efficiency.</p>
</div>
<div class="sect2">
<h3 id="shaders-scope-cross-device"><a class="anchor" href="#shaders-scope-cross-device"></a>Cross Device</h3>
<div class="paragraph">
<p>All invocations executed in a Vulkan instance fall into a single <em>cross
device scope instance</em>.</p>
</div>
<div class="paragraph">
<p>Whilst the <code>CrossDevice</code> scope is defined in SPIR-V, it is disallowed in
Vulkan.
API <a href="synchronization.html#synchronization" class="xref page">synchronization</a> commands <strong>can</strong> be used to
communicate between devices.</p>
</div>
</div>
<div class="sect2">
<h3 id="shaders-scope-device"><a class="anchor" href="#shaders-scope-device"></a>Device</h3>
<div class="paragraph">
<p>All invocations executed on a single device form a <em>device scope instance</em>.</p>
</div>
<div class="paragraph">
<p>If the <a href="features.html#features-vulkanMemoryModel" class="xref page"><code>vulkanMemoryModel</code></a> and
<a href="features.html#features-vulkanMemoryModelDeviceScope" class="xref page"><code>vulkanMemoryModelDeviceScope</code></a> features are enabled, this scope is
represented in SPIR-V by the <code>Device</code> <code>Scope</code>, which <strong>can</strong> be used as a
<code>Memory</code> <code>Scope</code> for barrier and atomic operations.</p>
</div>
<div class="paragraph">
<p>There is no method to synchronize the execution of these invocations within
SPIR-V, and this <strong>can</strong> only be done with API synchronization primitives.</p>
</div>
<div class="paragraph">
<p>Invocations executing on different devices in a device group operate in
separate device scope instances.</p>
</div>
</div>
<div class="sect2">
<h3 id="shaders-scope-queue-family"><a class="anchor" href="#shaders-scope-queue-family"></a>Queue Family</h3>
<div class="paragraph">
<p>Invocations executed by queues in a given queue family form a <em>queue family
scope instance</em>.</p>
</div>
<div class="paragraph">
<p>This scope is identified in SPIR-V as the
<code>QueueFamily</code> <code>Scope</code> if the <a href="features.html#features-vulkanMemoryModel" class="xref page"><code>vulkanMemoryModel</code></a> feature is enabled, or if not, the
<code>Device</code> <code>Scope</code>, which <strong>can</strong> be used as a <code>Memory</code> <code>Scope</code> for
barrier and atomic operations.</p>
</div>
<div class="paragraph">
<p>There is no method to synchronize the execution of these invocations within
SPIR-V, and this <strong>can</strong> only be done with API synchronization primitives.</p>
</div>
<div class="paragraph">
<p>Each invocation in a queue family scope instance <strong>must</strong> be in the same
<a href="#shaders-scope-device">device scope instance</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="shaders-scope-command"><a class="anchor" href="#shaders-scope-command"></a>Command</h3>
<div class="paragraph">
<p>Any shader invocations executed as the result of a single command such as
<a href="dispatch.html#vkCmdDispatch" class="xref page">vkCmdDispatch</a> or <a href="drawing.html#vkCmdDraw" class="xref page">vkCmdDraw</a> form a <em>command scope instance</em>.
For indirect drawing commands with <code>drawCount</code> greater than one,
invocations from separate draws are in separate command scope instances.</p>
</div>
<div class="paragraph">
<p>There is no specific <code>Scope</code> for communication across invocations in a
command scope instance.
As this has a clear boundary at the API level, coordination here <strong>can</strong> be
performed in the API, rather than in SPIR-V.</p>
</div>
<div class="paragraph">
<p>Each invocation in a command scope instance <strong>must</strong> be in the same
<a href="#shaders-scope-queue-family">queue-family scope instance</a>.</p>
</div>
<div class="paragraph">
<p>For shaders without defined <a href="#shaders-scope-workgroup">workgroups</a>, this
set of invocations forms an <em>invocation group</em> as defined in the
<a href="introduction.html#spirv-spec" class="xref page">SPIR-V specification</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="shaders-scope-primitive"><a class="anchor" href="#shaders-scope-primitive"></a>Primitive</h3>
<div class="paragraph">
<p>Any fragment shader invocations executed as the result of rasterization of a
single primitive form a <em>primitive scope instance</em>.</p>
</div>
<div class="paragraph">
<p>There is no specific <code>Scope</code> for communication across invocations in a
primitive scope instance.</p>
</div>
<div class="paragraph">
<p>Any generated <a href="#shaders-helper-invocations">helper invocations</a> are
included in this scope instance.</p>
</div>
<div class="paragraph">
<p>Each invocation in a primitive scope instance <strong>must</strong> be in the same
<a href="#shaders-scope-command">command scope instance</a>.</p>
</div>
<div class="paragraph">
<p>Any input variables decorated with <code>Flat</code> are uniform within a primitive
scope instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="shaders-scope-workgroup"><a class="anchor" href="#shaders-scope-workgroup"></a>Workgroup</h3>
<div class="paragraph">
<p>A <em>local workgroup</em> is a set of invocations that can synchronize and share
data with each other using memory in the <code>Workgroup</code> storage class.</p>
</div>
<div class="paragraph">
<p>The <code>Workgroup</code> <code>Scope</code> can be used as both an <code>Execution</code>
<code>Scope</code> and <code>Memory</code> <code>Scope</code> for barrier and atomic operations.</p>
</div>
<div class="paragraph">
<p>Each invocation in a local workgroup <strong>must</strong> be in the same
<a href="#shaders-scope-command">command scope instance</a>.</p>
</div>
<div class="paragraph">
<p>Only
compute shaders have defined workgroups - other shader types <strong>cannot</strong> use
workgroup functionality.
For shaders that have defined workgroups, this set of invocations forms an
<em>invocation group</em> as defined in the <a href="introduction.html#spirv-spec" class="xref page">SPIR-V specification</a>.</p>
</div>
<div id="workgroup-padding" class="paragraph">
<p>The amount of storage consumed by the
variables declared with the <code>Workgroup</code> storage class is
implementation-dependent.
However, the amount of storage consumed may not exceed the largest block
size that would be obtained if all active
variables declared with <code>Workgroup</code> storage class were assigned offsets
in an arbitrary order by successively taking the smallest valid offset
according to the <a href="interfaces.html#interfaces-resources-standard-layout" class="xref page">Standard Storage Buffer Layout</a> rules, and with <code>Boolean</code> values considered as 32-bit
integer values for the purpose of this calculation.
(This is equivalent to using the GLSL std430 layout rules.)</p>
</div>
</div>
<div class="sect2">
<h3 id="shaders-scope-subgroup"><a class="anchor" href="#shaders-scope-subgroup"></a>Subgroup</h3>
<div class="paragraph">
<p>A <em>subgroup</em> (see the subsection &#8220;Control Flow&#8221; of section 2 of the SPIR-V
1.3 Revision 1 specification) is a set of invocations that can synchronize
and share data with each other efficiently.</p>
</div>
<div class="paragraph">
<p>The <code>Subgroup</code> <code>Scope</code> can be used as both an <code>Execution</code>
<code>Scope</code> and <code>Memory</code> <code>Scope</code> for barrier and atomic operations.
Other <a href="limits.html#VkSubgroupFeatureFlagBits" class="xref page">subgroup features</a> allow the use of
<a href="#shaders-group-operations">group operations</a> with subgroup scope.</p>
</div>
<div class="paragraph">
<p>For <a href="#shaders-scope-workgroup">shaders that have defined workgroups</a>, each
invocation in a subgroup <strong>must</strong> be in the same <a href="#shaders-scope-workgroup">local workgroup</a>.</p>
</div>
<div class="paragraph">
<p>In other shader stages, each invocation in a subgroup <strong>must</strong> be in the same
<a href="#shaders-scope-device">device scope instance</a>.</p>
</div>
<div class="paragraph">
<p>Only <a href="devsandqueues.html#limits-subgroupSupportedStages" class="xref page">shader stages that support subgroup operations</a> have defined subgroups.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Subgroups are not guaranteed to be a subset of a single command in
<a href="#shaders-scope-workgroup">shaders that do not have defined workgroups</a>.
Values that are guaranteed to be uniform for a given command or sub command
may then not be uniform for the subgroup, and vice versa.
As such, applications must take care when dealing with mixed uniformity.</p>
</div>
<div class="paragraph">
<p>A somewhat common example of this would something like trying to optimize
access to per-draw data using subgroup operations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-glsl hljs" data-lang="glsl">buffer { uint draw_data[]; };

flat in int vDrawID; // Passed through from vertex shader

void main()
{
    uint local_draw_data = subgroupBroadcastFirst(draw_data[local_draw_data]);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be done in an attempt to optimize the shader to only perform the
loads once per subgroup.
However, if the implementation packs multiple draws into a single subgroup,
invocations from draws with a different drawID are now receiving data from
the wrong invocation.
Applications should rely on implementations to do this kind of optimization
automatically where the implementation can, rather than trying to force it.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="shaders-scope-quad"><a class="anchor" href="#shaders-scope-quad"></a>Quad</h3>
<div class="paragraph">
<p>A <em>quad scope instance</em> is formed of four shader invocations.</p>
</div>
<div class="paragraph">
<p>In a fragment shader, each invocation in a quad scope instance is formed of
invocations in neighboring framebuffer locations <span class="eq">(x<sub>i</sub>, y<sub>i</sub>)</span>, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="eq">i</span> is the index of the invocation within the scope instance.</p>
</li>
<li>
<p><span class="eq">w</span> and <span class="eq">h</span> are the number of pixels the fragment covers in the
<span class="eq">x</span> and <span class="eq">y</span> axes.</p>
</li>
<li>
<p><span class="eq">w</span> and <span class="eq">h</span> are identical for all participating invocations.</p>
</li>
<li>
<p><span class="eq">(x<sub>0</sub>) = (x<sub>1</sub> - w) = (x<sub>2</sub>) = (x<sub>3</sub> - w)</span></p>
</li>
<li>
<p><span class="eq">(y<sub>0</sub>) = (y<sub>1</sub>) = (y<sub>2</sub> - h) = (y<sub>3</sub> - h)</span></p>
</li>
<li>
<p>Each invocation has the same layer and sample indices.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In all shaders, each invocation in a quad scope instance is formed of
invocations in adjacent subgroup invocation indices <span class="eq">(s<sub>i</sub>)</span>, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="eq">i</span> is the index of the invocation within the quad scope instance.</p>
</li>
<li>
<p><span class="eq">(s<sub>0</sub>) = (s<sub>1</sub> - 1) = (s<sub>2</sub> - 2) = (s<sub>3</sub> - 3)</span></p>
</li>
<li>
<p><span class="eq">s<sub>0</sub></span> is an integer multiple of 4.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each invocation in a quad scope instance <strong>must</strong> be in the same
<a href="#shaders-scope-subgroup">subgroup</a>.</p>
</div>
<div class="paragraph">
<p>In a fragment shader, each invocation in a quad scope instance <strong>must</strong> be in
the same <a href="#shaders-scope-primitive">primitive scope instance</a>.</p>
</div>
<div class="paragraph">
<p>Fragment
and compute
shaders have defined quad scope instances.
If the <a href="devsandqueues.html#limits-subgroupQuadOperationsInAllStages" class="xref page"><code>quadOperationsInAllStages</code></a> limit is supported, any
<a href="devsandqueues.html#limits-subgroupSupportedStages" class="xref page">shader stages that support subgroup operations</a> also have defined quad scope instances.</p>
</div>
</div>
<div class="sect2">
<h3 id="shaders-scope-invocation"><a class="anchor" href="#shaders-scope-invocation"></a>Invocation</h3>
<div class="paragraph">
<p>The smallest <em>scope</em> is a single invocation; this is represented by the
<code>Invocation</code> <code>Scope</code> in SPIR-V.</p>
</div>
<div class="paragraph">
<p>Fragment shader invocations <strong>must</strong> be in a <a href="#shaders-scope-primitive">primitive scope instance</a>.</p>
</div>
<div class="paragraph">
<p>Invocations in <a href="#shaders-scope-workgroup">shaders that have defined workgroups</a> <strong>must</strong> be in a <a href="#shaders-scope-workgroup">local workgroup</a>.</p>
</div>
<div class="paragraph">
<p>Invocations in <a href="#shaders-scope-subgroup">shaders that have a defined subgroup scope</a> <strong>must</strong> be in a <a href="#shaders-scope-subgroup">subgroup</a>.</p>
</div>
<div class="paragraph">
<p>Invocations in <a href="#shaders-scope-quad">shaders that have a defined quad scope</a> <strong>must</strong> be in a <a href="#shaders-scope-quad">quad scope instance</a>.</p>
</div>
<div class="paragraph">
<p>All invocations in all stages <strong>must</strong> be in a <a href="#shaders-scope-command">command scope instance</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-group-operations"><a class="anchor" href="#shaders-group-operations"></a>Group Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Group operations</em> are executed by multiple invocations within a
<a href="#shaders-scope">scope instance</a>; with each invocation involved in
calculating the result.
This provides a mechanism for efficient communication between invocations in
a particular scope instance.</p>
</div>
<div class="paragraph">
<p>Group operations all take a <code>Scope</code> defining the desired
<a href="#shaders-scope">scope instance</a> to operate within.
Only the <code>Subgroup</code> scope <strong>can</strong> be used for these operations; the
<a href="devsandqueues.html#limits-subgroupSupportedOperations" class="xref page"><code>subgroupSupportedOperations</code></a>
limit defines which types of operation <strong>can</strong> be used.</p>
</div>
<div class="sect2">
<h3 id="shaders-group-operations-basic"><a class="anchor" href="#shaders-group-operations-basic"></a>Basic Group Operations</h3>
<div class="paragraph">
<p>Basic group operations include the use of <code>OpGroupNonUniformElect</code>,
<code>OpControlBarrier</code>, <code>OpMemoryBarrier</code>, and atomic operations.</p>
</div>
<div class="paragraph">
<p><code>OpGroupNonUniformElect</code> <strong>can</strong> be used to choose a single invocation to
perform a task for the whole group.
Only the invocation with the lowest id in the group will return <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The <a href="../appendices/memorymodel.html#memory-model" class="xref page">Memory Model</a> appendix defines the operation of barriers
and atomics.</p>
</div>
</div>
<div class="sect2">
<h3 id="shaders-group-operations-vote"><a class="anchor" href="#shaders-group-operations-vote"></a>Vote Group Operations</h3>
<div class="paragraph">
<p>The vote group operations allow invocations within a group to compare values
across a group.
The types of votes enabled are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do all active group invocations agree that an expression is true?</p>
</li>
<li>
<p>Do any active group invocations evaluate an expression to true?</p>
</li>
<li>
<p>Do all active group invocations have the same value of an expression?</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These operations are useful in combination with control flow in that they
allow for developers to check whether conditions match across the group and
choose potentially faster code-paths in these cases.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="shaders-group-operations-arithmetic"><a class="anchor" href="#shaders-group-operations-arithmetic"></a>Arithmetic Group Operations</h3>
<div class="paragraph">
<p>The arithmetic group operations allow invocations to perform scans and
reductions across a group.
The operators supported are add, mul, min, max, and, or, xor.</p>
</div>
<div class="paragraph">
<p>For reductions, every invocation in a group will obtain the cumulative
result of these operators applied to all values in the group.
For exclusive scans, each invocation in a group will obtain the cumulative
result of these operators applied to all values in invocations with a lower
index in the group.
Inclusive scans are identical to exclusive scans, except the cumulative
result includes the operator applied to the value in the current invocation.</p>
</div>
<div class="paragraph">
<p>The order in which these operators are applied is implementation-dependent.</p>
</div>
</div>
<div class="sect2">
<h3 id="shaders-group-operations-ballot"><a class="anchor" href="#shaders-group-operations-ballot"></a>Ballot Group Operations</h3>
<div class="paragraph">
<p>The ballot group operations allow invocations to perform more complex votes
across the group.
The ballot functionality allows all invocations within a group to provide a
boolean value and get as a result what each invocation provided as their
boolean value.
The broadcast functionality allows values to be broadcast from an invocation
to all other invocations within the group.</p>
</div>
</div>
<div class="sect2">
<h3 id="shaders-group-operations-shuffle"><a class="anchor" href="#shaders-group-operations-shuffle"></a>Shuffle Group Operations</h3>
<div class="paragraph">
<p>The shuffle group operations allow invocations to read values from other
invocations within a group.</p>
</div>
</div>
<div class="sect2">
<h3 id="shaders-group-operations-shuffle-relative"><a class="anchor" href="#shaders-group-operations-shuffle-relative"></a>Shuffle Relative Group Operations</h3>
<div class="paragraph">
<p>The shuffle relative group operations allow invocations to read values from
other invocations within the group relative to the current invocation in the
group.
The relative operations supported allow data to be shifted up and down
through the invocations within a group.</p>
</div>
</div>
<div class="sect2">
<h3 id="shaders-group-operations-clustered"><a class="anchor" href="#shaders-group-operations-clustered"></a>Clustered Group Operations</h3>
<div class="paragraph">
<p>The clustered group operations allow invocations to perform an operation
among partitions of a group, such that the operation is only performed
within the group invocations within a partition.
The partitions for clustered group operations are consecutive power-of-two
size groups of invocations and the cluster size <strong>must</strong> be known at pipeline
creation time.
The operations supported are add, mul, min, max, and, or, xor.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-quad-operations"><a class="anchor" href="#shaders-quad-operations"></a>Quad Group Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quad group operations (<code>OpGroupNonUniformQuad*</code>) are a specialized type
of <a href="#shaders-group-operations">group operations</a> that only operate on
<a href="#shaders-scope-quad">quad scope instances</a>.
Whilst these instructions do include a <code>Scope</code> parameter, this scope is
always overridden; only the <a href="#shaders-scope-quad">quad scope instance</a> is
included in its execution scope.</p>
</div>
<div class="paragraph">
<p>Fragment shaders that statically execute either
<code>OpGroupNonUniformQuadBroadcast</code> or <code>OpGroupNonUniformQuadSwap</code> <strong>must</strong>
launch sufficient invocations to ensure their correct operation; additional
<a href="#shaders-helper-invocations">helper invocations</a> are launched for
framebuffer locations not covered by rasterized fragments if necessary.</p>
</div>
<div class="paragraph">
<p>The index used to select participating invocations is <span class="eq">i</span>, as described
for a <a href="#shaders-scope-quad">quad scope instance</a>, defined as the <em>quad
index</em> in the <a href="introduction.html#spirv-spec" class="xref page">SPIR-V specification</a>.</p>
</div>
<div class="paragraph">
<p>For <code>OpGroupNonUniformQuadBroadcast</code> this value is equal to <code>Index</code>.
For <code>OpGroupNonUniformQuadSwap</code>, it is equal to the implicit <code>Index</code>
used by each participating invocation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-derivative-operations"><a class="anchor" href="#shaders-derivative-operations"></a>Derivative Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Derivative operations calculate the partial derivative for an expression
<span class="eq">P</span> as a function of an invocation&#8217;s <span class="eq">x</span> and <span class="eq">y</span> coordinates.</p>
</div>
<div class="paragraph">
<p>Derivative operations operate on a set of invocations known as a <em>derivative
group</em> as defined in the <a href="introduction.html#spirv-spec" class="xref page">SPIR-V specification</a>.</p>
</div>
<div class="paragraph">
<p>A derivative group in a fragment shader is equivalent to the
<a href="#shaders-scope-primitive">primitive scope instance</a>.</p>
</div>
<div class="paragraph">
<p>Derivatives are calculated assuming that <span class="eq">P</span> is piecewise linear and
continuous within the derivative group.</p>
</div>
<div class="paragraph">
<p>The following control-flow restrictions apply to derivative operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dynamic instances of explicit derivative instructions (<code>OpDPdx*</code>,
<code>OpDPdy*</code>, and <code>OpFwidth*</code>) <strong>must</strong> be executed in control flow
that is uniform within a derivative group.</p>
</li>
<li>
<p>dynamic instances of implicit derivative operations <strong>can</strong> be executed in
control flow that is not uniform within the derivative group, but
results are <strong>undefined</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Fragment shaders that statically execute derivative operations <strong>must</strong> launch
sufficient invocations to ensure their correct operation; additional
<a href="#shaders-helper-invocations">helper invocations</a> are launched for
framebuffer locations not covered by rasterized fragments if necessary.</p>
</div>
<div class="paragraph">
<p>Derivative operations calculate their results as the difference between the
result of <span class="eq">P</span> across invocations in the quad.
For fine derivative operations (<code>OpDPdxFine</code> and <code>OpDPdyFine</code>), the
values of <span class="eq">DPdx(P<sub>i</sub>)</span> are calculated as</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq">DPdx(P<sub>0</sub>) = DPdx(P<sub>1</sub>) = P<sub>1</sub> - P<sub>0</sub></span></p>
</dd>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq">DPdx(P<sub>2</sub>) = DPdx(P<sub>3</sub>) = P<sub>3</sub> - P<sub>2</sub></span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>and the values of <span class="eq">DPdy(P<sub>i</sub>)</span> are calculated as</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq">DPdy(P<sub>0</sub>) = DPdy(P<sub>2</sub>) = P<sub>2</sub> - P<sub>0</sub></span></p>
</dd>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq">DPdy(P<sub>1</sub>) = DPdy(P<sub>3</sub>) = P<sub>3</sub> - P<sub>1</sub></span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>where <span class="eq">i</span> is the index of each invocation as described in
<a href="#shaders-scope-quad">Quad</a>.</p>
</div>
<div class="paragraph">
<p>Coarse derivative operations (<code>OpDPdxCoarse</code> and <code>OpDPdyCoarse</code>),
calculate their results in roughly the same manner, but <strong>may</strong> only calculate
two values instead of four (one for each of <span class="eq">DPdx</span> and <span class="eq">DPdy</span>),
reusing the same result no matter the originating invocation.
If an implementation does this, it <strong>should</strong> use the fine derivative
calculations described for <span class="eq">P<sub>0</sub></span>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Derivative values are calculated between fragments rather than pixels.
If the fragment shader invocations involved in the calculation cover
multiple pixels, these operations cover a wider area, resulting in larger
derivative values.
This in turn will result in a coarser LOD being selected for image sampling
operations using derivatives.</p>
</div>
<div class="paragraph">
<p>Applications may want to account for this when using multi-pixel fragments;
if pixel derivatives are desired, applications should use explicit
derivative operations and divide the results by the size of the fragment in
each dimension as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq">DPdx(P<sub>n</sub>)' = DPdx(P<sub>n</sub>) / w</span></p>
</dd>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq">DPdy(P<sub>n</sub>)' = DPdy(P<sub>n</sub>) / h</span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>where <span class="eq">w</span> and <span class="eq">h</span> are the size of the fragments in the quad, and
<span class="eq">DPdx(P<sub>n</sub>)'</span> and <span class="eq">DPdy(P<sub>n</sub>)'</span> are the pixel derivatives.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The results for <code>OpDPdx</code> and <code>OpDPdy</code> <strong>may</strong> be calculated as either
fine or coarse derivatives, with implementations favoring the most efficient
approach.
Implementations <strong>must</strong> choose coarse or fine consistently between the two.</p>
</div>
<div class="paragraph">
<p>Executing <code>OpFwidthFine</code>, <code>OpFwidthCoarse</code>, or <code>OpFwidth</code> is
equivalent to executing the corresponding <code>OpDPdx*</code> and <code>OpDPdy*</code>
instructions, taking the absolute value of the results, and summing them.</p>
</div>
<div class="paragraph">
<p>Executing an <code>OpImage*Sample*ImplicitLod</code> instruction is equivalent to
executing <code>OpDPdx</code>(<code>Coordinate</code>) and <code>OpDPdy</code>(<code>Coordinate</code>), and
passing the results as the <code>Grad</code> operands <code>dx</code> and <code>dy</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is expected that using the <code>ImplicitLod</code> variants of sampling
functions will be substantially more efficient than using the
<code>ExplicitLod</code> variants with explicitly generated derivatives.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shaders-helper-invocations"><a class="anchor" href="#shaders-helper-invocations"></a>Helper Invocations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When performing <a href="#shaders-derivative-operations">derivative</a>
or <a href="#shaders-quad-operations">quad group</a>
operations in a fragment shader, additional invocations <strong>may</strong> be spawned in
order to ensure correct results.
These additional invocations are known as <em>helper invocations</em> and <strong>can</strong> be
identified by a non-zero value in the <code>HelperInvocation</code> built-in.
Stores and atomics performed by helper invocations <strong>must</strong> not have any effect
on memory except for the <code>Function</code>, <code>Private</code> and <code>Output</code> storage
classes, and values returned by atomic instructions in helper invocations
are <strong>undefined</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While storage to <code>Output</code> storage class has an effect even in helper
invocations, it does not mean that helper invocations have an effect on the
framebuffer.
<code>Output</code> variables in fragment shaders can be read from as well, and they
behave more like <code>Private</code> variables for the duration of the shader
invocation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Helper
invocations <strong>may</strong> be considered inactive for <a href="#shaders-group-operations">group operations</a> other than <a href="#shaders-derivative-operations">derivative</a>
and <a href="#shaders-quad-operations">quad group</a> operations.
All invocations in a quad scope instance <strong>may</strong> become permanently inactive at
any point once the only remaining invocations in that quad scope instance
are helper invocations.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
