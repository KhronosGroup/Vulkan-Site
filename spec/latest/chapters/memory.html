<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Memory Allocation :: Vulkan Documentation Project Demo</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Vulkan Documentation Project Demo</a>
      <div class="navbar-item">
        <img alt="Vulkan White Label" src="../../../_/Vulkan_White_Dec16.svg" height="100%" />
      </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label for="search-input"></label><input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../spec/latest/chapters/introduction.html">Vulkan 1.3</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../guide/latest/index.html">Vulkan Guide</a>
          </div>
        </div>
            <!--
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tools</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">TBD</a>
          </div>
        </div>
            -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tutorial</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../tutorial/latest/index.html">Vulkan Tutorial</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Samples</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../samples/latest/README.html">Vulkan Samples</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Help</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://khr.io/khrdiscord">Khronos Discord</a>
          </div>
        </div>
            <!--
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
            -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="spec" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Vulkan Specification and Proposals</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fundamentals.html">Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="initialization.html">Initialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="devsandqueues.html">Devices and Queues</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cmdbuffers.html">Command Buffers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="synchronization.html">Synchronization and Cache Control</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="renderpass.html">Render Pass</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="shaders.html">Shaders</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pipelines.html">Pipelines</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="memory.html">Memory Allocation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="resources.html">Resource Creation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="samplers.html">Samplers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="descriptorsets.html">Resource Descriptors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="interfaces.html">Shader Interfaces</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="textures.html">Image Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fragmentdensitymapops.html">Fragment Density Map Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="queries.html">Queries</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="clears.html">Clear Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="copies.html">Copy Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="drawing.html">Drawing Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fxvertex.html">Fixed-Function Vertex Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tessellation.html">Tessellation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="geometry.html">Geometry Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_mesh_shader/mesh.html">Mesh Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_HUAWEI_cluster_culling_shader/clusterculling.html">Cluster Culling Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="vertexpostproc.html">Fixed-Function Vertex Post-Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="primsrast.html">Rasterization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fragops.html">Fragment Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="framebuffer.html">The Framebuffer</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="dispatch.html">Dispatching Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_device_generated_commands/generatedcommands.html">Device-Generated Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="sparsemem.html">Sparse Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_KHR_surface/wsi.html">Window System Integration (WSI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_KHR_deferred_host_operations/deferred_host_operations.html">Deferred Host Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_EXT_private_data.html">Private Data</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="accelstructures.html">Acceleration Structures</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_EXT_opacity_micromap/micromaps.html">Micromap</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="raytraversal.html">Ray Traversal</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="raytracing.html">Ray Tracing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_memory_decompression.html">Memory Decompression</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="video_extensions.html">Video Coding</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_optical_flow/optical_flow.html">Optical Flow</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extensions.html">Extending Vulkan</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="limits.html">Limits</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="formats.html">Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="capabilities.html">Additional Capabilities</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="debugging.html">Debugging</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/spirvenv.html">Vulkan Environment for SPIR-V</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/memorymodel.html">Memory Model</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/compressedtex.html">Compressed Image Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/versions.html">Core Revisions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/extensions.html">Layers &amp; Extensions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/roadmap.html">Vulkan Roadmap Milestones</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/boilerplate.html">API Boilerplate</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/invariance.html">Invariance</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/glossary.html">Lexicon</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/credits.html">Credits (Informative)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../proposals/index.html">Vulkan Proposals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Vulkan Roadmap</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/Roadmap.html">Vulkan Roadmap</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extension Proposals</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_AMD_shader_early_and_late_fragment_tests.html">VK_AMD_shader_early_and_late_fragment_tests</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_attachment_feedback_loop_layout.html">VK_EXT_attachment_feedback_loop_layout</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_graphics_pipeline_library.html">VK_EXT_graphics_pipeline_library</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_image_2d_array_of_3d.html">VK_EXT_image_2d_array_of_3d</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_image_compression_control.html">VK_EXT_image_compression_control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_metal_objects.html">VK_EXT_metal_objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_multisampled_render_to_single_sampled.html">VK_EXT_multisampled_render_to_single_sampled</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_non_seamless_cube_map.html">VK_EXT_non_seamless_cube_map</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_primitives_generated_query.html">VK_EXT_primitives_generated_query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_rasterization_order_attachment_access.html">VK_EXT_rasterization_order_attachment_access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_shader_module_identifier.html">VK_EXT_shader_module_identifier</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_subpass_merge_feedback.html">VK_EXT_subpass_merge_feedback</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_GOOGLE_surfaceless_query.html">VK_GOOGLE_surfaceless_query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_HUAWEI_invocation_mask.html">VK_HUAWEI_invocation_mask</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_KHR_dynamic_rendering.html">VK_KHR_dynamic_rendering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_KHR_fragment_shader_barycentric.html">VK_KHR_fragment_shader_barycentric</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_KHR_fragment_shading_rate.html">VK_KHR_fragment_shading_rate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_KHR_shader_integer_dot_product.html">VK_KHR_shader_integer_dot_product</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_QCOM_image_processing.html">VK_QCOM_image_processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_QCOM_tile_properties.html">VK_QCOM_tile_properties</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extension Proposal Template</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/template.html">Proposal Template</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Vulkan Specification and Proposals</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../tutorial/latest/00_Introduction.html">Khronos Vulkan Tutorial</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tutorial/latest/00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../guide/latest/index.html">Vulkan Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Vulkan Specification and Proposals</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Vulkan Specification and Proposals</a></li>
    <li><a href="memory.html">Memory Allocation</a></li>
  </ul>
</nav>
    <!--
  <div class="edit-this-page"><a href="https://github.com/KhronosGroup/Vulkan-Docs/edit/main/antora/modules/ROOT/pages/chapters/memory.adoc">Edit this Page</a></div>
      -->
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Memory Allocation</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Vulkan memory is broken up into two categories, <em>host memory</em> and <em>device
memory</em>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="memory-host"><a class="anchor" href="#memory-host"></a>Host Memory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Host memory is memory needed by the Vulkan implementation for
non-device-visible storage.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>This memory <strong>may</strong> be used to store the implementation&#8217;s representation and
state of Vulkan objects.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="memory-allocation" class="paragraph">
<p>Vulkan provides applications the opportunity to perform host memory
allocations on behalf of the Vulkan implementation.
If this feature is not used, the implementation will perform its own memory
allocations.
Since most memory allocations are off the critical path, this is not meant
as a performance feature.
Rather, this <strong>can</strong> be useful for certain embedded systems, for debugging
purposes (e.g. putting a guard page after all host allocations), or for
memory allocation logging.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Allocators are provided by the application as a pointer to a
<code>VkAllocationCallbacks</code> structure:</p>
</div>
<div id="VkAllocationCallbacks" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkAllocationCallbacks {
    void*                                   pUserData;
    PFN_vkAllocationFunction                pfnAllocation;
    PFN_vkReallocationFunction              pfnReallocation;
    PFN_vkFreeFunction                      pfnFree;
    PFN_vkInternalAllocationNotification    pfnInternalAllocation;
    PFN_vkInternalFreeNotification          pfnInternalFree;
} VkAllocationCallbacks;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pUserData</code> is a value to be interpreted by the implementation of
the callbacks.
When any of the callbacks in <code>VkAllocationCallbacks</code> are called, the
Vulkan implementation will pass this value as the first parameter to the
callback.
This value <strong>can</strong> vary each time an allocator is passed into a command,
even when the same object takes an allocator in multiple commands.</p>
</li>
<li>
<p><code>pfnAllocation</code> is a <a href="#PFN_vkAllocationFunction">PFN_vkAllocationFunction</a> pointer to an
application-defined memory allocation function.</p>
</li>
<li>
<p><code>pfnReallocation</code> is a <a href="#PFN_vkReallocationFunction">PFN_vkReallocationFunction</a> pointer to
an application-defined memory reallocation function.</p>
</li>
<li>
<p><code>pfnFree</code> is a <a href="#PFN_vkFreeFunction">PFN_vkFreeFunction</a> pointer to an
application-defined memory free function.</p>
</li>
<li>
<p><code>pfnInternalAllocation</code> is a
<a href="#PFN_vkInternalAllocationNotification">PFN_vkInternalAllocationNotification</a> pointer to an
application-defined function that is called by the implementation when
the implementation makes internal allocations.</p>
</li>
<li>
<p><code>pfnInternalFree</code> is a <a href="#PFN_vkInternalFreeNotification">PFN_vkInternalFreeNotification</a> pointer
to an application-defined function that is called by the implementation
when the implementation frees internal allocations.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAllocationCallbacks-pfnAllocation-00632" href="#VUID-VkAllocationCallbacks-pfnAllocation-00632"></a> <span class="vuid">VUID-VkAllocationCallbacks-pfnAllocation-00632</span><br>

<code>pfnAllocation</code> <strong>must</strong> be a valid pointer to a valid user-defined
<a href="#PFN_vkAllocationFunction">PFN_vkAllocationFunction</a></p>
</li>
<li>
<p><a id="VUID-VkAllocationCallbacks-pfnReallocation-00633" href="#VUID-VkAllocationCallbacks-pfnReallocation-00633"></a> <span class="vuid">VUID-VkAllocationCallbacks-pfnReallocation-00633</span><br>

<code>pfnReallocation</code> <strong>must</strong> be a valid pointer to a valid user-defined
<a href="#PFN_vkReallocationFunction">PFN_vkReallocationFunction</a></p>
</li>
<li>
<p><a id="VUID-VkAllocationCallbacks-pfnFree-00634" href="#VUID-VkAllocationCallbacks-pfnFree-00634"></a> <span class="vuid">VUID-VkAllocationCallbacks-pfnFree-00634</span><br>

<code>pfnFree</code> <strong>must</strong> be a valid pointer to a valid user-defined
<a href="#PFN_vkFreeFunction">PFN_vkFreeFunction</a></p>
</li>
<li>
<p><a id="VUID-VkAllocationCallbacks-pfnInternalAllocation-00635" href="#VUID-VkAllocationCallbacks-pfnInternalAllocation-00635"></a> <span class="vuid">VUID-VkAllocationCallbacks-pfnInternalAllocation-00635</span><br>

If either of <code>pfnInternalAllocation</code> or <code>pfnInternalFree</code> is not
<code>NULL</code>, both <strong>must</strong> be valid callbacks</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The type of <code>pfnAllocation</code> is:</p>
</div>
<div id="PFN_vkAllocationFunction" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef void* (VKAPI_PTR *PFN_vkAllocationFunction)(
    void*                                       pUserData,
    size_t                                      size,
    size_t                                      alignment,
    VkSystemAllocationScope                     allocationScope);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pUserData</code> is the value specified for
<a href="#VkAllocationCallbacks">VkAllocationCallbacks</a>::<code>pUserData</code> in the allocator specified
by the application.</p>
</li>
<li>
<p><code>size</code> is the size in bytes of the requested allocation.</p>
</li>
<li>
<p><code>alignment</code> is the requested alignment of the allocation in bytes
and <strong>must</strong> be a power of two.</p>
</li>
<li>
<p><code>allocationScope</code> is a <a href="#VkSystemAllocationScope">VkSystemAllocationScope</a> value
specifying the allocation scope of the lifetime of the allocation, as
described <a href="#memory-host-allocation-scope">here</a>.</p>
</li>
</ul>
</div>
<div id="vkAllocationFunction_return_rules" class="paragraph">
<p>If <code>pfnAllocation</code> is unable to allocate the requested memory, it <strong>must</strong>
return <code>NULL</code>.
If the allocation was successful, it <strong>must</strong> return a valid pointer to memory
allocation containing at least <code>size</code> bytes, and with the pointer value
being a multiple of <code>alignment</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Correct Vulkan operation <strong>cannot</strong> be assumed if the application does not
follow these rules.</p>
</div>
<div class="paragraph">
<p>For example, <code>pfnAllocation</code> (or <code>pfnReallocation</code>) could cause
termination of running Vulkan instance(s) on a failed allocation for
debugging purposes, either directly or indirectly.
In these circumstances, it <strong>cannot</strong> be assumed that any part of any affected
<a href="initialization.html#VkInstance" class="xref page">VkInstance</a> objects are going to operate correctly (even
<a href="initialization.html#vkDestroyInstance" class="xref page">vkDestroyInstance</a>), and the application <strong>must</strong> ensure it cleans up
properly via other means (e.g. process termination).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If <code>pfnAllocation</code> returns <code>NULL</code>, and if the implementation is unable
to continue correct processing of the current command without the requested
allocation, it <strong>must</strong> treat this as a runtime error, and generate
<code>VK_ERROR_OUT_OF_HOST_MEMORY</code> at the appropriate time for the command in
which the condition was detected, as described in <a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Return Codes</a>.</p>
</div>
<div class="paragraph">
<p>If the implementation is able to continue correct processing of the current
command without the requested allocation, then it <strong>may</strong> do so, and <strong>must</strong> not
generate <code>VK_ERROR_OUT_OF_HOST_MEMORY</code> as a result of this failed
allocation.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The type of <code>pfnReallocation</code> is:</p>
</div>
<div id="PFN_vkReallocationFunction" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef void* (VKAPI_PTR *PFN_vkReallocationFunction)(
    void*                                       pUserData,
    void*                                       pOriginal,
    size_t                                      size,
    size_t                                      alignment,
    VkSystemAllocationScope                     allocationScope);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pUserData</code> is the value specified for
<a href="#VkAllocationCallbacks">VkAllocationCallbacks</a>::<code>pUserData</code> in the allocator specified
by the application.</p>
</li>
<li>
<p><code>pOriginal</code> <strong>must</strong> be either <code>NULL</code> or a pointer previously returned
by <code>pfnReallocation</code> or <code>pfnAllocation</code> of a compatible
allocator.</p>
</li>
<li>
<p><code>size</code> is the size in bytes of the requested allocation.</p>
</li>
<li>
<p><code>alignment</code> is the requested alignment of the allocation in bytes
and <strong>must</strong> be a power of two.</p>
</li>
<li>
<p><code>allocationScope</code> is a <a href="#VkSystemAllocationScope">VkSystemAllocationScope</a> value
specifying the allocation scope of the lifetime of the allocation, as
described <a href="#memory-host-allocation-scope">here</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the reallocation was successful, <code>pfnReallocation</code> <strong>must</strong> return an
allocation with enough space for <code>size</code> bytes, and the contents of the
original allocation from bytes zero to <span class="eq">min(original size, new size) -
1</span> <strong>must</strong> be preserved in the returned allocation.
If <code>size</code> is larger than the old size, the contents of the additional
space are <strong>undefined</strong>.
If satisfying these requirements involves creating a new allocation, then
the old allocation <strong>should</strong> be freed.</p>
</div>
<div class="paragraph">
<p>If <code>pOriginal</code> is <code>NULL</code>, then <code>pfnReallocation</code> <strong>must</strong> behave
equivalently to a call to <a href="#PFN_vkAllocationFunction">PFN_vkAllocationFunction</a> with the same
parameter values (without <code>pOriginal</code>).</p>
</div>
<div class="paragraph">
<p>If <code>size</code> is zero, then <code>pfnReallocation</code> <strong>must</strong> behave equivalently
to a call to <a href="#PFN_vkFreeFunction">PFN_vkFreeFunction</a> with the same <code>pUserData</code>
parameter value, and <code>pMemory</code> equal to <code>pOriginal</code>.</p>
</div>
<div class="paragraph">
<p>If <code>pOriginal</code> is non-<code>NULL</code>, the implementation <strong>must</strong> ensure that
<code>alignment</code> is equal to the <code>alignment</code> used to originally allocate
<code>pOriginal</code>.</p>
</div>
<div class="paragraph">
<p>If this function fails and <code>pOriginal</code> is non-<code>NULL</code> the application
<strong>must</strong> not free the old allocation.</p>
</div>
<div class="paragraph">
<p><code>pfnReallocation</code> <strong>must</strong> follow the same
<a href="#vkAllocationFunction_return_rules">rules for return values as<code>PFN_vkAllocationFunction</code></a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The type of <code>pfnFree</code> is:</p>
</div>
<div id="PFN_vkFreeFunction" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef void (VKAPI_PTR *PFN_vkFreeFunction)(
    void*                                       pUserData,
    void*                                       pMemory);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pUserData</code> is the value specified for
<a href="#VkAllocationCallbacks">VkAllocationCallbacks</a>::<code>pUserData</code> in the allocator specified
by the application.</p>
</li>
<li>
<p><code>pMemory</code> is the allocation to be freed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>pMemory</code> <strong>may</strong> be <code>NULL</code>, which the callback <strong>must</strong> handle safely.
If <code>pMemory</code> is non-<code>NULL</code>, it <strong>must</strong> be a pointer previously allocated
by <code>pfnAllocation</code> or <code>pfnReallocation</code>.
The application <strong>should</strong> free this memory.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The type of <code>pfnInternalAllocation</code> is:</p>
</div>
<div id="PFN_vkInternalAllocationNotification" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef void (VKAPI_PTR *PFN_vkInternalAllocationNotification)(
    void*                                       pUserData,
    size_t                                      size,
    VkInternalAllocationType                    allocationType,
    VkSystemAllocationScope                     allocationScope);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pUserData</code> is the value specified for
<a href="#VkAllocationCallbacks">VkAllocationCallbacks</a>::<code>pUserData</code> in the allocator specified
by the application.</p>
</li>
<li>
<p><code>size</code> is the requested size of an allocation.</p>
</li>
<li>
<p><code>allocationType</code> is a <a href="#VkInternalAllocationType">VkInternalAllocationType</a> value
specifying the requested type of an allocation.</p>
</li>
<li>
<p><code>allocationScope</code> is a <a href="#VkSystemAllocationScope">VkSystemAllocationScope</a> value
specifying the allocation scope of the lifetime of the allocation, as
described <a href="#memory-host-allocation-scope">here</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is a purely informational callback.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The type of <code>pfnInternalFree</code> is:</p>
</div>
<div id="PFN_vkInternalFreeNotification" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef void (VKAPI_PTR *PFN_vkInternalFreeNotification)(
    void*                                       pUserData,
    size_t                                      size,
    VkInternalAllocationType                    allocationType,
    VkSystemAllocationScope                     allocationScope);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pUserData</code> is the value specified for
<a href="#VkAllocationCallbacks">VkAllocationCallbacks</a>::<code>pUserData</code> in the allocator specified
by the application.</p>
</li>
<li>
<p><code>size</code> is the requested size of an allocation.</p>
</li>
<li>
<p><code>allocationType</code> is a <a href="#VkInternalAllocationType">VkInternalAllocationType</a> value
specifying the requested type of an allocation.</p>
</li>
<li>
<p><code>allocationScope</code> is a <a href="#VkSystemAllocationScope">VkSystemAllocationScope</a> value
specifying the allocation scope of the lifetime of the allocation, as
described <a href="#memory-host-allocation-scope">here</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="memory-host-allocation-scope" class="paragraph">
<p>Each allocation has an <em>allocation scope</em> defining its lifetime and which
object it is associated with.
Possible values passed to the <code>allocationScope</code> parameter of the
callback functions specified by <a href="#VkAllocationCallbacks">VkAllocationCallbacks</a>, indicating the
allocation scope, are:</p>
</div>
<div id="VkSystemAllocationScope" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef enum VkSystemAllocationScope {
    VK_SYSTEM_ALLOCATION_SCOPE_COMMAND = 0,
    VK_SYSTEM_ALLOCATION_SCOPE_OBJECT = 1,
    VK_SYSTEM_ALLOCATION_SCOPE_CACHE = 2,
    VK_SYSTEM_ALLOCATION_SCOPE_DEVICE = 3,
    VK_SYSTEM_ALLOCATION_SCOPE_INSTANCE = 4,
} VkSystemAllocationScope;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_SYSTEM_ALLOCATION_SCOPE_COMMAND</code> specifies that the allocation
is scoped to the duration of the Vulkan command.</p>
</li>
<li>
<p><code>VK_SYSTEM_ALLOCATION_SCOPE_OBJECT</code> specifies that the allocation is
scoped to the lifetime of the Vulkan object that is being created or
used.</p>
</li>
<li>
<p><code>VK_SYSTEM_ALLOCATION_SCOPE_CACHE</code> specifies that the allocation is
scoped to the lifetime of a <code>VkPipelineCache</code>
or <code>VkValidationCacheEXT</code>
object.</p>
</li>
<li>
<p><code>VK_SYSTEM_ALLOCATION_SCOPE_DEVICE</code> specifies that the allocation is
scoped to the lifetime of the Vulkan device.</p>
</li>
<li>
<p><code>VK_SYSTEM_ALLOCATION_SCOPE_INSTANCE</code> specifies that the allocation
is scoped to the lifetime of the Vulkan instance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Most Vulkan commands operate on a single object, or there is a sole object
that is being created or manipulated.
When an allocation uses an allocation scope of
<code>VK_SYSTEM_ALLOCATION_SCOPE_OBJECT</code> or
<code>VK_SYSTEM_ALLOCATION_SCOPE_CACHE</code>, the allocation is scoped to the
object being created or manipulated.</p>
</div>
<div class="paragraph">
<p>When an implementation requires host memory, it will make callbacks to the
application using the most specific allocator and allocation scope
available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If an allocation is scoped to the duration of a command, the allocator
will use the <code>VK_SYSTEM_ALLOCATION_SCOPE_COMMAND</code> allocation scope.
The most specific allocator available is used: if the object being
created or manipulated has an allocator, that object&#8217;s allocator will be
used, else if the parent <code>VkDevice</code> has an allocator it will be
used, else if the parent <code>VkInstance</code> has an allocator it will be
used.
Else,</p>
</li>
<li>
<p>If an allocation is associated with a
<code>VkValidationCacheEXT</code> or
<code>VkPipelineCache</code> object, the allocator will use the
<code>VK_SYSTEM_ALLOCATION_SCOPE_CACHE</code> allocation scope.
The most specific allocator available is used (cache, else device, else
instance).
Else,</p>
</li>
<li>
<p>If an allocation is scoped to the lifetime of an object, that object is
being created or manipulated by the command, and that object&#8217;s type is
not <code>VkDevice</code> or <code>VkInstance</code>, the allocator will use an
allocation scope of <code>VK_SYSTEM_ALLOCATION_SCOPE_OBJECT</code>.
The most specific allocator available is used (object, else device, else
instance).
Else,</p>
</li>
<li>
<p>If an allocation is scoped to the lifetime of a device, the allocator
will use an allocation scope of <code>VK_SYSTEM_ALLOCATION_SCOPE_DEVICE</code>.
The most specific allocator available is used (device, else instance).
Else,</p>
</li>
<li>
<p>If the allocation is scoped to the lifetime of an instance and the
instance has an allocator, its allocator will be used with an allocation
scope of <code>VK_SYSTEM_ALLOCATION_SCOPE_INSTANCE</code>.</p>
</li>
<li>
<p>Otherwise an implementation will allocate memory through an alternative
mechanism that is unspecified.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Objects that are allocated from pools do not specify their own allocator.
When an implementation requires host memory for such an object, that memory
is sourced from the object&#8217;s parent pool&#8217;s allocator.</p>
</div>
<div class="paragraph">
<p>The application is not expected to handle allocating memory that is intended
for execution by the host due to the complexities of differing security
implementations across multiple platforms.
The implementation will allocate such memory internally and invoke an
application provided informational callback when these <em>internal
allocations</em> are allocated and freed.
Upon allocation of executable memory, <code>pfnInternalAllocation</code> will be
called.
Upon freeing executable memory, <code>pfnInternalFree</code> will be called.
An implementation will only call an informational callback for executable
memory allocations and frees.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>allocationType</code> parameter to the <code>pfnInternalAllocation</code> and
<code>pfnInternalFree</code> functions <strong>may</strong> be one of the following values:</p>
</div>
<div id="VkInternalAllocationType" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef enum VkInternalAllocationType {
    VK_INTERNAL_ALLOCATION_TYPE_EXECUTABLE = 0,
} VkInternalAllocationType;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_INTERNAL_ALLOCATION_TYPE_EXECUTABLE</code> specifies that the
allocation is intended for execution by the host.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>An implementation <strong>must</strong> only make calls into an application-provided
allocator during the execution of an API command.
An implementation <strong>must</strong> only make calls into an application-provided
allocator from the same thread that called the provoking API command.
The implementation <strong>should</strong> not synchronize calls to any of the callbacks.
If synchronization is needed, the callbacks <strong>must</strong> provide it themselves.
The informational callbacks are subject to the same restrictions as the
allocation callbacks.</p>
</div>
<div class="paragraph">
<p>If an implementation intends to make calls through a
<code>VkAllocationCallbacks</code> structure between the time a <code>vkCreate*</code>
command returns and the time a corresponding <code>vkDestroy*</code> command
begins, that implementation <strong>must</strong> save a copy of the allocator before the
<code>vkCreate*</code> command returns.
The callback functions and any data structures they rely upon <strong>must</strong> remain
valid for the lifetime of the object they are associated with.</p>
</div>
<div class="paragraph">
<p>If an allocator is provided to a <code>vkCreate*</code> command, a <em>compatible</em>
allocator <strong>must</strong> be provided to the corresponding <code>vkDestroy*</code> command.
Two <code>VkAllocationCallbacks</code> structures are compatible if memory
allocated with <code>pfnAllocation</code> or <code>pfnReallocation</code> in each <strong>can</strong> be
freed with <code>pfnReallocation</code> or <code>pfnFree</code> in the other.
An allocator <strong>must</strong> not be provided to a <code>vkDestroy*</code> command if an
allocator was not provided to the corresponding <code>vkCreate*</code> command.</p>
</div>
<div class="paragraph">
<p>If a non-<code>NULL</code> allocator is used, the <code>pfnAllocation</code>,
<code>pfnReallocation</code> and <code>pfnFree</code> members <strong>must</strong> be non-<code>NULL</code> and
point to valid implementations of the callbacks.
An application <strong>can</strong> choose to not provide informational callbacks by setting
both <code>pfnInternalAllocation</code> and <code>pfnInternalFree</code> to <code>NULL</code>.
<code>pfnInternalAllocation</code> and <code>pfnInternalFree</code> <strong>must</strong> either both be
<code>NULL</code> or both be non-<code>NULL</code>.</p>
</div>
<div class="paragraph">
<p>If <code>pfnAllocation</code> or <code>pfnReallocation</code> fail, the implementation
<strong>may</strong> fail object creation and/or generate a
<code>VK_ERROR_OUT_OF_HOST_MEMORY</code> error, as appropriate.</p>
</div>
<div class="paragraph">
<p>Allocation callbacks <strong>must</strong> not call any Vulkan commands.</p>
</div>
<div class="paragraph">
<p>The following sets of rules define when an implementation is permitted to
call the allocator callbacks.</p>
</div>
<div class="paragraph">
<p><code>pfnAllocation</code> or <code>pfnReallocation</code> <strong>may</strong> be called in the following
situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Allocations scoped to a <code>VkDevice</code> or <code>VkInstance</code> <strong>may</strong> be
allocated from any API command.</p>
</li>
<li>
<p>Allocations scoped to a command <strong>may</strong> be allocated from any API command.</p>
</li>
<li>
<p>Allocations scoped to a <code>VkPipelineCache</code> <strong>may</strong> only be allocated
from:</p>
<div class="ulist">
<ul>
<li>
<p><code>vkCreatePipelineCache</code></p>
</li>
<li>
<p><code>vkMergePipelineCaches</code> for <code>dstCache</code></p>
</li>
<li>
<p><code>vkCreateGraphicsPipelines</code> for <code>pipelineCache</code></p>
</li>
<li>
<p><code>vkCreateComputePipelines</code> for <code>pipelineCache</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Allocations scoped to a <code>VkValidationCacheEXT</code> <strong>may</strong> only be
allocated from:</p>
<div class="ulist">
<ul>
<li>
<p><code>vkCreateValidationCacheEXT</code></p>
</li>
<li>
<p><code>vkMergeValidationCachesEXT</code> for <code>dstCache</code></p>
</li>
<li>
<p><code>vkCreateShaderModule</code> for <code>validationCache</code> in
<a href="shaders.html#VkShaderModuleValidationCacheCreateInfoEXT" class="xref page">VkShaderModuleValidationCacheCreateInfoEXT</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Allocations scoped to a <code>VkDescriptorPool</code> <strong>may</strong> only be allocated
from:</p>
<div class="ulist">
<ul>
<li>
<p>any command that takes the pool as a direct argument</p>
</li>
<li>
<p><code>vkAllocateDescriptorSets</code> for the <code>descriptorPool</code> member of
its <code>pAllocateInfo</code> parameter</p>
</li>
<li>
<p><code>vkCreateDescriptorPool</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Allocations scoped to a <code>VkCommandPool</code> <strong>may</strong> only be allocated from:</p>
<div class="ulist">
<ul>
<li>
<p>any command that takes the pool as a direct argument</p>
</li>
<li>
<p><code>vkCreateCommandPool</code></p>
</li>
<li>
<p><code>vkAllocateCommandBuffers</code> for the <code>commandPool</code> member of its
<code>pAllocateInfo</code> parameter</p>
</li>
<li>
<p>any <code>vkCmd*</code> command whose <code>commandBuffer</code> was allocated from
that <code>VkCommandPool</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Allocations scoped to any other object <strong>may</strong> only be allocated in that
object&#8217;s <code>vkCreate*</code> command.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>pfnFree</code>, or <code>pfnReallocation</code> with zero <code>size</code>, <strong>may</strong> be called
in the following situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Allocations scoped to a <code>VkDevice</code> or <code>VkInstance</code> <strong>may</strong> be freed
from any API command.</p>
</li>
<li>
<p>Allocations scoped to a command <strong>must</strong> be freed by any API command which
allocates such memory.</p>
</li>
<li>
<p>Allocations scoped to a <code>VkPipelineCache</code> <strong>may</strong> be freed from
<code>vkDestroyPipelineCache</code>.</p>
</li>
<li>
<p>Allocations scoped to a <code>VkValidationCacheEXT</code> <strong>may</strong> be freed from
<code>vkDestroyValidationCacheEXT</code>.</p>
</li>
<li>
<p>Allocations scoped to a <code>VkDescriptorPool</code> <strong>may</strong> be freed from</p>
<div class="ulist">
<ul>
<li>
<p>any command that takes the pool as a direct argument</p>
</li>
</ul>
</div>
</li>
<li>
<p>Allocations scoped to a <code>VkCommandPool</code> <strong>may</strong> be freed from:</p>
<div class="ulist">
<ul>
<li>
<p>any command that takes the pool as a direct argument</p>
</li>
<li>
<p><code>vkResetCommandBuffer</code> whose <code>commandBuffer</code> was allocated from
that <code>VkCommandPool</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Allocations scoped to any other object <strong>may</strong> be freed in that object&#8217;s
<code>vkDestroy*</code> command.</p>
</li>
<li>
<p>Any command that allocates host memory <strong>may</strong> also free host memory of the
same scope.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="memory-device"><a class="anchor" href="#memory-device"></a>Device Memory</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Device memory</em> is memory that is visible to the device&#8201;&#8212;&#8201;for example the
contents of the image or buffer objects, which <strong>can</strong> be natively used by the
device.</p>
</div>
<div class="sect2">
<h3 id="memory-device-properties"><a class="anchor" href="#memory-device-properties"></a>Device Memory Properties</h3>
<div class="paragraph">
<p>Memory properties of a physical device describe the memory heaps and memory
types available.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query memory properties, call:</p>
</div>
<div id="vkGetPhysicalDeviceMemoryProperties" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
void vkGetPhysicalDeviceMemoryProperties(
    VkPhysicalDevice                            physicalDevice,
    VkPhysicalDeviceMemoryProperties*           pMemoryProperties);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>physicalDevice</code> is the handle to the device to query.</p>
</li>
<li>
<p><code>pMemoryProperties</code> is a pointer to a
<a href="#VkPhysicalDeviceMemoryProperties">VkPhysicalDeviceMemoryProperties</a> structure in which the properties
are returned.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetPhysicalDeviceMemoryProperties-physicalDevice-parameter" href="#VUID-vkGetPhysicalDeviceMemoryProperties-physicalDevice-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceMemoryProperties-physicalDevice-parameter</span><br>
 <code>physicalDevice</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkPhysicalDevice" class="xref page">VkPhysicalDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetPhysicalDeviceMemoryProperties-pMemoryProperties-parameter" href="#VUID-vkGetPhysicalDeviceMemoryProperties-pMemoryProperties-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceMemoryProperties-pMemoryProperties-parameter</span><br>
 <code>pMemoryProperties</code> <strong>must</strong> be a valid pointer to a <a href="#VkPhysicalDeviceMemoryProperties">VkPhysicalDeviceMemoryProperties</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkPhysicalDeviceMemoryProperties</code> structure is defined as:</p>
</div>
<div id="VkPhysicalDeviceMemoryProperties" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkPhysicalDeviceMemoryProperties {
    uint32_t        memoryTypeCount;
    VkMemoryType    memoryTypes[VK_MAX_MEMORY_TYPES];
    uint32_t        memoryHeapCount;
    VkMemoryHeap    memoryHeaps[VK_MAX_MEMORY_HEAPS];
} VkPhysicalDeviceMemoryProperties;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>memoryTypeCount</code> is the number of valid elements in the
<code>memoryTypes</code> array.</p>
</li>
<li>
<p><code>memoryTypes</code> is an array of <code>VK_MAX_MEMORY_TYPES</code>
<a href="#VkMemoryType">VkMemoryType</a> structures describing the <em>memory types</em> that <strong>can</strong> be
used to access memory allocated from the heaps specified by
<code>memoryHeaps</code>.</p>
</li>
<li>
<p><code>memoryHeapCount</code> is the number of valid elements in the
<code>memoryHeaps</code> array.</p>
</li>
<li>
<p><code>memoryHeaps</code> is an array of <code>VK_MAX_MEMORY_HEAPS</code>
<a href="#VkMemoryHeap">VkMemoryHeap</a> structures describing the <em>memory heaps</em> from which
memory <strong>can</strong> be allocated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>VkPhysicalDeviceMemoryProperties</code> structure describes a number of
<em>memory heaps</em> as well as a number of <em>memory types</em> that <strong>can</strong> be used to
access memory allocated in those heaps.
Each heap describes a memory resource of a particular size, and each memory
type describes a set of memory properties (e.g. host cached vs. uncached)
that <strong>can</strong> be used with a given memory heap.
Allocations using a particular memory type will consume resources from the
heap indicated by that memory type&#8217;s heap index.
More than one memory type <strong>may</strong> share each heap, and the heaps and memory
types provide a mechanism to advertise an accurate size of the physical
memory resources while allowing the memory to be used with a variety of
different properties.</p>
</div>
<div class="paragraph">
<p>The number of memory heaps is given by <code>memoryHeapCount</code> and is less
than or equal to <code>VK_MAX_MEMORY_HEAPS</code>.
Each heap is described by an element of the <code>memoryHeaps</code> array as a
<a href="#VkMemoryHeap">VkMemoryHeap</a> structure.
The number of memory types available across all memory heaps is given by
<code>memoryTypeCount</code> and is less than or equal to
<code>VK_MAX_MEMORY_TYPES</code>.
Each memory type is described by an element of the <code>memoryTypes</code> array
as a <a href="#VkMemoryType">VkMemoryType</a> structure.</p>
</div>
<div class="paragraph">
<p>At least one heap <strong>must</strong> include <code>VK_MEMORY_HEAP_DEVICE_LOCAL_BIT</code> in
<a href="#VkMemoryHeap">VkMemoryHeap</a>::<code>flags</code>.
If there are multiple heaps that all have similar performance
characteristics, they <strong>may</strong> all include
<code>VK_MEMORY_HEAP_DEVICE_LOCAL_BIT</code>.
In a unified memory architecture (UMA) system there is often only a single
memory heap which is considered to be equally &#8220;local&#8221; to the host and to
the device, and such an implementation <strong>must</strong> advertise the heap as
device-local.</p>
</div>
<div id="memory-device-bitmask-list" class="paragraph">
<p>Each memory type returned by <a href="#vkGetPhysicalDeviceMemoryProperties">vkGetPhysicalDeviceMemoryProperties</a> <strong>must</strong>
have its <code>propertyFlags</code> set to one of the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>0</p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_CACHED_BIT</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_CACHED_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_CACHED_BIT</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_CACHED_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_LAZILY_ALLOCATED_BIT</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_PROTECTED_BIT</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_PROTECTED_BIT</code> |
<code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_CACHED_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_CACHED_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_UNCACHED_BIT_AMD</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_CACHED_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_UNCACHED_BIT_AMD</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_UNCACHED_BIT_AMD</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_UNCACHED_BIT_AMD</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_CACHED_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code> |<br>
<code>VK_MEMORY_PROPERTY_DEVICE_UNCACHED_BIT_AMD</code></p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> |<br>
<code>VK_MEMORY_PROPERTY_RDMA_CAPABLE_BIT_NV</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There <strong>must</strong> be at least one memory type with both the
<code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> and
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> bits set in its
<code>propertyFlags</code>.
There <strong>must</strong> be at least one memory type with the
<code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> bit set in its
<code>propertyFlags</code>.
If the <a href="features.html#features-deviceCoherentMemory" class="xref page"><code>deviceCoherentMemory</code></a> feature
is enabled, there <strong>must</strong> be at least one memory type with the
<code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code> bit set in its
<code>propertyFlags</code>.</p>
</div>
<div class="paragraph">
<p>For each pair of elements <strong>X</strong> and <strong>Y</strong> returned in <code>memoryTypes</code>, <strong>X</strong>
<strong>must</strong> be placed at a lower index position than <strong>Y</strong> if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the set of bit flags returned in the <code>propertyFlags</code> member of <strong>X</strong>
is a strict subset of the set of bit flags returned in the
<code>propertyFlags</code> member of <strong>Y</strong>; or</p>
</li>
<li>
<p>the <code>propertyFlags</code> members of <strong>X</strong> and <strong>Y</strong> are equal, and <strong>X</strong>
belongs to a memory heap with greater performance (as determined in an
implementation-specific manner)
; or</p>
</li>
<li>
<p>the <code>propertyFlags</code> members of <strong>Y</strong> includes
<code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code> or
<code>VK_MEMORY_PROPERTY_DEVICE_UNCACHED_BIT_AMD</code> and <strong>X</strong> does not</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>There is no ordering requirement between <strong>X</strong> and <strong>Y</strong> elements for the case
their <code>propertyFlags</code> members are not in a subset relation.
That potentially allows more than one possible way to order the same set of
memory types.
Notice that the <a href="#memory-device-bitmask-list">list of all allowed memoryproperty flag combinations</a> is written in a valid order.
But if instead <code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> was before
<code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> |
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code>, the list would still be in a
valid order.</p>
</div>
<div class="paragraph">
<p>There may be a performance penalty for using device coherent or uncached
device memory types, and using these accidentally is undesirable.
In order to avoid this, memory types with these properties always appear at
the end of the list; but are subject to the same rules otherwise.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This ordering requirement enables applications to use a simple search loop
to select the desired memory type along the lines of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Find a memory in `memoryTypeBitsRequirement` that includes all of `requiredProperties`
int32_t findProperties(const VkPhysicalDeviceMemoryProperties* pMemoryProperties,
                       uint32_t memoryTypeBitsRequirement,
                       VkMemoryPropertyFlags requiredProperties) {
    const uint32_t memoryCount = pMemoryProperties-&gt;memoryTypeCount;
    for (uint32_t memoryIndex = 0; memoryIndex &lt; memoryCount; ++memoryIndex) {
        const uint32_t memoryTypeBits = (1 &lt;&lt; memoryIndex);
        const bool isRequiredMemoryType = memoryTypeBitsRequirement &amp; memoryTypeBits;

        const VkMemoryPropertyFlags properties =
            pMemoryProperties-&gt;memoryTypes[memoryIndex].propertyFlags;
        const bool hasRequiredProperties =
            (properties &amp; requiredProperties) == requiredProperties;

        if (isRequiredMemoryType &amp;&amp; hasRequiredProperties)
            return static_cast&lt;int32_t&gt;(memoryIndex);
    }

    // failed to find memory type
    return -1;
}

// Try to find an optimal memory type, or if it does not exist try fallback memory type
// `device` is the VkDevice
// `image` is the VkImage that requires memory to be bound
// `memoryProperties` properties as returned by vkGetPhysicalDeviceMemoryProperties
// `requiredProperties` are the property flags that must be present
// `optimalProperties` are the property flags that are preferred by the application
VkMemoryRequirements memoryRequirements;
vkGetImageMemoryRequirements(device, image, &amp;memoryRequirements);
int32_t memoryType =
    findProperties(&amp;memoryProperties, memoryRequirements.memoryTypeBits, optimalProperties);
if (memoryType == -1) // not found; try fallback properties
    memoryType =
        findProperties(&amp;memoryProperties, memoryRequirements.memoryTypeBits, requiredProperties);</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><code>VK_MAX_MEMORY_TYPES</code> is the length of an array of <a href="#VkMemoryType">VkMemoryType</a>
structures describing memory types, as returned in
<a href="#VkPhysicalDeviceMemoryProperties">VkPhysicalDeviceMemoryProperties</a>::<code>memoryTypes</code>.</p>
</div>
<div id="VK_MAX_MEMORY_TYPES" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">#define VK_MAX_MEMORY_TYPES               32U</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><code>VK_MAX_MEMORY_HEAPS</code> is the length of an array of <a href="#VkMemoryHeap">VkMemoryHeap</a>
structures describing memory heaps, as returned in
<a href="#VkPhysicalDeviceMemoryProperties">VkPhysicalDeviceMemoryProperties</a>::<code>memoryHeaps</code>.</p>
</div>
<div id="VK_MAX_MEMORY_HEAPS" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">#define VK_MAX_MEMORY_HEAPS               16U</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query memory properties, call:</p>
</div>
<div id="vkGetPhysicalDeviceMemoryProperties2" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
void vkGetPhysicalDeviceMemoryProperties2(
    VkPhysicalDevice                            physicalDevice,
    VkPhysicalDeviceMemoryProperties2*          pMemoryProperties);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent command</p>
</div>
<div id="vkGetPhysicalDeviceMemoryProperties2KHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_get_physical_device_properties2
void vkGetPhysicalDeviceMemoryProperties2KHR(
    VkPhysicalDevice                            physicalDevice,
    VkPhysicalDeviceMemoryProperties2*          pMemoryProperties);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>physicalDevice</code> is the handle to the device to query.</p>
</li>
<li>
<p><code>pMemoryProperties</code> is a pointer to a
<a href="#VkPhysicalDeviceMemoryProperties2">VkPhysicalDeviceMemoryProperties2</a> structure in which the
properties are returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>vkGetPhysicalDeviceMemoryProperties2</code> behaves similarly to
<a href="#vkGetPhysicalDeviceMemoryProperties">vkGetPhysicalDeviceMemoryProperties</a>, with the ability to return
extended information in a <code>pNext</code> chain of output structures.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetPhysicalDeviceMemoryProperties2-physicalDevice-parameter" href="#VUID-vkGetPhysicalDeviceMemoryProperties2-physicalDevice-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceMemoryProperties2-physicalDevice-parameter</span><br>
 <code>physicalDevice</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkPhysicalDevice" class="xref page">VkPhysicalDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetPhysicalDeviceMemoryProperties2-pMemoryProperties-parameter" href="#VUID-vkGetPhysicalDeviceMemoryProperties2-pMemoryProperties-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceMemoryProperties2-pMemoryProperties-parameter</span><br>
 <code>pMemoryProperties</code> <strong>must</strong> be a valid pointer to a <a href="#VkPhysicalDeviceMemoryProperties2">VkPhysicalDeviceMemoryProperties2</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkPhysicalDeviceMemoryProperties2</code> structure is defined as:</p>
</div>
<div id="VkPhysicalDeviceMemoryProperties2" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
typedef struct VkPhysicalDeviceMemoryProperties2 {
    VkStructureType                     sType;
    void*                               pNext;
    VkPhysicalDeviceMemoryProperties    memoryProperties;
} VkPhysicalDeviceMemoryProperties2;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkPhysicalDeviceMemoryProperties2KHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_get_physical_device_properties2
typedef VkPhysicalDeviceMemoryProperties2 VkPhysicalDeviceMemoryProperties2KHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>memoryProperties</code> is a <a href="#VkPhysicalDeviceMemoryProperties">VkPhysicalDeviceMemoryProperties</a>
structure which is populated with the same values as in
<a href="#vkGetPhysicalDeviceMemoryProperties">vkGetPhysicalDeviceMemoryProperties</a>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPhysicalDeviceMemoryProperties2-sType-sType" href="#VUID-VkPhysicalDeviceMemoryProperties2-sType-sType"></a> <span class="vuid">VUID-VkPhysicalDeviceMemoryProperties2-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_MEMORY_PROPERTIES_2</code></p>
</li>
<li>
<p><a id="VUID-VkPhysicalDeviceMemoryProperties2-pNext-pNext" href="#VUID-VkPhysicalDeviceMemoryProperties2-pNext-pNext"></a> <span class="vuid">VUID-VkPhysicalDeviceMemoryProperties2-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code> or a pointer to a valid instance of <a href="#VkPhysicalDeviceMemoryBudgetPropertiesEXT">VkPhysicalDeviceMemoryBudgetPropertiesEXT</a></p>
</li>
<li>
<p><a id="VUID-VkPhysicalDeviceMemoryProperties2-sType-unique" href="#VUID-VkPhysicalDeviceMemoryProperties2-sType-unique"></a> <span class="vuid">VUID-VkPhysicalDeviceMemoryProperties2-sType-unique</span><br>
 The <code>sType</code> value of each struct in the <code>pNext</code> chain <strong>must</strong> be unique</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMemoryHeap</code> structure is defined as:</p>
</div>
<div id="VkMemoryHeap" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkMemoryHeap {
    VkDeviceSize         size;
    VkMemoryHeapFlags    flags;
} VkMemoryHeap;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>size</code> is the total memory size in bytes in the heap.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="#VkMemoryHeapFlagBits">VkMemoryHeapFlagBits</a> specifying
attribute flags for the heap.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong>may</strong> be set in <a href="#VkMemoryHeap">VkMemoryHeap</a>::<code>flags</code>, indicating
attribute flags for the heap, are:</p>
</div>
<div id="VkMemoryHeapFlagBits" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef enum VkMemoryHeapFlagBits {
    VK_MEMORY_HEAP_DEVICE_LOCAL_BIT = 0x00000001,
  // Provided by VK_VERSION_1_1
    VK_MEMORY_HEAP_MULTI_INSTANCE_BIT = 0x00000002,
  // Provided by VK_KHR_device_group_creation
    VK_MEMORY_HEAP_MULTI_INSTANCE_BIT_KHR = VK_MEMORY_HEAP_MULTI_INSTANCE_BIT,
} VkMemoryHeapFlagBits;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_MEMORY_HEAP_DEVICE_LOCAL_BIT</code> specifies that the heap
corresponds to device-local memory.
Device-local memory <strong>may</strong> have different performance characteristics than
host-local memory, and <strong>may</strong> support different memory property flags.</p>
</li>
<li>
<p><code>VK_MEMORY_HEAP_MULTI_INSTANCE_BIT</code> specifies that in a logical
device representing more than one physical device, there is a
per-physical device instance of the heap memory.
By default, an allocation from such a heap will be replicated to each
physical device&#8217;s instance of the heap.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkMemoryHeapFlags" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef VkFlags VkMemoryHeapFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkMemoryHeapFlags</code> is a bitmask type for setting a mask of zero or more
<a href="#VkMemoryHeapFlagBits">VkMemoryHeapFlagBits</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMemoryType</code> structure is defined as:</p>
</div>
<div id="VkMemoryType" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkMemoryType {
    VkMemoryPropertyFlags    propertyFlags;
    uint32_t                 heapIndex;
} VkMemoryType;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>heapIndex</code> describes which memory heap this memory type corresponds
to, and <strong>must</strong> be less than <code>memoryHeapCount</code> from the
<a href="#VkPhysicalDeviceMemoryProperties">VkPhysicalDeviceMemoryProperties</a> structure.</p>
</li>
<li>
<p><code>propertyFlags</code> is a bitmask of <a href="#VkMemoryPropertyFlagBits">VkMemoryPropertyFlagBits</a> of
properties for this memory type.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong>may</strong> be set in <a href="#VkMemoryType">VkMemoryType</a>::<code>propertyFlags</code>,
indicating properties of a memory type, are:</p>
</div>
<div id="VkMemoryPropertyFlagBits" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef enum VkMemoryPropertyFlagBits {
    VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT = 0x00000001,
    VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT = 0x00000002,
    VK_MEMORY_PROPERTY_HOST_COHERENT_BIT = 0x00000004,
    VK_MEMORY_PROPERTY_HOST_CACHED_BIT = 0x00000008,
    VK_MEMORY_PROPERTY_LAZILY_ALLOCATED_BIT = 0x00000010,
  // Provided by VK_VERSION_1_1
    VK_MEMORY_PROPERTY_PROTECTED_BIT = 0x00000020,
  // Provided by VK_AMD_device_coherent_memory
    VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD = 0x00000040,
  // Provided by VK_AMD_device_coherent_memory
    VK_MEMORY_PROPERTY_DEVICE_UNCACHED_BIT_AMD = 0x00000080,
  // Provided by VK_NV_external_memory_rdma
    VK_MEMORY_PROPERTY_RDMA_CAPABLE_BIT_NV = 0x00000100,
} VkMemoryPropertyFlagBits;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code> bit specifies that memory
allocated with this type is the most efficient for device access.
This property will be set if and only if the memory type belongs to a
heap with the <code>VK_MEMORY_HEAP_DEVICE_LOCAL_BIT</code> set.</p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> bit specifies that memory
allocated with this type <strong>can</strong> be mapped for host access using
<a href="#vkMapMemory">vkMapMemory</a>.</p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> bit specifies that the host
cache management commands <a href="#vkFlushMappedMemoryRanges">vkFlushMappedMemoryRanges</a> and
<a href="#vkInvalidateMappedMemoryRanges">vkInvalidateMappedMemoryRanges</a> are not needed to flush host writes
to the device or make device writes visible to the host, respectively.</p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_HOST_CACHED_BIT</code> bit specifies that memory
allocated with this type is cached on the host.
Host memory accesses to uncached memory are slower than to cached
memory, however uncached memory is always host coherent.</p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_LAZILY_ALLOCATED_BIT</code> bit specifies that the
memory type only allows device access to the memory.
Memory types <strong>must</strong> not have both
<code>VK_MEMORY_PROPERTY_LAZILY_ALLOCATED_BIT</code> and
<code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> set.
Additionally, the object&#8217;s backing memory <strong>may</strong> be provided by the
implementation lazily as specified in <a href="#memory-device-lazy_allocation">    Lazily Allocated Memory</a>.</p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_PROTECTED_BIT</code> bit specifies that the memory
type only allows device access to the memory, and allows protected queue
operations to access the memory.
Memory types <strong>must</strong> not have <code>VK_MEMORY_PROPERTY_PROTECTED_BIT</code> set
and any of <code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> set, or
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> set, or
<code>VK_MEMORY_PROPERTY_HOST_CACHED_BIT</code> set.</p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code> bit specifies that
device accesses to allocations of this memory type are automatically
made available and visible.</p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_DEVICE_UNCACHED_BIT_AMD</code> bit specifies that
memory allocated with this type is not cached on the device.
Uncached device memory is always device coherent.</p>
</li>
<li>
<p><code>VK_MEMORY_PROPERTY_RDMA_CAPABLE_BIT_NV</code> bit specifies that external
devices can access this memory directly.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For any memory allocated with both the
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> and the
<code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code>, host or device accesses
also perform automatic memory domain transfer operations, such that writes
are always automatically available and visible to both host and device
memory domains.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Device coherence is a useful property for certain debugging use cases (e.g.
crash analysis, where performing separate coherence actions could mean
values are not reported correctly).
However, device coherent accesses may be slower than equivalent accesses
without device coherence, particularly if they are also device uncached.
For device uncached memory in particular, repeated accesses to the same or
neighbouring memory locations over a short time period (e.g. within a frame)
may be slower than it would be for the equivalent cached memory type.
As such, it is generally inadvisable to use device coherent or device
uncached memory except when really needed.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkMemoryPropertyFlags" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef VkFlags VkMemoryPropertyFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkMemoryPropertyFlags</code> is a bitmask type for setting a mask of zero or
more <a href="#VkMemoryPropertyFlagBits">VkMemoryPropertyFlagBits</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If the <code>VkPhysicalDeviceMemoryBudgetPropertiesEXT</code> structure is included
in the <code>pNext</code> chain of <a href="#VkPhysicalDeviceMemoryProperties2">VkPhysicalDeviceMemoryProperties2</a>, it is
filled with the current memory budgets and usages.</p>
</div>
<div class="paragraph">
<p>The <code>VkPhysicalDeviceMemoryBudgetPropertiesEXT</code> structure is defined as:</p>
</div>
<div id="VkPhysicalDeviceMemoryBudgetPropertiesEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_memory_budget
typedef struct VkPhysicalDeviceMemoryBudgetPropertiesEXT {
    VkStructureType    sType;
    void*              pNext;
    VkDeviceSize       heapBudget[VK_MAX_MEMORY_HEAPS];
    VkDeviceSize       heapUsage[VK_MAX_MEMORY_HEAPS];
} VkPhysicalDeviceMemoryBudgetPropertiesEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>heapBudget</code> is an array of <code>VK_MAX_MEMORY_HEAPS</code>
<code>VkDeviceSize</code> values in which memory budgets are returned, with
one element for each memory heap.
A heap&#8217;s budget is a rough estimate of how much memory the process <strong>can</strong>
allocate from that heap before allocations <strong>may</strong> fail or cause
performance degradation.
The budget includes any currently allocated device memory.</p>
</li>
<li>
<p><code>heapUsage</code> is an array of <code>VK_MAX_MEMORY_HEAPS</code>
<code>VkDeviceSize</code> values in which memory usages are returned, with
one element for each memory heap.
A heap&#8217;s usage is an estimate of how much memory the process is
currently using in that heap.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The values returned in this structure are not invariant.
The <code>heapBudget</code> and <code>heapUsage</code> values <strong>must</strong> be zero for array
elements greater than or equal to
<a href="#VkPhysicalDeviceMemoryProperties">VkPhysicalDeviceMemoryProperties</a>::<code>memoryHeapCount</code>.
The <code>heapBudget</code> value <strong>must</strong> be non-zero for array elements less than
<a href="#VkPhysicalDeviceMemoryProperties">VkPhysicalDeviceMemoryProperties</a>::<code>memoryHeapCount</code>.
The <code>heapBudget</code> value <strong>must</strong> be less than or equal to
<a href="#VkMemoryHeap">VkMemoryHeap</a>::<code>size</code> for each heap.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPhysicalDeviceMemoryBudgetPropertiesEXT-sType-sType" href="#VUID-VkPhysicalDeviceMemoryBudgetPropertiesEXT-sType-sType"></a> <span class="vuid">VUID-VkPhysicalDeviceMemoryBudgetPropertiesEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_MEMORY_BUDGET_PROPERTIES_EXT</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="memory-device-objects"><a class="anchor" href="#memory-device-objects"></a>Device Memory Objects</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>A Vulkan device operates on data in device memory via memory objects that
are represented in the API by a <code>VkDeviceMemory</code> handle:</p>
</div>
<div id="VkDeviceMemory" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
VK_DEFINE_NON_DISPATCHABLE_HANDLE(VkDeviceMemory)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_device_memory_allocation"><a class="anchor" href="#_device_memory_allocation"></a>Device Memory Allocation</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To allocate memory objects, call:</p>
</div>
<div id="vkAllocateMemory" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
VkResult vkAllocateMemory(
    VkDevice                                    device,
    const VkMemoryAllocateInfo*                 pAllocateInfo,
    const VkAllocationCallbacks*                pAllocator,
    VkDeviceMemory*                             pMemory);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the memory.</p>
</li>
<li>
<p><code>pAllocateInfo</code> is a pointer to a <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a>
structure describing parameters of the allocation.
A successfully returned allocation <strong>must</strong> use the requested parameters&#8201;&#8212;&#8201;no substitution is permitted by the implementation.</p>
</li>
<li>
<p><code>pAllocator</code> controls host memory allocation as described in the
<a href="#memory-allocation">Memory Allocation</a> chapter.</p>
</li>
<li>
<p><code>pMemory</code> is a pointer to a <a href="#VkDeviceMemory">VkDeviceMemory</a> handle in which
information about the allocated memory is returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Allocations returned by <code>vkAllocateMemory</code> are guaranteed to meet any
alignment requirement of the implementation.
For example, if an implementation requires 128 byte alignment for images and
64 byte alignment for buffers, the device memory returned through this
mechanism would be 128-byte aligned.
This ensures that applications <strong>can</strong> correctly suballocate objects of
different types (with potentially different alignment requirements) in the
same memory object.</p>
</div>
<div class="paragraph">
<p>When memory is allocated, its contents are <strong>undefined</strong> with the following
constraint:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The contents of unprotected memory <strong>must</strong> not be a function of the
contents of data protected memory objects, even if those memory objects
were previously freed.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The contents of memory allocated by one application <strong>should</strong> not be a
function of data from protected memory objects of another application, even
if those memory objects were previously freed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The maximum number of valid memory allocations that <strong>can</strong> exist
simultaneously within a <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> <strong>may</strong> be restricted by implementation-
or platform-dependent limits.
The <a href="limits.html#limits-maxMemoryAllocationCount" class="xref page"><code>maxMemoryAllocationCount</code></a>
feature describes the number of allocations that <strong>can</strong> exist simultaneously
before encountering these internal limits.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>For historical reasons, if <code>maxMemoryAllocationCount</code> is exceeded, some
implementations may return <code>VK_ERROR_TOO_MANY_OBJECTS</code>.
Exceeding this limit will result in <strong>undefined</strong> behavior, and an application
should not rely on the use of the returned error code in order to identify
when the limit is reached.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Many protected memory implementations involve complex hardware and system
software support, and often have additional and much lower limits on the
number of simultaneous protected memory allocations (from memory types with
the <code>VK_MEMORY_PROPERTY_PROTECTED_BIT</code> property) than for non-protected
memory allocations.
These limits can be system-wide, and depend on a variety of factors outside
of the Vulkan implementation, so they cannot be queried in Vulkan.
Applications <strong>should</strong> use as few allocations as possible from such memory
types by suballocating aggressively, and be prepared for allocation failure
even when there is apparently plenty of capacity remaining in the memory
heap.
As a guideline, the Vulkan conformance test suite requires that at least 80
minimum-size allocations can exist concurrently when no other uses of
protected memory are active in the system.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some platforms <strong>may</strong> have a limit on the maximum size of a single allocation.
For example, certain systems <strong>may</strong> fail to create allocations with a size
greater than or equal to 4GB.
Such a limit is implementation-dependent, and if such a failure occurs then
the error <code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code> <strong>must</strong> be returned.
This limit is advertised in
<a href="limits.html#VkPhysicalDeviceMaintenance3Properties" class="xref page">VkPhysicalDeviceMaintenance3Properties</a>::<code>maxMemoryAllocationSize</code>.</p>
</div>
<div class="paragraph">
<p>The cumulative memory size allocated to a heap <strong>can</strong> be limited by the size
of the specified heap.
In such cases, allocated memory is tracked on a per-device and per-heap
basis.
Some platforms allow overallocation into other heaps.
The overallocation behavior <strong>can</strong> be specified through the
<code><a href="../appendices/extensions.html#VK_AMD_memory_overallocation_behavior" class="xref page">VK_AMD_memory_overallocation_behavior</a></code> extension.</p>
</div>
<div class="paragraph">
<p>If the
<a href="features.html#VkPhysicalDevicePageableDeviceLocalMemoryFeaturesEXT" class="xref page">VkPhysicalDevicePageableDeviceLocalMemoryFeaturesEXT</a>::<code>pageableDeviceLocalMemory</code>
feature is enabled, memory allocations made from a heap that includes
<code>VK_MEMORY_HEAP_DEVICE_LOCAL_BIT</code> in <a href="#VkMemoryHeap">VkMemoryHeap</a>::<code>flags</code>
<strong>may</strong> be transparently moved to host-local memory allowing multiple
applications to share device-local memory.
If there is no space left in device-local memory when this new allocation is
made, other allocations <strong>may</strong> be moved out transparently to make room.
The operating system will determine which allocations to move to
device-local memory or host-local memory based on platform-specific
criteria.
To help the operating system make good choices, the application <strong>should</strong> set
the appropriate memory priority with <a href="#VkMemoryPriorityAllocateInfoEXT">VkMemoryPriorityAllocateInfoEXT</a>
and adjust it as necessary with <a href="#vkSetDeviceMemoryPriorityEXT">vkSetDeviceMemoryPriorityEXT</a>.
Higher priority allocations will moved to device-local memory first.</p>
</div>
<div class="paragraph">
<p>Memory allocations made on heaps without the
<code>VK_MEMORY_HEAP_DEVICE_LOCAL_BIT</code> property will not be transparently
promoted to device-local memory by the operating system.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkAllocateMemory-pAllocateInfo-01713" href="#VUID-vkAllocateMemory-pAllocateInfo-01713"></a> <span class="vuid">VUID-vkAllocateMemory-pAllocateInfo-01713</span><br>

<code>pAllocateInfo-&gt;allocationSize</code> <strong>must</strong> be less than or equal to
<a href="#VkPhysicalDeviceMemoryProperties">VkPhysicalDeviceMemoryProperties</a>::<code>memoryHeaps</code>[<code>memindex</code>].<code>size</code>
where <code>memindex</code> =
<a href="#VkPhysicalDeviceMemoryProperties">VkPhysicalDeviceMemoryProperties</a>::<code>memoryTypes</code>[<code>pAllocateInfo-&gt;memoryTypeIndex</code>].<code>heapIndex</code>
as returned by <a href="#vkGetPhysicalDeviceMemoryProperties">vkGetPhysicalDeviceMemoryProperties</a> for the
<a href="devsandqueues.html#VkPhysicalDevice" class="xref page">VkPhysicalDevice</a> that <code>device</code> was created from</p>
</li>
<li>
<p><a id="VUID-vkAllocateMemory-pAllocateInfo-01714" href="#VUID-vkAllocateMemory-pAllocateInfo-01714"></a> <span class="vuid">VUID-vkAllocateMemory-pAllocateInfo-01714</span><br>

<code>pAllocateInfo-&gt;memoryTypeIndex</code> <strong>must</strong> be less than
<a href="#VkPhysicalDeviceMemoryProperties">VkPhysicalDeviceMemoryProperties</a>::<code>memoryTypeCount</code> as
returned by <a href="#vkGetPhysicalDeviceMemoryProperties">vkGetPhysicalDeviceMemoryProperties</a> for the
<a href="devsandqueues.html#VkPhysicalDevice" class="xref page">VkPhysicalDevice</a> that <code>device</code> was created from</p>
</li>
<li>
<p><a id="VUID-vkAllocateMemory-deviceCoherentMemory-02790" href="#VUID-vkAllocateMemory-deviceCoherentMemory-02790"></a> <span class="vuid">VUID-vkAllocateMemory-deviceCoherentMemory-02790</span><br>

If the <a href="features.html#features-deviceCoherentMemory" class="xref page"><code>deviceCoherentMemory</code></a>
feature is not enabled, <code>pAllocateInfo-&gt;memoryTypeIndex</code> <strong>must</strong> not
identify a memory type supporting
<code>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD</code></p>
</li>
<li>
<p><a id="VUID-vkAllocateMemory-maxMemoryAllocationCount-04101" href="#VUID-vkAllocateMemory-maxMemoryAllocationCount-04101"></a> <span class="vuid">VUID-vkAllocateMemory-maxMemoryAllocationCount-04101</span><br>

There <strong>must</strong> be less than
<code>VkPhysicalDeviceLimits</code>::<code>maxMemoryAllocationCount</code> device
memory allocations currently allocated on the device</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkAllocateMemory-device-parameter" href="#VUID-vkAllocateMemory-device-parameter"></a> <span class="vuid">VUID-vkAllocateMemory-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkAllocateMemory-pAllocateInfo-parameter" href="#VUID-vkAllocateMemory-pAllocateInfo-parameter"></a> <span class="vuid">VUID-vkAllocateMemory-pAllocateInfo-parameter</span><br>
 <code>pAllocateInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure</p>
</li>
<li>
<p><a id="VUID-vkAllocateMemory-pAllocator-parameter" href="#VUID-vkAllocateMemory-pAllocator-parameter"></a> <span class="vuid">VUID-vkAllocateMemory-pAllocator-parameter</span><br>
 If <code>pAllocator</code> is not <code>NULL</code>, <code>pAllocator</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkAllocationCallbacks">VkAllocationCallbacks</a> structure</p>
</li>
<li>
<p><a id="VUID-vkAllocateMemory-pMemory-parameter" href="#VUID-vkAllocateMemory-pMemory-parameter"></a> <span class="vuid">VUID-vkAllocateMemory-pMemory-parameter</span><br>
 <code>pMemory</code> <strong>must</strong> be a valid pointer to a <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_INVALID_EXTERNAL_HANDLE</code></p>
</li>
<li>
<p><code>VK_ERROR_INVALID_OPAQUE_CAPTURE_ADDRESS_KHR</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMemoryAllocateInfo</code> structure is defined as:</p>
</div>
<div id="VkMemoryAllocateInfo" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkMemoryAllocateInfo {
    VkStructureType    sType;
    const void*        pNext;
    VkDeviceSize       allocationSize;
    uint32_t           memoryTypeIndex;
} VkMemoryAllocateInfo;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>allocationSize</code> is the size of the allocation in bytes.</p>
</li>
<li>
<p><code>memoryTypeIndex</code> is an index identifying a memory type from the
<code>memoryTypes</code> array of the <a href="#VkPhysicalDeviceMemoryProperties">VkPhysicalDeviceMemoryProperties</a>
structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The internal data of an allocated device memory object <strong>must</strong> include a
reference to implementation-specific resources, referred to as the memory
object&#8217;s <em>payload</em>.
Applications <strong>can</strong> also import and export that internal data to and from
device memory objects to share data between Vulkan instances and other
compatible APIs.
A <code>VkMemoryAllocateInfo</code> structure defines a memory import operation if
its <code>pNext</code> chain includes one of the following structures:</p>
</div>
<div id="memory-import-operation" class="ulist">
<ul>
<li>
<p><a href="#VkImportMemoryWin32HandleInfoKHR">VkImportMemoryWin32HandleInfoKHR</a> with a non-zero <code>handleType</code>
value</p>
</li>
<li>
<p><a href="#VkImportMemoryFdInfoKHR">VkImportMemoryFdInfoKHR</a> with a non-zero <code>handleType</code> value</p>
</li>
<li>
<p><a href="#VkImportMemoryHostPointerInfoEXT">VkImportMemoryHostPointerInfoEXT</a> with a non-zero <code>handleType</code>
value</p>
</li>
<li>
<p><a href="#VkImportAndroidHardwareBufferInfoANDROID">VkImportAndroidHardwareBufferInfoANDROID</a> with a non-<code>NULL</code>
<code>buffer</code> value</p>
</li>
<li>
<p><a href="#VkImportMemoryZirconHandleInfoFUCHSIA">VkImportMemoryZirconHandleInfoFUCHSIA</a> with a non-zero
<code>handleType</code> value</p>
</li>
<li>
<p><a href="resources.html#VkImportMemoryBufferCollectionFUCHSIA" class="xref page">VkImportMemoryBufferCollectionFUCHSIA</a></p>
</li>
<li>
<p><a href="#VkImportScreenBufferInfoQNX">VkImportScreenBufferInfoQNX</a> with a non-<code>NULL</code> <code>buffer</code> value</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the parameters define an import operation and the external handle type is
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D11_TEXTURE_BIT</code>,
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D11_TEXTURE_KMT_BIT</code>, or
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D12_RESOURCE_BIT</code>,
<code>allocationSize</code> is ignored.
The implementation <strong>must</strong> query the size of these allocations from the OS.</p>
</div>
<div class="paragraph">
<p>Whether device memory objects constructed via a memory import operation hold
a reference to their payload depends on the properties of the handle type
used to perform the import, as defined below for each valid handle type.
Importing memory <strong>must</strong> not modify the content of the memory.
Implementations <strong>must</strong> ensure that importing memory does not enable the
importing Vulkan instance to access any memory or resources in other Vulkan
instances other than that corresponding to the memory object imported.
Implementations <strong>must</strong> also ensure accessing imported memory which has not
been initialized does not allow the importing Vulkan instance to obtain data
from the exporting Vulkan instance or vice-versa.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>How exported and imported memory is isolated is left to the implementation,
but applications should be aware that such isolation <strong>may</strong> prevent
implementations from placing multiple exportable memory objects in the same
physical or virtual page.
Hence, applications <strong>should</strong> avoid creating many small external memory
objects whenever possible.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Importing memory <strong>must</strong> not increase overall heap usage within a system.
However, it <strong>must</strong> affect the following per-process values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="limits.html#VkPhysicalDeviceMaintenance3Properties" class="xref page">VkPhysicalDeviceMaintenance3Properties</a>::<code>maxMemoryAllocationCount</code></p>
</li>
<li>
<p><a href="#VkPhysicalDeviceMemoryBudgetPropertiesEXT">VkPhysicalDeviceMemoryBudgetPropertiesEXT</a>::<code>heapUsage</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When performing a memory import operation, it is the responsibility of the
application to ensure the external handles and their associated payloads
meet all valid usage requirements.
However, implementations <strong>must</strong> perform sufficient validation of external
handles and payloads to ensure that the operation results in a valid memory
object which will not cause program termination, device loss, queue stalls,
or corruption of other resources when used as allowed according to its
allocation parameters.
If the external handle provided does not meet these requirements, the
implementation <strong>must</strong> fail the memory import operation with the error code
<code>VK_ERROR_INVALID_EXTERNAL_HANDLE</code>.
If the parameters define an export operation and the external handle type is
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ANDROID_HARDWARE_BUFFER_BIT_ANDROID</code>,
implementations <strong>should</strong> not strictly follow <code>memoryTypeIndex</code>.
Instead, they <strong>should</strong> modify the allocation internally to use the required
memory type for the application&#8217;s given usage.
This is because for an export operation, there is currently no way for the
client to know the memory type index before allocating.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-None-06657" href="#VUID-VkMemoryAllocateInfo-None-06657"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-None-06657</span><br>

The parameters <strong>must</strong> not define more than one
<a href="#memory-import-operation">import operation</a></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-allocationSize-07897" href="#VUID-VkMemoryAllocateInfo-allocationSize-07897"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-allocationSize-07897</span><br>

If the parameters do not define an <a href="#memory-import-operation">import or    export operation</a>, <code>allocationSize</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-allocationSize-07899" href="#VUID-VkMemoryAllocateInfo-allocationSize-07899"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-allocationSize-07899</span><br>

If the parameters define an export operation and the handle type is not
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ANDROID_HARDWARE_BUFFER_BIT_ANDROID</code>,
<code>allocationSize</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-buffer-06380" href="#VUID-VkMemoryAllocateInfo-buffer-06380"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-buffer-06380</span><br>

If the parameters define an import operation from an
<a href="resources.html#VkBufferCollectionFUCHSIA" class="xref page">VkBufferCollectionFUCHSIA</a>, and
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a>::<code>buffer</code> is present and
non-NULL, <a href="resources.html#VkImportMemoryBufferCollectionFUCHSIA" class="xref page">VkImportMemoryBufferCollectionFUCHSIA</a>::<code>collection</code>
and <a href="resources.html#VkImportMemoryBufferCollectionFUCHSIA" class="xref page">VkImportMemoryBufferCollectionFUCHSIA</a>::<code>index</code> must match
<a href="resources.html#VkBufferCollectionBufferCreateInfoFUCHSIA" class="xref page">VkBufferCollectionBufferCreateInfoFUCHSIA</a>::<code>collection</code> and
<a href="resources.html#VkBufferCollectionBufferCreateInfoFUCHSIA" class="xref page">VkBufferCollectionBufferCreateInfoFUCHSIA</a>::<code>index</code>,
respectively, of the <a href="resources.html#VkBufferCollectionBufferCreateInfoFUCHSIA" class="xref page">VkBufferCollectionBufferCreateInfoFUCHSIA</a>
structure used to create the
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a>::<code>buffer</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-image-06381" href="#VUID-VkMemoryAllocateInfo-image-06381"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-image-06381</span><br>

If the parameters define an import operation from an
<a href="resources.html#VkBufferCollectionFUCHSIA" class="xref page">VkBufferCollectionFUCHSIA</a>, and
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a>::<code>image</code> is present and
non-NULL, <a href="resources.html#VkImportMemoryBufferCollectionFUCHSIA" class="xref page">VkImportMemoryBufferCollectionFUCHSIA</a>::<code>collection</code>
and <a href="resources.html#VkImportMemoryBufferCollectionFUCHSIA" class="xref page">VkImportMemoryBufferCollectionFUCHSIA</a>::<code>index</code> must match
<a href="resources.html#VkBufferCollectionImageCreateInfoFUCHSIA" class="xref page">VkBufferCollectionImageCreateInfoFUCHSIA</a>::<code>collection</code> and
<a href="resources.html#VkBufferCollectionImageCreateInfoFUCHSIA" class="xref page">VkBufferCollectionImageCreateInfoFUCHSIA</a>::<code>index</code>,
respectively, of the <a href="resources.html#VkBufferCollectionImageCreateInfoFUCHSIA" class="xref page">VkBufferCollectionImageCreateInfoFUCHSIA</a>
structure used to create the
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a>::<code>image</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-allocationSize-06382" href="#VUID-VkMemoryAllocateInfo-allocationSize-06382"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-allocationSize-06382</span><br>

If the parameters define an import operation from an
<a href="resources.html#VkBufferCollectionFUCHSIA" class="xref page">VkBufferCollectionFUCHSIA</a>, <code>allocationSize</code> <strong>must</strong> match
<a href="resources.html#VkMemoryRequirements" class="xref page">VkMemoryRequirements</a>::<code>size</code> value retrieved by
<a href="resources.html#vkGetImageMemoryRequirements" class="xref page">vkGetImageMemoryRequirements</a> or
<a href="resources.html#vkGetBufferMemoryRequirements" class="xref page">vkGetBufferMemoryRequirements</a> for image-based or buffer-based
collections respectively</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-06383" href="#VUID-VkMemoryAllocateInfo-pNext-06383"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-06383</span><br>

If the parameters define an import operation from an
<a href="resources.html#VkBufferCollectionFUCHSIA" class="xref page">VkBufferCollectionFUCHSIA</a>, the <code>pNext</code> chain <strong>must</strong> include a
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a> structure with either its
<code>image</code> or <code>buffer</code> field set to a value other than
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-image-06384" href="#VUID-VkMemoryAllocateInfo-image-06384"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-image-06384</span><br>

If the parameters define an import operation from an
<a href="resources.html#VkBufferCollectionFUCHSIA" class="xref page">VkBufferCollectionFUCHSIA</a> and
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a>::<code>image</code> is not
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the <code>image</code> <strong>must</strong> be created with a
<a href="resources.html#VkBufferCollectionImageCreateInfoFUCHSIA" class="xref page">VkBufferCollectionImageCreateInfoFUCHSIA</a> structure chained to its
<a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>::<code>pNext</code> pointer</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-buffer-06385" href="#VUID-VkMemoryAllocateInfo-buffer-06385"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-buffer-06385</span><br>

If the parameters define an import operation from an
<a href="resources.html#VkBufferCollectionFUCHSIA" class="xref page">VkBufferCollectionFUCHSIA</a> and
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a>::<code>buffer</code> is not
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the <code>buffer</code> <strong>must</strong> be created with a
<a href="resources.html#VkBufferCollectionBufferCreateInfoFUCHSIA" class="xref page">VkBufferCollectionBufferCreateInfoFUCHSIA</a> structure chained to its
<a href="resources.html#VkBufferCreateInfo" class="xref page">VkBufferCreateInfo</a>::<code>pNext</code> pointer</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-memoryTypeIndex-06386" href="#VUID-VkMemoryAllocateInfo-memoryTypeIndex-06386"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-memoryTypeIndex-06386</span><br>

If the parameters define an import operation from an
<a href="resources.html#VkBufferCollectionFUCHSIA" class="xref page">VkBufferCollectionFUCHSIA</a>, <code>memoryTypeIndex</code> <strong>must</strong> be from
<a href="resources.html#VkBufferCollectionPropertiesFUCHSIA" class="xref page">VkBufferCollectionPropertiesFUCHSIA</a> as retrieved by
<a href="resources.html#vkGetBufferCollectionPropertiesFUCHSIA" class="xref page">vkGetBufferCollectionPropertiesFUCHSIA</a></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-00639" href="#VUID-VkMemoryAllocateInfo-pNext-00639"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-00639</span><br>

If the <code>pNext</code> chain includes a <code>VkExportMemoryAllocateInfo</code>
structure, and any of the handle types specified in
<code>VkExportMemoryAllocateInfo</code>::<code>handleTypes</code> require a dedicated
allocation, as reported by
<a href="capabilities.html#vkGetPhysicalDeviceImageFormatProperties2" class="xref page">vkGetPhysicalDeviceImageFormatProperties2</a> in
<code>VkExternalImageFormatProperties</code>::<code>externalMemoryProperties.externalMemoryFeatures</code>,
or by <a href="capabilities.html#vkGetPhysicalDeviceExternalBufferProperties" class="xref page">vkGetPhysicalDeviceExternalBufferProperties</a> in
<code>VkExternalBufferProperties</code>::<code>externalMemoryProperties.externalMemoryFeatures</code>,
the <code>pNext</code> chain <strong>must</strong> include a
<code>VkMemoryDedicatedAllocateInfo</code> or
<code>VkDedicatedAllocationMemoryAllocateInfoNV</code> structure with either
its <code>image</code> or <code>buffer</code> member set to a value other than
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-00640" href="#VUID-VkMemoryAllocateInfo-pNext-00640"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-00640</span><br>

If the <code>pNext</code> chain includes a <a href="#VkExportMemoryAllocateInfo">VkExportMemoryAllocateInfo</a>
structure, it <strong>must</strong> not include a <a href="#VkExportMemoryAllocateInfoNV">VkExportMemoryAllocateInfoNV</a> or
<a href="#VkExportMemoryWin32HandleInfoNV">VkExportMemoryWin32HandleInfoNV</a> structure</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-00641" href="#VUID-VkMemoryAllocateInfo-pNext-00641"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-00641</span><br>

If the <code>pNext</code> chain includes a
<a href="#VkImportMemoryWin32HandleInfoKHR">VkImportMemoryWin32HandleInfoKHR</a> structure, it <strong>must</strong> not include a
<a href="#VkImportMemoryWin32HandleInfoNV">VkImportMemoryWin32HandleInfoNV</a> structure</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-allocationSize-01742" href="#VUID-VkMemoryAllocateInfo-allocationSize-01742"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-allocationSize-01742</span><br>

If the parameters define an import operation, the external handle
specified was created by the Vulkan API, and the external handle type is
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_FD_BIT</code>, then the values of
<code>allocationSize</code> and <code>memoryTypeIndex</code> <strong>must</strong> match those
specified when the payload being imported was created</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-None-00643" href="#VUID-VkMemoryAllocateInfo-None-00643"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-None-00643</span><br>

If the parameters define an import operation and the external handle
specified was created by the Vulkan API, the device mask specified by
<a href="#VkMemoryAllocateFlagsInfo">VkMemoryAllocateFlagsInfo</a> <strong>must</strong> match the mask specified when the
payload being imported was allocated</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-None-00644" href="#VUID-VkMemoryAllocateInfo-None-00644"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-None-00644</span><br>

If the parameters define an import operation and the external handle
specified was created by the Vulkan API, the list of physical devices
that comprise the logical device passed to <a href="#vkAllocateMemory">vkAllocateMemory</a> <strong>must</strong>
match the list of physical devices that comprise the logical device on
which the payload was originally allocated</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-memoryTypeIndex-00645" href="#VUID-VkMemoryAllocateInfo-memoryTypeIndex-00645"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-memoryTypeIndex-00645</span><br>

If the parameters define an import operation and the external handle is
an NT handle or a global share handle created outside of the Vulkan API,
the value of <code>memoryTypeIndex</code> <strong>must</strong> be one of those returned by
<a href="#vkGetMemoryWin32HandlePropertiesKHR">vkGetMemoryWin32HandlePropertiesKHR</a></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-allocationSize-01743" href="#VUID-VkMemoryAllocateInfo-allocationSize-01743"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-allocationSize-01743</span><br>

If the parameters define an import operation, the external handle was
created by the Vulkan API, and the external handle type is
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_BIT</code> or
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_KMT_BIT</code>, then the
values of <code>allocationSize</code> and <code>memoryTypeIndex</code> <strong>must</strong> match
those specified when the payload being imported was created</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-allocationSize-00647" href="#VUID-VkMemoryAllocateInfo-allocationSize-00647"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-allocationSize-00647</span><br>

If the parameters define an import operation and the external handle
type is <code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D12_HEAP_BIT</code>,
<code>allocationSize</code> <strong>must</strong> match the size specified when creating the
Direct3D 12 heap from which the payload was extracted</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-memoryTypeIndex-00648" href="#VUID-VkMemoryAllocateInfo-memoryTypeIndex-00648"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-memoryTypeIndex-00648</span><br>

If the parameters define an import operation and the external handle is
a POSIX file descriptor created outside of the Vulkan API, the value of
<code>memoryTypeIndex</code> <strong>must</strong> be one of those returned by
<a href="#vkGetMemoryFdPropertiesKHR">vkGetMemoryFdPropertiesKHR</a></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-memoryTypeIndex-01872" href="#VUID-VkMemoryAllocateInfo-memoryTypeIndex-01872"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-memoryTypeIndex-01872</span><br>

If the <a href="features.html#features-protectedMemory" class="xref page"><code>protectedMemory</code></a> feature is
not enabled, the <code>VkMemoryAllocateInfo</code>::<code>memoryTypeIndex</code> <strong>must</strong>
not indicate a memory type that reports
<code>VK_MEMORY_PROPERTY_PROTECTED_BIT</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-memoryTypeIndex-01744" href="#VUID-VkMemoryAllocateInfo-memoryTypeIndex-01744"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-memoryTypeIndex-01744</span><br>

If the parameters define an import operation and the external handle is
a host pointer, the value of <code>memoryTypeIndex</code> <strong>must</strong> be one of those
returned by <a href="#vkGetMemoryHostPointerPropertiesEXT">vkGetMemoryHostPointerPropertiesEXT</a></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-allocationSize-01745" href="#VUID-VkMemoryAllocateInfo-allocationSize-01745"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-allocationSize-01745</span><br>

If the parameters define an import operation and the external handle is
a host pointer, <code>allocationSize</code> <strong>must</strong> be an integer multiple of
<code>VkPhysicalDeviceExternalMemoryHostPropertiesEXT</code>::<code>minImportedHostPointerAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-02805" href="#VUID-VkMemoryAllocateInfo-pNext-02805"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-02805</span><br>

If the parameters define an import operation and the external handle is
a host pointer, the <code>pNext</code> chain <strong>must</strong> not include a
<a href="#VkDedicatedAllocationMemoryAllocateInfoNV">VkDedicatedAllocationMemoryAllocateInfoNV</a> structure with either
its <code>image</code> or <code>buffer</code> field set to a value other than
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-02806" href="#VUID-VkMemoryAllocateInfo-pNext-02806"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-02806</span><br>

If the parameters define an import operation and the external handle is
a host pointer, the <code>pNext</code> chain <strong>must</strong> not include a
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a> structure with either its
<code>image</code> or <code>buffer</code> field set to a value other than
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-allocationSize-02383" href="#VUID-VkMemoryAllocateInfo-allocationSize-02383"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-allocationSize-02383</span><br>

If the parameters define an import operation and the external handle
type is
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ANDROID_HARDWARE_BUFFER_BIT_ANDROID</code>,
<code>allocationSize</code> <strong>must</strong> be the size returned by
<a href="#vkGetAndroidHardwareBufferPropertiesANDROID">vkGetAndroidHardwareBufferPropertiesANDROID</a> for the Android
hardware buffer</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-02384" href="#VUID-VkMemoryAllocateInfo-pNext-02384"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-02384</span><br>

If the parameters define an import operation and the external handle
type is
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ANDROID_HARDWARE_BUFFER_BIT_ANDROID</code>,
and the <code>pNext</code> chain does not include a
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a> structure or
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a>::<code>image</code> is
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the Android hardware buffer <strong>must</strong> have a
<code>AHardwareBuffer_Desc</code>::<code>format</code> of
<code>AHARDWAREBUFFER_FORMAT_BLOB</code> and a
<code>AHardwareBuffer_Desc</code>::<code>usage</code> that includes
<code>AHARDWAREBUFFER_USAGE_GPU_DATA_BUFFER</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-memoryTypeIndex-02385" href="#VUID-VkMemoryAllocateInfo-memoryTypeIndex-02385"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-memoryTypeIndex-02385</span><br>

If the parameters define an import operation and the external handle
type is
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ANDROID_HARDWARE_BUFFER_BIT_ANDROID</code>,
<code>memoryTypeIndex</code> <strong>must</strong> be one of those returned by
<a href="#vkGetAndroidHardwareBufferPropertiesANDROID">vkGetAndroidHardwareBufferPropertiesANDROID</a> for the Android
hardware buffer</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-01874" href="#VUID-VkMemoryAllocateInfo-pNext-01874"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-01874</span><br>

If the parameters do not define an import operation, and the <code>pNext</code>
chain includes a <code>VkExportMemoryAllocateInfo</code> structure with
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ANDROID_HARDWARE_BUFFER_BIT_ANDROID</code>
included in its <code>handleTypes</code> member, and the <code>pNext</code> chain
includes a <a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a> structure with
<code>image</code> not equal to <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, then <code>allocationSize</code>
<strong>must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-07900" href="#VUID-VkMemoryAllocateInfo-pNext-07900"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-07900</span><br>

If the parameters define an export operation, the handle type is
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ANDROID_HARDWARE_BUFFER_BIT_ANDROID</code>,
and the <code>pNext</code> does not include a
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a> structure, <code>allocationSize</code>
<strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-07901" href="#VUID-VkMemoryAllocateInfo-pNext-07901"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-07901</span><br>

If the parameters define an export operation, the handle type is
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ANDROID_HARDWARE_BUFFER_BIT_ANDROID</code>,
and the <code>pNext</code> chain includes a <a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a>
structure with <code>buffer</code> set to a valid <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> object,
<code>allocationSize</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-02386" href="#VUID-VkMemoryAllocateInfo-pNext-02386"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-02386</span><br>

If the parameters define an import operation, the external handle is an
Android hardware buffer, and the <code>pNext</code> chain includes a
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a> with <code>image</code> that is not
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the Android hardware buffer&#8217;s
<code>AHardwareBuffer</code>::<code>usage</code> <strong>must</strong> include at least one of
<code>AHARDWAREBUFFER_USAGE_GPU_FRAMEBUFFER</code>,
<code>AHARDWAREBUFFER_USAGE_GPU_SAMPLED_IMAGE</code> or
<code>AHARDWAREBUFFER_USAGE_GPU_DATA_BUFFER</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-02387" href="#VUID-VkMemoryAllocateInfo-pNext-02387"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-02387</span><br>

If the parameters define an import operation, the external handle is an
Android hardware buffer, and the <code>pNext</code> chain includes a
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a> with <code>image</code> that is not
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the format of <code>image</code> <strong>must</strong> be
<code>VK_FORMAT_UNDEFINED</code> or the format returned by
<a href="#vkGetAndroidHardwareBufferPropertiesANDROID">vkGetAndroidHardwareBufferPropertiesANDROID</a> in
<a href="#VkAndroidHardwareBufferFormatPropertiesANDROID">VkAndroidHardwareBufferFormatPropertiesANDROID</a>::<code>format</code> for
the Android hardware buffer</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-02388" href="#VUID-VkMemoryAllocateInfo-pNext-02388"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-02388</span><br>

If the parameters define an import operation, the external handle is an
Android hardware buffer, and the <code>pNext</code> chain includes a
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a> structure with <code>image</code> that is
not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the width, height, and array layer dimensions
of <code>image</code> and the Android hardware buffer&#8217;s
<code>AHardwareBuffer_Desc</code> <strong>must</strong> be identical</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-02389" href="#VUID-VkMemoryAllocateInfo-pNext-02389"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-02389</span><br>

If the parameters define an import operation, the external handle is an
Android hardware buffer, and the <code>pNext</code> chain includes a
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a> structure with <code>image</code> that is
not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, and the Android hardware buffer&#8217;s
<code>AHardwareBuffer</code>::<code>usage</code> includes
<code>AHARDWAREBUFFER_USAGE_GPU_MIPMAP_COMPLETE</code>, the <code>image</code> <strong>must</strong>
have a complete mipmap chain</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-02586" href="#VUID-VkMemoryAllocateInfo-pNext-02586"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-02586</span><br>

If the parameters define an import operation, the external handle is an
Android hardware buffer, and the <code>pNext</code> chain includes a
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a> structure with <code>image</code> that is
not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, and the Android hardware buffer&#8217;s
<code>AHardwareBuffer</code>::<code>usage</code> does not include
<code>AHARDWAREBUFFER_USAGE_GPU_MIPMAP_COMPLETE</code>, the <code>image</code> <strong>must</strong>
have exactly one mipmap level</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-02390" href="#VUID-VkMemoryAllocateInfo-pNext-02390"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-02390</span><br>

If the parameters define an import operation, the external handle is an
Android hardware buffer, and the <code>pNext</code> chain includes a
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a> structure with <code>image</code> that is
not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, each bit set in the usage of <code>image</code> <strong>must</strong>
be listed in
<a href="#memory-external-android-hardware-buffer-usage">AHardwareBuffer Usage    Equivalence</a>, and if there is a corresponding
<code>AHARDWAREBUFFER_USAGE</code> bit listed that bit <strong>must</strong> be included in the
Android hardware buffer&#8217;s <code>AHardwareBuffer_Desc</code>::<code>usage</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-screenBufferImport-08941" href="#VUID-VkMemoryAllocateInfo-screenBufferImport-08941"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-screenBufferImport-08941</span><br>

If the parameters define an import operation and the external handle
type is <code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_SCREEN_BUFFER_BIT_QNX</code>,
<a href="features.html#VkPhysicalDeviceExternalMemoryScreenBufferFeaturesQNX" class="xref page">VkPhysicalDeviceExternalMemoryScreenBufferFeaturesQNX</a>::<code>screenBufferImport</code>
<strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-allocationSize-08942" href="#VUID-VkMemoryAllocateInfo-allocationSize-08942"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-allocationSize-08942</span><br>

If the parameters define an import operation and the external handle
type is <code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_SCREEN_BUFFER_BIT_QNX</code>,
<code>allocationSize</code> <strong>must</strong> be the size returned by
<a href="#vkGetScreenBufferPropertiesQNX">vkGetScreenBufferPropertiesQNX</a> for the QNX Screen buffer</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-memoryTypeIndex-08943" href="#VUID-VkMemoryAllocateInfo-memoryTypeIndex-08943"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-memoryTypeIndex-08943</span><br>

If the parameters define an import operation and the external handle
type is <code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_SCREEN_BUFFER_BIT_QNX</code>,
<code>memoryTypeIndex</code> <strong>must</strong> be one of those returned by
<a href="#vkGetScreenBufferPropertiesQNX">vkGetScreenBufferPropertiesQNX</a> for the QNX Screen buffer</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-08944" href="#VUID-VkMemoryAllocateInfo-pNext-08944"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-08944</span><br>

If the parameters define an import operation, the external handle is a
QNX Screen buffer, and the <code>pNext</code> chain includes a
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a> with <code>image</code> that is not
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the QNX Screen&#8217;s buffer must be a
<a href="#memory-external-screen-buffer-validity">valid QNX Screen buffer</a></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-08945" href="#VUID-VkMemoryAllocateInfo-pNext-08945"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-08945</span><br>

If the parameters define an import operation, the external handle is an
QNX Screen buffer, and the <code>pNext</code> chain includes a
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a> with <code>image</code> that is not
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the format of <code>image</code> <strong>must</strong> be
<code>VK_FORMAT_UNDEFINED</code> or the format returned by
<a href="#vkGetScreenBufferPropertiesQNX">vkGetScreenBufferPropertiesQNX</a> in
<a href="#VkScreenBufferFormatPropertiesQNX">VkScreenBufferFormatPropertiesQNX</a>::<code>format</code> for the QNX Screen
buffer</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-08946" href="#VUID-VkMemoryAllocateInfo-pNext-08946"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-08946</span><br>

If the parameters define an import operation, the external handle is a
QNX Screen buffer, and the <code>pNext</code> chain includes a
<a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a> structure with <code>image</code> that is
not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the width, height, and array layer dimensions
of <code>image</code> and the QNX Screen buffer&#8217;s <code>_screen_buffer</code> must be
identical</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-opaqueCaptureAddress-03329" href="#VUID-VkMemoryAllocateInfo-opaqueCaptureAddress-03329"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-opaqueCaptureAddress-03329</span><br>

If
<a href="#VkMemoryOpaqueCaptureAddressAllocateInfo">VkMemoryOpaqueCaptureAddressAllocateInfo</a>::<code>opaqueCaptureAddress</code>
is not zero, <code>VkMemoryAllocateFlagsInfo</code>::<code>flags</code> <strong>must</strong> include
<code>VK_MEMORY_ALLOCATE_DEVICE_ADDRESS_CAPTURE_REPLAY_BIT</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-flags-03330" href="#VUID-VkMemoryAllocateInfo-flags-03330"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-flags-03330</span><br>

If <code>VkMemoryAllocateFlagsInfo</code>::<code>flags</code> includes
<code>VK_MEMORY_ALLOCATE_DEVICE_ADDRESS_CAPTURE_REPLAY_BIT</code>, the
<a href="features.html#features-bufferDeviceAddressCaptureReplay" class="xref page">    <code>bufferDeviceAddressCaptureReplay</code></a> feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-flags-03331" href="#VUID-VkMemoryAllocateInfo-flags-03331"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-flags-03331</span><br>

If <code>VkMemoryAllocateFlagsInfo</code>::<code>flags</code> includes
<code>VK_MEMORY_ALLOCATE_DEVICE_ADDRESS_BIT</code>, the
<a href="features.html#features-bufferDeviceAddress" class="xref page"><code>bufferDeviceAddress</code></a> feature
<strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-03332" href="#VUID-VkMemoryAllocateInfo-pNext-03332"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-03332</span><br>

If the <code>pNext</code> chain includes a
<code>VkImportMemoryHostPointerInfoEXT</code> structure,
<a href="#VkMemoryOpaqueCaptureAddressAllocateInfo">VkMemoryOpaqueCaptureAddressAllocateInfo</a>::<code>opaqueCaptureAddress</code>
<strong>must</strong> be zero</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-opaqueCaptureAddress-03333" href="#VUID-VkMemoryAllocateInfo-opaqueCaptureAddress-03333"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-opaqueCaptureAddress-03333</span><br>

If the parameters define an import operation,
<a href="#VkMemoryOpaqueCaptureAddressAllocateInfo">VkMemoryOpaqueCaptureAddressAllocateInfo</a>::<code>opaqueCaptureAddress</code>
<strong>must</strong> be zero</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-None-04749" href="#VUID-VkMemoryAllocateInfo-None-04749"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-None-04749</span><br>

If the parameters define an import operation and the external handle
type is <code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ZIRCON_VMO_BIT_FUCHSIA</code>, the
value of <code>memoryTypeIndex</code> <strong>must</strong> be an index identifying a memory
type from the <code>memoryTypeBits</code> field of the
<a href="#VkMemoryZirconHandlePropertiesFUCHSIA">VkMemoryZirconHandlePropertiesFUCHSIA</a> structure populated by a
call to <a href="#vkGetMemoryZirconHandlePropertiesFUCHSIA">vkGetMemoryZirconHandlePropertiesFUCHSIA</a></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-allocationSize-07902" href="#VUID-VkMemoryAllocateInfo-allocationSize-07902"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-allocationSize-07902</span><br>

If the parameters define an import operation and the external handle
type is <code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ZIRCON_VMO_BIT_FUCHSIA</code>, the
value of <code>allocationSize</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-allocationSize-07903" href="#VUID-VkMemoryAllocateInfo-allocationSize-07903"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-allocationSize-07903</span><br>

If the parameters define an import operation and the external handle
type is <code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ZIRCON_VMO_BIT_FUCHSIA</code>, the
value of <code>allocationSize</code> <strong>must</strong> be less than or equal to the size of
the VMO as determined by <code>zx_vmo_get_size</code>(<code>handle</code>) where
<code>handle</code> is the VMO handle to the imported external memory</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-06780" href="#VUID-VkMemoryAllocateInfo-pNext-06780"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-06780</span><br>

If the <code>pNext</code> chain includes a
<a href="#VkExportMetalObjectCreateInfoEXT">VkExportMetalObjectCreateInfoEXT</a> structure, its
<code>exportObjectType</code> member <strong>must</strong> be
<code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_BUFFER_BIT_EXT</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-sType-sType" href="#VUID-VkMemoryAllocateInfo-sType-sType"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_INFO</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-pNext-pNext" href="#VUID-VkMemoryAllocateInfo-pNext-pNext"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-pNext-pNext</span><br>
 Each <code>pNext</code> member of any structure (including this one) in the <code>pNext</code> chain <strong>must</strong> be either <code>NULL</code> or a pointer to a valid instance of <a href="#VkDedicatedAllocationMemoryAllocateInfoNV">VkDedicatedAllocationMemoryAllocateInfoNV</a>, <a href="#VkExportMemoryAllocateInfo">VkExportMemoryAllocateInfo</a>, <a href="#VkExportMemoryAllocateInfoNV">VkExportMemoryAllocateInfoNV</a>, <a href="#VkExportMemoryWin32HandleInfoKHR">VkExportMemoryWin32HandleInfoKHR</a>, <a href="#VkExportMemoryWin32HandleInfoNV">VkExportMemoryWin32HandleInfoNV</a>, <a href="#VkExportMetalObjectCreateInfoEXT">VkExportMetalObjectCreateInfoEXT</a>, <a href="#VkImportAndroidHardwareBufferInfoANDROID">VkImportAndroidHardwareBufferInfoANDROID</a>, <a href="resources.html#VkImportMemoryBufferCollectionFUCHSIA" class="xref page">VkImportMemoryBufferCollectionFUCHSIA</a>, <a href="#VkImportMemoryFdInfoKHR">VkImportMemoryFdInfoKHR</a>, <a href="#VkImportMemoryHostPointerInfoEXT">VkImportMemoryHostPointerInfoEXT</a>, <a href="#VkImportMemoryWin32HandleInfoKHR">VkImportMemoryWin32HandleInfoKHR</a>, <a href="#VkImportMemoryWin32HandleInfoNV">VkImportMemoryWin32HandleInfoNV</a>, <a href="#VkImportMemoryZirconHandleInfoFUCHSIA">VkImportMemoryZirconHandleInfoFUCHSIA</a>, <a href="#VkImportMetalBufferInfoEXT">VkImportMetalBufferInfoEXT</a>, <a href="#VkImportScreenBufferInfoQNX">VkImportScreenBufferInfoQNX</a>, <a href="#VkMemoryAllocateFlagsInfo">VkMemoryAllocateFlagsInfo</a>, <a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a>, <a href="#VkMemoryOpaqueCaptureAddressAllocateInfo">VkMemoryOpaqueCaptureAddressAllocateInfo</a>, or <a href="#VkMemoryPriorityAllocateInfoEXT">VkMemoryPriorityAllocateInfoEXT</a></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateInfo-sType-unique" href="#VUID-VkMemoryAllocateInfo-sType-unique"></a> <span class="vuid">VUID-VkMemoryAllocateInfo-sType-unique</span><br>
 The <code>sType</code> value of each struct in the <code>pNext</code> chain <strong>must</strong> be unique, with the exception of structures of type <a href="#VkExportMetalObjectCreateInfoEXT">VkExportMetalObjectCreateInfoEXT</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If the <code>pNext</code> chain includes a <code>VkMemoryDedicatedAllocateInfo</code>
structure, then that structure includes a handle of the sole buffer or image
resource that the memory <strong>can</strong> be bound to.</p>
</div>
<div class="paragraph">
<p>The <code>VkMemoryDedicatedAllocateInfo</code> structure is defined as:</p>
</div>
<div id="VkMemoryDedicatedAllocateInfo" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
typedef struct VkMemoryDedicatedAllocateInfo {
    VkStructureType    sType;
    const void*        pNext;
    VkImage            image;
    VkBuffer           buffer;
} VkMemoryDedicatedAllocateInfo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkMemoryDedicatedAllocateInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_dedicated_allocation
typedef VkMemoryDedicatedAllocateInfo VkMemoryDedicatedAllocateInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>image</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> or a handle of an image which this
memory will be bound to.</p>
</li>
<li>
<p><code>buffer</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> or a handle of a buffer which this
memory will be bound to.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-image-01432" href="#VUID-VkMemoryDedicatedAllocateInfo-image-01432"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-image-01432</span><br>

At least one of <code>image</code> and <code>buffer</code> <strong>must</strong> be
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-image-02964" href="#VUID-VkMemoryDedicatedAllocateInfo-image-02964"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-image-02964</span><br>

If <code>image</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> and the memory is not an
imported Android Hardware Buffer or an imported QNX Screen buffer,
<code>VkMemoryAllocateInfo</code>::<code>allocationSize</code> <strong>must</strong> equal the
<code>VkMemoryRequirements</code>::<code>size</code> of the image</p>
</li>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-image-01434" href="#VUID-VkMemoryDedicatedAllocateInfo-image-01434"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-image-01434</span><br>

If <code>image</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>image</code> <strong>must</strong> have been
created without <code>VK_IMAGE_CREATE_SPARSE_BINDING_BIT</code> set in
<a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>::<code>flags</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-buffer-02965" href="#VUID-VkMemoryDedicatedAllocateInfo-buffer-02965"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-buffer-02965</span><br>

If <code>buffer</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> and the memory is not an
imported Android Hardware Buffer or an imported QNX Screen buffer,
<code>VkMemoryAllocateInfo</code>::<code>allocationSize</code> <strong>must</strong> equal the
<code>VkMemoryRequirements</code>::<code>size</code> of the buffer</p>
</li>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-buffer-01436" href="#VUID-VkMemoryDedicatedAllocateInfo-buffer-01436"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-buffer-01436</span><br>

If <code>buffer</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>buffer</code> <strong>must</strong> have
been created without <code>VK_BUFFER_CREATE_SPARSE_BINDING_BIT</code> set in
<a href="resources.html#VkBufferCreateInfo" class="xref page">VkBufferCreateInfo</a>::<code>flags</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-image-01876" href="#VUID-VkMemoryDedicatedAllocateInfo-image-01876"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-image-01876</span><br>

If <code>image</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> and
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> defines a memory import operation with handle
type <code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_BIT</code>,
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_KMT_BIT</code>,
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D11_TEXTURE_BIT</code>,
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D11_TEXTURE_KMT_BIT</code>,
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D12_HEAP_BIT</code>, or
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D12_RESOURCE_BIT</code>, and the
external handle was created by the Vulkan API, then the memory being
imported <strong>must</strong> also be a dedicated image allocation and <code>image</code>
<strong>must</strong> be identical to the image associated with the imported memory</p>
</li>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-buffer-01877" href="#VUID-VkMemoryDedicatedAllocateInfo-buffer-01877"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-buffer-01877</span><br>

If <code>buffer</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> and
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> defines a memory import operation with handle
type <code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_BIT</code>,
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_KMT_BIT</code>,
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D11_TEXTURE_BIT</code>,
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D11_TEXTURE_KMT_BIT</code>,
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D12_HEAP_BIT</code>, or
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D12_RESOURCE_BIT</code>, and the
external handle was created by the Vulkan API, then the memory being
imported <strong>must</strong> also be a dedicated buffer allocation and <code>buffer</code>
<strong>must</strong> be identical to the buffer associated with the imported memory</p>
</li>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-image-01878" href="#VUID-VkMemoryDedicatedAllocateInfo-image-01878"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-image-01878</span><br>

If <code>image</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> and
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> defines a memory import operation with handle
type <code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_FD_BIT</code>, the memory
being imported <strong>must</strong> also be a dedicated image allocation and
<code>image</code> <strong>must</strong> be identical to the image associated with the imported
memory</p>
</li>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-buffer-01879" href="#VUID-VkMemoryDedicatedAllocateInfo-buffer-01879"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-buffer-01879</span><br>

If <code>buffer</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> and
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> defines a memory import operation with handle
type <code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_FD_BIT</code>, the memory
being imported <strong>must</strong> also be a dedicated buffer allocation and
<code>buffer</code> <strong>must</strong> be identical to the buffer associated with the
imported memory</p>
</li>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-image-01797" href="#VUID-VkMemoryDedicatedAllocateInfo-image-01797"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-image-01797</span><br>

If <code>image</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>image</code> <strong>must</strong> not have
been created with <code>VK_IMAGE_CREATE_DISJOINT_BIT</code> set in
<a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>::<code>flags</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-image-04751" href="#VUID-VkMemoryDedicatedAllocateInfo-image-04751"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-image-04751</span><br>

If <code>image</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> and
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> defines a memory import operation with handle
type <code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ZIRCON_VMO_BIT_FUCHSIA</code>, the
memory being imported <strong>must</strong> also be a dedicated image allocation and
<code>image</code> <strong>must</strong> be identical to the image associated with the imported
memory</p>
</li>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-buffer-04752" href="#VUID-VkMemoryDedicatedAllocateInfo-buffer-04752"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-buffer-04752</span><br>

If <code>buffer</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> and
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> defines a memory import operation with handle
type <code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ZIRCON_VMO_BIT_FUCHSIA</code>, the
memory being imported <strong>must</strong> also be a dedicated buffer allocation and
<code>buffer</code> <strong>must</strong> be identical to the buffer associated with the
imported memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-sType-sType" href="#VUID-VkMemoryDedicatedAllocateInfo-sType-sType"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_DEDICATED_ALLOCATE_INFO</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-image-parameter" href="#VUID-VkMemoryDedicatedAllocateInfo-image-parameter"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-image-parameter</span><br>
 If <code>image</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>image</code> <strong>must</strong> be a valid <a href="resources.html#VkImage" class="xref page">VkImage</a> handle</p>
</li>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-buffer-parameter" href="#VUID-VkMemoryDedicatedAllocateInfo-buffer-parameter"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-buffer-parameter</span><br>
 If <code>buffer</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>buffer</code> <strong>must</strong> be a valid <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-VkMemoryDedicatedAllocateInfo-commonparent" href="#VUID-VkMemoryDedicatedAllocateInfo-commonparent"></a> <span class="vuid">VUID-VkMemoryDedicatedAllocateInfo-commonparent</span><br>
 Both of <code>buffer</code>, and <code>image</code> that are valid handles of non-ignored parameters <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If the <code>pNext</code> chain includes a
<code>VkDedicatedAllocationMemoryAllocateInfoNV</code> structure, then that
structure includes a handle of the sole buffer or image resource that the
memory <strong>can</strong> be bound to.</p>
</div>
<div class="paragraph">
<p>The <code>VkDedicatedAllocationMemoryAllocateInfoNV</code> structure is defined as:</p>
</div>
<div id="VkDedicatedAllocationMemoryAllocateInfoNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_dedicated_allocation
typedef struct VkDedicatedAllocationMemoryAllocateInfoNV {
    VkStructureType    sType;
    const void*        pNext;
    VkImage            image;
    VkBuffer           buffer;
} VkDedicatedAllocationMemoryAllocateInfoNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>image</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> or a handle of an image which this
memory will be bound to.</p>
</li>
<li>
<p><code>buffer</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> or a handle of a buffer which this
memory will be bound to.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-00649" href="#VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-00649"></a> <span class="vuid">VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-00649</span><br>

At least one of <code>image</code> and <code>buffer</code> <strong>must</strong> be
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-00650" href="#VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-00650"></a> <span class="vuid">VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-00650</span><br>

If <code>image</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the image <strong>must</strong> have been
created with
<a href="resources.html#VkDedicatedAllocationImageCreateInfoNV" class="xref page">VkDedicatedAllocationImageCreateInfoNV</a>::<code>dedicatedAllocation</code>
equal to <code>VK_TRUE</code></p>
</li>
<li>
<p><a id="VUID-VkDedicatedAllocationMemoryAllocateInfoNV-buffer-00651" href="#VUID-VkDedicatedAllocationMemoryAllocateInfoNV-buffer-00651"></a> <span class="vuid">VUID-VkDedicatedAllocationMemoryAllocateInfoNV-buffer-00651</span><br>

If <code>buffer</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the buffer <strong>must</strong> have been
created with
<a href="resources.html#VkDedicatedAllocationBufferCreateInfoNV" class="xref page">VkDedicatedAllocationBufferCreateInfoNV</a>::<code>dedicatedAllocation</code>
equal to <code>VK_TRUE</code></p>
</li>
<li>
<p><a id="VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-00652" href="#VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-00652"></a> <span class="vuid">VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-00652</span><br>

If <code>image</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>,
<code>VkMemoryAllocateInfo</code>::<code>allocationSize</code> <strong>must</strong> equal the
<code>VkMemoryRequirements</code>::<code>size</code> of the image</p>
</li>
<li>
<p><a id="VUID-VkDedicatedAllocationMemoryAllocateInfoNV-buffer-00653" href="#VUID-VkDedicatedAllocationMemoryAllocateInfoNV-buffer-00653"></a> <span class="vuid">VUID-VkDedicatedAllocationMemoryAllocateInfoNV-buffer-00653</span><br>

If <code>buffer</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>,
<code>VkMemoryAllocateInfo</code>::<code>allocationSize</code> <strong>must</strong> equal the
<code>VkMemoryRequirements</code>::<code>size</code> of the buffer</p>
</li>
<li>
<p><a id="VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-00654" href="#VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-00654"></a> <span class="vuid">VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-00654</span><br>

If <code>image</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> and
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> defines a memory import operation, the memory
being imported <strong>must</strong> also be a dedicated image allocation and
<code>image</code> <strong>must</strong> be identical to the image associated with the imported
memory</p>
</li>
<li>
<p><a id="VUID-VkDedicatedAllocationMemoryAllocateInfoNV-buffer-00655" href="#VUID-VkDedicatedAllocationMemoryAllocateInfoNV-buffer-00655"></a> <span class="vuid">VUID-VkDedicatedAllocationMemoryAllocateInfoNV-buffer-00655</span><br>

If <code>buffer</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> and
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> defines a memory import operation, the memory
being imported <strong>must</strong> also be a dedicated buffer allocation and
<code>buffer</code> <strong>must</strong> be identical to the buffer associated with the
imported memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkDedicatedAllocationMemoryAllocateInfoNV-sType-sType" href="#VUID-VkDedicatedAllocationMemoryAllocateInfoNV-sType-sType"></a> <span class="vuid">VUID-VkDedicatedAllocationMemoryAllocateInfoNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_DEDICATED_ALLOCATION_MEMORY_ALLOCATE_INFO_NV</code></p>
</li>
<li>
<p><a id="VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-parameter" href="#VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-parameter"></a> <span class="vuid">VUID-VkDedicatedAllocationMemoryAllocateInfoNV-image-parameter</span><br>
 If <code>image</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>image</code> <strong>must</strong> be a valid <a href="resources.html#VkImage" class="xref page">VkImage</a> handle</p>
</li>
<li>
<p><a id="VUID-VkDedicatedAllocationMemoryAllocateInfoNV-buffer-parameter" href="#VUID-VkDedicatedAllocationMemoryAllocateInfoNV-buffer-parameter"></a> <span class="vuid">VUID-VkDedicatedAllocationMemoryAllocateInfoNV-buffer-parameter</span><br>
 If <code>buffer</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>buffer</code> <strong>must</strong> be a valid <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-VkDedicatedAllocationMemoryAllocateInfoNV-commonparent" href="#VUID-VkDedicatedAllocationMemoryAllocateInfoNV-commonparent"></a> <span class="vuid">VUID-VkDedicatedAllocationMemoryAllocateInfoNV-commonparent</span><br>
 Both of <code>buffer</code>, and <code>image</code> that are valid handles of non-ignored parameters <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If the <code>pNext</code> chain includes a <code>VkMemoryPriorityAllocateInfoEXT</code>
structure, then that structure includes a priority for the memory.</p>
</div>
<div class="paragraph">
<p>The <code>VkMemoryPriorityAllocateInfoEXT</code> structure is defined as:</p>
</div>
<div id="VkMemoryPriorityAllocateInfoEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_memory_priority
typedef struct VkMemoryPriorityAllocateInfoEXT {
    VkStructureType    sType;
    const void*        pNext;
    float              priority;
} VkMemoryPriorityAllocateInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>priority</code> is a floating-point value between <code>0</code> and <code>1</code>, indicating
the priority of the allocation relative to other memory allocations.
Larger values are higher priority.
The granularity of the priorities is implementation-dependent.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Memory allocations with higher priority <strong>may</strong> be more likely to stay in
device-local memory when the system is under memory pressure.</p>
</div>
<div class="paragraph">
<p>If this structure is not included, it is as if the <code>priority</code> value were
<code>0.5</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryPriorityAllocateInfoEXT-priority-02602" href="#VUID-VkMemoryPriorityAllocateInfoEXT-priority-02602"></a> <span class="vuid">VUID-VkMemoryPriorityAllocateInfoEXT-priority-02602</span><br>

<code>priority</code> <strong>must</strong> be between <code>0</code> and <code>1</code>, inclusive</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryPriorityAllocateInfoEXT-sType-sType" href="#VUID-VkMemoryPriorityAllocateInfoEXT-sType-sType"></a> <span class="vuid">VUID-VkMemoryPriorityAllocateInfoEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_PRIORITY_ALLOCATE_INFO_EXT</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To modify the priority of an existing memory allocation, call:</p>
</div>
<div id="vkSetDeviceMemoryPriorityEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_pageable_device_local_memory
void vkSetDeviceMemoryPriorityEXT(
    VkDevice                                    device,
    VkDeviceMemory                              memory,
    float                                       priority);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the memory.</p>
</li>
<li>
<p><code>memory</code> is the <a href="#VkDeviceMemory">VkDeviceMemory</a> object to which the new
priority will be applied.</p>
</li>
<li>
<p><code>priority</code> is a floating-point value between <code>0</code> and <code>1</code>, indicating
the priority of the allocation relative to other memory allocations.
Larger values are higher priority.
The granularity of the priorities is implementation-dependent.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Memory allocations with higher priority <strong>may</strong> be more likely to stay in
device-local memory when the system is under memory pressure.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkSetDeviceMemoryPriorityEXT-priority-06258" href="#VUID-vkSetDeviceMemoryPriorityEXT-priority-06258"></a> <span class="vuid">VUID-vkSetDeviceMemoryPriorityEXT-priority-06258</span><br>

<code>priority</code> <strong>must</strong> be between <code>0</code> and <code>1</code>, inclusive</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkSetDeviceMemoryPriorityEXT-device-parameter" href="#VUID-vkSetDeviceMemoryPriorityEXT-device-parameter"></a> <span class="vuid">VUID-vkSetDeviceMemoryPriorityEXT-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkSetDeviceMemoryPriorityEXT-memory-parameter" href="#VUID-vkSetDeviceMemoryPriorityEXT-memory-parameter"></a> <span class="vuid">VUID-vkSetDeviceMemoryPriorityEXT-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
<li>
<p><a id="VUID-vkSetDeviceMemoryPriorityEXT-memory-parent" href="#VUID-vkSetDeviceMemoryPriorityEXT-memory-parent"></a> <span class="vuid">VUID-vkSetDeviceMemoryPriorityEXT-memory-parent</span><br>
 <code>memory</code> <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>When allocating memory whose payload <strong>may</strong> be exported to another process or
Vulkan instance, add a <a href="#VkExportMemoryAllocateInfo">VkExportMemoryAllocateInfo</a> structure to the
<code>pNext</code> chain of the <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure, specifying
the handle types that <strong>may</strong> be exported.</p>
</div>
<div class="paragraph">
<p>The <a href="#VkExportMemoryAllocateInfo">VkExportMemoryAllocateInfo</a> structure is defined as:</p>
</div>
<div id="VkExportMemoryAllocateInfo" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
typedef struct VkExportMemoryAllocateInfo {
    VkStructureType                    sType;
    const void*                        pNext;
    VkExternalMemoryHandleTypeFlags    handleTypes;
} VkExportMemoryAllocateInfo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkExportMemoryAllocateInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_external_memory
typedef VkExportMemoryAllocateInfo VkExportMemoryAllocateInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>handleTypes</code> is zero or a bitmask of
<a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> specifying one or more memory
handle types the application <strong>can</strong> export from the resulting allocation.
The application <strong>can</strong> request multiple handle types for the same
allocation.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMemoryAllocateInfo-handleTypes-00656" href="#VUID-VkExportMemoryAllocateInfo-handleTypes-00656"></a> <span class="vuid">VUID-VkExportMemoryAllocateInfo-handleTypes-00656</span><br>

The bits in <code>handleTypes</code> <strong>must</strong> be supported and compatible, as
reported by <a href="capabilities.html#VkExternalImageFormatProperties" class="xref page">VkExternalImageFormatProperties</a> or
<a href="capabilities.html#VkExternalBufferProperties" class="xref page">VkExternalBufferProperties</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMemoryAllocateInfo-sType-sType" href="#VUID-VkExportMemoryAllocateInfo-sType-sType"></a> <span class="vuid">VUID-VkExportMemoryAllocateInfo-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_MEMORY_ALLOCATE_INFO</code></p>
</li>
<li>
<p><a id="VUID-VkExportMemoryAllocateInfo-handleTypes-parameter" href="#VUID-VkExportMemoryAllocateInfo-handleTypes-parameter"></a> <span class="vuid">VUID-VkExportMemoryAllocateInfo-handleTypes-parameter</span><br>
 <code>handleTypes</code> <strong>must</strong> be a valid combination of <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When allocating memory that <strong>may</strong> be exported to another process or Vulkan
instance, add a <a href="#VkExportMemoryAllocateInfoNV">VkExportMemoryAllocateInfoNV</a> structure to the
<code>pNext</code> chain of the <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure, specifying
the handle types that <strong>may</strong> be exported.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkExportMemoryAllocateInfoNV">VkExportMemoryAllocateInfoNV</a> structure is defined as:</p>
</div>
<div id="VkExportMemoryAllocateInfoNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_external_memory
typedef struct VkExportMemoryAllocateInfoNV {
    VkStructureType                      sType;
    const void*                          pNext;
    VkExternalMemoryHandleTypeFlagsNV    handleTypes;
} VkExportMemoryAllocateInfoNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>handleTypes</code> is a bitmask of
<a href="#VkExternalMemoryHandleTypeFlagBitsNV">VkExternalMemoryHandleTypeFlagBitsNV</a> specifying one or more memory
handle types that <strong>may</strong> be exported.
Multiple handle types <strong>may</strong> be requested for the same allocation as long
as they are compatible, as reported by
<a href="capabilities.html#vkGetPhysicalDeviceExternalImageFormatPropertiesNV" class="xref page">vkGetPhysicalDeviceExternalImageFormatPropertiesNV</a>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMemoryAllocateInfoNV-sType-sType" href="#VUID-VkExportMemoryAllocateInfoNV-sType-sType"></a> <span class="vuid">VUID-VkExportMemoryAllocateInfoNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_MEMORY_ALLOCATE_INFO_NV</code></p>
</li>
<li>
<p><a id="VUID-VkExportMemoryAllocateInfoNV-handleTypes-parameter" href="#VUID-VkExportMemoryAllocateInfoNV-handleTypes-parameter"></a> <span class="vuid">VUID-VkExportMemoryAllocateInfoNV-handleTypes-parameter</span><br>
 <code>handleTypes</code> <strong>must</strong> be a valid combination of <a href="#VkExternalMemoryHandleTypeFlagBitsNV">VkExternalMemoryHandleTypeFlagBitsNV</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_win32_external_memory"><a class="anchor" href="#_win32_external_memory"></a>Win32 External Memory</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To specify additional attributes of NT handles exported from a memory
object, add a <a href="#VkExportMemoryWin32HandleInfoKHR">VkExportMemoryWin32HandleInfoKHR</a> structure to the
<code>pNext</code> chain of the <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure.
The <code>VkExportMemoryWin32HandleInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkExportMemoryWin32HandleInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_external_memory_win32
typedef struct VkExportMemoryWin32HandleInfoKHR {
    VkStructureType               sType;
    const void*                   pNext;
    const SECURITY_ATTRIBUTES*    pAttributes;
    DWORD                         dwAccess;
    LPCWSTR                       name;
} VkExportMemoryWin32HandleInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>pAttributes</code> is a pointer to a Windows <code>SECURITY_ATTRIBUTES</code>
structure specifying security attributes of the handle.</p>
</li>
<li>
<p><code>dwAccess</code> is a <code>DWORD</code> specifying access rights of the handle.</p>
</li>
<li>
<p><code>name</code> is a null-terminated UTF-16 string to associate with the
payload referenced by NT handles exported from the created memory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <a href="#VkExportMemoryAllocateInfo">VkExportMemoryAllocateInfo</a> is not included in the same <code>pNext</code>
chain, this structure is ignored.</p>
</div>
<div class="paragraph">
<p>If <a href="#VkExportMemoryAllocateInfo">VkExportMemoryAllocateInfo</a> is included in the <code>pNext</code> chain of
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> with a Windows <code>handleType</code>, but either
<code>VkExportMemoryWin32HandleInfoKHR</code> is not included in the <code>pNext</code>
chain, or it is included but <code>pAttributes</code> is set to <code>NULL</code>, default
security descriptor values will be used, and child processes created by the
application will not inherit the handle, as described in the MSDN
documentation for &#8220;Synchronization Object Security and Access Rights&#8221;<sup>1</sup>.
Further, if the structure is not present, the access rights used depend on
the handle type.</p>
</div>
<div class="paragraph">
<p>For handles of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_BIT</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The implementation <strong>must</strong> ensure the access rights allow read and write
access to the memory.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">1</dt>
<dd>
<p><a href="https://docs.microsoft.com/en-us/windows/win32/sync/synchronization-object-security-and-access-rights" class="bare">https://docs.microsoft.com/en-us/windows/win32/sync/synchronization-object-security-and-access-rights</a></p>
</dd>
</dl>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMemoryWin32HandleInfoKHR-handleTypes-00657" href="#VUID-VkExportMemoryWin32HandleInfoKHR-handleTypes-00657"></a> <span class="vuid">VUID-VkExportMemoryWin32HandleInfoKHR-handleTypes-00657</span><br>

If <a href="#VkExportMemoryAllocateInfo">VkExportMemoryAllocateInfo</a>::<code>handleTypes</code> does not include
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_BIT</code>, a
<code>VkExportMemoryWin32HandleInfoKHR</code> structure <strong>must</strong> not be included
in the <code>pNext</code> chain of <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMemoryWin32HandleInfoKHR-sType-sType" href="#VUID-VkExportMemoryWin32HandleInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkExportMemoryWin32HandleInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_MEMORY_WIN32_HANDLE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkExportMemoryWin32HandleInfoKHR-pAttributes-parameter" href="#VUID-VkExportMemoryWin32HandleInfoKHR-pAttributes-parameter"></a> <span class="vuid">VUID-VkExportMemoryWin32HandleInfoKHR-pAttributes-parameter</span><br>
 If <code>pAttributes</code> is not <code>NULL</code>, <code>pAttributes</code> <strong>must</strong> be a valid pointer to a valid <code>SECURITY_ATTRIBUTES</code> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To import memory from a Windows handle, add a
<a href="#VkImportMemoryWin32HandleInfoKHR">VkImportMemoryWin32HandleInfoKHR</a> structure to the <code>pNext</code> chain of
the <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure.</p>
</div>
<div class="paragraph">
<p>The <code>VkImportMemoryWin32HandleInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkImportMemoryWin32HandleInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_external_memory_win32
typedef struct VkImportMemoryWin32HandleInfoKHR {
    VkStructureType                       sType;
    const void*                           pNext;
    VkExternalMemoryHandleTypeFlagBits    handleType;
    HANDLE                                handle;
    LPCWSTR                               name;
} VkImportMemoryWin32HandleInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>handleType</code> is a <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value
specifying the type of <code>handle</code> or <code>name</code>.</p>
</li>
<li>
<p><code>handle</code> is <code>NULL</code> or the external handle to import.</p>
</li>
<li>
<p><code>name</code> is <code>NULL</code> or a null-terminated UTF-16 string naming the
payload to import.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Importing memory object payloads from Windows handles does not transfer
ownership of the handle to the Vulkan implementation.
For handle types defined as NT handles, the application <strong>must</strong> release handle
ownership using the <code>CloseHandle</code> system call when the handle is no
longer needed.
For handle types defined as NT handles, the imported memory object holds a
reference to its payload.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Non-NT handle import operations do not add a reference to their associated
payload.
If the original object owning the payload is destroyed, all resources and
handles sharing that payload will become invalid.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Applications <strong>can</strong> import the same payload into multiple instances of Vulkan,
into the same instance from which it was exported, and multiple times into a
given Vulkan instance.
In all cases, each import operation <strong>must</strong> create a distinct
<code>VkDeviceMemory</code> object.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoKHR-handleType-00658" href="#VUID-VkImportMemoryWin32HandleInfoKHR-handleType-00658"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoKHR-handleType-00658</span><br>

If <code>handleType</code> is not <code>0</code>, it <strong>must</strong> be supported for import, as
reported by <a href="capabilities.html#VkExternalImageFormatProperties" class="xref page">VkExternalImageFormatProperties</a> or
<a href="capabilities.html#VkExternalBufferProperties" class="xref page">VkExternalBufferProperties</a></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoKHR-handle-00659" href="#VUID-VkImportMemoryWin32HandleInfoKHR-handle-00659"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoKHR-handle-00659</span><br>

The memory from which <code>handle</code> was exported, or the memory named by
<code>name</code> <strong>must</strong> have been created on the same underlying physical
device as <code>device</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoKHR-handleType-00660" href="#VUID-VkImportMemoryWin32HandleInfoKHR-handleType-00660"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoKHR-handleType-00660</span><br>

If <code>handleType</code> is not <code>0</code>, it <strong>must</strong> be defined as an NT handle or a
global share handle</p>
</li>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoKHR-handleType-01439" href="#VUID-VkImportMemoryWin32HandleInfoKHR-handleType-01439"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoKHR-handleType-01439</span><br>

If <code>handleType</code> is not
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_BIT</code>,
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D11_TEXTURE_BIT</code>,
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D12_HEAP_BIT</code>, or
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D12_RESOURCE_BIT</code>, <code>name</code>
<strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoKHR-handleType-01440" href="#VUID-VkImportMemoryWin32HandleInfoKHR-handleType-01440"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoKHR-handleType-01440</span><br>

If <code>handleType</code> is not <code>0</code> and <code>handle</code> is <code>NULL</code>, <code>name</code>
<strong>must</strong> name a valid memory resource of the type specified by
<code>handleType</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoKHR-handleType-00661" href="#VUID-VkImportMemoryWin32HandleInfoKHR-handleType-00661"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoKHR-handleType-00661</span><br>

If <code>handleType</code> is not <code>0</code> and <code>name</code> is <code>NULL</code>, <code>handle</code>
<strong>must</strong> be a valid handle of the type specified by <code>handleType</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoKHR-handle-01441" href="#VUID-VkImportMemoryWin32HandleInfoKHR-handle-01441"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoKHR-handle-01441</span><br>

If <code>handle</code> is not <code>NULL</code>, <code>name</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoKHR-handle-01518" href="#VUID-VkImportMemoryWin32HandleInfoKHR-handle-01518"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoKHR-handle-01518</span><br>

If <code>handle</code> is not <code>NULL</code>, it <strong>must</strong> obey any requirements listed for
<code>handleType</code> in
<a href="capabilities.html#external-memory-handle-types-compatibility" class="xref page">external memory handle    types compatibility</a></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoKHR-name-01519" href="#VUID-VkImportMemoryWin32HandleInfoKHR-name-01519"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoKHR-name-01519</span><br>

If <code>name</code> is not <code>NULL</code>, it <strong>must</strong> obey any requirements listed for
<code>handleType</code> in
<a href="capabilities.html#external-memory-handle-types-compatibility" class="xref page">external memory handle    types compatibility</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoKHR-sType-sType" href="#VUID-VkImportMemoryWin32HandleInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_MEMORY_WIN32_HANDLE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoKHR-handleType-parameter" href="#VUID-VkImportMemoryWin32HandleInfoKHR-handleType-parameter"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoKHR-handleType-parameter</span><br>
 If <code>handleType</code> is not <code>0</code>, <code>handleType</code> <strong>must</strong> be a valid <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export a Windows handle representing the payload of a Vulkan device
memory object, call:</p>
</div>
<div id="vkGetMemoryWin32HandleKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_external_memory_win32
VkResult vkGetMemoryWin32HandleKHR(
    VkDevice                                    device,
    const VkMemoryGetWin32HandleInfoKHR*        pGetWin32HandleInfo,
    HANDLE*                                     pHandle);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that created the device memory being
exported.</p>
</li>
<li>
<p><code>pGetWin32HandleInfo</code> is a pointer to a
<a href="#VkMemoryGetWin32HandleInfoKHR">VkMemoryGetWin32HandleInfoKHR</a> structure containing parameters of
the export operation.</p>
</li>
<li>
<p><code>pHandle</code> will return the Windows handle representing the payload of
the device memory object.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For handle types defined as NT handles, the handles returned by
<code>vkGetMemoryWin32HandleKHR</code> are owned by the application and hold a
reference to their payload.
To avoid leaking resources, the application <strong>must</strong> release ownership of them
using the <code>CloseHandle</code> system call when they are no longer needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Non-NT handle types do not add a reference to their associated payload.
If the original object owning the payload is destroyed, all resources and
handles sharing that payload will become invalid.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryWin32HandleKHR-device-parameter" href="#VUID-vkGetMemoryWin32HandleKHR-device-parameter"></a> <span class="vuid">VUID-vkGetMemoryWin32HandleKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryWin32HandleKHR-pGetWin32HandleInfo-parameter" href="#VUID-vkGetMemoryWin32HandleKHR-pGetWin32HandleInfo-parameter"></a> <span class="vuid">VUID-vkGetMemoryWin32HandleKHR-pGetWin32HandleInfo-parameter</span><br>
 <code>pGetWin32HandleInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkMemoryGetWin32HandleInfoKHR">VkMemoryGetWin32HandleInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryWin32HandleKHR-pHandle-parameter" href="#VUID-vkGetMemoryWin32HandleKHR-pHandle-parameter"></a> <span class="vuid">VUID-vkGetMemoryWin32HandleKHR-pHandle-parameter</span><br>
 <code>pHandle</code> <strong>must</strong> be a valid pointer to a <code>HANDLE</code> value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_TOO_MANY_OBJECTS</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMemoryGetWin32HandleInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkMemoryGetWin32HandleInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_external_memory_win32
typedef struct VkMemoryGetWin32HandleInfoKHR {
    VkStructureType                       sType;
    const void*                           pNext;
    VkDeviceMemory                        memory;
    VkExternalMemoryHandleTypeFlagBits    handleType;
} VkMemoryGetWin32HandleInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>memory</code> is the memory object from which the handle will be
exported.</p>
</li>
<li>
<p><code>handleType</code> is a <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value
specifying the type of handle requested.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The properties of the handle returned depend on the value of
<code>handleType</code>.
See <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> for a description of the
properties of the defined external memory handle types.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryGetWin32HandleInfoKHR-handleType-00662" href="#VUID-VkMemoryGetWin32HandleInfoKHR-handleType-00662"></a> <span class="vuid">VUID-VkMemoryGetWin32HandleInfoKHR-handleType-00662</span><br>

<code>handleType</code> <strong>must</strong> have been included in
<a href="#VkExportMemoryAllocateInfo">VkExportMemoryAllocateInfo</a>::<code>handleTypes</code> when <code>memory</code>
was created</p>
</li>
<li>
<p><a id="VUID-VkMemoryGetWin32HandleInfoKHR-handleType-00663" href="#VUID-VkMemoryGetWin32HandleInfoKHR-handleType-00663"></a> <span class="vuid">VUID-VkMemoryGetWin32HandleInfoKHR-handleType-00663</span><br>

If <code>handleType</code> is defined as an NT handle,
<a href="#vkGetMemoryWin32HandleKHR">vkGetMemoryWin32HandleKHR</a> <strong>must</strong> be called no more than once for
each valid unique combination of <code>memory</code> and <code>handleType</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryGetWin32HandleInfoKHR-handleType-00664" href="#VUID-VkMemoryGetWin32HandleInfoKHR-handleType-00664"></a> <span class="vuid">VUID-VkMemoryGetWin32HandleInfoKHR-handleType-00664</span><br>

<code>handleType</code> <strong>must</strong> be defined as an NT handle or a global share
handle</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryGetWin32HandleInfoKHR-sType-sType" href="#VUID-VkMemoryGetWin32HandleInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkMemoryGetWin32HandleInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_GET_WIN32_HANDLE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryGetWin32HandleInfoKHR-pNext-pNext" href="#VUID-VkMemoryGetWin32HandleInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkMemoryGetWin32HandleInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryGetWin32HandleInfoKHR-memory-parameter" href="#VUID-VkMemoryGetWin32HandleInfoKHR-memory-parameter"></a> <span class="vuid">VUID-VkMemoryGetWin32HandleInfoKHR-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
<li>
<p><a id="VUID-VkMemoryGetWin32HandleInfoKHR-handleType-parameter" href="#VUID-VkMemoryGetWin32HandleInfoKHR-handleType-parameter"></a> <span class="vuid">VUID-VkMemoryGetWin32HandleInfoKHR-handleType-parameter</span><br>
 <code>handleType</code> <strong>must</strong> be a valid <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Windows memory handles compatible with Vulkan <strong>may</strong> also be created by
non-Vulkan APIs using methods beyond the scope of this specification.
To determine the correct parameters to use when importing such handles,
call:</p>
</div>
<div id="vkGetMemoryWin32HandlePropertiesKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_external_memory_win32
VkResult vkGetMemoryWin32HandlePropertiesKHR(
    VkDevice                                    device,
    VkExternalMemoryHandleTypeFlagBits          handleType,
    HANDLE                                      handle,
    VkMemoryWin32HandlePropertiesKHR*           pMemoryWin32HandleProperties);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that will be importing <code>handle</code>.</p>
</li>
<li>
<p><code>handleType</code> is a <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value
specifying the type of the handle <code>handle</code>.</p>
</li>
<li>
<p><code>handle</code> is the handle which will be imported.</p>
</li>
<li>
<p><code>pMemoryWin32HandleProperties</code> is a pointer to a
<a href="#VkMemoryWin32HandlePropertiesKHR">VkMemoryWin32HandlePropertiesKHR</a> structure in which properties of
<code>handle</code> are returned.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryWin32HandlePropertiesKHR-handle-00665" href="#VUID-vkGetMemoryWin32HandlePropertiesKHR-handle-00665"></a> <span class="vuid">VUID-vkGetMemoryWin32HandlePropertiesKHR-handle-00665</span><br>

<code>handle</code> <strong>must</strong> point to a valid Windows memory handle</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryWin32HandlePropertiesKHR-handleType-00666" href="#VUID-vkGetMemoryWin32HandlePropertiesKHR-handleType-00666"></a> <span class="vuid">VUID-vkGetMemoryWin32HandlePropertiesKHR-handleType-00666</span><br>

<code>handleType</code> <strong>must</strong> not be one of the handle types defined as opaque</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryWin32HandlePropertiesKHR-device-parameter" href="#VUID-vkGetMemoryWin32HandlePropertiesKHR-device-parameter"></a> <span class="vuid">VUID-vkGetMemoryWin32HandlePropertiesKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryWin32HandlePropertiesKHR-handleType-parameter" href="#VUID-vkGetMemoryWin32HandlePropertiesKHR-handleType-parameter"></a> <span class="vuid">VUID-vkGetMemoryWin32HandlePropertiesKHR-handleType-parameter</span><br>
 <code>handleType</code> <strong>must</strong> be a valid <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryWin32HandlePropertiesKHR-pMemoryWin32HandleProperties-parameter" href="#VUID-vkGetMemoryWin32HandlePropertiesKHR-pMemoryWin32HandleProperties-parameter"></a> <span class="vuid">VUID-vkGetMemoryWin32HandlePropertiesKHR-pMemoryWin32HandleProperties-parameter</span><br>
 <code>pMemoryWin32HandleProperties</code> <strong>must</strong> be a valid pointer to a <a href="#VkMemoryWin32HandlePropertiesKHR">VkMemoryWin32HandlePropertiesKHR</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_INVALID_EXTERNAL_HANDLE</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMemoryWin32HandlePropertiesKHR</code> structure returned is defined as:</p>
</div>
<div id="VkMemoryWin32HandlePropertiesKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_external_memory_win32
typedef struct VkMemoryWin32HandlePropertiesKHR {
    VkStructureType    sType;
    void*              pNext;
    uint32_t           memoryTypeBits;
} VkMemoryWin32HandlePropertiesKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>memoryTypeBits</code> is a bitmask containing one bit set for every
memory type which the specified windows handle <strong>can</strong> be imported as.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryWin32HandlePropertiesKHR-sType-sType" href="#VUID-VkMemoryWin32HandlePropertiesKHR-sType-sType"></a> <span class="vuid">VUID-VkMemoryWin32HandlePropertiesKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_WIN32_HANDLE_PROPERTIES_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryWin32HandlePropertiesKHR-pNext-pNext" href="#VUID-VkMemoryWin32HandlePropertiesKHR-pNext-pNext"></a> <span class="vuid">VUID-VkMemoryWin32HandlePropertiesKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>When <a href="#VkExportMemoryAllocateInfoNV">VkExportMemoryAllocateInfoNV</a>::<code>handleTypes</code> includes
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_BIT_NV</code>, add a
<code>VkExportMemoryWin32HandleInfoNV</code> structure to the <code>pNext</code> chain of
the <a href="#VkExportMemoryAllocateInfoNV">VkExportMemoryAllocateInfoNV</a> structure to specify security
attributes and access rights for the memory object&#8217;s external handle.</p>
</div>
<div class="paragraph">
<p>The <code>VkExportMemoryWin32HandleInfoNV</code> structure is defined as:</p>
</div>
<div id="VkExportMemoryWin32HandleInfoNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_external_memory_win32
typedef struct VkExportMemoryWin32HandleInfoNV {
    VkStructureType               sType;
    const void*                   pNext;
    const SECURITY_ATTRIBUTES*    pAttributes;
    DWORD                         dwAccess;
} VkExportMemoryWin32HandleInfoNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>pAttributes</code> is a pointer to a Windows <code>SECURITY_ATTRIBUTES</code>
structure specifying security attributes of the handle.</p>
</li>
<li>
<p><code>dwAccess</code> is a <code>DWORD</code> specifying access rights of the handle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If this structure is not present, or if <code>pAttributes</code> is set to <code>NULL</code>,
default security descriptor values will be used, and child processes created
by the application will not inherit the handle, as described in the MSDN
documentation for &#8220;Synchronization Object Security and Access Rights&#8221;<sup>1</sup>.
Further, if the structure is not present, the access rights will be</p>
</div>
<div class="paragraph">
<p><code>DXGI_SHARED_RESOURCE_READ</code> | <code>DXGI_SHARED_RESOURCE_WRITE</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">1</dt>
<dd>
<p><a href="https://docs.microsoft.com/en-us/windows/win32/sync/synchronization-object-security-and-access-rights" class="bare">https://docs.microsoft.com/en-us/windows/win32/sync/synchronization-object-security-and-access-rights</a></p>
</dd>
</dl>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMemoryWin32HandleInfoNV-sType-sType" href="#VUID-VkExportMemoryWin32HandleInfoNV-sType-sType"></a> <span class="vuid">VUID-VkExportMemoryWin32HandleInfoNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_MEMORY_WIN32_HANDLE_INFO_NV</code></p>
</li>
<li>
<p><a id="VUID-VkExportMemoryWin32HandleInfoNV-pAttributes-parameter" href="#VUID-VkExportMemoryWin32HandleInfoNV-pAttributes-parameter"></a> <span class="vuid">VUID-VkExportMemoryWin32HandleInfoNV-pAttributes-parameter</span><br>
 If <code>pAttributes</code> is not <code>NULL</code>, <code>pAttributes</code> <strong>must</strong> be a valid pointer to a valid <code>SECURITY_ATTRIBUTES</code> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To import memory created on the same physical device but outside of the
current Vulkan instance, add a <a href="#VkImportMemoryWin32HandleInfoNV">VkImportMemoryWin32HandleInfoNV</a>
structure to the <code>pNext</code> chain of the <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a>
structure, specifying a handle to and the type of the memory.</p>
</div>
<div class="paragraph">
<p>The <code>VkImportMemoryWin32HandleInfoNV</code> structure is defined as:</p>
</div>
<div id="VkImportMemoryWin32HandleInfoNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_external_memory_win32
typedef struct VkImportMemoryWin32HandleInfoNV {
    VkStructureType                      sType;
    const void*                          pNext;
    VkExternalMemoryHandleTypeFlagsNV    handleType;
    HANDLE                               handle;
} VkImportMemoryWin32HandleInfoNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>handleType</code> is <code>0</code> or a <a href="#VkExternalMemoryHandleTypeFlagBitsNV">VkExternalMemoryHandleTypeFlagBitsNV</a>
value specifying the type of memory handle in <code>handle</code>.</p>
</li>
<li>
<p><code>handle</code> is a Windows <code>HANDLE</code> referring to the memory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>handleType</code> is <code>0</code>, this structure is ignored by consumers of the
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure it is chained from.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoNV-handleType-01327" href="#VUID-VkImportMemoryWin32HandleInfoNV-handleType-01327"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoNV-handleType-01327</span><br>

<code>handleType</code> <strong>must</strong> not have more than one bit set</p>
</li>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoNV-handle-01328" href="#VUID-VkImportMemoryWin32HandleInfoNV-handle-01328"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoNV-handle-01328</span><br>

<code>handle</code> <strong>must</strong> be a valid handle to memory, obtained as specified by
<code>handleType</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoNV-sType-sType" href="#VUID-VkImportMemoryWin32HandleInfoNV-sType-sType"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_MEMORY_WIN32_HANDLE_INFO_NV</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryWin32HandleInfoNV-handleType-parameter" href="#VUID-VkImportMemoryWin32HandleInfoNV-handleType-parameter"></a> <span class="vuid">VUID-VkImportMemoryWin32HandleInfoNV-handleType-parameter</span><br>
 <code>handleType</code> <strong>must</strong> be a valid combination of <a href="#VkExternalMemoryHandleTypeFlagBitsNV">VkExternalMemoryHandleTypeFlagBitsNV</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Bits which <strong>can</strong> be set in <code>handleType</code> are:</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Possible values of <a href="#VkImportMemoryWin32HandleInfoNV">VkImportMemoryWin32HandleInfoNV</a>::<code>handleType</code>,
specifying the type of an external memory handle, are:</p>
</div>
<div id="VkExternalMemoryHandleTypeFlagBitsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_external_memory_capabilities
typedef enum VkExternalMemoryHandleTypeFlagBitsNV {
    VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_BIT_NV = 0x00000001,
    VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_KMT_BIT_NV = 0x00000002,
    VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D11_IMAGE_BIT_NV = 0x00000004,
    VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D11_IMAGE_KMT_BIT_NV = 0x00000008,
} VkExternalMemoryHandleTypeFlagBitsNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_KMT_BIT_NV</code> specifies a
handle to memory returned by <a href="#vkGetMemoryWin32HandleNV">vkGetMemoryWin32HandleNV</a>.</p>
</li>
<li>
<p><code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_BIT_NV</code> specifies a
handle to memory returned by <a href="#vkGetMemoryWin32HandleNV">vkGetMemoryWin32HandleNV</a>, or one
duplicated from such a handle using <code>DuplicateHandle()</code>.</p>
</li>
<li>
<p><code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D11_IMAGE_BIT_NV</code> specifies a
valid NT handle to memory returned by
<code>IDXGIResource1::CreateSharedHandle</code>, or a handle duplicated from such a
handle using <code>DuplicateHandle()</code>.</p>
</li>
<li>
<p><code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_D3D11_IMAGE_KMT_BIT_NV</code> specifies a
handle to memory returned by <code>IDXGIResource::GetSharedHandle()</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkExternalMemoryHandleTypeFlagsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_external_memory_capabilities
typedef VkFlags VkExternalMemoryHandleTypeFlagsNV;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkExternalMemoryHandleTypeFlagsNV</code> is a bitmask type for setting a mask
of zero or more <a href="#VkExternalMemoryHandleTypeFlagBitsNV">VkExternalMemoryHandleTypeFlagBitsNV</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To retrieve the handle corresponding to a device memory object created with
<a href="#VkExportMemoryAllocateInfoNV">VkExportMemoryAllocateInfoNV</a>::<code>handleTypes</code> set to include
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_BIT_NV</code> or
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_WIN32_KMT_BIT_NV</code>, call:</p>
</div>
<div id="vkGetMemoryWin32HandleNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_external_memory_win32
VkResult vkGetMemoryWin32HandleNV(
    VkDevice                                    device,
    VkDeviceMemory                              memory,
    VkExternalMemoryHandleTypeFlagsNV           handleType,
    HANDLE*                                     pHandle);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the memory.</p>
</li>
<li>
<p><code>memory</code> is the <a href="#VkDeviceMemory">VkDeviceMemory</a> object.</p>
</li>
<li>
<p><code>handleType</code> is a bitmask of
<a href="#VkExternalMemoryHandleTypeFlagBitsNV">VkExternalMemoryHandleTypeFlagBitsNV</a> containing a single bit
specifying the type of handle requested.</p>
</li>
<li>
<p><code>handle</code> is a pointer to a Windows <code>HANDLE</code> in which the handle
is returned.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryWin32HandleNV-handleType-01326" href="#VUID-vkGetMemoryWin32HandleNV-handleType-01326"></a> <span class="vuid">VUID-vkGetMemoryWin32HandleNV-handleType-01326</span><br>

<code>handleType</code> <strong>must</strong> be a flag specified in
<a href="#VkExportMemoryAllocateInfoNV">VkExportMemoryAllocateInfoNV</a>::<code>handleTypes</code> when allocating
<code>memory</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryWin32HandleNV-device-parameter" href="#VUID-vkGetMemoryWin32HandleNV-device-parameter"></a> <span class="vuid">VUID-vkGetMemoryWin32HandleNV-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryWin32HandleNV-memory-parameter" href="#VUID-vkGetMemoryWin32HandleNV-memory-parameter"></a> <span class="vuid">VUID-vkGetMemoryWin32HandleNV-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryWin32HandleNV-handleType-parameter" href="#VUID-vkGetMemoryWin32HandleNV-handleType-parameter"></a> <span class="vuid">VUID-vkGetMemoryWin32HandleNV-handleType-parameter</span><br>
 <code>handleType</code> <strong>must</strong> be a valid combination of <a href="#VkExternalMemoryHandleTypeFlagBitsNV">VkExternalMemoryHandleTypeFlagBitsNV</a> values</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryWin32HandleNV-handleType-requiredbitmask" href="#VUID-vkGetMemoryWin32HandleNV-handleType-requiredbitmask"></a> <span class="vuid">VUID-vkGetMemoryWin32HandleNV-handleType-requiredbitmask</span><br>
 <code>handleType</code> <strong>must</strong> not be <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkGetMemoryWin32HandleNV-pHandle-parameter" href="#VUID-vkGetMemoryWin32HandleNV-pHandle-parameter"></a> <span class="vuid">VUID-vkGetMemoryWin32HandleNV-pHandle-parameter</span><br>
 <code>pHandle</code> <strong>must</strong> be a valid pointer to a <code>HANDLE</code> value</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryWin32HandleNV-memory-parent" href="#VUID-vkGetMemoryWin32HandleNV-memory-parent"></a> <span class="vuid">VUID-vkGetMemoryWin32HandleNV-memory-parent</span><br>
 <code>memory</code> <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_TOO_MANY_OBJECTS</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_file_descriptor_external_memory"><a class="anchor" href="#_file_descriptor_external_memory"></a>File Descriptor External Memory</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To import memory from a POSIX file descriptor handle, add a
<a href="#VkImportMemoryFdInfoKHR">VkImportMemoryFdInfoKHR</a> structure to the <code>pNext</code> chain of the
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure.
The <code>VkImportMemoryFdInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkImportMemoryFdInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_external_memory_fd
typedef struct VkImportMemoryFdInfoKHR {
    VkStructureType                       sType;
    const void*                           pNext;
    VkExternalMemoryHandleTypeFlagBits    handleType;
    int                                   fd;
} VkImportMemoryFdInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>handleType</code> is a <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value
specifying the handle type of <code>fd</code>.</p>
</li>
<li>
<p><code>fd</code> is the external handle to import.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Importing memory from a file descriptor transfers ownership of the file
descriptor from the application to the Vulkan implementation.
The application <strong>must</strong> not perform any operations on the file descriptor
after a successful import.
The imported memory object holds a reference to its payload.</p>
</div>
<div class="paragraph">
<p>Applications <strong>can</strong> import the same payload into multiple instances of Vulkan,
into the same instance from which it was exported, and multiple times into a
given Vulkan instance.
In all cases, each import operation <strong>must</strong> create a distinct
<code>VkDeviceMemory</code> object.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportMemoryFdInfoKHR-handleType-00667" href="#VUID-VkImportMemoryFdInfoKHR-handleType-00667"></a> <span class="vuid">VUID-VkImportMemoryFdInfoKHR-handleType-00667</span><br>

If <code>handleType</code> is not <code>0</code>, it <strong>must</strong> be supported for import, as
reported by <a href="capabilities.html#VkExternalImageFormatProperties" class="xref page">VkExternalImageFormatProperties</a> or
<a href="capabilities.html#VkExternalBufferProperties" class="xref page">VkExternalBufferProperties</a></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryFdInfoKHR-fd-00668" href="#VUID-VkImportMemoryFdInfoKHR-fd-00668"></a> <span class="vuid">VUID-VkImportMemoryFdInfoKHR-fd-00668</span><br>

The memory from which <code>fd</code> was exported <strong>must</strong> have been created on
the same underlying physical device as <code>device</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryFdInfoKHR-handleType-00669" href="#VUID-VkImportMemoryFdInfoKHR-handleType-00669"></a> <span class="vuid">VUID-VkImportMemoryFdInfoKHR-handleType-00669</span><br>

If <code>handleType</code> is not <code>0</code>, it <strong>must</strong> be
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_FD_BIT</code> or
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_DMA_BUF_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryFdInfoKHR-handleType-00670" href="#VUID-VkImportMemoryFdInfoKHR-handleType-00670"></a> <span class="vuid">VUID-VkImportMemoryFdInfoKHR-handleType-00670</span><br>

If <code>handleType</code> is not <code>0</code>, <code>fd</code> <strong>must</strong> be a valid handle of the
type specified by <code>handleType</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryFdInfoKHR-fd-01746" href="#VUID-VkImportMemoryFdInfoKHR-fd-01746"></a> <span class="vuid">VUID-VkImportMemoryFdInfoKHR-fd-01746</span><br>

The memory represented by <code>fd</code> <strong>must</strong> have been created from a
physical device and driver that is compatible with <code>device</code> and
<code>handleType</code>, as described in
<a href="capabilities.html#external-memory-handle-types-compatibility" class="xref page">External memory handle types compatibility</a></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryFdInfoKHR-fd-01520" href="#VUID-VkImportMemoryFdInfoKHR-fd-01520"></a> <span class="vuid">VUID-VkImportMemoryFdInfoKHR-fd-01520</span><br>

<code>fd</code> <strong>must</strong> obey any requirements listed for <code>handleType</code> in
<a href="capabilities.html#external-memory-handle-types-compatibility" class="xref page">external memory handle    types compatibility</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportMemoryFdInfoKHR-sType-sType" href="#VUID-VkImportMemoryFdInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkImportMemoryFdInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_MEMORY_FD_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryFdInfoKHR-handleType-parameter" href="#VUID-VkImportMemoryFdInfoKHR-handleType-parameter"></a> <span class="vuid">VUID-VkImportMemoryFdInfoKHR-handleType-parameter</span><br>
 If <code>handleType</code> is not <code>0</code>, <code>handleType</code> <strong>must</strong> be a valid <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export a POSIX file descriptor referencing the payload of a Vulkan device
memory object, call:</p>
</div>
<div id="vkGetMemoryFdKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_external_memory_fd
VkResult vkGetMemoryFdKHR(
    VkDevice                                    device,
    const VkMemoryGetFdInfoKHR*                 pGetFdInfo,
    int*                                        pFd);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that created the device memory being
exported.</p>
</li>
<li>
<p><code>pGetFdInfo</code> is a pointer to a <a href="#VkMemoryGetFdInfoKHR">VkMemoryGetFdInfoKHR</a> structure
containing parameters of the export operation.</p>
</li>
<li>
<p><code>pFd</code> will return a file descriptor referencing the payload of the
device memory object.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each call to <code>vkGetMemoryFdKHR</code> <strong>must</strong> create a new file descriptor
holding a reference to the memory object&#8217;s payload and transfer ownership of
the file descriptor to the application.
To avoid leaking resources, the application <strong>must</strong> release ownership of the
file descriptor using the <code>close</code> system call when it is no longer
needed, or by importing a Vulkan memory object from it.
Where supported by the operating system, the implementation <strong>must</strong> set the
file descriptor to be closed automatically when an <code>execve</code> system call
is made.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryFdKHR-device-parameter" href="#VUID-vkGetMemoryFdKHR-device-parameter"></a> <span class="vuid">VUID-vkGetMemoryFdKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryFdKHR-pGetFdInfo-parameter" href="#VUID-vkGetMemoryFdKHR-pGetFdInfo-parameter"></a> <span class="vuid">VUID-vkGetMemoryFdKHR-pGetFdInfo-parameter</span><br>
 <code>pGetFdInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkMemoryGetFdInfoKHR">VkMemoryGetFdInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryFdKHR-pFd-parameter" href="#VUID-vkGetMemoryFdKHR-pFd-parameter"></a> <span class="vuid">VUID-vkGetMemoryFdKHR-pFd-parameter</span><br>
 <code>pFd</code> <strong>must</strong> be a valid pointer to an <code>int</code> value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_TOO_MANY_OBJECTS</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMemoryGetFdInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkMemoryGetFdInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_external_memory_fd
typedef struct VkMemoryGetFdInfoKHR {
    VkStructureType                       sType;
    const void*                           pNext;
    VkDeviceMemory                        memory;
    VkExternalMemoryHandleTypeFlagBits    handleType;
} VkMemoryGetFdInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>memory</code> is the memory object from which the handle will be
exported.</p>
</li>
<li>
<p><code>handleType</code> is a <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value
specifying the type of handle requested.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The properties of the file descriptor exported depend on the value of
<code>handleType</code>.
See <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> for a description of the
properties of the defined external memory handle types.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The size of the exported file <strong>may</strong> be larger than the size requested by
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a>::<code>allocationSize</code>.
If <code>handleType</code> is <code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_DMA_BUF_BIT_EXT</code>,
then the application <strong>can</strong> query the file&#8217;s actual size with
<a href="https://man7.org/linux/man-pages/man2/lseek.2.html"><code>lseek</code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryGetFdInfoKHR-handleType-00671" href="#VUID-VkMemoryGetFdInfoKHR-handleType-00671"></a> <span class="vuid">VUID-VkMemoryGetFdInfoKHR-handleType-00671</span><br>

<code>handleType</code> <strong>must</strong> have been included in
<a href="#VkExportMemoryAllocateInfo">VkExportMemoryAllocateInfo</a>::<code>handleTypes</code> when <code>memory</code>
was created</p>
</li>
<li>
<p><a id="VUID-VkMemoryGetFdInfoKHR-handleType-00672" href="#VUID-VkMemoryGetFdInfoKHR-handleType-00672"></a> <span class="vuid">VUID-VkMemoryGetFdInfoKHR-handleType-00672</span><br>

<code>handleType</code> <strong>must</strong> be
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_FD_BIT</code> or
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_DMA_BUF_BIT_EXT</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryGetFdInfoKHR-sType-sType" href="#VUID-VkMemoryGetFdInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkMemoryGetFdInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_GET_FD_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryGetFdInfoKHR-pNext-pNext" href="#VUID-VkMemoryGetFdInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkMemoryGetFdInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryGetFdInfoKHR-memory-parameter" href="#VUID-VkMemoryGetFdInfoKHR-memory-parameter"></a> <span class="vuid">VUID-VkMemoryGetFdInfoKHR-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
<li>
<p><a id="VUID-VkMemoryGetFdInfoKHR-handleType-parameter" href="#VUID-VkMemoryGetFdInfoKHR-handleType-parameter"></a> <span class="vuid">VUID-VkMemoryGetFdInfoKHR-handleType-parameter</span><br>
 <code>handleType</code> <strong>must</strong> be a valid <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>POSIX file descriptor memory handles compatible with Vulkan <strong>may</strong> also be
created by non-Vulkan APIs using methods beyond the scope of this
specification.
To determine the correct parameters to use when importing such handles,
call:</p>
</div>
<div id="vkGetMemoryFdPropertiesKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_external_memory_fd
VkResult vkGetMemoryFdPropertiesKHR(
    VkDevice                                    device,
    VkExternalMemoryHandleTypeFlagBits          handleType,
    int                                         fd,
    VkMemoryFdPropertiesKHR*                    pMemoryFdProperties);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that will be importing <code>fd</code>.</p>
</li>
<li>
<p><code>handleType</code> is a <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value
specifying the type of the handle <code>fd</code>.</p>
</li>
<li>
<p><code>fd</code> is the handle which will be imported.</p>
</li>
<li>
<p><code>pMemoryFdProperties</code> is a pointer to a
<a href="#VkMemoryFdPropertiesKHR">VkMemoryFdPropertiesKHR</a> structure in which the properties of the
handle <code>fd</code> are returned.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryFdPropertiesKHR-fd-00673" href="#VUID-vkGetMemoryFdPropertiesKHR-fd-00673"></a> <span class="vuid">VUID-vkGetMemoryFdPropertiesKHR-fd-00673</span><br>

<code>fd</code> <strong>must</strong> point to a valid POSIX file descriptor memory handle</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryFdPropertiesKHR-handleType-00674" href="#VUID-vkGetMemoryFdPropertiesKHR-handleType-00674"></a> <span class="vuid">VUID-vkGetMemoryFdPropertiesKHR-handleType-00674</span><br>

<code>handleType</code> <strong>must</strong> not be
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_FD_BIT</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryFdPropertiesKHR-device-parameter" href="#VUID-vkGetMemoryFdPropertiesKHR-device-parameter"></a> <span class="vuid">VUID-vkGetMemoryFdPropertiesKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryFdPropertiesKHR-handleType-parameter" href="#VUID-vkGetMemoryFdPropertiesKHR-handleType-parameter"></a> <span class="vuid">VUID-vkGetMemoryFdPropertiesKHR-handleType-parameter</span><br>
 <code>handleType</code> <strong>must</strong> be a valid <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryFdPropertiesKHR-pMemoryFdProperties-parameter" href="#VUID-vkGetMemoryFdPropertiesKHR-pMemoryFdProperties-parameter"></a> <span class="vuid">VUID-vkGetMemoryFdPropertiesKHR-pMemoryFdProperties-parameter</span><br>
 <code>pMemoryFdProperties</code> <strong>must</strong> be a valid pointer to a <a href="#VkMemoryFdPropertiesKHR">VkMemoryFdPropertiesKHR</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_INVALID_EXTERNAL_HANDLE</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMemoryFdPropertiesKHR</code> structure returned is defined as:</p>
</div>
<div id="VkMemoryFdPropertiesKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_external_memory_fd
typedef struct VkMemoryFdPropertiesKHR {
    VkStructureType    sType;
    void*              pNext;
    uint32_t           memoryTypeBits;
} VkMemoryFdPropertiesKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>memoryTypeBits</code> is a bitmask containing one bit set for every
memory type which the specified file descriptor <strong>can</strong> be imported as.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryFdPropertiesKHR-sType-sType" href="#VUID-VkMemoryFdPropertiesKHR-sType-sType"></a> <span class="vuid">VUID-VkMemoryFdPropertiesKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_FD_PROPERTIES_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryFdPropertiesKHR-pNext-pNext" href="#VUID-VkMemoryFdPropertiesKHR-pNext-pNext"></a> <span class="vuid">VUID-VkMemoryFdPropertiesKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_host_external_memory"><a class="anchor" href="#_host_external_memory"></a>Host External Memory</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To import memory from a host pointer, add a
<a href="#VkImportMemoryHostPointerInfoEXT">VkImportMemoryHostPointerInfoEXT</a> structure to the <code>pNext</code> chain of
the <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure.
The <code>VkImportMemoryHostPointerInfoEXT</code> structure is defined as:</p>
</div>
<div id="VkImportMemoryHostPointerInfoEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_external_memory_host
typedef struct VkImportMemoryHostPointerInfoEXT {
    VkStructureType                       sType;
    const void*                           pNext;
    VkExternalMemoryHandleTypeFlagBits    handleType;
    void*                                 pHostPointer;
} VkImportMemoryHostPointerInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>handleType</code> is a <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value
specifying the handle type.</p>
</li>
<li>
<p><code>pHostPointer</code> is the host pointer to import from.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Importing memory from a host pointer shares ownership of the memory between
the host and the Vulkan implementation.
The application <strong>can</strong> continue to access the memory through the host pointer
but it is the application&#8217;s responsibility to synchronize device and
non-device access to the payload as defined in
<a href="#memory-device-hostaccess">Host Access to Device Memory Objects</a>.</p>
</div>
<div class="paragraph">
<p>Applications <strong>can</strong> import the same payload into multiple instances of Vulkan
and multiple times into a given Vulkan instance.
However, implementations <strong>may</strong> fail to import the same payload multiple times
into a given physical device due to platform constraints.</p>
</div>
<div class="paragraph">
<p>Importing memory from a particular host pointer <strong>may</strong> not be possible due to
additional platform-specific restrictions beyond the scope of this
specification in which case the implementation <strong>must</strong> fail the memory import
operation with the error code <code>VK_ERROR_INVALID_EXTERNAL_HANDLE_KHR</code>.</p>
</div>
<div class="paragraph">
<p>Whether device memory objects imported from a host pointer hold a reference
to their payload is <strong>undefined</strong>.
As such, the application <strong>must</strong> ensure that the imported memory range remains
valid and accessible for the lifetime of the imported memory object.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportMemoryHostPointerInfoEXT-handleType-01747" href="#VUID-VkImportMemoryHostPointerInfoEXT-handleType-01747"></a> <span class="vuid">VUID-VkImportMemoryHostPointerInfoEXT-handleType-01747</span><br>

If <code>handleType</code> is not <code>0</code>, it <strong>must</strong> be supported for import, as
reported in <a href="capabilities.html#VkExternalMemoryProperties" class="xref page">VkExternalMemoryProperties</a></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryHostPointerInfoEXT-handleType-01748" href="#VUID-VkImportMemoryHostPointerInfoEXT-handleType-01748"></a> <span class="vuid">VUID-VkImportMemoryHostPointerInfoEXT-handleType-01748</span><br>

If <code>handleType</code> is not <code>0</code>, it <strong>must</strong> be
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_HOST_ALLOCATION_BIT_EXT</code> or
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_HOST_MAPPED_FOREIGN_MEMORY_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryHostPointerInfoEXT-pHostPointer-01749" href="#VUID-VkImportMemoryHostPointerInfoEXT-pHostPointer-01749"></a> <span class="vuid">VUID-VkImportMemoryHostPointerInfoEXT-pHostPointer-01749</span><br>

<code>pHostPointer</code> <strong>must</strong> be a pointer aligned to an integer multiple of
<code>VkPhysicalDeviceExternalMemoryHostPropertiesEXT</code>::<code>minImportedHostPointerAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryHostPointerInfoEXT-handleType-01750" href="#VUID-VkImportMemoryHostPointerInfoEXT-handleType-01750"></a> <span class="vuid">VUID-VkImportMemoryHostPointerInfoEXT-handleType-01750</span><br>

If <code>handleType</code> is
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_HOST_ALLOCATION_BIT_EXT</code>,
<code>pHostPointer</code> <strong>must</strong> be a pointer to <code>allocationSize</code> number of
bytes of host memory, where <code>allocationSize</code> is the member of the
<code>VkMemoryAllocateInfo</code> structure this structure is chained to</p>
</li>
<li>
<p><a id="VUID-VkImportMemoryHostPointerInfoEXT-handleType-01751" href="#VUID-VkImportMemoryHostPointerInfoEXT-handleType-01751"></a> <span class="vuid">VUID-VkImportMemoryHostPointerInfoEXT-handleType-01751</span><br>

If <code>handleType</code> is
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_HOST_MAPPED_FOREIGN_MEMORY_BIT_EXT</code>,
<code>pHostPointer</code> <strong>must</strong> be a pointer to <code>allocationSize</code> number of
bytes of host mapped foreign memory, where <code>allocationSize</code> is the
member of the <code>VkMemoryAllocateInfo</code> structure this structure is
chained to</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportMemoryHostPointerInfoEXT-sType-sType" href="#VUID-VkImportMemoryHostPointerInfoEXT-sType-sType"></a> <span class="vuid">VUID-VkImportMemoryHostPointerInfoEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_MEMORY_HOST_POINTER_INFO_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryHostPointerInfoEXT-handleType-parameter" href="#VUID-VkImportMemoryHostPointerInfoEXT-handleType-parameter"></a> <span class="vuid">VUID-VkImportMemoryHostPointerInfoEXT-handleType-parameter</span><br>
 <code>handleType</code> <strong>must</strong> be a valid <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value</p>
</li>
<li>
<p><a id="VUID-VkImportMemoryHostPointerInfoEXT-pHostPointer-parameter" href="#VUID-VkImportMemoryHostPointerInfoEXT-pHostPointer-parameter"></a> <span class="vuid">VUID-VkImportMemoryHostPointerInfoEXT-pHostPointer-parameter</span><br>
 <code>pHostPointer</code> <strong>must</strong> be a pointer value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To determine the correct parameters to use when importing host pointers,
call:</p>
</div>
<div id="vkGetMemoryHostPointerPropertiesEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_external_memory_host
VkResult vkGetMemoryHostPointerPropertiesEXT(
    VkDevice                                    device,
    VkExternalMemoryHandleTypeFlagBits          handleType,
    const void*                                 pHostPointer,
    VkMemoryHostPointerPropertiesEXT*           pMemoryHostPointerProperties);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that will be importing
<code>pHostPointer</code>.</p>
</li>
<li>
<p><code>handleType</code> is a <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value
specifying the type of the handle <code>pHostPointer</code>.</p>
</li>
<li>
<p><code>pHostPointer</code> is the host pointer to import from.</p>
</li>
<li>
<p><code>pMemoryHostPointerProperties</code> is a pointer to a
<a href="#VkMemoryHostPointerPropertiesEXT">VkMemoryHostPointerPropertiesEXT</a> structure in which the host
pointer properties are returned.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryHostPointerPropertiesEXT-handleType-01752" href="#VUID-vkGetMemoryHostPointerPropertiesEXT-handleType-01752"></a> <span class="vuid">VUID-vkGetMemoryHostPointerPropertiesEXT-handleType-01752</span><br>

<code>handleType</code> <strong>must</strong> be
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_HOST_ALLOCATION_BIT_EXT</code> or
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_HOST_MAPPED_FOREIGN_MEMORY_BIT_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkGetMemoryHostPointerPropertiesEXT-pHostPointer-01753" href="#VUID-vkGetMemoryHostPointerPropertiesEXT-pHostPointer-01753"></a> <span class="vuid">VUID-vkGetMemoryHostPointerPropertiesEXT-pHostPointer-01753</span><br>

<code>pHostPointer</code> <strong>must</strong> be a pointer aligned to an integer multiple of
<code>VkPhysicalDeviceExternalMemoryHostPropertiesEXT</code>::<code>minImportedHostPointerAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkGetMemoryHostPointerPropertiesEXT-handleType-01754" href="#VUID-vkGetMemoryHostPointerPropertiesEXT-handleType-01754"></a> <span class="vuid">VUID-vkGetMemoryHostPointerPropertiesEXT-handleType-01754</span><br>

If <code>handleType</code> is
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_HOST_ALLOCATION_BIT_EXT</code>,
<code>pHostPointer</code> <strong>must</strong> be a pointer to host memory</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryHostPointerPropertiesEXT-handleType-01755" href="#VUID-vkGetMemoryHostPointerPropertiesEXT-handleType-01755"></a> <span class="vuid">VUID-vkGetMemoryHostPointerPropertiesEXT-handleType-01755</span><br>

If <code>handleType</code> is
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_HOST_MAPPED_FOREIGN_MEMORY_BIT_EXT</code>,
<code>pHostPointer</code> <strong>must</strong> be a pointer to host mapped foreign memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryHostPointerPropertiesEXT-device-parameter" href="#VUID-vkGetMemoryHostPointerPropertiesEXT-device-parameter"></a> <span class="vuid">VUID-vkGetMemoryHostPointerPropertiesEXT-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryHostPointerPropertiesEXT-handleType-parameter" href="#VUID-vkGetMemoryHostPointerPropertiesEXT-handleType-parameter"></a> <span class="vuid">VUID-vkGetMemoryHostPointerPropertiesEXT-handleType-parameter</span><br>
 <code>handleType</code> <strong>must</strong> be a valid <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryHostPointerPropertiesEXT-pHostPointer-parameter" href="#VUID-vkGetMemoryHostPointerPropertiesEXT-pHostPointer-parameter"></a> <span class="vuid">VUID-vkGetMemoryHostPointerPropertiesEXT-pHostPointer-parameter</span><br>
 <code>pHostPointer</code> <strong>must</strong> be a pointer value</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryHostPointerPropertiesEXT-pMemoryHostPointerProperties-parameter" href="#VUID-vkGetMemoryHostPointerPropertiesEXT-pMemoryHostPointerProperties-parameter"></a> <span class="vuid">VUID-vkGetMemoryHostPointerPropertiesEXT-pMemoryHostPointerProperties-parameter</span><br>
 <code>pMemoryHostPointerProperties</code> <strong>must</strong> be a valid pointer to a <a href="#VkMemoryHostPointerPropertiesEXT">VkMemoryHostPointerPropertiesEXT</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_INVALID_EXTERNAL_HANDLE</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMemoryHostPointerPropertiesEXT</code> structure is defined as:</p>
</div>
<div id="VkMemoryHostPointerPropertiesEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_external_memory_host
typedef struct VkMemoryHostPointerPropertiesEXT {
    VkStructureType    sType;
    void*              pNext;
    uint32_t           memoryTypeBits;
} VkMemoryHostPointerPropertiesEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>memoryTypeBits</code> is a bitmask containing one bit set for every
memory type which the specified host pointer <strong>can</strong> be imported as.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The value returned by <code>memoryTypeBits</code> <strong>must</strong> only include bits that
identify memory types which are host visible.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryHostPointerPropertiesEXT-sType-sType" href="#VUID-VkMemoryHostPointerPropertiesEXT-sType-sType"></a> <span class="vuid">VUID-VkMemoryHostPointerPropertiesEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_HOST_POINTER_PROPERTIES_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryHostPointerPropertiesEXT-pNext-pNext" href="#VUID-VkMemoryHostPointerPropertiesEXT-pNext-pNext"></a> <span class="vuid">VUID-VkMemoryHostPointerPropertiesEXT-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_android_hardware_buffer_external_memory"><a class="anchor" href="#_android_hardware_buffer_external_memory"></a>Android Hardware Buffer External Memory</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To import memory created outside of the current Vulkan instance from an
Android hardware buffer, add a
<code>VkImportAndroidHardwareBufferInfoANDROID</code> structure to the <code>pNext</code>
chain of the <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure.
The <code>VkImportAndroidHardwareBufferInfoANDROID</code> structure is defined as:</p>
</div>
<div id="VkImportAndroidHardwareBufferInfoANDROID" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_ANDROID_external_memory_android_hardware_buffer
typedef struct VkImportAndroidHardwareBufferInfoANDROID {
    VkStructureType            sType;
    const void*                pNext;
    struct AHardwareBuffer*    buffer;
} VkImportAndroidHardwareBufferInfoANDROID;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>buffer</code> is the Android hardware buffer to import.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the <a href="#vkAllocateMemory">vkAllocateMemory</a> command succeeds, the implementation <strong>must</strong>
acquire a reference to the imported hardware buffer, which it <strong>must</strong> release
when the device memory object is freed.
If the command fails, the implementation <strong>must</strong> not retain a reference.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportAndroidHardwareBufferInfoANDROID-buffer-01880" href="#VUID-VkImportAndroidHardwareBufferInfoANDROID-buffer-01880"></a> <span class="vuid">VUID-VkImportAndroidHardwareBufferInfoANDROID-buffer-01880</span><br>

If <code>buffer</code> is not <code>NULL</code>, Android hardware buffers <strong>must</strong> be
supported for import, as reported by
<a href="capabilities.html#VkExternalImageFormatProperties" class="xref page">VkExternalImageFormatProperties</a> or
<a href="capabilities.html#VkExternalBufferProperties" class="xref page">VkExternalBufferProperties</a></p>
</li>
<li>
<p><a id="VUID-VkImportAndroidHardwareBufferInfoANDROID-buffer-01881" href="#VUID-VkImportAndroidHardwareBufferInfoANDROID-buffer-01881"></a> <span class="vuid">VUID-VkImportAndroidHardwareBufferInfoANDROID-buffer-01881</span><br>

If <code>buffer</code> is not <code>NULL</code>, it <strong>must</strong> be a valid Android hardware
buffer object with <code>AHardwareBuffer_Desc</code>::<code>usage</code> compatible with
Vulkan as described in <a href="#memory-external-android-hardware-buffer">Android    Hardware Buffers</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportAndroidHardwareBufferInfoANDROID-sType-sType" href="#VUID-VkImportAndroidHardwareBufferInfoANDROID-sType-sType"></a> <span class="vuid">VUID-VkImportAndroidHardwareBufferInfoANDROID-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_ANDROID_HARDWARE_BUFFER_INFO_ANDROID</code></p>
</li>
<li>
<p><a id="VUID-VkImportAndroidHardwareBufferInfoANDROID-buffer-parameter" href="#VUID-VkImportAndroidHardwareBufferInfoANDROID-buffer-parameter"></a> <span class="vuid">VUID-VkImportAndroidHardwareBufferInfoANDROID-buffer-parameter</span><br>
 <code>buffer</code> <strong>must</strong> be a valid pointer to an <code>AHardwareBuffer</code> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export an Android hardware buffer referencing the payload of a Vulkan
device memory object, call:</p>
</div>
<div id="vkGetMemoryAndroidHardwareBufferANDROID" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_ANDROID_external_memory_android_hardware_buffer
VkResult vkGetMemoryAndroidHardwareBufferANDROID(
    VkDevice                                    device,
    const VkMemoryGetAndroidHardwareBufferInfoANDROID* pInfo,
    struct AHardwareBuffer**                    pBuffer);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that created the device memory being
exported.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="#VkMemoryGetAndroidHardwareBufferInfoANDROID">VkMemoryGetAndroidHardwareBufferInfoANDROID</a> structure containing
parameters of the export operation.</p>
</li>
<li>
<p><code>pBuffer</code> will return an Android hardware buffer referencing the
payload of the device memory object.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each call to <code>vkGetMemoryAndroidHardwareBufferANDROID</code> <strong>must</strong> return an
Android hardware buffer with a new reference acquired in addition to the
reference held by the <a href="#VkDeviceMemory">VkDeviceMemory</a>.
To avoid leaking resources, the application <strong>must</strong> release the reference by
calling <code>AHardwareBuffer_release</code> when it is no longer needed.
When called with the same handle in
<a href="#VkMemoryGetAndroidHardwareBufferInfoANDROID">VkMemoryGetAndroidHardwareBufferInfoANDROID</a>::<code>memory</code>,
<code>vkGetMemoryAndroidHardwareBufferANDROID</code> <strong>must</strong> return the same Android
hardware buffer object.
If the device memory was created by importing an Android hardware buffer,
<code>vkGetMemoryAndroidHardwareBufferANDROID</code> <strong>must</strong> return that same Android
hardware buffer object.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryAndroidHardwareBufferANDROID-device-parameter" href="#VUID-vkGetMemoryAndroidHardwareBufferANDROID-device-parameter"></a> <span class="vuid">VUID-vkGetMemoryAndroidHardwareBufferANDROID-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryAndroidHardwareBufferANDROID-pInfo-parameter" href="#VUID-vkGetMemoryAndroidHardwareBufferANDROID-pInfo-parameter"></a> <span class="vuid">VUID-vkGetMemoryAndroidHardwareBufferANDROID-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkMemoryGetAndroidHardwareBufferInfoANDROID">VkMemoryGetAndroidHardwareBufferInfoANDROID</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryAndroidHardwareBufferANDROID-pBuffer-parameter" href="#VUID-vkGetMemoryAndroidHardwareBufferANDROID-pBuffer-parameter"></a> <span class="vuid">VUID-vkGetMemoryAndroidHardwareBufferANDROID-pBuffer-parameter</span><br>
 <code>pBuffer</code> <strong>must</strong> be a valid pointer to a valid pointer to an <code>AHardwareBuffer</code> value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_TOO_MANY_OBJECTS</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMemoryGetAndroidHardwareBufferInfoANDROID</code> structure is defined
as:</p>
</div>
<div id="VkMemoryGetAndroidHardwareBufferInfoANDROID" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_ANDROID_external_memory_android_hardware_buffer
typedef struct VkMemoryGetAndroidHardwareBufferInfoANDROID {
    VkStructureType    sType;
    const void*        pNext;
    VkDeviceMemory     memory;
} VkMemoryGetAndroidHardwareBufferInfoANDROID;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>memory</code> is the memory object from which the Android hardware buffer
will be exported.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-handleTypes-01882" href="#VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-handleTypes-01882"></a> <span class="vuid">VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-handleTypes-01882</span><br>

<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ANDROID_HARDWARE_BUFFER_BIT_ANDROID</code>
<strong>must</strong> have been included in
<a href="#VkExportMemoryAllocateInfo">VkExportMemoryAllocateInfo</a>::<code>handleTypes</code> when <code>memory</code>
was created</p>
</li>
<li>
<p><a id="VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-pNext-01883" href="#VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-pNext-01883"></a> <span class="vuid">VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-pNext-01883</span><br>

If the <code>pNext</code> chain of the <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> used to
allocate <code>memory</code> included a <a href="#VkMemoryDedicatedAllocateInfo">VkMemoryDedicatedAllocateInfo</a>
with non-<code>NULL</code> <code>image</code> member, then that <code>image</code> <strong>must</strong> already
be bound to <code>memory</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-sType-sType" href="#VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-sType-sType"></a> <span class="vuid">VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_GET_ANDROID_HARDWARE_BUFFER_INFO_ANDROID</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-pNext-pNext" href="#VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-pNext-pNext"></a> <span class="vuid">VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-memory-parameter" href="#VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-memory-parameter"></a> <span class="vuid">VUID-VkMemoryGetAndroidHardwareBufferInfoANDROID-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To determine the memory parameters to use when importing an Android hardware
buffer, call:</p>
</div>
<div id="vkGetAndroidHardwareBufferPropertiesANDROID" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_ANDROID_external_memory_android_hardware_buffer
VkResult vkGetAndroidHardwareBufferPropertiesANDROID(
    VkDevice                                    device,
    const struct AHardwareBuffer*               buffer,
    VkAndroidHardwareBufferPropertiesANDROID*   pProperties);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that will be importing <code>buffer</code>.</p>
</li>
<li>
<p><code>buffer</code> is the Android hardware buffer which will be imported.</p>
</li>
<li>
<p><code>pProperties</code> is a pointer to a
<a href="#VkAndroidHardwareBufferPropertiesANDROID">VkAndroidHardwareBufferPropertiesANDROID</a> structure in which the
properties of <code>buffer</code> are returned.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetAndroidHardwareBufferPropertiesANDROID-buffer-01884" href="#VUID-vkGetAndroidHardwareBufferPropertiesANDROID-buffer-01884"></a> <span class="vuid">VUID-vkGetAndroidHardwareBufferPropertiesANDROID-buffer-01884</span><br>

<code>buffer</code> <strong>must</strong> be a valid Android hardware buffer object with at
least one of the <code>AHARDWAREBUFFER_USAGE_GPU_*</code> flags in its
<code>AHardwareBuffer_Desc</code>::<code>usage</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetAndroidHardwareBufferPropertiesANDROID-device-parameter" href="#VUID-vkGetAndroidHardwareBufferPropertiesANDROID-device-parameter"></a> <span class="vuid">VUID-vkGetAndroidHardwareBufferPropertiesANDROID-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetAndroidHardwareBufferPropertiesANDROID-buffer-parameter" href="#VUID-vkGetAndroidHardwareBufferPropertiesANDROID-buffer-parameter"></a> <span class="vuid">VUID-vkGetAndroidHardwareBufferPropertiesANDROID-buffer-parameter</span><br>
 <code>buffer</code> <strong>must</strong> be a valid pointer to a valid <code>AHardwareBuffer</code> value</p>
</li>
<li>
<p><a id="VUID-vkGetAndroidHardwareBufferPropertiesANDROID-pProperties-parameter" href="#VUID-vkGetAndroidHardwareBufferPropertiesANDROID-pProperties-parameter"></a> <span class="vuid">VUID-vkGetAndroidHardwareBufferPropertiesANDROID-pProperties-parameter</span><br>
 <code>pProperties</code> <strong>must</strong> be a valid pointer to a <a href="#VkAndroidHardwareBufferPropertiesANDROID">VkAndroidHardwareBufferPropertiesANDROID</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_INVALID_EXTERNAL_HANDLE_KHR</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAndroidHardwareBufferPropertiesANDROID</code> structure returned is
defined as:</p>
</div>
<div id="VkAndroidHardwareBufferPropertiesANDROID" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_ANDROID_external_memory_android_hardware_buffer
typedef struct VkAndroidHardwareBufferPropertiesANDROID {
    VkStructureType    sType;
    void*              pNext;
    VkDeviceSize       allocationSize;
    uint32_t           memoryTypeBits;
} VkAndroidHardwareBufferPropertiesANDROID;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>allocationSize</code> is the size of the external memory</p>
</li>
<li>
<p><code>memoryTypeBits</code> is a bitmask containing one bit set for every
memory type which the specified Android hardware buffer <strong>can</strong> be imported
as.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAndroidHardwareBufferPropertiesANDROID-sType-sType" href="#VUID-VkAndroidHardwareBufferPropertiesANDROID-sType-sType"></a> <span class="vuid">VUID-VkAndroidHardwareBufferPropertiesANDROID-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ANDROID_HARDWARE_BUFFER_PROPERTIES_ANDROID</code></p>
</li>
<li>
<p><a id="VUID-VkAndroidHardwareBufferPropertiesANDROID-pNext-pNext" href="#VUID-VkAndroidHardwareBufferPropertiesANDROID-pNext-pNext"></a> <span class="vuid">VUID-VkAndroidHardwareBufferPropertiesANDROID-pNext-pNext</span><br>
 Each <code>pNext</code> member of any structure (including this one) in the <code>pNext</code> chain <strong>must</strong> be either <code>NULL</code> or a pointer to a valid instance of <a href="#VkAndroidHardwareBufferFormatProperties2ANDROID">VkAndroidHardwareBufferFormatProperties2ANDROID</a> or <a href="#VkAndroidHardwareBufferFormatPropertiesANDROID">VkAndroidHardwareBufferFormatPropertiesANDROID</a></p>
</li>
<li>
<p><a id="VUID-VkAndroidHardwareBufferPropertiesANDROID-sType-unique" href="#VUID-VkAndroidHardwareBufferPropertiesANDROID-sType-unique"></a> <span class="vuid">VUID-VkAndroidHardwareBufferPropertiesANDROID-sType-unique</span><br>
 The <code>sType</code> value of each struct in the <code>pNext</code> chain <strong>must</strong> be unique</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To obtain format properties of an Android hardware buffer, include a
<code>VkAndroidHardwareBufferFormatPropertiesANDROID</code> structure in the
<code>pNext</code> chain of the <a href="#VkAndroidHardwareBufferPropertiesANDROID">VkAndroidHardwareBufferPropertiesANDROID</a>
structure passed to <a href="#vkGetAndroidHardwareBufferPropertiesANDROID">vkGetAndroidHardwareBufferPropertiesANDROID</a>.
This structure is defined as:</p>
</div>
<div id="VkAndroidHardwareBufferFormatPropertiesANDROID" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_ANDROID_external_memory_android_hardware_buffer
typedef struct VkAndroidHardwareBufferFormatPropertiesANDROID {
    VkStructureType                  sType;
    void*                            pNext;
    VkFormat                         format;
    uint64_t                         externalFormat;
    VkFormatFeatureFlags             formatFeatures;
    VkComponentMapping               samplerYcbcrConversionComponents;
    VkSamplerYcbcrModelConversion    suggestedYcbcrModel;
    VkSamplerYcbcrRange              suggestedYcbcrRange;
    VkChromaLocation                 suggestedXChromaOffset;
    VkChromaLocation                 suggestedYChromaOffset;
} VkAndroidHardwareBufferFormatPropertiesANDROID;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>format</code> is the Vulkan format corresponding to the Android hardware
buffer&#8217;s format, or <code>VK_FORMAT_UNDEFINED</code> if there is not an
equivalent Vulkan format.</p>
</li>
<li>
<p><code>externalFormat</code> is an implementation-defined external format
identifier for use with <a href="resources.html#VkExternalFormatANDROID" class="xref page">VkExternalFormatANDROID</a>.
It <strong>must</strong> not be zero.</p>
</li>
<li>
<p><code>formatFeatures</code> describes the capabilities of this external format
when used with an image bound to memory imported from <code>buffer</code>.</p>
</li>
<li>
<p><code>samplerYcbcrConversionComponents</code> is the component swizzle that
<strong>should</strong> be used in <a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
<li>
<p><code>suggestedYcbcrModel</code> is a suggested color model to use in the
<a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
<li>
<p><code>suggestedYcbcrRange</code> is a suggested numerical value range to use in
<a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
<li>
<p><code>suggestedXChromaOffset</code> is a suggested X chroma offset to use in
<a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
<li>
<p><code>suggestedYChromaOffset</code> is a suggested Y chroma offset to use in
<a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the Android hardware buffer has one of the formats listed in the
<a href="#memory-external-android-hardware-buffer-formats">Format Equivalencetable</a>, then <code>format</code> <strong>must</strong> have the equivalent Vulkan format listed in
the table.
Otherwise, <code>format</code> <strong>may</strong> be <code>VK_FORMAT_UNDEFINED</code>, indicating the
Android hardware buffer <strong>can</strong> only be used with an external format.</p>
</div>
<div class="paragraph">
<p>The <code>formatFeatures</code> member <strong>must</strong> include
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT</code> and at least one of
<code>VK_FORMAT_FEATURE_MIDPOINT_CHROMA_SAMPLES_BIT</code> or
<code>VK_FORMAT_FEATURE_COSITED_CHROMA_SAMPLES_BIT</code>, and <strong>should</strong> include
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BIT</code> and
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_YCBCR_CONVERSION_LINEAR_FILTER_BIT</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The <code>formatFeatures</code> member only indicates the features available when
using an
<a href="#memory-external-android-hardware-buffer-external-formats">external-formatimage</a> created from the Android hardware buffer.
Images from Android hardware buffers with a format other than
<code>VK_FORMAT_UNDEFINED</code> are subject to the format capabilities obtained
from <a href="formats.html#vkGetPhysicalDeviceFormatProperties2" class="xref page">vkGetPhysicalDeviceFormatProperties2</a>, and
<a href="capabilities.html#vkGetPhysicalDeviceImageFormatProperties2" class="xref page">vkGetPhysicalDeviceImageFormatProperties2</a> with appropriate parameters.
These sets of features are independent of each other, e.g. the external
format will support sampler Y′C<sub>B</sub>C<sub>R</sub> conversion even if the non-external
format does not, and writing to non-external format images is possible but
writing to external format images is not.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Android hardware buffers with the same external format <strong>must</strong> have the same
support for <code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BIT</code>,
<code>VK_FORMAT_FEATURE_MIDPOINT_CHROMA_SAMPLES_BIT</code>,
<code>VK_FORMAT_FEATURE_COSITED_CHROMA_SAMPLES_BIT</code>,
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_YCBCR_CONVERSION_LINEAR_FILTER_BIT</code>,
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_YCBCR_CONVERSION_SEPARATE_RECONSTRUCTION_FILTER_BIT</code>,
and
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_YCBCR_CONVERSION_CHROMA_RECONSTRUCTION_EXPLICIT_FORCEABLE_BIT</code>.
in <code>formatFeatures</code>.
Other format features <strong>may</strong> differ between Android hardware buffers that have
the same external format.
This allows applications to use the same <a href="samplers.html#VkSamplerYcbcrConversion" class="xref page">VkSamplerYcbcrConversion</a>
object (and samplers and pipelines created from them) for any Android
hardware buffers that have the same external format.</p>
</div>
<div class="paragraph">
<p>If <code>format</code> is not <code>VK_FORMAT_UNDEFINED</code>, then the value of
<code>samplerYcbcrConversionComponents</code> <strong>must</strong> be valid when used as the
<code>components</code> member of <a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a> with
that format.
If <code>format</code> is <code>VK_FORMAT_UNDEFINED</code>, all members of
<code>samplerYcbcrConversionComponents</code> <strong>must</strong> be the
<a href="resources.html#resources-image-views-identity-mappings" class="xref page">identity swizzle</a>.</p>
</div>
<div class="paragraph">
<p>Implementations <strong>may</strong> not always be able to determine the color model,
numerical range, or chroma offsets of the image contents, so the values in
<code>VkAndroidHardwareBufferFormatPropertiesANDROID</code> are only suggestions.
Applications <strong>should</strong> treat these values as sensible defaults to use in the
absence of more reliable information obtained through some other means.
If the underlying physical device is also usable via OpenGL ES with the
<a href="https://registry.khronos.org/OpenGL/extensions/OES/OES_EGL_image_external.txt"><code>GL_OES_EGL_image_external</code></a>
extension, the implementation <strong>should</strong> suggest values that will produce
similar sampled values as would be obtained by sampling the same external
image via <code>samplerExternalOES</code> in OpenGL ES using equivalent sampler
parameters.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Since
<a href="https://registry.khronos.org/OpenGL/extensions/OES/OES_EGL_image_external.txt"><code>GL_OES_EGL_image_external</code></a>
does not require the same sampling and conversion calculations as Vulkan
does, achieving identical results between APIs <strong>may</strong> not be possible on some
implementations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAndroidHardwareBufferFormatPropertiesANDROID-sType-sType" href="#VUID-VkAndroidHardwareBufferFormatPropertiesANDROID-sType-sType"></a> <span class="vuid">VUID-VkAndroidHardwareBufferFormatPropertiesANDROID-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ANDROID_HARDWARE_BUFFER_FORMAT_PROPERTIES_ANDROID</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The format properties of an Android hardware buffer <strong>can</strong> be obtained by
including a <code>VkAndroidHardwareBufferFormatProperties2ANDROID</code> structure
in the <code>pNext</code> chain of the
<a href="#VkAndroidHardwareBufferPropertiesANDROID">VkAndroidHardwareBufferPropertiesANDROID</a> structure passed to
<a href="#vkGetAndroidHardwareBufferPropertiesANDROID">vkGetAndroidHardwareBufferPropertiesANDROID</a>.
This structure is defined as:</p>
</div>
<div id="VkAndroidHardwareBufferFormatProperties2ANDROID" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_format_feature_flags2 with VK_ANDROID_external_memory_android_hardware_buffer
typedef struct VkAndroidHardwareBufferFormatProperties2ANDROID {
    VkStructureType                  sType;
    void*                            pNext;
    VkFormat                         format;
    uint64_t                         externalFormat;
    VkFormatFeatureFlags2            formatFeatures;
    VkComponentMapping               samplerYcbcrConversionComponents;
    VkSamplerYcbcrModelConversion    suggestedYcbcrModel;
    VkSamplerYcbcrRange              suggestedYcbcrRange;
    VkChromaLocation                 suggestedXChromaOffset;
    VkChromaLocation                 suggestedYChromaOffset;
} VkAndroidHardwareBufferFormatProperties2ANDROID;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>format</code> is the Vulkan format corresponding to the Android hardware
buffer&#8217;s format, or <code>VK_FORMAT_UNDEFINED</code> if there is not an
equivalent Vulkan format.</p>
</li>
<li>
<p><code>externalFormat</code> is an implementation-defined external format
identifier for use with <a href="resources.html#VkExternalFormatANDROID" class="xref page">VkExternalFormatANDROID</a>.
It <strong>must</strong> not be zero.</p>
</li>
<li>
<p><code>formatFeatures</code> describes the capabilities of this external format
when used with an image bound to memory imported from <code>buffer</code>.</p>
</li>
<li>
<p><code>samplerYcbcrConversionComponents</code> is the component swizzle that
<strong>should</strong> be used in <a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
<li>
<p><code>suggestedYcbcrModel</code> is a suggested color model to use in the
<a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
<li>
<p><code>suggestedYcbcrRange</code> is a suggested numerical value range to use in
<a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
<li>
<p><code>suggestedXChromaOffset</code> is a suggested X chroma offset to use in
<a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
<li>
<p><code>suggestedYChromaOffset</code> is a suggested Y chroma offset to use in
<a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The bits reported in <code>formatFeatures</code> <strong>must</strong> include the bits reported in
the corresponding fields of
<code>VkAndroidHardwareBufferFormatPropertiesANDROID</code>::<code>formatFeatures</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAndroidHardwareBufferFormatProperties2ANDROID-sType-sType" href="#VUID-VkAndroidHardwareBufferFormatProperties2ANDROID-sType-sType"></a> <span class="vuid">VUID-VkAndroidHardwareBufferFormatProperties2ANDROID-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ANDROID_HARDWARE_BUFFER_FORMAT_PROPERTIES_2_ANDROID</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_remote_device_external_memory"><a class="anchor" href="#_remote_device_external_memory"></a>Remote Device External Memory</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export an address representing the payload of a Vulkan device memory
object accessible by remote devices, call:</p>
</div>
<div id="vkGetMemoryRemoteAddressNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_external_memory_rdma
VkResult vkGetMemoryRemoteAddressNV(
    VkDevice                                    device,
    const VkMemoryGetRemoteAddressInfoNV*       pMemoryGetRemoteAddressInfo,
    VkRemoteAddressNV*                          pAddress);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that created the device memory being
exported.</p>
</li>
<li>
<p><code>pMemoryGetRemoteAddressInfo</code> is a pointer to a
<a href="#VkMemoryGetRemoteAddressInfoNV">VkMemoryGetRemoteAddressInfoNV</a> structure containing parameters of
the export operation.</p>
</li>
<li>
<p><code>pAddress</code> is a pointer to a <code>VkRemoteAddressNV</code> value in
which an address representing the payload of the device memory object is
returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More communication may be required between the kernel-mode drivers of the
devices involved.
This information is out of scope of this documentation and should be
requested from the vendors of the devices.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryRemoteAddressNV-device-parameter" href="#VUID-vkGetMemoryRemoteAddressNV-device-parameter"></a> <span class="vuid">VUID-vkGetMemoryRemoteAddressNV-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryRemoteAddressNV-pMemoryGetRemoteAddressInfo-parameter" href="#VUID-vkGetMemoryRemoteAddressNV-pMemoryGetRemoteAddressInfo-parameter"></a> <span class="vuid">VUID-vkGetMemoryRemoteAddressNV-pMemoryGetRemoteAddressInfo-parameter</span><br>
 <code>pMemoryGetRemoteAddressInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkMemoryGetRemoteAddressInfoNV">VkMemoryGetRemoteAddressInfoNV</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryRemoteAddressNV-pAddress-parameter" href="#VUID-vkGetMemoryRemoteAddressNV-pAddress-parameter"></a> <span class="vuid">VUID-vkGetMemoryRemoteAddressNV-pAddress-parameter</span><br>
 <code>pAddress</code> <strong>must</strong> be a valid pointer to a <code>VkRemoteAddressNV</code> value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_INVALID_EXTERNAL_HANDLE</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMemoryGetRemoteAddressInfoNV</code> structure is defined as:</p>
</div>
<div id="VkMemoryGetRemoteAddressInfoNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_external_memory_rdma
typedef struct VkMemoryGetRemoteAddressInfoNV {
    VkStructureType                       sType;
    const void*                           pNext;
    VkDeviceMemory                        memory;
    VkExternalMemoryHandleTypeFlagBits    handleType;
} VkMemoryGetRemoteAddressInfoNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>memory</code> is the memory object from which the remote accessible
address will be exported.</p>
</li>
<li>
<p><code>handleType</code> is the type of handle requested.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryGetRemoteAddressInfoNV-handleType-04966" href="#VUID-VkMemoryGetRemoteAddressInfoNV-handleType-04966"></a> <span class="vuid">VUID-VkMemoryGetRemoteAddressInfoNV-handleType-04966</span><br>

<code>handleType</code> <strong>must</strong> have been included in
<a href="#VkExportMemoryAllocateInfo">VkExportMemoryAllocateInfo</a>::<code>handleTypes</code> when <code>memory</code>
was created</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryGetRemoteAddressInfoNV-sType-sType" href="#VUID-VkMemoryGetRemoteAddressInfoNV-sType-sType"></a> <span class="vuid">VUID-VkMemoryGetRemoteAddressInfoNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_GET_REMOTE_ADDRESS_INFO_NV</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryGetRemoteAddressInfoNV-pNext-pNext" href="#VUID-VkMemoryGetRemoteAddressInfoNV-pNext-pNext"></a> <span class="vuid">VUID-VkMemoryGetRemoteAddressInfoNV-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryGetRemoteAddressInfoNV-memory-parameter" href="#VUID-VkMemoryGetRemoteAddressInfoNV-memory-parameter"></a> <span class="vuid">VUID-VkMemoryGetRemoteAddressInfoNV-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
<li>
<p><a id="VUID-VkMemoryGetRemoteAddressInfoNV-handleType-parameter" href="#VUID-VkMemoryGetRemoteAddressInfoNV-handleType-parameter"></a> <span class="vuid">VUID-VkMemoryGetRemoteAddressInfoNV-handleType-parameter</span><br>
 <code>handleType</code> <strong>must</strong> be a valid <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><code>VkRemoteAddressNV</code> represents an address of a memory object
accessible by remote devices, as returned in
<a href="#vkGetMemoryRemoteAddressNV">vkGetMemoryRemoteAddressNV</a>::<code>pAddress</code>.</p>
</div>
<div id="VkRemoteAddressNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_external_memory_rdma
typedef void* VkRemoteAddressNV;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fuchsia-external-memory"><a class="anchor" href="#fuchsia-external-memory"></a>Fuchsia External Memory</h3>
<div class="paragraph">
<p>On Fuchsia, when allocating memory that <strong>may</strong> be imported from another
device, process or Vulkan instance, add a
<a href="#VkImportMemoryZirconHandleInfoFUCHSIA">VkImportMemoryZirconHandleInfoFUCHSIA</a> structure to the <code>pNext</code>
chain of the <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure.</p>
</div>
<div class="paragraph">
<p>External memory on Fuchsia is imported and exported using VMO handles of
type <code>zx_handle_t</code>.
VMO handles to external memory are canonically obtained from Fuchsia&#8217;s
Sysmem service or from syscalls such as <code>zx_vmo_create</code>().
VMO handles for import can also be obtained by exporting them from another
Vulkan instance as described in <a href="#exporting-fuchsia-device-memory">exportingfuchsia device memory</a>.</p>
</div>
<div class="paragraph">
<p>Importing VMO handles to the Vulkan instance transfers ownership of the
handle to the instance from the application.
The application <strong>must</strong> not perform any operations on the handle after
successful import.</p>
</div>
<div class="paragraph">
<p>Applications <strong>can</strong> import the same underlying memory into multiple instances
of Vulkan, into the same instance from which it was exported, and multiple
times into a given Vulkan instance.
In all cases, each import operation <strong>must</strong> create a distinct
<code>VkDeviceMemory</code> object.</p>
</div>
<div class="sect3">
<h4 id="importing-fuchsia-external-memory"><a class="anchor" href="#importing-fuchsia-external-memory"></a>Importing Fuchsia External Memory</h4>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkImportMemoryZirconHandleInfoFUCHSIA</code> structure is defined as:</p>
</div>
<div id="VkImportMemoryZirconHandleInfoFUCHSIA" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_FUCHSIA_external_memory
typedef struct VkImportMemoryZirconHandleInfoFUCHSIA {
    VkStructureType                       sType;
    const void*                           pNext;
    VkExternalMemoryHandleTypeFlagBits    handleType;
    zx_handle_t                           handle;
} VkImportMemoryZirconHandleInfoFUCHSIA;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>handleType</code> is a <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value
specifying the type of <code>handle</code>.</p>
</li>
<li>
<p><code>handle</code> is a <code>zx_handle_t</code> (Zircon) handle to the external
memory.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportMemoryZirconHandleInfoFUCHSIA-handleType-04771" href="#VUID-VkImportMemoryZirconHandleInfoFUCHSIA-handleType-04771"></a> <span class="vuid">VUID-VkImportMemoryZirconHandleInfoFUCHSIA-handleType-04771</span><br>

<code>handleType</code> <strong>must</strong> be
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ZIRCON_VMO_BIT_FUCHSIA</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryZirconHandleInfoFUCHSIA-handle-04772" href="#VUID-VkImportMemoryZirconHandleInfoFUCHSIA-handle-04772"></a> <span class="vuid">VUID-VkImportMemoryZirconHandleInfoFUCHSIA-handle-04772</span><br>

<code>handle</code> must be a valid VMO handle</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportMemoryZirconHandleInfoFUCHSIA-sType-sType" href="#VUID-VkImportMemoryZirconHandleInfoFUCHSIA-sType-sType"></a> <span class="vuid">VUID-VkImportMemoryZirconHandleInfoFUCHSIA-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_MEMORY_ZIRCON_HANDLE_INFO_FUCHSIA</code></p>
</li>
<li>
<p><a id="VUID-VkImportMemoryZirconHandleInfoFUCHSIA-handleType-parameter" href="#VUID-VkImportMemoryZirconHandleInfoFUCHSIA-handleType-parameter"></a> <span class="vuid">VUID-VkImportMemoryZirconHandleInfoFUCHSIA-handleType-parameter</span><br>
 If <code>handleType</code> is not <code>0</code>, <code>handleType</code> <strong>must</strong> be a valid <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To obtain the memoryTypeIndex for the <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure,
call <code>vkGetMemoryZirconHandlePropertiesFUCHSIA</code>:</p>
</div>
<div id="vkGetMemoryZirconHandlePropertiesFUCHSIA" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_FUCHSIA_external_memory
VkResult vkGetMemoryZirconHandlePropertiesFUCHSIA(
    VkDevice                                    device,
    VkExternalMemoryHandleTypeFlagBits          handleType,
    zx_handle_t                                 zirconHandle,
    VkMemoryZirconHandlePropertiesFUCHSIA*      pMemoryZirconHandleProperties);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a>.</p>
</li>
<li>
<p><code>handleType</code> is a <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value
specifying the type of <code>zirconHandle</code></p>
</li>
<li>
<p><code>zirconHandle</code> is a <code>zx_handle_t</code> (Zircon) handle to the external
resource.</p>
</li>
<li>
<p><code>pMemoryZirconHandleProperties</code> is a pointer to a
<a href="#VkMemoryZirconHandlePropertiesFUCHSIA">VkMemoryZirconHandlePropertiesFUCHSIA</a> structure in which the
result will be stored.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-handleType-04773" href="#VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-handleType-04773"></a> <span class="vuid">VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-handleType-04773</span><br>

<code>handleType</code> <strong>must</strong> be
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ZIRCON_VMO_BIT_FUCHSIA</code></p>
</li>
<li>
<p><a id="VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-zirconHandle-04774" href="#VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-zirconHandle-04774"></a> <span class="vuid">VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-zirconHandle-04774</span><br>

<code>zirconHandle</code> must reference a valid VMO</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-device-parameter" href="#VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-device-parameter"></a> <span class="vuid">VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-handleType-parameter" href="#VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-handleType-parameter"></a> <span class="vuid">VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-handleType-parameter</span><br>
 <code>handleType</code> <strong>must</strong> be a valid <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-pMemoryZirconHandleProperties-parameter" href="#VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-pMemoryZirconHandleProperties-parameter"></a> <span class="vuid">VUID-vkGetMemoryZirconHandlePropertiesFUCHSIA-pMemoryZirconHandleProperties-parameter</span><br>
 <code>pMemoryZirconHandleProperties</code> <strong>must</strong> be a valid pointer to a <a href="#VkMemoryZirconHandlePropertiesFUCHSIA">VkMemoryZirconHandlePropertiesFUCHSIA</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_INVALID_EXTERNAL_HANDLE</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMemoryZirconHandlePropertiesFUCHSIA</code> structure is defined as:</p>
</div>
<div id="VkMemoryZirconHandlePropertiesFUCHSIA" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_FUCHSIA_external_memory
typedef struct VkMemoryZirconHandlePropertiesFUCHSIA {
    VkStructureType    sType;
    void*              pNext;
    uint32_t           memoryTypeBits;
} VkMemoryZirconHandlePropertiesFUCHSIA;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>memoryTypeBits</code> a bitmask containing one bit set for every memory
type which the specified handle can be imported as.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryZirconHandlePropertiesFUCHSIA-sType-sType" href="#VUID-VkMemoryZirconHandlePropertiesFUCHSIA-sType-sType"></a> <span class="vuid">VUID-VkMemoryZirconHandlePropertiesFUCHSIA-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_ZIRCON_HANDLE_PROPERTIES_FUCHSIA</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryZirconHandlePropertiesFUCHSIA-pNext-pNext" href="#VUID-VkMemoryZirconHandlePropertiesFUCHSIA-pNext-pNext"></a> <span class="vuid">VUID-VkMemoryZirconHandlePropertiesFUCHSIA-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With <code>pMemoryZirconHandleProperties</code> now successfully populated by
<a href="#vkGetMemoryZirconHandlePropertiesFUCHSIA">vkGetMemoryZirconHandlePropertiesFUCHSIA</a>, assign the
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> memoryTypeIndex field to a memory type which has
a bit set in the <a href="#VkMemoryZirconHandlePropertiesFUCHSIA">VkMemoryZirconHandlePropertiesFUCHSIA</a> memoryTypeBits
field.</p>
</div>
</div>
<div class="sect3">
<h4 id="exporting-fuchsia-device-memory"><a class="anchor" href="#exporting-fuchsia-device-memory"></a>Exporting Fuchsia Device Memory</h4>
<div class="paragraph">
<p>Similar to importing, exporting a VMO handle from Vulkan transfers ownership
of the handle from the Vulkan instance to the application.
The application is responsible for closing the handle with
<code>zx_handle_close</code>() when it is no longer in use.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export device memory as a Zircon handle that can be used by another
instance, device, or process, the handle to the <a href="#VkDeviceMemory">VkDeviceMemory</a> must be
retrieved using <a href="#vkGetMemoryZirconHandleFUCHSIA">vkGetMemoryZirconHandleFUCHSIA</a>:</p>
</div>
<div id="vkGetMemoryZirconHandleFUCHSIA" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_FUCHSIA_external_memory
VkResult vkGetMemoryZirconHandleFUCHSIA(
    VkDevice                                    device,
    const VkMemoryGetZirconHandleInfoFUCHSIA*   pGetZirconHandleInfo,
    zx_handle_t*                                pZirconHandle);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a>.</p>
</li>
<li>
<p><code>pGetZirconHandleInfo</code> is a pointer to a
<a href="#VkMemoryGetZirconHandleInfoFUCHSIA">VkMemoryGetZirconHandleInfoFUCHSIA</a> structure.</p>
</li>
<li>
<p><code>pZirconHandle</code> is a pointer to a <code>zx_handle_t</code> which holds the
resulting Zircon handle.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetMemoryZirconHandleFUCHSIA-device-parameter" href="#VUID-vkGetMemoryZirconHandleFUCHSIA-device-parameter"></a> <span class="vuid">VUID-vkGetMemoryZirconHandleFUCHSIA-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryZirconHandleFUCHSIA-pGetZirconHandleInfo-parameter" href="#VUID-vkGetMemoryZirconHandleFUCHSIA-pGetZirconHandleInfo-parameter"></a> <span class="vuid">VUID-vkGetMemoryZirconHandleFUCHSIA-pGetZirconHandleInfo-parameter</span><br>
 <code>pGetZirconHandleInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkMemoryGetZirconHandleInfoFUCHSIA">VkMemoryGetZirconHandleInfoFUCHSIA</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetMemoryZirconHandleFUCHSIA-pZirconHandle-parameter" href="#VUID-vkGetMemoryZirconHandleFUCHSIA-pZirconHandle-parameter"></a> <span class="vuid">VUID-vkGetMemoryZirconHandleFUCHSIA-pZirconHandle-parameter</span><br>
 <code>pZirconHandle</code> <strong>must</strong> be a valid pointer to a <code>zx_handle_t</code> value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_TOO_MANY_OBJECTS</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><code>VkMemoryGetZirconHandleInfoFUCHSIA</code> is defined as:</p>
</div>
<div id="VkMemoryGetZirconHandleInfoFUCHSIA" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_FUCHSIA_external_memory
typedef struct VkMemoryGetZirconHandleInfoFUCHSIA {
    VkStructureType                       sType;
    const void*                           pNext;
    VkDeviceMemory                        memory;
    VkExternalMemoryHandleTypeFlagBits    handleType;
} VkMemoryGetZirconHandleInfoFUCHSIA;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>memory</code> the <a href="#VkDeviceMemory">VkDeviceMemory</a> being exported.</p>
</li>
<li>
<p><code>handleType</code> is a <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value
specifying the type of the handle pointed to by
<a href="#vkGetMemoryZirconHandleFUCHSIA">vkGetMemoryZirconHandleFUCHSIA</a>::<code>pZirconHandle</code>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryGetZirconHandleInfoFUCHSIA-handleType-04775" href="#VUID-VkMemoryGetZirconHandleInfoFUCHSIA-handleType-04775"></a> <span class="vuid">VUID-VkMemoryGetZirconHandleInfoFUCHSIA-handleType-04775</span><br>

<code>handleType</code> <strong>must</strong> be
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ZIRCON_VMO_BIT_FUCHSIA</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryGetZirconHandleInfoFUCHSIA-handleType-04776" href="#VUID-VkMemoryGetZirconHandleInfoFUCHSIA-handleType-04776"></a> <span class="vuid">VUID-VkMemoryGetZirconHandleInfoFUCHSIA-handleType-04776</span><br>

<code>handleType</code> <strong>must</strong> have been included in the <code>handleTypes</code> field
of the <code>VkExportMemoryAllocateInfo</code> structure when the external
memory was allocated</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryGetZirconHandleInfoFUCHSIA-sType-sType" href="#VUID-VkMemoryGetZirconHandleInfoFUCHSIA-sType-sType"></a> <span class="vuid">VUID-VkMemoryGetZirconHandleInfoFUCHSIA-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_GET_ZIRCON_HANDLE_INFO_FUCHSIA</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryGetZirconHandleInfoFUCHSIA-pNext-pNext" href="#VUID-VkMemoryGetZirconHandleInfoFUCHSIA-pNext-pNext"></a> <span class="vuid">VUID-VkMemoryGetZirconHandleInfoFUCHSIA-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryGetZirconHandleInfoFUCHSIA-memory-parameter" href="#VUID-VkMemoryGetZirconHandleInfoFUCHSIA-memory-parameter"></a> <span class="vuid">VUID-VkMemoryGetZirconHandleInfoFUCHSIA-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
<li>
<p><a id="VUID-VkMemoryGetZirconHandleInfoFUCHSIA-handleType-parameter" href="#VUID-VkMemoryGetZirconHandleInfoFUCHSIA-handleType-parameter"></a> <span class="vuid">VUID-VkMemoryGetZirconHandleInfoFUCHSIA-handleType-parameter</span><br>
 <code>handleType</code> <strong>must</strong> be a valid <a href="capabilities.html#VkExternalMemoryHandleTypeFlagBits" class="xref page">VkExternalMemoryHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the result <code>pZirconHandle</code> now obtained, the memory properties for
the handle can be retrieved using
<a href="#vkGetMemoryZirconHandlePropertiesFUCHSIA">vkGetMemoryZirconHandlePropertiesFUCHSIA</a> as documented above
substituting the dereferenced, retrieved <code>pZirconHandle</code> in for the
<code>zirconHandle</code> argument.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="metal-objects"><a class="anchor" href="#metal-objects"></a>Metal Objects</h3>
<div class="paragraph">
<p>A Vulkan implementation that is layered on top of Metal on Apple device
platform, and implements the <code><a href="../appendices/extensions.html#VK_EXT_metal_objects" class="xref page">VK_EXT_metal_objects</a></code> extension,
supports the ability to import and export the underlying Metal objects
associated with specific Vulkan objects.</p>
</div>
<div class="paragraph">
<p>The underlying Metal objects associated with certain Vulkan objects can be
exported from those Vulkan objects using the <code>pNext</code> chain of the
<a href="#VkExportMetalObjectsInfoEXT">VkExportMetalObjectsInfoEXT</a> parameter of the
<a href="#vkExportMetalObjectsEXT">vkExportMetalObjectsEXT</a> command.</p>
</div>
<div class="paragraph">
<p>An <a href="#VkDeviceMemory">VkDeviceMemory</a> object can be allocated on an existing
<code>MTLBuffer</code> object, by including the <code>MTLBuffer</code> object in a
<a href="#VkImportMetalBufferInfoEXT">VkImportMetalBufferInfoEXT</a> structure in the <code>pNext</code> chain of the
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure in the <a href="#vkAllocateMemory">vkAllocateMemory</a> command.</p>
</div>
<div class="paragraph">
<p>A new <a href="resources.html#VkImage" class="xref page">VkImage</a> object can be created on an existing <code>IOSurface</code>
object, or one or more existing Metal <code>MTLTexture</code> objects, by including
those Metal objects in either <a href="#VkImportMetalIOSurfaceInfoEXT">VkImportMetalIOSurfaceInfoEXT</a> or
<a href="#VkImportMetalTextureInfoEXT">VkImportMetalTextureInfoEXT</a> structures in the <code>pNext</code> chain of the
<a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a> structure in the <a href="resources.html#vkCreateImage" class="xref page">vkCreateImage</a> command.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export Metal objects from Vulkan objects, the app <strong>must</strong> first indicate
the intention to do so during the creation of the Vulkan object, by
including one or more <a href="#VkExportMetalObjectCreateInfoEXT">VkExportMetalObjectCreateInfoEXT</a> structures in
the <code>pNext</code> chain of the <a href="initialization.html#VkInstanceCreateInfo" class="xref page">VkInstanceCreateInfo</a>,
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a>, <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>,
<a href="resources.html#VkImageViewCreateInfo" class="xref page">VkImageViewCreateInfo</a>, <a href="resources.html#VkBufferViewCreateInfo" class="xref page">VkBufferViewCreateInfo</a>,
<a href="synchronization.html#VkSemaphoreCreateInfo" class="xref page">VkSemaphoreCreateInfo</a>, or <a href="synchronization.html#VkEventCreateInfo" class="xref page">VkEventCreateInfo</a>, in the
corresponding Vulkan object creation command.</p>
</div>
<div class="paragraph">
<p>The <code>VkExportMetalObjectCreateInfoEXT</code> structure is defined as:</p>
</div>
<div id="VkExportMetalObjectCreateInfoEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef struct VkExportMetalObjectCreateInfoEXT {
    VkStructureType                       sType;
    const void*                           pNext;
    VkExportMetalObjectTypeFlagBitsEXT    exportObjectType;
} VkExportMetalObjectCreateInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>exportObjectType</code> is a <a href="#VkExportMetalObjectTypeFlagBitsEXT">VkExportMetalObjectTypeFlagBitsEXT</a>
indicating the type of Metal object that the application may request to
be exported from the Vulkan object.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMetalObjectCreateInfoEXT-sType-sType" href="#VUID-VkExportMetalObjectCreateInfoEXT-sType-sType"></a> <span class="vuid">VUID-VkExportMetalObjectCreateInfoEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_METAL_OBJECT_CREATE_INFO_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectCreateInfoEXT-exportObjectType-parameter" href="#VUID-VkExportMetalObjectCreateInfoEXT-exportObjectType-parameter"></a> <span class="vuid">VUID-VkExportMetalObjectCreateInfoEXT-exportObjectType-parameter</span><br>
 If <code>exportObjectType</code> is not <code>0</code>, <code>exportObjectType</code> <strong>must</strong> be a valid <a href="#VkExportMetalObjectTypeFlagBitsEXT">VkExportMetalObjectTypeFlagBitsEXT</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which indicate the types of Metal objects that may be exported from a
corresponding Vulkan object are:</p>
</div>
<div id="VkExportMetalObjectTypeFlagBitsEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef enum VkExportMetalObjectTypeFlagBitsEXT {
    VK_EXPORT_METAL_OBJECT_TYPE_METAL_DEVICE_BIT_EXT = 0x00000001,
    VK_EXPORT_METAL_OBJECT_TYPE_METAL_COMMAND_QUEUE_BIT_EXT = 0x00000002,
    VK_EXPORT_METAL_OBJECT_TYPE_METAL_BUFFER_BIT_EXT = 0x00000004,
    VK_EXPORT_METAL_OBJECT_TYPE_METAL_TEXTURE_BIT_EXT = 0x00000008,
    VK_EXPORT_METAL_OBJECT_TYPE_METAL_IOSURFACE_BIT_EXT = 0x00000010,
    VK_EXPORT_METAL_OBJECT_TYPE_METAL_SHARED_EVENT_BIT_EXT = 0x00000020,
} VkExportMetalObjectTypeFlagBitsEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_DEVICE_BIT_EXT</code> indicates a Metal
<code>MTLDevice</code> may be exported.</p>
</li>
<li>
<p><code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_COMMAND_QUEUE_BIT_EXT</code> indicates
a Metal <code>MTLCommandQueue</code> may be exported.</p>
</li>
<li>
<p><code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_BUFFER_BIT_EXT</code> indicates a Metal
<code>MTLBuffer</code> may be exported.</p>
</li>
<li>
<p><code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_TEXTURE_BIT_EXT</code> indicates a
Metal <code>MTLTexture</code> may be exported.</p>
</li>
<li>
<p><code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_IOSURFACE_BIT_EXT</code> indicates a
Metal <code>IOSurface</code> may be exported.</p>
</li>
<li>
<p><code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_SHARED_EVENT_BIT_EXT</code> indicates a
Metal <code>MTLSharedEvent</code> may be exported.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkExportMetalObjectTypeFlagsEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef VkFlags VkExportMetalObjectTypeFlagsEXT;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkExportMetalObjectTypeFlagsEXT</code> is a bitmask type for setting a mask
of zero or more <a href="#VkExportMetalObjectTypeFlagBitsEXT">VkExportMetalObjectTypeFlagBitsEXT</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export Metal objects that underlie Vulkan objects, call:</p>
</div>
<div id="vkExportMetalObjectsEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
void vkExportMetalObjectsEXT(
    VkDevice                                    device,
    VkExportMetalObjectsInfoEXT*                pMetalObjectsInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device that created the Vulkan objects.</p>
</li>
<li>
<p><code>pMetalObjectsInfo</code> is a pointer to a
<a href="#VkExportMetalObjectsInfoEXT">VkExportMetalObjectsInfoEXT</a> structure whose <code>pNext</code> chain
contains structures, each identifying a Vulkan object and providing a
pointer through which the Metal object will be returned.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkExportMetalObjectsEXT-device-parameter" href="#VUID-vkExportMetalObjectsEXT-device-parameter"></a> <span class="vuid">VUID-vkExportMetalObjectsEXT-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkExportMetalObjectsEXT-pMetalObjectsInfo-parameter" href="#VUID-vkExportMetalObjectsEXT-pMetalObjectsInfo-parameter"></a> <span class="vuid">VUID-vkExportMetalObjectsEXT-pMetalObjectsInfo-parameter</span><br>
 <code>pMetalObjectsInfo</code> <strong>must</strong> be a valid pointer to a <a href="#VkExportMetalObjectsInfoEXT">VkExportMetalObjectsInfoEXT</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkExportMetalObjectsInfoEXT</code> structure is defined as:</p>
</div>
<div id="VkExportMetalObjectsInfoEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef struct VkExportMetalObjectsInfoEXT {
    VkStructureType    sType;
    const void*        pNext;
} VkExportMetalObjectsInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06791" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06791"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06791</span><br>

If the <code>pNext</code> chain includes a <a href="#VkExportMetalDeviceInfoEXT">VkExportMetalDeviceInfoEXT</a>
structure, the <a href="initialization.html#VkInstance" class="xref page">VkInstance</a> <strong>must</strong> have been created with
<code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_DEVICE_BIT_EXT</code> in the
<code>exportObjectType</code> member of a
<a href="#VkExportMetalObjectCreateInfoEXT">VkExportMetalObjectCreateInfoEXT</a> structure in the <code>pNext</code>
chain of the <a href="initialization.html#VkInstanceCreateInfo" class="xref page">VkInstanceCreateInfo</a> structure in the
<a href="initialization.html#vkCreateInstance" class="xref page">vkCreateInstance</a> command</p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06792" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06792"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06792</span><br>

If the <code>pNext</code> chain includes a
<a href="#VkExportMetalCommandQueueInfoEXT">VkExportMetalCommandQueueInfoEXT</a> structure, the <a href="initialization.html#VkInstance" class="xref page">VkInstance</a>
<strong>must</strong> have been created with
<code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_COMMAND_QUEUE_BIT_EXT</code> in the
<code>exportObjectType</code> member of a
<a href="#VkExportMetalObjectCreateInfoEXT">VkExportMetalObjectCreateInfoEXT</a> structure in the <code>pNext</code>
chain of the <a href="initialization.html#VkInstanceCreateInfo" class="xref page">VkInstanceCreateInfo</a> structure in the
<a href="initialization.html#vkCreateInstance" class="xref page">vkCreateInstance</a> command</p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06793" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06793"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06793</span><br>

If the <code>pNext</code> chain includes a <a href="#VkExportMetalBufferInfoEXT">VkExportMetalBufferInfoEXT</a>
structure, the <a href="#VkDeviceMemory">VkDeviceMemory</a> in its <code>memory</code> member <strong>must</strong>
have been allocated with
<code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_BUFFER_BIT_EXT</code> in the
<code>exportObjectType</code> member of a
<a href="#VkExportMetalObjectCreateInfoEXT">VkExportMetalObjectCreateInfoEXT</a> structure in the <code>pNext</code>
chain of the <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure in the
<a href="#vkAllocateMemory">vkAllocateMemory</a> command</p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06794" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06794"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06794</span><br>

If the <code>pNext</code> chain includes a <a href="#VkExportMetalTextureInfoEXT">VkExportMetalTextureInfoEXT</a>
structure, exactly one of its <code>image</code>, <code>imageView</code>, or
<code>bufferView</code> members <strong>must</strong> not be <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06795" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06795"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06795</span><br>

If the <code>pNext</code> chain includes a <a href="#VkExportMetalTextureInfoEXT">VkExportMetalTextureInfoEXT</a>
structure, and its <code>image</code> member is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the
<a href="resources.html#VkImage" class="xref page">VkImage</a> in its <code>image</code> member <strong>must</strong> have been created with
<code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_TEXTURE_BIT_EXT</code> in the
<code>exportObjectType</code> member of a
<a href="#VkExportMetalObjectCreateInfoEXT">VkExportMetalObjectCreateInfoEXT</a> structure in the <code>pNext</code>
chain of the <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a> structure in the
<a href="resources.html#vkCreateImage" class="xref page">vkCreateImage</a> command</p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06796" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06796"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06796</span><br>

If the <code>pNext</code> chain includes a <a href="#VkExportMetalTextureInfoEXT">VkExportMetalTextureInfoEXT</a>
structure, and its <code>imageView</code> member is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>,
the <a href="resources.html#VkImageView" class="xref page">VkImageView</a> in its <code>imageView</code> member <strong>must</strong> have been
created with <code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_TEXTURE_BIT_EXT</code> in
the <code>exportObjectType</code> member of a
<a href="#VkExportMetalObjectCreateInfoEXT">VkExportMetalObjectCreateInfoEXT</a> structure in the <code>pNext</code>
chain of the <a href="resources.html#VkImageViewCreateInfo" class="xref page">VkImageViewCreateInfo</a> structure in the
<a href="resources.html#vkCreateImageView" class="xref page">vkCreateImageView</a> command</p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06797" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06797"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06797</span><br>

If the <code>pNext</code> chain includes a <a href="#VkExportMetalTextureInfoEXT">VkExportMetalTextureInfoEXT</a>
structure, and its <code>bufferView</code> member is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>,
the <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> in its <code>bufferView</code> member <strong>must</strong> have been
created with <code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_TEXTURE_BIT_EXT</code> in
the <code>exportObjectType</code> member of a
<a href="#VkExportMetalObjectCreateInfoEXT">VkExportMetalObjectCreateInfoEXT</a> structure in the <code>pNext</code>
chain of the <a href="resources.html#VkBufferViewCreateInfo" class="xref page">VkBufferViewCreateInfo</a> structure in the
<a href="resources.html#vkCreateBufferView" class="xref page">vkCreateBufferView</a> command</p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06798" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06798"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06798</span><br>

If the <code>pNext</code> chain includes a <a href="#VkExportMetalTextureInfoEXT">VkExportMetalTextureInfoEXT</a>
structure, and if either its <code>image</code> or <code>imageView</code> member is
not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, then <code>plane</code> <strong>must</strong> be
<code>VK_IMAGE_ASPECT_PLANE_0_BIT</code>, <code>VK_IMAGE_ASPECT_PLANE_1_BIT</code>, or
<code>VK_IMAGE_ASPECT_PLANE_2_BIT</code></p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06799" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06799"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06799</span><br>

If the <code>pNext</code> chain includes a <a href="#VkExportMetalTextureInfoEXT">VkExportMetalTextureInfoEXT</a>
structure, and if the <a href="resources.html#VkImage" class="xref page">VkImage</a> in its <code>image</code> member does not
have a multi-planar format, then its <code>plane</code> member <strong>must</strong> be
<code>VK_IMAGE_ASPECT_PLANE_0_BIT</code></p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06800" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06800"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06800</span><br>

If the <code>pNext</code> chain includes a <a href="#VkExportMetalTextureInfoEXT">VkExportMetalTextureInfoEXT</a>
structure, and if the <a href="resources.html#VkImage" class="xref page">VkImage</a> in its <code>image</code> member has a
multi-planar format with only two planes, then its <code>plane</code> member
<strong>must</strong> not be <code>VK_IMAGE_ASPECT_PLANE_2_BIT</code></p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06801" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06801"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06801</span><br>

If the <code>pNext</code> chain includes a <a href="#VkExportMetalTextureInfoEXT">VkExportMetalTextureInfoEXT</a>
structure, and if the <a href="resources.html#VkImageView" class="xref page">VkImageView</a> in its <code>imageView</code> member
does not have a multi-planar format, then its <code>plane</code> member <strong>must</strong>
be <code>VK_IMAGE_ASPECT_PLANE_0_BIT</code></p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06802" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06802"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06802</span><br>

If the <code>pNext</code> chain includes a <a href="#VkExportMetalTextureInfoEXT">VkExportMetalTextureInfoEXT</a>
structure, and if the <a href="resources.html#VkImageView" class="xref page">VkImageView</a> in its <code>imageView</code> member
has a multi-planar format with only two planes, then its <code>plane</code>
member <strong>must</strong> not be <code>VK_IMAGE_ASPECT_PLANE_2_BIT</code></p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06803" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06803"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06803</span><br>

If the <code>pNext</code> chain includes a <a href="#VkExportMetalIOSurfaceInfoEXT">VkExportMetalIOSurfaceInfoEXT</a>
structure, the <a href="resources.html#VkImage" class="xref page">VkImage</a> in its <code>image</code> member <strong>must</strong> have been
created with <code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_IOSURFACE_BIT_EXT</code>
in the <code>exportObjectType</code> member of a
<a href="#VkExportMetalObjectCreateInfoEXT">VkExportMetalObjectCreateInfoEXT</a> structure in the <code>pNext</code>
chain of the <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a> structure in the
<a href="resources.html#vkCreateImage" class="xref page">vkCreateImage</a> command</p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06804" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06804"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06804</span><br>

If the <code>pNext</code> chain includes a
<a href="#VkExportMetalSharedEventInfoEXT">VkExportMetalSharedEventInfoEXT</a> structure, exactly one of its
<code>semaphore</code> or <code>event</code> members <strong>must</strong> not be <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06805" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06805"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06805</span><br>

If the <code>pNext</code> chain includes a
<a href="#VkExportMetalSharedEventInfoEXT">VkExportMetalSharedEventInfoEXT</a> structure, and its <code>semaphore</code>
member is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the <a href="synchronization.html#VkSemaphore" class="xref page">VkSemaphore</a> in its
<code>semaphore</code> member <strong>must</strong> have been created with
<code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_SHARED_EVENT_BIT_EXT</code> in the
<code>exportObjectType</code> member of a
<a href="#VkExportMetalObjectCreateInfoEXT">VkExportMetalObjectCreateInfoEXT</a> structure in the <code>pNext</code>
chain of the <a href="synchronization.html#VkSemaphoreCreateInfo" class="xref page">VkSemaphoreCreateInfo</a> structure in the
<a href="synchronization.html#vkCreateSemaphore" class="xref page">vkCreateSemaphore</a> command</p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-06806" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-06806"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-06806</span><br>

If the <code>pNext</code> chain includes a
<a href="#VkExportMetalSharedEventInfoEXT">VkExportMetalSharedEventInfoEXT</a> structure, and its <code>event</code>
member is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the <a href="synchronization.html#VkEvent" class="xref page">VkEvent</a> in its <code>event</code>
member <strong>must</strong> have been created with
<code>VK_EXPORT_METAL_OBJECT_TYPE_METAL_SHARED_EVENT_BIT_EXT</code> in the
<code>exportObjectType</code> member of a
<a href="#VkExportMetalObjectCreateInfoEXT">VkExportMetalObjectCreateInfoEXT</a> structure in the <code>pNext</code>
chain of the <a href="synchronization.html#VkEventCreateInfo" class="xref page">VkEventCreateInfo</a> structure in the
<a href="synchronization.html#vkCreateEvent" class="xref page">vkCreateEvent</a> command</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-sType-sType" href="#VUID-VkExportMetalObjectsInfoEXT-sType-sType"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_METAL_OBJECTS_INFO_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-pNext-pNext" href="#VUID-VkExportMetalObjectsInfoEXT-pNext-pNext"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-pNext-pNext</span><br>
 Each <code>pNext</code> member of any structure (including this one) in the <code>pNext</code> chain <strong>must</strong> be either <code>NULL</code> or a pointer to a valid instance of <a href="#VkExportMetalBufferInfoEXT">VkExportMetalBufferInfoEXT</a>, <a href="#VkExportMetalCommandQueueInfoEXT">VkExportMetalCommandQueueInfoEXT</a>, <a href="#VkExportMetalDeviceInfoEXT">VkExportMetalDeviceInfoEXT</a>, <a href="#VkExportMetalIOSurfaceInfoEXT">VkExportMetalIOSurfaceInfoEXT</a>, <a href="#VkExportMetalSharedEventInfoEXT">VkExportMetalSharedEventInfoEXT</a>, or <a href="#VkExportMetalTextureInfoEXT">VkExportMetalTextureInfoEXT</a></p>
</li>
<li>
<p><a id="VUID-VkExportMetalObjectsInfoEXT-sType-unique" href="#VUID-VkExportMetalObjectsInfoEXT-sType-unique"></a> <span class="vuid">VUID-VkExportMetalObjectsInfoEXT-sType-unique</span><br>
 The <code>sType</code> value of each struct in the <code>pNext</code> chain <strong>must</strong> be unique, with the exception of structures of type <a href="#VkExportMetalBufferInfoEXT">VkExportMetalBufferInfoEXT</a>, <a href="#VkExportMetalCommandQueueInfoEXT">VkExportMetalCommandQueueInfoEXT</a>, <a href="#VkExportMetalIOSurfaceInfoEXT">VkExportMetalIOSurfaceInfoEXT</a>, <a href="#VkExportMetalSharedEventInfoEXT">VkExportMetalSharedEventInfoEXT</a>, or <a href="#VkExportMetalTextureInfoEXT">VkExportMetalTextureInfoEXT</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export the Metal <code>MTLDevice</code> object underlying the
<a href="devsandqueues.html#VkPhysicalDevice" class="xref page">VkPhysicalDevice</a> associated with a <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> object, include a
<code>VkExportMetalDeviceInfoEXT</code> structure in the <code>pNext</code> chain of the
<code>pMetalObjectsInfo</code> parameter of a <a href="#vkExportMetalObjectsEXT">vkExportMetalObjectsEXT</a> call.</p>
</div>
<div class="paragraph">
<p>The <code>VkExportMetalDeviceInfoEXT</code> structure is defined as:</p>
</div>
<div id="VkExportMetalDeviceInfoEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef struct VkExportMetalDeviceInfoEXT {
    VkStructureType    sType;
    const void*        pNext;
    MTLDevice_id       mtlDevice;
} VkExportMetalDeviceInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>mtlDevice</code> is the Metal <code>id&lt;MTLDevice&gt;</code> object underlying the
<a href="devsandqueues.html#VkPhysicalDevice" class="xref page">VkPhysicalDevice</a> associated with the <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> object
identified in the call.
The implementation will return the <code>MTLDevice</code> in this member, or it
will return <code>NULL</code> if no <code>MTLDevice</code> could be found underlying the
<a href="devsandqueues.html#VkPhysicalDevice" class="xref page">VkPhysicalDevice</a> object.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMetalDeviceInfoEXT-sType-sType" href="#VUID-VkExportMetalDeviceInfoEXT-sType-sType"></a> <span class="vuid">VUID-VkExportMetalDeviceInfoEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_METAL_DEVICE_INFO_EXT</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The type <code>id&lt;MTLDevice&gt;</code> is defined in Apple&#8217;s Metal framework, but to
remove an unnecessary compile time dependency, an incomplete type definition
of <code>MTLDevice_id</code> is provided in the Vulkan headers:</p>
</div>
<div id="MTLDevice_id" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
#ifdef __OBJC__
@protocol MTLDevice;
typedef id&lt;MTLDevice&gt; MTLDevice_id;
#else
typedef void* MTLDevice_id;
#endif</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export the Metal <code>MTLCommandQueue</code> object underlying a <a href="devsandqueues.html#VkQueue" class="xref page">VkQueue</a>
object, include a <code>VkExportMetalCommandQueueInfoEXT</code> structure in the
<code>pNext</code> chain of the <code>pMetalObjectsInfo</code> parameter of a
<a href="#vkExportMetalObjectsEXT">vkExportMetalObjectsEXT</a> call.</p>
</div>
<div class="paragraph">
<p>The <code>VkExportMetalCommandQueueInfoEXT</code> structure is defined as:</p>
</div>
<div id="VkExportMetalCommandQueueInfoEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef struct VkExportMetalCommandQueueInfoEXT {
    VkStructureType       sType;
    const void*           pNext;
    VkQueue               queue;
    MTLCommandQueue_id    mtlCommandQueue;
} VkExportMetalCommandQueueInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>queue</code> is a <a href="devsandqueues.html#VkQueue" class="xref page">VkQueue</a>.</p>
</li>
<li>
<p><code>mtlCommandQueue</code> is the Metal <code>id&lt;MTLCommandQueue&gt;</code> object
underlying the <a href="devsandqueues.html#VkQueue" class="xref page">VkQueue</a> object in <code>queue</code>.
The implementation will return the <code>MTLCommandQueue</code> in this member,
or it will return <code>NULL</code> if no <code>MTLCommandQueue</code> could be found
underlying the <a href="devsandqueues.html#VkQueue" class="xref page">VkQueue</a> object.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMetalCommandQueueInfoEXT-sType-sType" href="#VUID-VkExportMetalCommandQueueInfoEXT-sType-sType"></a> <span class="vuid">VUID-VkExportMetalCommandQueueInfoEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_METAL_COMMAND_QUEUE_INFO_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkExportMetalCommandQueueInfoEXT-queue-parameter" href="#VUID-VkExportMetalCommandQueueInfoEXT-queue-parameter"></a> <span class="vuid">VUID-VkExportMetalCommandQueueInfoEXT-queue-parameter</span><br>
 <code>queue</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkQueue" class="xref page">VkQueue</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The type <code>id&lt;MTLCommandQueue&gt;</code> is defined in Apple&#8217;s Metal framework, but to
remove an unnecessary compile time dependency, an incomplete type definition
of <code>MTLCommandQueue_id</code> is provided in the Vulkan headers:</p>
</div>
<div id="MTLCommandQueue_id" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
#ifdef __OBJC__
@protocol MTLCommandQueue;
typedef id&lt;MTLCommandQueue&gt; MTLCommandQueue_id;
#else
typedef void* MTLCommandQueue_id;
#endif</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export the Metal <code>MTLBuffer</code> object underlying a <a href="#VkDeviceMemory">VkDeviceMemory</a>
object, include a <code>VkExportMetalBufferInfoEXT</code> structure in the
<code>pNext</code> chain of the <code>pMetalObjectsInfo</code> parameter of a
<a href="#vkExportMetalObjectsEXT">vkExportMetalObjectsEXT</a> call.</p>
</div>
<div class="paragraph">
<p>The <code>VkExportMetalBufferInfoEXT</code> structure is defined as:</p>
</div>
<div id="VkExportMetalBufferInfoEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef struct VkExportMetalBufferInfoEXT {
    VkStructureType    sType;
    const void*        pNext;
    VkDeviceMemory     memory;
    MTLBuffer_id       mtlBuffer;
} VkExportMetalBufferInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>memory</code> is a <a href="#VkDeviceMemory">VkDeviceMemory</a>.</p>
</li>
<li>
<p><code>mtlBuffer</code> is the Metal <code>id&lt;MTLBuffer&gt;</code> object underlying the
<a href="#VkDeviceMemory">VkDeviceMemory</a> object in <code>memory</code>.
The implementation will return the <code>MTLBuffer</code> in this member, or it
will return <code>NULL</code> if no <code>MTLBuffer</code> could be found underlying the
<a href="#VkDeviceMemory">VkDeviceMemory</a> object.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMetalBufferInfoEXT-sType-sType" href="#VUID-VkExportMetalBufferInfoEXT-sType-sType"></a> <span class="vuid">VUID-VkExportMetalBufferInfoEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_METAL_BUFFER_INFO_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkExportMetalBufferInfoEXT-memory-parameter" href="#VUID-VkExportMetalBufferInfoEXT-memory-parameter"></a> <span class="vuid">VUID-VkExportMetalBufferInfoEXT-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To import a Metal <code>MTLBuffer</code> object to underlie a <a href="#VkDeviceMemory">VkDeviceMemory</a>
object, include a <code>VkImportMetalBufferInfoEXT</code> structure in the
<code>pNext</code> chain of the <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure in a
<a href="#vkAllocateMemory">vkAllocateMemory</a> command.</p>
</div>
<div class="paragraph">
<p>The <code>VkImportMetalBufferInfoEXT</code> structure is defined as:</p>
</div>
<div id="VkImportMetalBufferInfoEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef struct VkImportMetalBufferInfoEXT {
    VkStructureType    sType;
    const void*        pNext;
    MTLBuffer_id       mtlBuffer;
} VkImportMetalBufferInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>mtlBuffer</code> is the Metal <code>id&lt;MTLBuffer&gt;</code> object that is to underlie
the <a href="#VkDeviceMemory">VkDeviceMemory</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The app <strong>must</strong> ensure that the configuration of the <code>id&lt;MTLBuffer&gt;</code> object is
compatible with the configuration of the <a href="#VkDeviceMemory">VkDeviceMemory</a>.
Failure to do so results in <strong>undefined</strong> behavior.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportMetalBufferInfoEXT-sType-sType" href="#VUID-VkImportMetalBufferInfoEXT-sType-sType"></a> <span class="vuid">VUID-VkImportMetalBufferInfoEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_METAL_BUFFER_INFO_EXT</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The type <code>id&lt;MTLBuffer&gt;</code> is defined in Apple&#8217;s Metal framework, but to
remove an unnecessary compile time dependency, an incomplete type definition
of <code>MTLBuffer_id</code> is provided in the Vulkan headers:</p>
</div>
<div id="MTLBuffer_id" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
#ifdef __OBJC__
@protocol MTLBuffer;
typedef id&lt;MTLBuffer&gt; MTLBuffer_id;
#else
typedef void* MTLBuffer_id;
#endif</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export a Metal <code>MTLTexture</code> object underlying a <a href="resources.html#VkImage" class="xref page">VkImage</a>,
<a href="resources.html#VkImageView" class="xref page">VkImageView</a>, or <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> object, include a
<code>VkExportMetalTextureInfoEXT</code> structure in the <code>pNext</code> chain of the
<code>pMetalObjectsInfo</code> parameter of a <a href="#vkExportMetalObjectsEXT">vkExportMetalObjectsEXT</a> call.</p>
</div>
<div class="paragraph">
<p>The <code>VkExportMetalTextureInfoEXT</code> structure is defined as:</p>
</div>
<div id="VkExportMetalTextureInfoEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef struct VkExportMetalTextureInfoEXT {
    VkStructureType          sType;
    const void*              pNext;
    VkImage                  image;
    VkImageView              imageView;
    VkBufferView             bufferView;
    VkImageAspectFlagBits    plane;
    MTLTexture_id            mtlTexture;
} VkExportMetalTextureInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>image</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> or a <a href="resources.html#VkImage" class="xref page">VkImage</a>.</p>
</li>
<li>
<p><code>imageView</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> or a <a href="resources.html#VkImageView" class="xref page">VkImageView</a>.</p>
</li>
<li>
<p><code>bufferView</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> or a <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a>.</p>
</li>
<li>
<p><code>plane</code> indicates the plane of a multi-planar <a href="resources.html#VkImage" class="xref page">VkImage</a> or
<a href="resources.html#VkImageView" class="xref page">VkImageView</a>.</p>
</li>
<li>
<p><code>mtlTexture</code> is the Metal <code>id&lt;MTLTexture&gt;</code> object underlying the
<a href="resources.html#VkImage" class="xref page">VkImage</a>, <a href="resources.html#VkImageView" class="xref page">VkImageView</a>, or <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> object in
<code>image</code>, <code>imageView</code>, or <code>bufferView</code>, respectively, at the
plane indicated in <code>aspectMask</code>.
The implementation will return the <code>MTLTexture</code> in this member, or it
will return <code>NULL</code> if no <code>MTLTexture</code> could be found underlying the
<a href="resources.html#VkImage" class="xref page">VkImage</a>, <a href="resources.html#VkImageView" class="xref page">VkImageView</a>, or <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> object, at the
plane indicated in <code>aspectMask</code>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMetalTextureInfoEXT-sType-sType" href="#VUID-VkExportMetalTextureInfoEXT-sType-sType"></a> <span class="vuid">VUID-VkExportMetalTextureInfoEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_METAL_TEXTURE_INFO_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkExportMetalTextureInfoEXT-image-parameter" href="#VUID-VkExportMetalTextureInfoEXT-image-parameter"></a> <span class="vuid">VUID-VkExportMetalTextureInfoEXT-image-parameter</span><br>
 If <code>image</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>image</code> <strong>must</strong> be a valid <a href="resources.html#VkImage" class="xref page">VkImage</a> handle</p>
</li>
<li>
<p><a id="VUID-VkExportMetalTextureInfoEXT-imageView-parameter" href="#VUID-VkExportMetalTextureInfoEXT-imageView-parameter"></a> <span class="vuid">VUID-VkExportMetalTextureInfoEXT-imageView-parameter</span><br>
 If <code>imageView</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>imageView</code> <strong>must</strong> be a valid <a href="resources.html#VkImageView" class="xref page">VkImageView</a> handle</p>
</li>
<li>
<p><a id="VUID-VkExportMetalTextureInfoEXT-bufferView-parameter" href="#VUID-VkExportMetalTextureInfoEXT-bufferView-parameter"></a> <span class="vuid">VUID-VkExportMetalTextureInfoEXT-bufferView-parameter</span><br>
 If <code>bufferView</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>bufferView</code> <strong>must</strong> be a valid <a href="resources.html#VkBufferView" class="xref page">VkBufferView</a> handle</p>
</li>
<li>
<p><a id="VUID-VkExportMetalTextureInfoEXT-plane-parameter" href="#VUID-VkExportMetalTextureInfoEXT-plane-parameter"></a> <span class="vuid">VUID-VkExportMetalTextureInfoEXT-plane-parameter</span><br>
 <code>plane</code> <strong>must</strong> be a valid <a href="resources.html#VkImageAspectFlagBits" class="xref page">VkImageAspectFlagBits</a> value</p>
</li>
<li>
<p><a id="VUID-VkExportMetalTextureInfoEXT-commonparent" href="#VUID-VkExportMetalTextureInfoEXT-commonparent"></a> <span class="vuid">VUID-VkExportMetalTextureInfoEXT-commonparent</span><br>
 Each of <code>bufferView</code>, <code>image</code>, and <code>imageView</code> that are valid handles of non-ignored parameters <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To import one or more existing Metal <code>MTLTexture</code> objects to underlie a
<a href="resources.html#VkImage" class="xref page">VkImage</a> object, include one or more <code>VkImportMetalTextureInfoEXT</code>
structures in the <code>pNext</code> chain of the <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a> structure
in a <a href="resources.html#vkCreateImage" class="xref page">vkCreateImage</a> command.</p>
</div>
<div class="paragraph">
<p>The <code>VkImportMetalTextureInfoEXT</code> structure is defined as:</p>
</div>
<div id="VkImportMetalTextureInfoEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef struct VkImportMetalTextureInfoEXT {
    VkStructureType          sType;
    const void*              pNext;
    VkImageAspectFlagBits    plane;
    MTLTexture_id            mtlTexture;
} VkImportMetalTextureInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>plane</code> indicates the plane of the <a href="resources.html#VkImage" class="xref page">VkImage</a> that the
<code>id&lt;MTLTexture&gt;</code> object should be attached to.</p>
</li>
<li>
<p><code>mtlTexture</code> is a the Metal <code>id&lt;MTLTexture&gt;</code> object that is to
underlie the <a href="resources.html#VkImage" class="xref page">VkImage</a> plane.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>pNext</code> chain <strong>must</strong> include one <code>VkImportMetalTextureInfoEXT</code>
structure for each plane in the <a href="resources.html#VkImage" class="xref page">VkImage</a>.
The app <strong>must</strong> ensure that the configuration of the Metal <code>id&lt;MTLTexture&gt;</code>
objects are compatible with the configuration of the <a href="resources.html#VkImage" class="xref page">VkImage</a>.
Failure to do so results in <strong>undefined</strong> behavior.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportMetalTextureInfoEXT-sType-sType" href="#VUID-VkImportMetalTextureInfoEXT-sType-sType"></a> <span class="vuid">VUID-VkImportMetalTextureInfoEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_METAL_TEXTURE_INFO_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkImportMetalTextureInfoEXT-plane-parameter" href="#VUID-VkImportMetalTextureInfoEXT-plane-parameter"></a> <span class="vuid">VUID-VkImportMetalTextureInfoEXT-plane-parameter</span><br>
 <code>plane</code> <strong>must</strong> be a valid <a href="resources.html#VkImageAspectFlagBits" class="xref page">VkImageAspectFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The type <code>id&lt;MTLTexture&gt;</code> is defined in Apple&#8217;s Metal framework, but to
remove an unnecessary compile time dependency, an incomplete type definition
of <code>MTLTexture_id</code> is provided in the Vulkan headers:</p>
</div>
<div id="MTLTexture_id" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
#ifdef __OBJC__
@protocol MTLTexture;
typedef id&lt;MTLTexture&gt; MTLTexture_id;
#else
typedef void* MTLTexture_id;
#endif</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export the Metal <code>IOSurfaceRef</code> object underlying a <a href="resources.html#VkImage" class="xref page">VkImage</a>
object, include a <code>VkExportMetalIOSurfaceInfoEXT</code> structure in the
<code>pNext</code> chain of the <code>pMetalObjectsInfo</code> parameter of a
<a href="#vkExportMetalObjectsEXT">vkExportMetalObjectsEXT</a> call.</p>
</div>
<div class="paragraph">
<p>The <code>VkExportMetalIOSurfaceInfoEXT</code> structure is defined as:</p>
</div>
<div id="VkExportMetalIOSurfaceInfoEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef struct VkExportMetalIOSurfaceInfoEXT {
    VkStructureType    sType;
    const void*        pNext;
    VkImage            image;
    IOSurfaceRef       ioSurface;
} VkExportMetalIOSurfaceInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>image</code> is a <a href="resources.html#VkImage" class="xref page">VkImage</a>.</p>
</li>
<li>
<p><code>ioSurface</code> is the Metal <code>IOSurfaceRef</code> object underlying the
<a href="resources.html#VkImage" class="xref page">VkImage</a> object in <code>image</code>.
The implementation will return the <code>IOSurfaceRef</code> in this member,
or it will return <code>NULL</code> if no <code>IOSurfaceRef</code> could be found
underlying the <a href="resources.html#VkImage" class="xref page">VkImage</a> object.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMetalIOSurfaceInfoEXT-sType-sType" href="#VUID-VkExportMetalIOSurfaceInfoEXT-sType-sType"></a> <span class="vuid">VUID-VkExportMetalIOSurfaceInfoEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_METAL_IO_SURFACE_INFO_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkExportMetalIOSurfaceInfoEXT-image-parameter" href="#VUID-VkExportMetalIOSurfaceInfoEXT-image-parameter"></a> <span class="vuid">VUID-VkExportMetalIOSurfaceInfoEXT-image-parameter</span><br>
 <code>image</code> <strong>must</strong> be a valid <a href="resources.html#VkImage" class="xref page">VkImage</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To import, or create, a Metal <code>IOSurfaceRef</code> object to underlie a
<a href="resources.html#VkImage" class="xref page">VkImage</a> object, include a <code>VkImportMetalIOSurfaceInfoEXT</code>
structure in the <code>pNext</code> chain of the <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a> structure
in a <a href="resources.html#vkCreateImage" class="xref page">vkCreateImage</a> command.</p>
</div>
<div class="paragraph">
<p>The <code>VkImportMetalIOSurfaceInfoEXT</code> structure is defined as:</p>
</div>
<div id="VkImportMetalIOSurfaceInfoEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef struct VkImportMetalIOSurfaceInfoEXT {
    VkStructureType    sType;
    const void*        pNext;
    IOSurfaceRef       ioSurface;
} VkImportMetalIOSurfaceInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>ioSurface</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> or the Metal
<code>IOSurfaceRef</code> object that is to underlie the <a href="resources.html#VkImage" class="xref page">VkImage</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>ioSurface</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, it will be used to underlie
the <a href="resources.html#VkImage" class="xref page">VkImage</a>.
If <code>ioSurface</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the implementation will create a
new <code>IOSurface</code> to underlie the <a href="resources.html#VkImage" class="xref page">VkImage</a>.</p>
</div>
<div class="paragraph">
<p>If provided, the app <strong>must</strong> ensure that the configuration of the
<code>IOSurfaceRef</code> object is compatible with the configuration of the
<a href="resources.html#VkImage" class="xref page">VkImage</a>.
Failure to do so results in <strong>undefined</strong> behavior.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportMetalIOSurfaceInfoEXT-sType-sType" href="#VUID-VkImportMetalIOSurfaceInfoEXT-sType-sType"></a> <span class="vuid">VUID-VkImportMetalIOSurfaceInfoEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_METAL_IO_SURFACE_INFO_EXT</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The type <code>IOSurfaceRef</code> is defined in Apple&#8217;s CoreGraphics framework,
but to remove an unnecessary compile time dependency, an incomplete type
definition of <code>IOSurfaceRef</code> is provided in the Vulkan headers:</p>
</div>
<div id="IOSurfaceRef" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef struct __IOSurface* IOSurfaceRef;</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export the Metal <code>MTLSharedEvent</code> object underlying a
<a href="synchronization.html#VkSemaphore" class="xref page">VkSemaphore</a> or <a href="synchronization.html#VkEvent" class="xref page">VkEvent</a> object, include a
<code>VkExportMetalSharedEventInfoEXT</code> structure in the <code>pNext</code> chain of
the <code>pMetalObjectsInfo</code> parameter of a <a href="#vkExportMetalObjectsEXT">vkExportMetalObjectsEXT</a>
call.</p>
</div>
<div class="paragraph">
<p>The <code>VkExportMetalSharedEventInfoEXT</code> structure is defined as:</p>
</div>
<div id="VkExportMetalSharedEventInfoEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef struct VkExportMetalSharedEventInfoEXT {
    VkStructureType      sType;
    const void*          pNext;
    VkSemaphore          semaphore;
    VkEvent              event;
    MTLSharedEvent_id    mtlSharedEvent;
} VkExportMetalSharedEventInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>semaphore</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> or a <a href="synchronization.html#VkSemaphore" class="xref page">VkSemaphore</a>.</p>
</li>
<li>
<p><code>event</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a> or a <a href="synchronization.html#VkEvent" class="xref page">VkEvent</a>.</p>
</li>
<li>
<p><code>mtlSharedEvent</code> is the Metal <code>id&lt;MTLSharedEvent&gt;</code> object underlying
the <a href="synchronization.html#VkSemaphore" class="xref page">VkSemaphore</a> or <a href="synchronization.html#VkEvent" class="xref page">VkEvent</a> object in <code>semaphore</code> or
<code>event</code>, respectively.
The implementation will return the <code>MTLSharedEvent</code> in this member,
or it will return <code>NULL</code> if no <code>MTLSharedEvent</code> could be found
underlying the <a href="synchronization.html#VkSemaphore" class="xref page">VkSemaphore</a> or <a href="synchronization.html#VkEvent" class="xref page">VkEvent</a> object.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportMetalSharedEventInfoEXT-sType-sType" href="#VUID-VkExportMetalSharedEventInfoEXT-sType-sType"></a> <span class="vuid">VUID-VkExportMetalSharedEventInfoEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_METAL_SHARED_EVENT_INFO_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkExportMetalSharedEventInfoEXT-semaphore-parameter" href="#VUID-VkExportMetalSharedEventInfoEXT-semaphore-parameter"></a> <span class="vuid">VUID-VkExportMetalSharedEventInfoEXT-semaphore-parameter</span><br>
 If <code>semaphore</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>semaphore</code> <strong>must</strong> be a valid <a href="synchronization.html#VkSemaphore" class="xref page">VkSemaphore</a> handle</p>
</li>
<li>
<p><a id="VUID-VkExportMetalSharedEventInfoEXT-event-parameter" href="#VUID-VkExportMetalSharedEventInfoEXT-event-parameter"></a> <span class="vuid">VUID-VkExportMetalSharedEventInfoEXT-event-parameter</span><br>
 If <code>event</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>event</code> <strong>must</strong> be a valid <a href="synchronization.html#VkEvent" class="xref page">VkEvent</a> handle</p>
</li>
<li>
<p><a id="VUID-VkExportMetalSharedEventInfoEXT-commonparent" href="#VUID-VkExportMetalSharedEventInfoEXT-commonparent"></a> <span class="vuid">VUID-VkExportMetalSharedEventInfoEXT-commonparent</span><br>
 Both of <code>event</code>, and <code>semaphore</code> that are valid handles of non-ignored parameters <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To import a Metal <code>id&lt;MTLSharedEvent&gt;</code> object to underlie a
<a href="synchronization.html#VkSemaphore" class="xref page">VkSemaphore</a> or <a href="synchronization.html#VkEvent" class="xref page">VkEvent</a> object, include a
<code>VkImportMetalSharedEventInfoEXT</code> structure in the <code>pNext</code> chain of
the <a href="synchronization.html#VkSemaphoreCreateInfo" class="xref page">VkSemaphoreCreateInfo</a> or <a href="synchronization.html#VkEventCreateInfo" class="xref page">VkEventCreateInfo</a> structure in a
<a href="synchronization.html#vkCreateSemaphore" class="xref page">vkCreateSemaphore</a> or <a href="synchronization.html#vkCreateEvent" class="xref page">vkCreateEvent</a> command, respectively.</p>
</div>
<div class="paragraph">
<p>The <code>VkImportMetalSharedEventInfoEXT</code> structure is defined as:</p>
</div>
<div id="VkImportMetalSharedEventInfoEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
typedef struct VkImportMetalSharedEventInfoEXT {
    VkStructureType      sType;
    const void*          pNext;
    MTLSharedEvent_id    mtlSharedEvent;
} VkImportMetalSharedEventInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>mtlSharedEvent</code> is the Metal <code>id&lt;MTLSharedEvent&gt;</code> object that is to
underlie the <a href="synchronization.html#VkSemaphore" class="xref page">VkSemaphore</a> or <a href="synchronization.html#VkEvent" class="xref page">VkEvent</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the <code>pNext</code> chain of the <a href="synchronization.html#VkSemaphoreCreateInfo" class="xref page">VkSemaphoreCreateInfo</a> structure
includes both <code>VkImportMetalSharedEventInfoEXT</code> and
<a href="synchronization.html#VkSemaphoreTypeCreateInfo" class="xref page">VkSemaphoreTypeCreateInfo</a>, the <code>signaledValue</code> property of the
imported <code>id&lt;MTLSharedEvent&gt;</code> object will be set to <code>initialValue</code> of
<a href="synchronization.html#VkSemaphoreTypeCreateInfo" class="xref page">VkSemaphoreTypeCreateInfo</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportMetalSharedEventInfoEXT-sType-sType" href="#VUID-VkImportMetalSharedEventInfoEXT-sType-sType"></a> <span class="vuid">VUID-VkImportMetalSharedEventInfoEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_METAL_SHARED_EVENT_INFO_EXT</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The type <code>id&lt;MTLSharedEvent&gt;</code> is defined in Apple&#8217;s Metal framework, but to
remove an unnecessary compile time dependency, an incomplete type definition
of <code>MTLSharedEvent_id</code> is provided in the Vulkan headers:</p>
</div>
<div id="MTLSharedEvent_id" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_metal_objects
#ifdef __OBJC__
@protocol MTLSharedEvent;
typedef id&lt;MTLSharedEvent&gt; MTLSharedEvent_id;
#else
typedef void* MTLSharedEvent_id;
#endif</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="qnx-screen-buffer-external-memory"><a class="anchor" href="#qnx-screen-buffer-external-memory"></a>QNX Screen Buffer External Memory</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To import memory created outside of the current Vulkan instance from a QNX
Screen buffer, add a <code>VkImportScreenBufferInfoQNX</code> structure to the
<code>pNext</code> chain of the <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure.
The <code>VkImportScreenBufferInfoQNX</code> structure is defined as:</p>
</div>
<div id="VkImportScreenBufferInfoQNX" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_QNX_external_memory_screen_buffer
typedef struct VkImportScreenBufferInfoQNX {
    VkStructureType           sType;
    const void*               pNext;
    struct _screen_buffer*    buffer;
} VkImportScreenBufferInfoQNX;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>buffer</code> is a pointer to a <code>struct</code> <code>_screen_buffer</code>, the QNX
Screen buffer to import</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The implementation <strong>may</strong> not acquire a reference to the imported Screen
buffer.
Therefore, the application <strong>must</strong> ensure that the object referred to by
<code>buffer</code> stays valid as long as the device memory to which it is
imported is being used.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportScreenBufferInfoQNX-buffer-08966" href="#VUID-VkImportScreenBufferInfoQNX-buffer-08966"></a> <span class="vuid">VUID-VkImportScreenBufferInfoQNX-buffer-08966</span><br>

If <code>buffer</code> is not <code>NULL</code>, QNX Screen Buffers <strong>must</strong> be supported for
import, as reported by <a href="capabilities.html#VkExternalImageFormatProperties" class="xref page">VkExternalImageFormatProperties</a> or
<a href="capabilities.html#VkExternalBufferProperties" class="xref page">VkExternalBufferProperties</a></p>
</li>
<li>
<p><a id="VUID-VkImportScreenBufferInfoQNX-buffer-08967" href="#VUID-VkImportScreenBufferInfoQNX-buffer-08967"></a> <span class="vuid">VUID-VkImportScreenBufferInfoQNX-buffer-08967</span><br>

<code>buffer</code> is not <code>NULL</code>, it <strong>must</strong> be a pointer to
<a href="#memory-external-screen-buffer-validity">valid QNX Screen buffer</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportScreenBufferInfoQNX-sType-sType" href="#VUID-VkImportScreenBufferInfoQNX-sType-sType"></a> <span class="vuid">VUID-VkImportScreenBufferInfoQNX-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_SCREEN_BUFFER_INFO_QNX</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To determine the memory parameters to use when importing a QNX Screen
buffer, call:</p>
</div>
<div id="vkGetScreenBufferPropertiesQNX" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_QNX_external_memory_screen_buffer
VkResult vkGetScreenBufferPropertiesQNX(
    VkDevice                                    device,
    const struct _screen_buffer*                buffer,
    VkScreenBufferPropertiesQNX*                pProperties);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that will be importing <code>buffer</code>.</p>
</li>
<li>
<p><code>buffer</code> is the QNX Screen buffer which will be imported.</p>
</li>
<li>
<p><code>pProperties</code> is a pointer to a <a href="#VkScreenBufferPropertiesQNX">VkScreenBufferPropertiesQNX</a>
structure in which the properties of <code>buffer</code> are returned.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetScreenBufferPropertiesQNX-buffer-08968" href="#VUID-vkGetScreenBufferPropertiesQNX-buffer-08968"></a> <span class="vuid">VUID-vkGetScreenBufferPropertiesQNX-buffer-08968</span><br>

<code>buffer</code> <strong>must</strong> be a <a href="#memory-external-screen-buffer-validity">valid    QNX Screen buffer</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetScreenBufferPropertiesQNX-device-parameter" href="#VUID-vkGetScreenBufferPropertiesQNX-device-parameter"></a> <span class="vuid">VUID-vkGetScreenBufferPropertiesQNX-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetScreenBufferPropertiesQNX-buffer-parameter" href="#VUID-vkGetScreenBufferPropertiesQNX-buffer-parameter"></a> <span class="vuid">VUID-vkGetScreenBufferPropertiesQNX-buffer-parameter</span><br>
 <code>buffer</code> <strong>must</strong> be a valid pointer to a valid <code>_screen_buffer</code> value</p>
</li>
<li>
<p><a id="VUID-vkGetScreenBufferPropertiesQNX-pProperties-parameter" href="#VUID-vkGetScreenBufferPropertiesQNX-pProperties-parameter"></a> <span class="vuid">VUID-vkGetScreenBufferPropertiesQNX-pProperties-parameter</span><br>
 <code>pProperties</code> <strong>must</strong> be a valid pointer to a <a href="#VkScreenBufferPropertiesQNX">VkScreenBufferPropertiesQNX</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_INVALID_EXTERNAL_HANDLE_KHR</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkScreenBufferPropertiesQNX</code> structure returned is defined as:</p>
</div>
<div id="VkScreenBufferPropertiesQNX" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_QNX_external_memory_screen_buffer
typedef struct VkScreenBufferPropertiesQNX {
    VkStructureType    sType;
    void*              pNext;
    VkDeviceSize       allocationSize;
    uint32_t           memoryTypeBits;
} VkScreenBufferPropertiesQNX;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>allocationSize</code> is the size of the external memory.</p>
</li>
<li>
<p><code>memoryTypeBits</code> is a bitmask containing one bit set for every
memory type which the specified Screen buffer <strong>can</strong> be imported as.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkScreenBufferPropertiesQNX-sType-sType" href="#VUID-VkScreenBufferPropertiesQNX-sType-sType"></a> <span class="vuid">VUID-VkScreenBufferPropertiesQNX-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_SCREEN_BUFFER_PROPERTIES_QNX</code></p>
</li>
<li>
<p><a id="VUID-VkScreenBufferPropertiesQNX-pNext-pNext" href="#VUID-VkScreenBufferPropertiesQNX-pNext-pNext"></a> <span class="vuid">VUID-VkScreenBufferPropertiesQNX-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code> or a pointer to a valid instance of <a href="#VkScreenBufferFormatPropertiesQNX">VkScreenBufferFormatPropertiesQNX</a></p>
</li>
<li>
<p><a id="VUID-VkScreenBufferPropertiesQNX-sType-unique" href="#VUID-VkScreenBufferPropertiesQNX-sType-unique"></a> <span class="vuid">VUID-VkScreenBufferPropertiesQNX-sType-unique</span><br>
 The <code>sType</code> value of each struct in the <code>pNext</code> chain <strong>must</strong> be unique</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To obtain format properties of a QNX Screen buffer, include a
<code>VkScreenBufferFormatPropertiesQNX</code> structure in the <code>pNext</code> chain
of the <a href="#VkScreenBufferPropertiesQNX">VkScreenBufferPropertiesQNX</a> structure passed to
<a href="#vkGetScreenBufferPropertiesQNX">vkGetScreenBufferPropertiesQNX</a>.
This structure is defined as:</p>
</div>
<div id="VkScreenBufferFormatPropertiesQNX" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_QNX_external_memory_screen_buffer
typedef struct VkScreenBufferFormatPropertiesQNX {
    VkStructureType                  sType;
    void*                            pNext;
    VkFormat                         format;
    uint64_t                         externalFormat;
    uint64_t                         screenUsage;
    VkFormatFeatureFlags             formatFeatures;
    VkComponentMapping               samplerYcbcrConversionComponents;
    VkSamplerYcbcrModelConversion    suggestedYcbcrModel;
    VkSamplerYcbcrRange              suggestedYcbcrRange;
    VkChromaLocation                 suggestedXChromaOffset;
    VkChromaLocation                 suggestedYChromaOffset;
} VkScreenBufferFormatPropertiesQNX;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>format</code> is the Vulkan format corresponding to the Screen buffer&#8217;s
format or <code>VK_FORMAT_UNDEFINED</code> if there is not an equivalent Vulkan
format.</p>
</li>
<li>
<p><code>externalFormat</code> is an implementation-defined external format
identifier for use with <a href="resources.html#VkExternalFormatQNX" class="xref page">VkExternalFormatQNX</a>.
It <strong>must</strong> not be zero.</p>
</li>
<li>
<p><code>screenUsage</code> is an implementation-defined external usage identifier
for the QNX Screen buffer.</p>
</li>
<li>
<p><code>formatFeatures</code> describes the capabilities of this external format
when used with an image bound to memory imported from <code>buffer</code>.</p>
</li>
<li>
<p><code>samplerYcbcrConversionComponents</code> is the component swizzle that
<strong>should</strong> be used in <a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
<li>
<p><code>suggestedYcbcrModel</code> is a suggested color model to use in the
<a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
<li>
<p><code>suggestedYcbcrRange</code> is a suggested numerical value range to use in
<a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
<li>
<p><code>suggestedXChromaOffset</code> is a suggested X chroma offset to use in
<a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
<li>
<p><code>suggestedYChromaOffset</code> is a suggested Y chroma offset to use in
<a href="samplers.html#VkSamplerYcbcrConversionCreateInfo" class="xref page">VkSamplerYcbcrConversionCreateInfo</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the QNX Screen buffer has one of the formats listed in the
<a href="#memory-external-qnx-screen-buffer-formats">QNX Screen Format Equivalencetable</a>, then <code>format</code> <strong>must</strong> have the equivalent Vulkan format listed in
the table.
Otherwise, <code>format</code> <strong>may</strong> be <code>VK_FORMAT_UNDEFINED</code>, indicating the
QNX Screen buffer <strong>can</strong> only be used with an external format.
The <code>formatFeatures</code> member <strong>must</strong> include
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT</code> and <strong>should</strong> include
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BIT</code> and
<code>VK_FORMAT_FEATURE_SAMPLED_IMAGE_YCBCR_CONVERSION_LINEAR_FILTER_BIT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkScreenBufferFormatPropertiesQNX-sType-sType" href="#VUID-VkScreenBufferFormatPropertiesQNX-sType-sType"></a> <span class="vuid">VUID-VkScreenBufferFormatPropertiesQNX-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_SCREEN_BUFFER_FORMAT_PROPERTIES_QNX</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_device_group_memory_allocations"><a class="anchor" href="#_device_group_memory_allocations"></a>Device Group Memory Allocations</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If the <code>pNext</code> chain of <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> includes a
<code>VkMemoryAllocateFlagsInfo</code> structure, then that structure includes
flags and a device mask controlling how many instances of the memory will be
allocated.</p>
</div>
<div class="paragraph">
<p>The <code>VkMemoryAllocateFlagsInfo</code> structure is defined as:</p>
</div>
<div id="VkMemoryAllocateFlagsInfo" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
typedef struct VkMemoryAllocateFlagsInfo {
    VkStructureType          sType;
    const void*              pNext;
    VkMemoryAllocateFlags    flags;
    uint32_t                 deviceMask;
} VkMemoryAllocateFlagsInfo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkMemoryAllocateFlagsInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_device_group
typedef VkMemoryAllocateFlagsInfo VkMemoryAllocateFlagsInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="#VkMemoryAllocateFlagBits">VkMemoryAllocateFlagBits</a> controlling
the allocation.</p>
</li>
<li>
<p><code>deviceMask</code> is a mask of physical devices in the logical device,
indicating that memory <strong>must</strong> be allocated on each device in the mask, if
<code>VK_MEMORY_ALLOCATE_DEVICE_MASK_BIT</code> is set in <code>flags</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>VK_MEMORY_ALLOCATE_DEVICE_MASK_BIT</code> is not set, the number of
instances allocated depends on whether
<code>VK_MEMORY_HEAP_MULTI_INSTANCE_BIT</code> is set in the memory heap.
If <code>VK_MEMORY_HEAP_MULTI_INSTANCE_BIT</code> is set, then memory is allocated
for every physical device in the logical device (as if <code>deviceMask</code> has
bits set for all device indices).
If <code>VK_MEMORY_HEAP_MULTI_INSTANCE_BIT</code> is not set, then a single
instance of memory is allocated (as if <code>deviceMask</code> is set to one).</p>
</div>
<div class="paragraph">
<p>On some implementations, allocations from a multi-instance heap <strong>may</strong> consume
memory on all physical devices even if the <code>deviceMask</code> excludes some
devices.
If <a href="devsandqueues.html#VkPhysicalDeviceGroupProperties" class="xref page">VkPhysicalDeviceGroupProperties</a>::<code>subsetAllocation</code> is
<code>VK_TRUE</code>, then memory is only consumed for the devices in the device
mask.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>In practice, most allocations on a multi-instance heap will be allocated
across all physical devices.
Unicast allocation support is an optional optimization for a minority of
allocations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryAllocateFlagsInfo-deviceMask-00675" href="#VUID-VkMemoryAllocateFlagsInfo-deviceMask-00675"></a> <span class="vuid">VUID-VkMemoryAllocateFlagsInfo-deviceMask-00675</span><br>

If <code>VK_MEMORY_ALLOCATE_DEVICE_MASK_BIT</code> is set, <code>deviceMask</code>
<strong>must</strong> be a valid device mask</p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateFlagsInfo-deviceMask-00676" href="#VUID-VkMemoryAllocateFlagsInfo-deviceMask-00676"></a> <span class="vuid">VUID-VkMemoryAllocateFlagsInfo-deviceMask-00676</span><br>

If <code>VK_MEMORY_ALLOCATE_DEVICE_MASK_BIT</code> is set, <code>deviceMask</code>
<strong>must</strong> not be zero</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryAllocateFlagsInfo-sType-sType" href="#VUID-VkMemoryAllocateFlagsInfo-sType-sType"></a> <span class="vuid">VUID-VkMemoryAllocateFlagsInfo-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_FLAGS_INFO</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryAllocateFlagsInfo-flags-parameter" href="#VUID-VkMemoryAllocateFlagsInfo-flags-parameter"></a> <span class="vuid">VUID-VkMemoryAllocateFlagsInfo-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="#VkMemoryAllocateFlagBits">VkMemoryAllocateFlagBits</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong>can</strong> be set in <a href="#VkMemoryAllocateFlagsInfo">VkMemoryAllocateFlagsInfo</a>::<code>flags</code>,
controlling device memory allocation, are:</p>
</div>
<div id="VkMemoryAllocateFlagBits" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
typedef enum VkMemoryAllocateFlagBits {
    VK_MEMORY_ALLOCATE_DEVICE_MASK_BIT = 0x00000001,
  // Provided by VK_VERSION_1_2
    VK_MEMORY_ALLOCATE_DEVICE_ADDRESS_BIT = 0x00000002,
  // Provided by VK_VERSION_1_2
    VK_MEMORY_ALLOCATE_DEVICE_ADDRESS_CAPTURE_REPLAY_BIT = 0x00000004,
  // Provided by VK_KHR_device_group
    VK_MEMORY_ALLOCATE_DEVICE_MASK_BIT_KHR = VK_MEMORY_ALLOCATE_DEVICE_MASK_BIT,
  // Provided by VK_KHR_buffer_device_address
    VK_MEMORY_ALLOCATE_DEVICE_ADDRESS_BIT_KHR = VK_MEMORY_ALLOCATE_DEVICE_ADDRESS_BIT,
  // Provided by VK_KHR_buffer_device_address
    VK_MEMORY_ALLOCATE_DEVICE_ADDRESS_CAPTURE_REPLAY_BIT_KHR = VK_MEMORY_ALLOCATE_DEVICE_ADDRESS_CAPTURE_REPLAY_BIT,
} VkMemoryAllocateFlagBits;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkMemoryAllocateFlagBitsKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_device_group
typedef VkMemoryAllocateFlagBits VkMemoryAllocateFlagBitsKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_MEMORY_ALLOCATE_DEVICE_MASK_BIT</code> specifies that memory will be
allocated for the devices in
<a href="#VkMemoryAllocateFlagsInfo">VkMemoryAllocateFlagsInfo</a>::<code>deviceMask</code>.</p>
</li>
<li>
<p><code>VK_MEMORY_ALLOCATE_DEVICE_ADDRESS_BIT</code> specifies that the memory
<strong>can</strong> be attached to a buffer object created with the
<code>VK_BUFFER_USAGE_SHADER_DEVICE_ADDRESS_BIT</code> bit set in <code>usage</code>,
and that the memory handle <strong>can</strong> be used to retrieve an opaque address
via <a href="#vkGetDeviceMemoryOpaqueCaptureAddress">vkGetDeviceMemoryOpaqueCaptureAddress</a>.</p>
</li>
<li>
<p><code>VK_MEMORY_ALLOCATE_DEVICE_ADDRESS_CAPTURE_REPLAY_BIT</code> specifies
that the memory&#8217;s address <strong>can</strong> be saved and reused on a subsequent run
(e.g. for trace capture and replay), see
<a href="resources.html#VkBufferOpaqueCaptureAddressCreateInfo" class="xref page">VkBufferOpaqueCaptureAddressCreateInfo</a> for more detail.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkMemoryAllocateFlags" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
typedef VkFlags VkMemoryAllocateFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkMemoryAllocateFlagsKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_device_group
typedef VkMemoryAllocateFlags VkMemoryAllocateFlagsKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkMemoryAllocateFlags</code> is a bitmask type for setting a mask of zero or
more <a href="#VkMemoryAllocateFlagBits">VkMemoryAllocateFlagBits</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_opaque_capture_address_allocation"><a class="anchor" href="#_opaque_capture_address_allocation"></a>Opaque Capture Address Allocation</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To request a specific device address for a memory allocation, add a
<a href="#VkMemoryOpaqueCaptureAddressAllocateInfo">VkMemoryOpaqueCaptureAddressAllocateInfo</a> structure to the <code>pNext</code>
chain of the <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a> structure.
The <code>VkMemoryOpaqueCaptureAddressAllocateInfo</code> structure is defined as:</p>
</div>
<div id="VkMemoryOpaqueCaptureAddressAllocateInfo" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_2
typedef struct VkMemoryOpaqueCaptureAddressAllocateInfo {
    VkStructureType    sType;
    const void*        pNext;
    uint64_t           opaqueCaptureAddress;
} VkMemoryOpaqueCaptureAddressAllocateInfo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkMemoryOpaqueCaptureAddressAllocateInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_buffer_device_address
typedef VkMemoryOpaqueCaptureAddressAllocateInfo VkMemoryOpaqueCaptureAddressAllocateInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>opaqueCaptureAddress</code> is the opaque capture address requested for
the memory allocation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>opaqueCaptureAddress</code> is zero, no specific address is requested.</p>
</div>
<div class="paragraph">
<p>If <code>opaqueCaptureAddress</code> is not zero, it <strong>should</strong> be an address
retrieved from <a href="#vkGetDeviceMemoryOpaqueCaptureAddress">vkGetDeviceMemoryOpaqueCaptureAddress</a> on an identically
created memory allocation on the same implementation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>In most cases, it is expected that a non-zero <code>opaqueAddress</code> is an
address retrieved from <a href="#vkGetDeviceMemoryOpaqueCaptureAddress">vkGetDeviceMemoryOpaqueCaptureAddress</a> on an
identically created memory allocation.
If this is not the case, it is likely that
<code>VK_ERROR_INVALID_OPAQUE_CAPTURE_ADDRESS</code> errors will occur.</p>
</div>
<div class="paragraph">
<p>This is, however, not a strict requirement because trace capture/replay
tools may need to adjust memory allocation parameters for imported memory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If this structure is not present, it is as if <code>opaqueCaptureAddress</code> is
zero.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryOpaqueCaptureAddressAllocateInfo-sType-sType" href="#VUID-VkMemoryOpaqueCaptureAddressAllocateInfo-sType-sType"></a> <span class="vuid">VUID-VkMemoryOpaqueCaptureAddressAllocateInfo-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_OPAQUE_CAPTURE_ADDRESS_ALLOCATE_INFO</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_freeing_device_memory"><a class="anchor" href="#_freeing_device_memory"></a>Freeing Device Memory</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To free a memory object, call:</p>
</div>
<div id="vkFreeMemory" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
void vkFreeMemory(
    VkDevice                                    device,
    VkDeviceMemory                              memory,
    const VkAllocationCallbacks*                pAllocator);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the memory.</p>
</li>
<li>
<p><code>memory</code> is the <a href="#VkDeviceMemory">VkDeviceMemory</a> object to be freed.</p>
</li>
<li>
<p><code>pAllocator</code> controls host memory allocation as described in the
<a href="#memory-allocation">Memory Allocation</a> chapter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before freeing a memory object, an application <strong>must</strong> ensure the memory
object is no longer in use by the device&#8201;&#8212;&#8201;for example by command buffers
in the <em>pending state</em>.
Memory <strong>can</strong> be freed whilst still bound to resources, but those resources
<strong>must</strong> not be used afterwards.
Freeing a memory object releases the reference it held, if any, to its
payload.
If there are still any bound images or buffers, the memory object&#8217;s payload
<strong>may</strong> not be immediately released by the implementation, but <strong>must</strong> be
released by the time all bound images and buffers have been destroyed.
Once all references to a payload are released, it is returned to the heap
from which it was allocated.</p>
</div>
<div class="paragraph">
<p>How memory objects are bound to Images and Buffers is described in detail in
the <a href="resources.html#resources-association" class="xref page">Resource Memory Association</a> section.</p>
</div>
<div class="paragraph">
<p>If a memory object is mapped at the time it is freed, it is implicitly
unmapped.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>As described <a href="#memory-device-unmap-does-not-flush">below</a>, host writes are
not implicitly flushed when the memory object is unmapped, but the
implementation <strong>must</strong> guarantee that writes that have not been flushed do not
affect any other memory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkFreeMemory-memory-00677" href="#VUID-vkFreeMemory-memory-00677"></a> <span class="vuid">VUID-vkFreeMemory-memory-00677</span><br>

All submitted commands that refer to <code>memory</code> (via images or
buffers) <strong>must</strong> have completed execution</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkFreeMemory-device-parameter" href="#VUID-vkFreeMemory-device-parameter"></a> <span class="vuid">VUID-vkFreeMemory-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkFreeMemory-memory-parameter" href="#VUID-vkFreeMemory-memory-parameter"></a> <span class="vuid">VUID-vkFreeMemory-memory-parameter</span><br>
 If <code>memory</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
<li>
<p><a id="VUID-vkFreeMemory-pAllocator-parameter" href="#VUID-vkFreeMemory-pAllocator-parameter"></a> <span class="vuid">VUID-vkFreeMemory-pAllocator-parameter</span><br>
 If <code>pAllocator</code> is not <code>NULL</code>, <code>pAllocator</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkAllocationCallbacks">VkAllocationCallbacks</a> structure</p>
</li>
<li>
<p><a id="VUID-vkFreeMemory-memory-parent" href="#VUID-vkFreeMemory-memory-parent"></a> <span class="vuid">VUID-vkFreeMemory-memory-parent</span><br>
 If <code>memory</code> is a valid handle, it <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>memory</code> <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="memory-device-hostaccess"><a class="anchor" href="#memory-device-hostaccess"></a>Host Access to Device Memory Objects</h3>
<div class="paragraph">
<p>Memory objects created with <a href="#vkAllocateMemory">vkAllocateMemory</a> are not directly host
accessible.</p>
</div>
<div class="paragraph">
<p>Memory objects created with the memory property
<code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> are considered <em>mappable</em>.
Memory objects <strong>must</strong> be mappable in order to be successfully mapped on the
host.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To retrieve a host virtual address pointer to a region of a mappable memory
object, call:</p>
</div>
<div id="vkMapMemory" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
VkResult vkMapMemory(
    VkDevice                                    device,
    VkDeviceMemory                              memory,
    VkDeviceSize                                offset,
    VkDeviceSize                                size,
    VkMemoryMapFlags                            flags,
    void**                                      ppData);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the memory.</p>
</li>
<li>
<p><code>memory</code> is the <a href="#VkDeviceMemory">VkDeviceMemory</a> object to be mapped.</p>
</li>
<li>
<p><code>offset</code> is a zero-based byte offset from the beginning of the
memory object.</p>
</li>
<li>
<p><code>size</code> is the size of the memory range to map, or
<code>VK_WHOLE_SIZE</code> to map from <code>offset</code> to the end of the
allocation.</p>
</li>
<li>
<p><code>flags</code> is reserved for future use.</p>
</li>
<li>
<p><code>ppData</code> is a pointer to a <code>void*</code> variable in which a
host-accessible pointer to the beginning of the mapped range is
returned.
This pointer minus <code>offset</code> <strong>must</strong> be aligned to at least
<a href="limits.html#VkPhysicalDeviceLimits" class="xref page">VkPhysicalDeviceLimits</a>::<code>minMemoryMapAlignment</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After a successful call to <code>vkMapMemory</code> the memory object <code>memory</code>
is considered to be currently <em>host mapped</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>It is an application error to call <code>vkMapMemory</code> on a memory object that
is already <em>host mapped</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p><code>vkMapMemory</code> will fail if the implementation is unable to allocate an
appropriately sized contiguous virtual address range, e.g. due to virtual
address space fragmentation or platform limits.
In such cases, <code>vkMapMemory</code> <strong>must</strong> return
<code>VK_ERROR_MEMORY_MAP_FAILED</code>.
The application <strong>can</strong> improve the likelihood of success by reducing the size
of the mapped range and/or removing unneeded mappings using
<a href="#vkUnmapMemory">vkUnmapMemory</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="memory-device-hostaccess-hazards" class="paragraph">
<p><code>vkMapMemory</code> does not check whether the device memory is currently in
use before returning the host-accessible pointer.
The application <strong>must</strong> guarantee that any previously submitted command that
writes to this range has completed before the host reads from or writes to
that range, and that any previously submitted command that reads from that
range has completed before the host writes to that region (see
<a href="synchronization.html#synchronization-submission-host-writes" class="xref page">here</a> for details on fulfilling
such a guarantee).
If the device memory was allocated without the
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> set, these guarantees <strong>must</strong> be
made for an extended range: the application <strong>must</strong> round down the start of
the range to the nearest multiple of
<a href="limits.html#VkPhysicalDeviceLimits" class="xref page">VkPhysicalDeviceLimits</a>::<code>nonCoherentAtomSize</code>, and round the end
of the range up to the nearest multiple of
<a href="limits.html#VkPhysicalDeviceLimits" class="xref page">VkPhysicalDeviceLimits</a>::<code>nonCoherentAtomSize</code>.</p>
</div>
<div class="paragraph">
<p>While a range of device memory is host mapped, the application is
responsible for synchronizing both device and host access to that memory
range.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>It is important for the application developer to become meticulously
familiar with all of the mechanisms described in the chapter on
<a href="synchronization.html#synchronization" class="xref page">Synchronization and Cache Control</a> as they are crucial
to maintaining memory access ordering.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Calling <code>vkMapMemory</code> is equivalent to calling <a href="#vkMapMemory2KHR">vkMapMemory2KHR</a>
with an empty <code>pNext</code> chain.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkMapMemory-memory-00678" href="#VUID-vkMapMemory-memory-00678"></a> <span class="vuid">VUID-vkMapMemory-memory-00678</span><br>

<code>memory</code> <strong>must</strong> not be currently host mapped</p>
</li>
<li>
<p><a id="VUID-vkMapMemory-offset-00679" href="#VUID-vkMapMemory-offset-00679"></a> <span class="vuid">VUID-vkMapMemory-offset-00679</span><br>

<code>offset</code> <strong>must</strong> be less than the size of <code>memory</code></p>
</li>
<li>
<p><a id="VUID-vkMapMemory-size-00680" href="#VUID-vkMapMemory-size-00680"></a> <span class="vuid">VUID-vkMapMemory-size-00680</span><br>

If <code>size</code> is not equal to <code>VK_WHOLE_SIZE</code>, <code>size</code> <strong>must</strong> be
greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkMapMemory-size-00681" href="#VUID-vkMapMemory-size-00681"></a> <span class="vuid">VUID-vkMapMemory-size-00681</span><br>

If <code>size</code> is not equal to <code>VK_WHOLE_SIZE</code>, <code>size</code> <strong>must</strong> be
less than or equal to the size of the <code>memory</code> minus <code>offset</code></p>
</li>
<li>
<p><a id="VUID-vkMapMemory-memory-00682" href="#VUID-vkMapMemory-memory-00682"></a> <span class="vuid">VUID-vkMapMemory-memory-00682</span><br>

<code>memory</code> <strong>must</strong> have been created with a memory type that reports
<code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkMapMemory-memory-00683" href="#VUID-vkMapMemory-memory-00683"></a> <span class="vuid">VUID-vkMapMemory-memory-00683</span><br>

<code>memory</code> <strong>must</strong> not have been allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkMapMemory-device-parameter" href="#VUID-vkMapMemory-device-parameter"></a> <span class="vuid">VUID-vkMapMemory-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkMapMemory-memory-parameter" href="#VUID-vkMapMemory-memory-parameter"></a> <span class="vuid">VUID-vkMapMemory-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
<li>
<p><a id="VUID-vkMapMemory-flags-zerobitmask" href="#VUID-vkMapMemory-flags-zerobitmask"></a> <span class="vuid">VUID-vkMapMemory-flags-zerobitmask</span><br>
 <code>flags</code> <strong>must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkMapMemory-ppData-parameter" href="#VUID-vkMapMemory-ppData-parameter"></a> <span class="vuid">VUID-vkMapMemory-ppData-parameter</span><br>
 <code>ppData</code> <strong>must</strong> be a valid pointer to a pointer value</p>
</li>
<li>
<p><a id="VUID-vkMapMemory-memory-parent" href="#VUID-vkMapMemory-memory-parent"></a> <span class="vuid">VUID-vkMapMemory-memory-parent</span><br>
 <code>memory</code> <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>memory</code> <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_MEMORY_MAP_FAILED</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkMemoryMapFlags" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef VkFlags VkMemoryMapFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkMemoryMapFlags</code> is a bitmask type for setting a mask, but is
currently reserved for future use.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Alternatively, to retrieve a host virtual address pointer to a region of a
mappable memory object, call:</p>
</div>
<div id="vkMapMemory2KHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_map_memory2
VkResult vkMapMemory2KHR(
    VkDevice                                    device,
    const VkMemoryMapInfoKHR*                   pMemoryMapInfo,
    void**                                      ppData);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the memory.</p>
</li>
<li>
<p><code>pMemoryMapInfo</code> is a pointer to a <a href="#VkMemoryMapInfoKHR">VkMemoryMapInfoKHR</a>
structure describing parameters of the map.</p>
</li>
<li>
<p><code>ppData</code> is a pointer to a <code>void *</code> variable in which is returned a
host-accessible pointer to the beginning of the mapped range.
This pointer minus <a href="#VkMemoryMapInfoKHR">VkMemoryMapInfoKHR</a>::<code>offset</code> <strong>must</strong> be
aligned to at least
<a href="limits.html#VkPhysicalDeviceLimits" class="xref page">VkPhysicalDeviceLimits</a>::<code>minMemoryMapAlignment</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This function behaves identically to <a href="#vkMapMemory">vkMapMemory</a> except that it gets
its parameters via an extensible structure pointer rather than directly as
function arguments.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkMapMemory2KHR-device-parameter" href="#VUID-vkMapMemory2KHR-device-parameter"></a> <span class="vuid">VUID-vkMapMemory2KHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkMapMemory2KHR-pMemoryMapInfo-parameter" href="#VUID-vkMapMemory2KHR-pMemoryMapInfo-parameter"></a> <span class="vuid">VUID-vkMapMemory2KHR-pMemoryMapInfo-parameter</span><br>
 <code>pMemoryMapInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkMemoryMapInfoKHR">VkMemoryMapInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkMapMemory2KHR-ppData-parameter" href="#VUID-vkMapMemory2KHR-ppData-parameter"></a> <span class="vuid">VUID-vkMapMemory2KHR-ppData-parameter</span><br>
 <code>ppData</code> <strong>must</strong> be a valid pointer to a pointer value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_MEMORY_MAP_FAILED</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMemoryMapInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkMemoryMapInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_map_memory2
typedef struct VkMemoryMapInfoKHR {
    VkStructureType     sType;
    const void*         pNext;
    VkMemoryMapFlags    flags;
    VkDeviceMemory      memory;
    VkDeviceSize        offset;
    VkDeviceSize        size;
} VkMemoryMapInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>flags</code> is reserved for future use.</p>
</li>
<li>
<p><code>memory</code> is the <a href="#VkDeviceMemory">VkDeviceMemory</a> object to be mapped.</p>
</li>
<li>
<p><code>offset</code> is a zero-based byte offset from the beginning of the
memory object.</p>
</li>
<li>
<p><code>size</code> is the size of the memory range to map, or
<code>VK_WHOLE_SIZE</code> to map from <code>offset</code> to the end of the
allocation.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryMapInfoKHR-memory-07958" href="#VUID-VkMemoryMapInfoKHR-memory-07958"></a> <span class="vuid">VUID-VkMemoryMapInfoKHR-memory-07958</span><br>

<code>memory</code> <strong>must</strong> not be currently host mapped</p>
</li>
<li>
<p><a id="VUID-VkMemoryMapInfoKHR-offset-07959" href="#VUID-VkMemoryMapInfoKHR-offset-07959"></a> <span class="vuid">VUID-VkMemoryMapInfoKHR-offset-07959</span><br>

<code>offset</code> <strong>must</strong> be less than the size of <code>memory</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryMapInfoKHR-size-07960" href="#VUID-VkMemoryMapInfoKHR-size-07960"></a> <span class="vuid">VUID-VkMemoryMapInfoKHR-size-07960</span><br>

If <code>size</code> is not equal to <code>VK_WHOLE_SIZE</code>, <code>size</code> <strong>must</strong> be
greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryMapInfoKHR-size-07961" href="#VUID-VkMemoryMapInfoKHR-size-07961"></a> <span class="vuid">VUID-VkMemoryMapInfoKHR-size-07961</span><br>

If <code>size</code> is not equal to <code>VK_WHOLE_SIZE</code>, <code>size</code> <strong>must</strong> be
less than or equal to the size of the <code>memory</code> minus <code>offset</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryMapInfoKHR-memory-07962" href="#VUID-VkMemoryMapInfoKHR-memory-07962"></a> <span class="vuid">VUID-VkMemoryMapInfoKHR-memory-07962</span><br>

<code>memory</code> <strong>must</strong> have been created with a memory type that reports
<code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryMapInfoKHR-memory-07963" href="#VUID-VkMemoryMapInfoKHR-memory-07963"></a> <span class="vuid">VUID-VkMemoryMapInfoKHR-memory-07963</span><br>

<code>memory</code> <strong>must</strong> not have been allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryMapInfoKHR-sType-sType" href="#VUID-VkMemoryMapInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkMemoryMapInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_MAP_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryMapInfoKHR-pNext-pNext" href="#VUID-VkMemoryMapInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkMemoryMapInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryMapInfoKHR-flags-zerobitmask" href="#VUID-VkMemoryMapInfoKHR-flags-zerobitmask"></a> <span class="vuid">VUID-VkMemoryMapInfoKHR-flags-zerobitmask</span><br>
 <code>flags</code> <strong>must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryMapInfoKHR-memory-parameter" href="#VUID-VkMemoryMapInfoKHR-memory-parameter"></a> <span class="vuid">VUID-VkMemoryMapInfoKHR-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>memory</code> <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Two commands are provided to enable applications to work with non-coherent
memory allocations: <code>vkFlushMappedMemoryRanges</code> and
<code>vkInvalidateMappedMemoryRanges</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>If the memory object was created with the
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> set,
<code>vkFlushMappedMemoryRanges</code> and <code>vkInvalidateMappedMemoryRanges</code> are
unnecessary and <strong>may</strong> have a performance cost.
However, <a href="synchronization.html#synchronization-dependencies-available-and-visible" class="xref page">availabilityand visibility operations</a> still need to be managed on the device.
See the description of <a href="synchronization.html#synchronization-host-access-types" class="xref page">host accesstypes</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>While memory objects imported from a handle type of
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_HOST_ALLOCATION_BIT_EXT</code> or
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_HOST_MAPPED_FOREIGN_MEMORY_BIT_EXT</code> are
inherently mapped to host address space, they are not considered to be host
mapped device memory unless they are explicitly host mapped using
<a href="#vkMapMemory">vkMapMemory</a>.
That means flushing or invalidating host caches with respect to host
accesses performed on such memory through the original host pointer
specified at import time is the responsibility of the application and <strong>must</strong>
be performed with appropriate synchronization primitives provided by the
platform which are outside the scope of Vulkan.
<code>vkFlushMappedMemoryRanges</code> and <code>vkInvalidateMappedMemoryRanges</code>,
however, <strong>can</strong> still be used on such memory objects to synchronize host
accesses performed through the host pointer of the host mapped device memory
range returned by <a href="#vkMapMemory">vkMapMemory</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After a successful call to <code>vkMapMemory</code>
or <code>vkMapMemory2KHR</code>
the memory object <code>memory</code> is considered to be currently <em>host mapped</em>.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To flush ranges of non-coherent memory from the host caches, call:</p>
</div>
<div id="vkFlushMappedMemoryRanges" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
VkResult vkFlushMappedMemoryRanges(
    VkDevice                                    device,
    uint32_t                                    memoryRangeCount,
    const VkMappedMemoryRange*                  pMemoryRanges);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the memory ranges.</p>
</li>
<li>
<p><code>memoryRangeCount</code> is the length of the <code>pMemoryRanges</code> array.</p>
</li>
<li>
<p><code>pMemoryRanges</code> is a pointer to an array of
<a href="#VkMappedMemoryRange">VkMappedMemoryRange</a> structures describing the memory ranges to
flush.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>vkFlushMappedMemoryRanges</code> guarantees that host writes to the memory
ranges described by <code>pMemoryRanges</code> are made available to the host
memory domain, such that they <strong>can</strong> be made available to the device memory
domain via <a href="synchronization.html#synchronization-dependencies-available-and-visible" class="xref page">memorydomain operations</a> using the <code>VK_ACCESS_HOST_WRITE_BIT</code>
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a>.</p>
</div>
<div class="paragraph">
<p>Within each range described by <code>pMemoryRanges</code>, each set of
<code>nonCoherentAtomSize</code> bytes in that range is flushed if any byte in that
set has been written by the host since it was first host mapped, or the last
time it was flushed.
If <code>pMemoryRanges</code> includes sets of <code>nonCoherentAtomSize</code> bytes
where no bytes have been written by the host, those bytes <strong>must</strong> not be
flushed.</p>
</div>
<div id="memory-device-unmap-does-not-flush" class="paragraph">
<p>Unmapping non-coherent memory does not implicitly flush the host mapped
memory, and host writes that have not been flushed <strong>may</strong> not ever be visible
to the device.
However, implementations <strong>must</strong> ensure that writes that have not been flushed
do not become visible to any other memory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The above guarantee avoids a potential memory corruption in scenarios where
host writes to a mapped memory object have not been flushed before the
memory is unmapped (or freed), and the virtual address range is subsequently
reused for a different mapping (or memory allocation).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkFlushMappedMemoryRanges-device-parameter" href="#VUID-vkFlushMappedMemoryRanges-device-parameter"></a> <span class="vuid">VUID-vkFlushMappedMemoryRanges-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkFlushMappedMemoryRanges-pMemoryRanges-parameter" href="#VUID-vkFlushMappedMemoryRanges-pMemoryRanges-parameter"></a> <span class="vuid">VUID-vkFlushMappedMemoryRanges-pMemoryRanges-parameter</span><br>
 <code>pMemoryRanges</code> <strong>must</strong> be a valid pointer to an array of <code>memoryRangeCount</code> valid <a href="#VkMappedMemoryRange">VkMappedMemoryRange</a> structures</p>
</li>
<li>
<p><a id="VUID-vkFlushMappedMemoryRanges-memoryRangeCount-arraylength" href="#VUID-vkFlushMappedMemoryRanges-memoryRangeCount-arraylength"></a> <span class="vuid">VUID-vkFlushMappedMemoryRanges-memoryRangeCount-arraylength</span><br>
 <code>memoryRangeCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To invalidate ranges of non-coherent memory from the host caches, call:</p>
</div>
<div id="vkInvalidateMappedMemoryRanges" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
VkResult vkInvalidateMappedMemoryRanges(
    VkDevice                                    device,
    uint32_t                                    memoryRangeCount,
    const VkMappedMemoryRange*                  pMemoryRanges);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the memory ranges.</p>
</li>
<li>
<p><code>memoryRangeCount</code> is the length of the <code>pMemoryRanges</code> array.</p>
</li>
<li>
<p><code>pMemoryRanges</code> is a pointer to an array of
<a href="#VkMappedMemoryRange">VkMappedMemoryRange</a> structures describing the memory ranges to
invalidate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>vkInvalidateMappedMemoryRanges</code> guarantees that device writes to the
memory ranges described by <code>pMemoryRanges</code>, which have been made
available to the host memory domain using the <code>VK_ACCESS_HOST_WRITE_BIT</code>
and <code>VK_ACCESS_HOST_READ_BIT</code> <a href="synchronization.html#synchronization-access-types" class="xref page">accesstypes</a>, are made visible to the host.
If a range of non-coherent memory is written by the host and then
invalidated without first being flushed, its contents are <strong>undefined</strong>.</p>
</div>
<div class="paragraph">
<p>Within each range described by <code>pMemoryRanges</code>, each set of
<code>nonCoherentAtomSize</code> bytes in that range is invalidated if any byte in
that set has been written by the device since it was first host mapped, or
the last time it was invalidated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Mapping non-coherent memory does not implicitly invalidate that memory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkInvalidateMappedMemoryRanges-device-parameter" href="#VUID-vkInvalidateMappedMemoryRanges-device-parameter"></a> <span class="vuid">VUID-vkInvalidateMappedMemoryRanges-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkInvalidateMappedMemoryRanges-pMemoryRanges-parameter" href="#VUID-vkInvalidateMappedMemoryRanges-pMemoryRanges-parameter"></a> <span class="vuid">VUID-vkInvalidateMappedMemoryRanges-pMemoryRanges-parameter</span><br>
 <code>pMemoryRanges</code> <strong>must</strong> be a valid pointer to an array of <code>memoryRangeCount</code> valid <a href="#VkMappedMemoryRange">VkMappedMemoryRange</a> structures</p>
</li>
<li>
<p><a id="VUID-vkInvalidateMappedMemoryRanges-memoryRangeCount-arraylength" href="#VUID-vkInvalidateMappedMemoryRanges-memoryRangeCount-arraylength"></a> <span class="vuid">VUID-vkInvalidateMappedMemoryRanges-memoryRangeCount-arraylength</span><br>
 <code>memoryRangeCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMappedMemoryRange</code> structure is defined as:</p>
</div>
<div id="VkMappedMemoryRange" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkMappedMemoryRange {
    VkStructureType    sType;
    const void*        pNext;
    VkDeviceMemory     memory;
    VkDeviceSize       offset;
    VkDeviceSize       size;
} VkMappedMemoryRange;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>memory</code> is the memory object to which this range belongs.</p>
</li>
<li>
<p><code>offset</code> is the zero-based byte offset from the beginning of the
memory object.</p>
</li>
<li>
<p><code>size</code> is either the size of range, or <code>VK_WHOLE_SIZE</code> to affect
the range from <code>offset</code> to the end of the current mapping of the
allocation.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMappedMemoryRange-memory-00684" href="#VUID-VkMappedMemoryRange-memory-00684"></a> <span class="vuid">VUID-VkMappedMemoryRange-memory-00684</span><br>

<code>memory</code> <strong>must</strong> be currently host mapped</p>
</li>
<li>
<p><a id="VUID-VkMappedMemoryRange-size-00685" href="#VUID-VkMappedMemoryRange-size-00685"></a> <span class="vuid">VUID-VkMappedMemoryRange-size-00685</span><br>

If <code>size</code> is not equal to <code>VK_WHOLE_SIZE</code>, <code>offset</code> and
<code>size</code> <strong>must</strong> specify a range contained within the currently mapped
range of <code>memory</code></p>
</li>
<li>
<p><a id="VUID-VkMappedMemoryRange-size-00686" href="#VUID-VkMappedMemoryRange-size-00686"></a> <span class="vuid">VUID-VkMappedMemoryRange-size-00686</span><br>

If <code>size</code> is equal to <code>VK_WHOLE_SIZE</code>, <code>offset</code> <strong>must</strong> be
within the currently mapped range of <code>memory</code></p>
</li>
<li>
<p><a id="VUID-VkMappedMemoryRange-offset-00687" href="#VUID-VkMappedMemoryRange-offset-00687"></a> <span class="vuid">VUID-VkMappedMemoryRange-offset-00687</span><br>

<code>offset</code> <strong>must</strong> be a multiple of
<a href="limits.html#VkPhysicalDeviceLimits" class="xref page">VkPhysicalDeviceLimits</a>::<code>nonCoherentAtomSize</code></p>
</li>
<li>
<p><a id="VUID-VkMappedMemoryRange-size-01389" href="#VUID-VkMappedMemoryRange-size-01389"></a> <span class="vuid">VUID-VkMappedMemoryRange-size-01389</span><br>

If <code>size</code> is equal to <code>VK_WHOLE_SIZE</code>, the end of the current
mapping of <code>memory</code> <strong>must</strong> either be a multiple of
<a href="limits.html#VkPhysicalDeviceLimits" class="xref page">VkPhysicalDeviceLimits</a>::<code>nonCoherentAtomSize</code> bytes from the
beginning of the memory object, or be equal to the end of the memory
object</p>
</li>
<li>
<p><a id="VUID-VkMappedMemoryRange-size-01390" href="#VUID-VkMappedMemoryRange-size-01390"></a> <span class="vuid">VUID-VkMappedMemoryRange-size-01390</span><br>

If <code>size</code> is not equal to <code>VK_WHOLE_SIZE</code>, <code>size</code> <strong>must</strong>
either be a multiple of
<a href="limits.html#VkPhysicalDeviceLimits" class="xref page">VkPhysicalDeviceLimits</a>::<code>nonCoherentAtomSize</code>, or <code>offset</code>
plus <code>size</code> <strong>must</strong> equal the size of <code>memory</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMappedMemoryRange-sType-sType" href="#VUID-VkMappedMemoryRange-sType-sType"></a> <span class="vuid">VUID-VkMappedMemoryRange-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MAPPED_MEMORY_RANGE</code></p>
</li>
<li>
<p><a id="VUID-VkMappedMemoryRange-pNext-pNext" href="#VUID-VkMappedMemoryRange-pNext-pNext"></a> <span class="vuid">VUID-VkMappedMemoryRange-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkMappedMemoryRange-memory-parameter" href="#VUID-VkMappedMemoryRange-memory-parameter"></a> <span class="vuid">VUID-VkMappedMemoryRange-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To unmap a memory object once host access to it is no longer needed by the
application, call:</p>
</div>
<div id="vkUnmapMemory" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
void vkUnmapMemory(
    VkDevice                                    device,
    VkDeviceMemory                              memory);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the memory.</p>
</li>
<li>
<p><code>memory</code> is the memory object to be unmapped.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Calling <code>vkUnmapMemory</code> is equivalent to calling <a href="#vkUnmapMemory2KHR">vkUnmapMemory2KHR</a>
with an empty <code>pNext</code> chain and the flags parameter set to zero.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkUnmapMemory-memory-00689" href="#VUID-vkUnmapMemory-memory-00689"></a> <span class="vuid">VUID-vkUnmapMemory-memory-00689</span><br>

<code>memory</code> <strong>must</strong> be currently host mapped</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkUnmapMemory-device-parameter" href="#VUID-vkUnmapMemory-device-parameter"></a> <span class="vuid">VUID-vkUnmapMemory-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkUnmapMemory-memory-parameter" href="#VUID-vkUnmapMemory-memory-parameter"></a> <span class="vuid">VUID-vkUnmapMemory-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
<li>
<p><a id="VUID-vkUnmapMemory-memory-parent" href="#VUID-vkUnmapMemory-memory-parent"></a> <span class="vuid">VUID-vkUnmapMemory-memory-parent</span><br>
 <code>memory</code> <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>memory</code> <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Alternatively, to unmap a memory object once host access to it is no longer
needed by the application, call:</p>
</div>
<div id="vkUnmapMemory2KHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_map_memory2
VkResult vkUnmapMemory2KHR(
    VkDevice                                    device,
    const VkMemoryUnmapInfoKHR*                 pMemoryUnmapInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the memory.</p>
</li>
<li>
<p><code>pMemoryUnmapInfo</code> is a pointer to a <a href="#VkMemoryUnmapInfoKHR">VkMemoryUnmapInfoKHR</a>
structure describing parameters of the unmap.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This function behaves identically to <a href="#vkUnmapMemory">vkUnmapMemory</a> except that it gets
its parameters via an extensible structure pointer rather than directly as
function arguments.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkUnmapMemory2KHR-device-parameter" href="#VUID-vkUnmapMemory2KHR-device-parameter"></a> <span class="vuid">VUID-vkUnmapMemory2KHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkUnmapMemory2KHR-pMemoryUnmapInfo-parameter" href="#VUID-vkUnmapMemory2KHR-pMemoryUnmapInfo-parameter"></a> <span class="vuid">VUID-vkUnmapMemory2KHR-pMemoryUnmapInfo-parameter</span><br>
 <code>pMemoryUnmapInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkMemoryUnmapInfoKHR">VkMemoryUnmapInfoKHR</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMemoryUnmapInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkMemoryUnmapInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_map_memory2
typedef struct VkMemoryUnmapInfoKHR {
    VkStructureType          sType;
    const void*              pNext;
    VkMemoryUnmapFlagsKHR    flags;
    VkDeviceMemory           memory;
} VkMemoryUnmapInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>flags</code> is reserved for future use.</p>
</li>
<li>
<p><code>memory</code> is the <a href="#VkDeviceMemory">VkDeviceMemory</a> object to be unmapped.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryUnmapInfoKHR-memory-07964" href="#VUID-VkMemoryUnmapInfoKHR-memory-07964"></a> <span class="vuid">VUID-VkMemoryUnmapInfoKHR-memory-07964</span><br>

<code>memory</code> <strong>must</strong> be currently host mapped</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryUnmapInfoKHR-sType-sType" href="#VUID-VkMemoryUnmapInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkMemoryUnmapInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_UNMAP_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryUnmapInfoKHR-pNext-pNext" href="#VUID-VkMemoryUnmapInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkMemoryUnmapInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryUnmapInfoKHR-flags-zerobitmask" href="#VUID-VkMemoryUnmapInfoKHR-flags-zerobitmask"></a> <span class="vuid">VUID-VkMemoryUnmapInfoKHR-flags-zerobitmask</span><br>
 <code>flags</code> <strong>must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryUnmapInfoKHR-memory-parameter" href="#VUID-VkMemoryUnmapInfoKHR-memory-parameter"></a> <span class="vuid">VUID-VkMemoryUnmapInfoKHR-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>memory</code> <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkMemoryUnmapFlagsKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_map_memory2
typedef VkFlags VkMemoryUnmapFlagsKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkMemoryMapFlagsKHR</code> is a bitmask type for setting a mask, but is
currently reserved for future use.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="memory-device-lazy_allocation"><a class="anchor" href="#memory-device-lazy_allocation"></a>Lazily Allocated Memory</h3>
<div class="paragraph">
<p>If the memory object is allocated from a heap with the
<code>VK_MEMORY_PROPERTY_LAZILY_ALLOCATED_BIT</code> bit set, that object&#8217;s backing
memory <strong>may</strong> be provided by the implementation lazily.
The actual committed size of the memory <strong>may</strong> initially be as small as zero
(or as large as the requested size), and monotonically increases as
additional memory is needed.</p>
</div>
<div class="paragraph">
<p>A memory type with this flag set is only allowed to be bound to a
<code>VkImage</code> whose usage flags include
<code>VK_IMAGE_USAGE_TRANSIENT_ATTACHMENT_BIT</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Using lazily allocated memory objects for framebuffer attachments that are
not needed once a render pass instance has completed <strong>may</strong> allow some
implementations to never allocate memory for such attachments.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To determine the amount of lazily-allocated memory that is currently
committed for a memory object, call:</p>
</div>
<div id="vkGetDeviceMemoryCommitment" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
void vkGetDeviceMemoryCommitment(
    VkDevice                                    device,
    VkDeviceMemory                              memory,
    VkDeviceSize*                               pCommittedMemoryInBytes);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the memory.</p>
</li>
<li>
<p><code>memory</code> is the memory object being queried.</p>
</li>
<li>
<p><code>pCommittedMemoryInBytes</code> is a pointer to a <code>VkDeviceSize</code>
value in which the number of bytes currently committed is returned, on
success.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The implementation <strong>may</strong> update the commitment at any time, and the value
returned by this query <strong>may</strong> be out of date.</p>
</div>
<div class="paragraph">
<p>The implementation guarantees to allocate any committed memory from the
<code>heapIndex</code> indicated by the memory type that the memory object was
created with.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceMemoryCommitment-memory-00690" href="#VUID-vkGetDeviceMemoryCommitment-memory-00690"></a> <span class="vuid">VUID-vkGetDeviceMemoryCommitment-memory-00690</span><br>

<code>memory</code> <strong>must</strong> have been created with a memory type that reports
<code>VK_MEMORY_PROPERTY_LAZILY_ALLOCATED_BIT</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceMemoryCommitment-device-parameter" href="#VUID-vkGetDeviceMemoryCommitment-device-parameter"></a> <span class="vuid">VUID-vkGetDeviceMemoryCommitment-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceMemoryCommitment-memory-parameter" href="#VUID-vkGetDeviceMemoryCommitment-memory-parameter"></a> <span class="vuid">VUID-vkGetDeviceMemoryCommitment-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceMemoryCommitment-pCommittedMemoryInBytes-parameter" href="#VUID-vkGetDeviceMemoryCommitment-pCommittedMemoryInBytes-parameter"></a> <span class="vuid">VUID-vkGetDeviceMemoryCommitment-pCommittedMemoryInBytes-parameter</span><br>
 <code>pCommittedMemoryInBytes</code> <strong>must</strong> be a valid pointer to a <code>VkDeviceSize</code> value</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceMemoryCommitment-memory-parent" href="#VUID-vkGetDeviceMemoryCommitment-memory-parent"></a> <span class="vuid">VUID-vkGetDeviceMemoryCommitment-memory-parent</span><br>
 <code>memory</code> <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="memory-protected-memory"><a class="anchor" href="#memory-protected-memory"></a>Protected Memory</h3>
<div class="paragraph">
<p><em>Protected memory</em> divides device memory into protected device memory and
unprotected device memory.</p>
</div>
<div class="paragraph">
<p>Protected memory adds the following concepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Memory:</p>
<div class="ulist">
<ul>
<li>
<p>Unprotected device memory, which <strong>can</strong> be visible to the device and <strong>can</strong>
be visible to the host</p>
</li>
<li>
<p>Protected device memory, which <strong>can</strong> be visible to the device but <strong>must</strong>
not be visible to the host</p>
</li>
</ul>
</div>
</li>
<li>
<p>Resources:</p>
<div class="ulist">
<ul>
<li>
<p>Unprotected images and unprotected buffers, to which unprotected memory
<strong>can</strong> be bound</p>
</li>
<li>
<p>Protected images and protected buffers, to which protected memory <strong>can</strong>
be bound</p>
</li>
</ul>
</div>
</li>
<li>
<p>Command buffers:</p>
<div class="ulist">
<ul>
<li>
<p>Unprotected command buffers, which <strong>can</strong> be submitted to a device queue
to execute unprotected queue operations</p>
</li>
<li>
<p>Protected command buffers, which <strong>can</strong> be submitted to a
protected-capable device queue to execute protected queue operations</p>
</li>
</ul>
</div>
</li>
<li>
<p>Device queues:</p>
<div class="ulist">
<ul>
<li>
<p>Unprotected device queues, to which unprotected command buffers <strong>can</strong> be
submitted</p>
</li>
<li>
<p>Protected-capable device queues, to which unprotected command buffers
or protected command buffers <strong>can</strong> be submitted</p>
</li>
</ul>
</div>
</li>
<li>
<p>Queue submissions</p>
<div class="ulist">
<ul>
<li>
<p>Unprotected queue submissions, through which unprotected command
buffers <strong>can</strong> be submitted</p>
</li>
<li>
<p>Protected queue submissions, through which protected command buffers
<strong>can</strong> be submitted</p>
</li>
</ul>
</div>
</li>
<li>
<p>Queue operations</p>
<div class="ulist">
<ul>
<li>
<p>Unprotected queue operations</p>
</li>
<li>
<p>Protected queue operations</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>When the <a href="features.html#features-protectedMemory" class="xref page"><code>protectedMemory</code></a> feature is
enabled, all pipelines <strong>may</strong> be recorded in either protected or unprotected
command buffers (or both), which may incur an extra cost on some
implementations.
This <strong>can</strong> be mitigated by enabling the <a href="features.html#features-pipelineProtectedAccess" class="xref page"><code>pipelineProtectedAccess</code></a> feature, in which case pipelines created
with <code>VK_PIPELINE_CREATE_PROTECTED_ACCESS_ONLY_BIT_EXT</code> may only be
recorded in protected command buffers, and pipelines created with
<code>VK_PIPELINE_CREATE_NO_PROTECTED_ACCESS_BIT_EXT</code> may only be recorded in
unprotected command buffers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="memory-protected-access-rules"><a class="anchor" href="#memory-protected-access-rules"></a>Protected Memory Access Rules</h4>
<div class="paragraph">
<p>If <a href="limits.html#VkPhysicalDeviceProtectedMemoryProperties" class="xref page">VkPhysicalDeviceProtectedMemoryProperties</a>::<code>protectedNoFault</code>
is <code>VK_FALSE</code>, applications <strong>must</strong> not perform any of the following
operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Write to unprotected memory within protected queue operations.</p>
</li>
<li>
<p>Access protected memory within protected queue operations other than in
framebuffer-space pipeline stages, the compute shader stage, or the
transfer stage.</p>
</li>
<li>
<p>Perform a query within protected queue operations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <a href="limits.html#VkPhysicalDeviceProtectedMemoryProperties" class="xref page">VkPhysicalDeviceProtectedMemoryProperties</a>::<code>protectedNoFault</code>
is <code>VK_TRUE</code>, these operations are valid, but reads will return
<strong>undefined</strong> values, and writes will either be dropped or store <strong>undefined</strong>
values.</p>
</div>
<div class="paragraph">
<p>Additionally, indirect operations <strong>must</strong> not be performed within protected
queue operations.</p>
</div>
<div class="paragraph">
<p>Whether these operations are valid or not, or if any other invalid usage is
performed, the implementation <strong>must</strong> guarantee that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Protected device memory <strong>must</strong> never be visible to the host.</p>
</li>
<li>
<p>Values written to unprotected device memory <strong>must</strong> not be a function of
values from protected memory.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="memory-external-handle-types"><a class="anchor" href="#memory-external-handle-types"></a>External Memory Handle Types</h3>
<div class="sect3">
<h4 id="memory-external-android-hardware-buffer"><a class="anchor" href="#memory-external-android-hardware-buffer"></a>Android Hardware Buffer</h4>
<div class="paragraph">
<p>Android&#8217;s NDK defines <code>AHardwareBuffer</code> objects, which represent
device memory that is shareable across processes and that <strong>can</strong> be accessed
by a variety of media APIs and the hardware used to implement them.
These Android hardware buffer objects <strong>may</strong> be imported into
<a href="#VkDeviceMemory">VkDeviceMemory</a> objects for access via Vulkan, or exported from Vulkan.
An <a href="resources.html#VkImage" class="xref page">VkImage</a> or <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> <strong>can</strong> be bound to the imported or exported
<a href="#VkDeviceMemory">VkDeviceMemory</a> object if it is created with
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ANDROID_HARDWARE_BUFFER_BIT_ANDROID</code>.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To remove an unnecessary compile time dependency, an incomplete type
definition of <code>AHardwareBuffer</code> is provided in the Vulkan headers:</p>
</div>
<div id="AHardwareBuffer" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_ANDROID_external_memory_android_hardware_buffer
struct AHardwareBuffer;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The actual <code>AHardwareBuffer</code> type is defined in Android NDK headers.</p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The NDK format, usage, and size/dimensions of an <code>AHardwareBuffer</code>
object can be obtained with the <code>AHardwareBuffer_describe</code> function.
While Android hardware buffers can be imported to or exported from Vulkan
without using that function, valid usage and implementation behavior is
defined in terms of the <code>AHardwareBuffer_Desc</code> properties it returns.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Android hardware buffer objects are reference-counted using Android NDK
functions outside of the scope of this specification.
A <a href="#VkDeviceMemory">VkDeviceMemory</a> imported from an Android hardware buffer or that <strong>can</strong>
be exported to an Android hardware buffer <strong>must</strong> acquire a reference to its
<code>AHardwareBuffer</code> object, and <strong>must</strong> release this reference when the
device memory is freed.
During the host execution of a Vulkan command that has an Android hardware
buffer as a parameter (including indirect parameters via <code>pNext</code>
chains), the application <strong>must</strong> not decrement the Android hardware buffer&#8217;s
reference count to zero.</p>
</div>
<div class="paragraph">
<p>Android hardware buffers <strong>can</strong> be mapped and unmapped for CPU access using
the NDK functions.
These lock and unlock APIs are considered to acquire and release ownership
of the Android hardware buffer, and applications <strong>must</strong> follow the rules
described in <a href="resources.html#resources-external-sharing" class="xref page">External Resource Sharing</a> to
transfer ownership between the Vulkan instance and these native APIs.</p>
</div>
<div class="paragraph">
<p>Android hardware buffers <strong>can</strong> be shared with external APIs and Vulkan
instances on the same device, and also with foreign devices.
When transferring ownership of the Android hardware buffer, the external and
foreign special queue families described in
<a href="synchronization.html#synchronization-queue-transfers" class="xref page">Queue Family Ownership Transfer</a> are not identical.
All APIs which produce or consume Android hardware buffers are considered to
use foreign devices, except OpenGL ES contexts and Vulkan logical devices
that have matching device and driver UUIDs.
Implementations <strong>may</strong> treat a transfer to or from the foreign queue family as
if it were a transfer to or from the external queue family when the Android
hardware buffer&#8217;s usage only permits it to be used on the same physical
device.</p>
</div>
<div class="sect4">
<h5 id="memory-external-android-hardware-buffer-optimal-usages"><a class="anchor" href="#memory-external-android-hardware-buffer-optimal-usages"></a>Android Hardware Buffer Optimal Usages</h5>
<div class="paragraph">
<p>Vulkan buffer and image usage flags do not correspond exactly to Android
hardware buffer usage flags.
When allocating Android hardware buffers with non-Vulkan APIs, if any
<code>AHARDWAREBUFFER_USAGE_GPU_*</code> usage bits are included, by default the
allocator <strong>must</strong> allocate the memory in such a way that it supports Vulkan
usages and creation flags in the
<a href="#memory-external-android-hardware-buffer-usage">usage equivalence table</a>
which do not have Android hardware buffer equivalents.</p>
</div>
<div class="paragraph">
<p>An <a href="capabilities.html#VkAndroidHardwareBufferUsageANDROID" class="xref page">VkAndroidHardwareBufferUsageANDROID</a> structure <strong>can</strong> be included in
the <code>pNext</code> chain of a <a href="capabilities.html#VkImageFormatProperties2" class="xref page">VkImageFormatProperties2</a> structure passed
to <a href="capabilities.html#vkGetPhysicalDeviceImageFormatProperties2" class="xref page">vkGetPhysicalDeviceImageFormatProperties2</a> to obtain optimal Android
hardware buffer usage flags for specific Vulkan resource creation
parameters.
Some usage flags returned by these commands are <strong>required</strong> based on the input
parameters, but additional vendor-specific usage flags
(<code>AHARDWAREBUFFER_USAGE_VENDOR_*</code>) <strong>may</strong> also be returned.
Any Android hardware buffer allocated with these vendor-specific usage flags
and imported to Vulkan <strong>must</strong> only be bound to resources created with
parameters that are a subset of the parameters used to obtain the Android
hardware buffer usage, since the memory <strong>may</strong> have been allocated in a way
incompatible with other parameters.
If an Android hardware buffer is successfully allocated with additional
non-vendor-specific usage flags in addition to the recommended usage, it
<strong>must</strong> support being used in the same ways as an Android hardware buffer
allocated with only the recommended usage, and also in ways indicated by the
additional usage.</p>
</div>
</div>
<div class="sect4">
<h5 id="memory-external-android-hardware-buffer-external-formats"><a class="anchor" href="#memory-external-android-hardware-buffer-external-formats"></a>Android Hardware Buffer External Formats</h5>
<div class="paragraph">
<p>Android hardware buffers <strong>may</strong> represent images using implementation-specific
formats, layouts, color models, etc., which do not have Vulkan equivalents.
Such <em>external formats</em> are commonly used by external image sources such as
video decoders or cameras.
Vulkan <strong>can</strong> import Android hardware buffers that have external formats, but
since the image contents are in an undiscoverable and possibly proprietary
representation, images with external formats <strong>must</strong> only be used as sampled
images, <strong>must</strong> only be sampled with a sampler that has Y′C<sub>B</sub>C<sub>R</sub> conversion
enabled, and <strong>must</strong> have optimal tiling.</p>
</div>
<div class="paragraph">
<p>Images that will be backed by an Android hardware buffer <strong>can</strong> use an
external format by setting <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>::<code>format</code> to
<code>VK_FORMAT_UNDEFINED</code> and including a <a href="resources.html#VkExternalFormatANDROID" class="xref page">VkExternalFormatANDROID</a>
structure in the <code>pNext</code> chain.
Images <strong>can</strong> be created with an external format even if the Android hardware
buffer has a format which has an
<a href="#memory-external-android-hardware-buffer-formats">equivalent Vulkan format</a>
to enable consistent handling of images from sources that might use either
category of format.
However, all images created with an external format are subject to the valid
usage requirements associated with external formats, even if the Android
hardware buffer&#8217;s format has a Vulkan equivalent.
The external format of an Android hardware buffer <strong>can</strong> be obtained by
passing a <a href="#VkAndroidHardwareBufferFormatPropertiesANDROID">VkAndroidHardwareBufferFormatPropertiesANDROID</a> structure to
<a href="#vkGetAndroidHardwareBufferPropertiesANDROID">vkGetAndroidHardwareBufferPropertiesANDROID</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="memory-external-android-hardware-buffer-image-resources"><a class="anchor" href="#memory-external-android-hardware-buffer-image-resources"></a>Android Hardware Buffer Image Resources</h5>
<div class="paragraph">
<p>Android hardware buffers have intrinsic width, height, format, and usage
properties, so Vulkan images bound to memory imported from an Android
hardware buffer <strong>must</strong> use dedicated allocations:
<code>VkMemoryDedicatedRequirements</code>::<code>requiresDedicatedAllocation</code> <strong>must</strong>
be <code>VK_TRUE</code> for images created with
<a href="resources.html#VkExternalMemoryImageCreateInfo" class="xref page">VkExternalMemoryImageCreateInfo</a>::<code>handleTypes</code> that includes
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ANDROID_HARDWARE_BUFFER_BIT_ANDROID</code>.
When creating an image that will be bound to an imported Android hardware
buffer, the image creation parameters <strong>must</strong> be equivalent to the
<code>AHardwareBuffer</code> properties as described by the valid usage of
<a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a>.
Similarly, device memory allocated for a dedicated image <strong>must</strong> not be
exported to an Android hardware buffer until it has been bound to that
image, and the implementation <strong>must</strong> return an Android hardware buffer with
properties derived from the image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>width</code> and <code>height</code> members of <code>AHardwareBuffer_Desc</code>
<strong>must</strong> be the same as the <code>width</code> and <code>height</code> members of
<a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>::<code>extent</code>, respectively.</p>
</li>
<li>
<p>The <code>layers</code> member of <code>AHardwareBuffer_Desc</code> <strong>must</strong> be the same as
the <code>arrayLayers</code> member of <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>.</p>
</li>
<li>
<p>The <code>format</code> member of <code>AHardwareBuffer_Desc</code> <strong>must</strong> be equivalent
to <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>::<code>format</code> as defined by
<a href="#memory-external-android-hardware-buffer-formats">AHardwareBuffer Format    Equivalence</a>.</p>
</li>
<li>
<p>The <code>usage</code> member of <code>AHardwareBuffer_Desc</code> <strong>must</strong> include bits
corresponding to bits included in <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>::<code>usage</code>
and <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>::<code>flags</code> where such a correspondence
exists according to
<a href="#memory-external-android-hardware-buffer-usage">AHardwareBuffer Usage    Equivalence</a>.
It <strong>may</strong> also include additional usage bits, including vendor-specific
usages.
Presence of vendor usage bits <strong>may</strong> make the Android hardware buffer only
usable in ways indicated by the image creation parameters, even when
used outside Vulkan, in a similar way that allocating the Android
hardware buffer with usage returned in
<a href="capabilities.html#VkAndroidHardwareBufferUsageANDROID" class="xref page">VkAndroidHardwareBufferUsageANDROID</a> does.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Implementations <strong>may</strong> support fewer combinations of image creation parameters
for images with Android hardware buffer external handle type than for
non-external images.
Support for a given set of parameters <strong>can</strong> be determined by passing
<a href="capabilities.html#VkExternalImageFormatProperties" class="xref page">VkExternalImageFormatProperties</a> to
<a href="capabilities.html#vkGetPhysicalDeviceImageFormatProperties2" class="xref page">vkGetPhysicalDeviceImageFormatProperties2</a> with <code>handleType</code> set to
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_ANDROID_HARDWARE_BUFFER_BIT_ANDROID</code>.
Any Android hardware buffer successfully allocated outside Vulkan with usage
that includes <code>AHARDWAREBUFFER_USAGE_GPU_*</code> <strong>must</strong> be supported when using
equivalent Vulkan image parameters.
If a given choice of image parameters are supported for import, they <strong>can</strong>
also be used to create an image and memory that will be exported to an
Android hardware buffer.</p>
</div>
<table id="memory-external-android-hardware-buffer-formats" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. AHardwareBuffer Format Equivalence</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">AHardwareBuffer Format</th>
<th class="tableblock halign-left valign-top">Vulkan Format</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_FORMAT_R8G8B8A8_UNORM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_R8G8B8A8_UNORM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_FORMAT_R8G8B8X8_UNORM</code> <sup>1</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_R8G8B8A8_UNORM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_FORMAT_R8G8B8_UNORM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_R8G8B8_UNORM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_FORMAT_R5G6B5_UNORM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_R5G6B5_UNORM_PACK16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_FORMAT_R16G16B16A16_FLOAT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_R16G16B16A16_SFLOAT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_FORMAT_R10G10B10A2_UNORM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_A2B10G10R10_UNORM_PACK32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_FORMAT_D16_UNORM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_D16_UNORM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_FORMAT_D24_UNORM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_X8_D24_UNORM_PACK32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_FORMAT_D24_UNORM_S8_UINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_D24_UNORM_S8_UINT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_FORMAT_D32_FLOAT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_D32_SFLOAT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_FORMAT_D32_FLOAT_S8_UINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_D32_SFLOAT_S8_UINT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_FORMAT_S8_UINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_S8_UINT</code></p></td>
</tr>
</tbody>
</table>
<table id="memory-external-android-hardware-buffer-usage" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. AHardwareBuffer Usage Equivalence</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">AHardwareBuffer Usage</th>
<th class="tableblock halign-left valign-top">Vulkan Usage or Creation Flag</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_IMAGE_USAGE_TRANSFER_SRC_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_IMAGE_USAGE_TRANSFER_DST_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_USAGE_GPU_SAMPLED_IMAGE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_IMAGE_USAGE_SAMPLED_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_USAGE_GPU_SAMPLED_IMAGE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_IMAGE_USAGE_INPUT_ATTACHMENT_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_USAGE_GPU_FRAMEBUFFER</code> <sup>3</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_USAGE_GPU_FRAMEBUFFER</code> <sup>3</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_USAGE_GPU_CUBE_MAP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_IMAGE_CREATE_CUBE_COMPATIBLE_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_USAGE_GPU_MIPMAP_COMPLETE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None <sup>2</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_USAGE_PROTECTED_CONTENT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_IMAGE_CREATE_PROTECTED_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_IMAGE_CREATE_MUTABLE_FORMAT_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_IMAGE_CREATE_EXTENDED_USAGE_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AHARDWAREBUFFER_USAGE_GPU_DATA_BUFFER</code> <sup>4</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_IMAGE_USAGE_STORAGE_BIT</code></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">1</dt>
<dd>
<p>Vulkan does not differentiate between
<code>AHARDWAREBUFFER_FORMAT_R8G8B8A8_UNORM</code> and
<code>AHARDWAREBUFFER_FORMAT_R8G8B8X8_UNORM</code>: they both behave as
<code>VK_FORMAT_R8G8B8A8_UNORM</code>.
After an external entity writes to a
<code>AHARDWAREBUFFER_FORMAT_R8G8B8X8_UNORM</code> Android hardware buffer, the
values read by Vulkan from the X/A component are <strong>undefined</strong>.
To emulate the traditional behavior of the X component during sampling
or blending, applications <strong>should</strong> use <code>VK_COMPONENT_SWIZZLE_ONE</code> in
image view component mappings and <code>VK_BLEND_FACTOR_ONE</code> in color
blend factors.
There is no way to avoid copying these <strong>undefined</strong> values when copying
from such an image to another image or buffer.</p>
</dd>
<dt class="hdlist1">2</dt>
<dd>
<p>The <code>AHARDWAREBUFFER_USAGE_GPU_MIPMAP_COMPLETE</code> flag does not
correspond to a Vulkan image usage or creation flag.
Instead, its presence indicates that the Android hardware buffer
contains a complete mipmap chain, and its absence indicates that the
Android hardware buffer contains only a single mip level.</p>
</dd>
<dt class="hdlist1">3</dt>
<dd>
<p>Only image usages valid for the format are valid.
It would be invalid to take a Android Hardware Buffer with a format of
<code>AHARDWAREBUFFER_FORMAT_R8G8B8A8_UNORM</code> that has a
<code>AHARDWAREBUFFER_USAGE_GPU_FRAMEBUFFER</code> usage and try to create an
image with <code>VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT</code>.</p>
</dd>
<dt class="hdlist1">4</dt>
<dd>
<p>In combination with a hardware buffer format other than <code>BLOB</code>.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>When using <code>VK_IMAGE_CREATE_MUTABLE_FORMAT_BIT</code> with Android hardware
buffer images, applications <strong>should</strong> use <a href="resources.html#VkImageFormatListCreateInfo" class="xref page">VkImageFormatListCreateInfo</a> to
inform the implementation which view formats will be used with the image.
For some common sets of format, this allows some implementations to provide
significantly better performance when accessing the image via Vulkan.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="memory-external-android-hardware-buffer-buffer-resources"><a class="anchor" href="#memory-external-android-hardware-buffer-buffer-resources"></a>Android Hardware Buffer Buffer Resources</h5>
<div class="paragraph">
<p>Android hardware buffers with a format of <code>AHARDWAREBUFFER_FORMAT_BLOB</code>
and usage that includes <code>AHARDWAREBUFFER_USAGE_GPU_DATA_BUFFER</code> <strong>can</strong> be
used as the backing store for <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> objects.
Such Android hardware buffers have a size in bytes specified by their
<code>width</code>; <code>height</code> and <code>layers</code> are both <code>1</code>.</p>
</div>
<div class="paragraph">
<p>Unlike images, buffer resources backed by Android hardware buffers do not
require dedicated allocations.</p>
</div>
<div class="paragraph">
<p>Exported <code>AHardwareBuffer</code> objects that do not have dedicated images
<strong>must</strong> have a format of <code>AHARDWAREBUFFER_FORMAT_BLOB</code>, usage <strong>must</strong> include
<code>AHARDWAREBUFFER_USAGE_GPU_DATA_BUFFER</code>, <code>width</code> <strong>must</strong> equal the
device memory allocation size, and <code>height</code> and <code>layers</code> <strong>must</strong> be <code>1</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="memory-external-qnx-screen-buffer"><a class="anchor" href="#memory-external-qnx-screen-buffer"></a>QNX Screen Buffer</h4>
<div class="paragraph">
<p>The QNX SDP defines <code>_screen_buffer</code> objects, which represent a buffer
that the QNX Screen graphics subsystem can use directly in its windowing
system APIs.
More specifically, a Screen buffer is an area of memory that stores pixel
data.
It can be attached to Screen windows, streams, or pixmaps.
These QNX Screen buffer objects <strong>may</strong> be imported into <a href="#VkDeviceMemory">VkDeviceMemory</a>
objects for access via Vulkan.
An <a href="resources.html#VkImage" class="xref page">VkImage</a> or <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> <strong>can</strong> be bound to the imported
<a href="#VkDeviceMemory">VkDeviceMemory</a> object if it is created with
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_SCREEN_BUFFER_BIT_QNX</code>.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><code>struct</code> <code>_screen_buffer</code> is strongly typed, so naming the handle type
is redundant.
The internal layout and therefore size of a <code>struct</code> <code>_screen_buffer</code>
image may depend on native usage flags that do not have corresponding Vulkan
counterparts.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="memory-external-screen-buffer-validity"><a class="anchor" href="#memory-external-screen-buffer-validity"></a>QNX Screen Buffer Validity</h5>
<div class="paragraph">
<p>The design of Screen in the QNX SDP makes it difficult to determine the
validity of objects from outside of Screen.
Therefore, applications <strong>must</strong> ensure that QNX Screen buffer objects provided
used in various Vulkan interfaces are ones created explicitly with QNX
Screen APIs.
See QNX SDP documentation for more information.</p>
</div>
<div class="paragraph">
<p>A <a href="#VkDeviceMemory">VkDeviceMemory</a> imported from a QNX Screen buffer has no way to
acquire a reference to its <code>_screen_buffer</code> object.
Therefore, during the host execution of a Vulkan command that has a QNX
Screen buffer as a parameter (including indirect parameters via <code>pNext</code>
chains), the application <strong>must</strong> ensure that the QNX Screen buffer resource
remains valid.</p>
</div>
<div class="paragraph">
<p>Generally, for a <code>_screen_buffer</code> object to be valid for use within a
Vulkan implementation, the buffer object <strong>should</strong> have a
<code>_screen_buffer</code>::<code>SCREEN_PROPERTY_USAGE</code> that includes at least one
of: <code>SCREEN_USAGE_VULKAN</code>, <code>SCREEN_USAGE_OPENGL_ES2</code>,
<code>SCREEN_USAGE_OPENGL_ES3</code>, or <code>SCREEN_USAGE_NATIVE</code>.
The exact Screen-native usage flags required depends on the Vulkan
implementation, and QNX Screen itself will not necessarily enforce these
requirements.
Note that Screen-native usage flags are in no way related to usage flags in
the Vulkan specification.</p>
</div>
</div>
<div class="sect4">
<h5 id="memory-external-screen-buffer-external-formats"><a class="anchor" href="#memory-external-screen-buffer-external-formats"></a>QNX Screen Buffer External Formats</h5>
<div class="paragraph">
<p>QNX Screen buffers <strong>may</strong> represent images using implementation-specific
formats, layouts, color models, etc., which do not have Vulkan equivalents.
Such <em>external formats</em> are commonly used by external image sources such as
video decoders or cameras.
Vulkan <strong>can</strong> import QNX Screen buffers that have external formats, but since
the image contents are in an undiscoverable and possibly proprietary
representation, images with external formats <strong>must</strong> only be used as sampled
images, <strong>must</strong> only be sampled with a sampler that has Y′C<sub>B</sub>C<sub>R</sub> conversion
enabled, and <strong>must</strong> have optimal tiling.</p>
</div>
<div class="paragraph">
<p>Images that will be backed by a QNX Screen buffer <strong>can</strong> use an external
format by setting <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>::<code>format</code> to
<code>VK_FORMAT_UNDEFINED</code> and including a <a href="resources.html#VkExternalFormatQNX" class="xref page">VkExternalFormatQNX</a>
structure in the <code>pNext</code> chain.
Images <strong>can</strong> be created with an external format even if the QNX Screen buffer
has a format which has an
<a href="#memory-external-qnx-screen-buffer-formats">equivalent Vulkan format</a> to
enable consistent handling of images from sources that might use either
category of format.
The external format of a QNX Screen buffer <strong>can</strong> be obtained by passing a
<a href="#VkScreenBufferFormatPropertiesQNX">VkScreenBufferFormatPropertiesQNX</a> structure to
<a href="#vkGetScreenBufferPropertiesQNX">vkGetScreenBufferPropertiesQNX</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="memory-external-qnx-screen-buffer-image-resources"><a class="anchor" href="#memory-external-qnx-screen-buffer-image-resources"></a>QNX Screen Buffer Image Resources</h5>
<div class="paragraph">
<p>QNX Screen buffers have intrinsic width, height, format, and usage
properties, so Vulkan images bound to memory imported from a QNX Screen
buffer <strong>must</strong> use dedicated allocations:
<code>VkMemoryDedicatedRequirements</code>::<code>requiresDedicatedAllocation</code> <strong>must</strong>
be <code>VK_TRUE</code> for images created with
<a href="resources.html#VkExternalMemoryImageCreateInfo" class="xref page">VkExternalMemoryImageCreateInfo</a>::<code>handleTypes</code> that includes
<code>VK_EXTERNAL_MEMORY_HANDLE_TYPE_SCREEN_BUFFER_BIT_QNX</code>.
When creating an image that will be bound to an imported QNX Screen buffer,
the image creation parameters <strong>must</strong> be equivalent to the <code>_screen_buffer</code>
properties as described by the valid usage of <a href="#VkMemoryAllocateInfo">VkMemoryAllocateInfo</a>.</p>
</div>
<table id="memory-external-qnx-screen-buffer-formats" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. QNX Screen Buffer Format Equivalence</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">QNX Screen Format</th>
<th class="tableblock halign-left valign-top">Vulkan Format</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCREEN_FORMAT_RGBA8888</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_B8G8R8A8_UNORM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCREEN_FORMAT_RGBX8888</code> <sup>1</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_B8G8R8A8_UNORM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCREEN_FORMAT_BGRA8888</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_R8G8B8A8_UNORM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCREEN_FORMAT_BGRX8888</code> <sup>1</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_R8G8B8A8_UNORM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCREEN_FORMAT_RGBA1010102</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_A2R10G10B10_UNORM_PACK32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCREEN_FORMAT_RGBX1010102</code> <sup>1</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_A2R10G10B10_UNORM_PACK32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCREEN_FORMAT_BGRA1010102</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_A2B10G10R10_UNORM_PACK32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCREEN_FORMAT_BGRX1010102</code> <sup>1</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_A2B10G10R10_UNORM_PACK32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCREEN_FORMAT_RGBA5551</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_A1R5G5B5_UNORM_PACK16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCREEN_FORMAT_RGBX5551</code> <sup>1</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_A1R5G5B5_UNORM_PACK16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCREEN_FORMAT_RGB565</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_R5G6B5_UNORM_PACK16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCREEN_FORMAT_RGB888</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_FORMAT_R8G8B8_UNORM</code></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">1</dt>
<dd>
<p>Vulkan does not differentiate between <code>SCREEN_FORMAT_RGBA8888</code> and
<code>SCREEN_FORMAT_RGBX8888</code>: they both behave as
<code>VK_FORMAT_R8G8B8A8_UNORM</code>.
After an external entity writes to a <code>SCREEN_FORMAT_RGBX8888</code> QNX
Screen buffer, the values read by Vulkan from the X/A component are
<strong>undefined</strong>.
To emulate the traditional behavior of the X component during sampling
or blending, applications <strong>should</strong> use <code>VK_COMPONENT_SWIZZLE_ONE</code> in
image view component mappings and <code>VK_BLEND_FACTOR_ONE</code> in color
blend factors.
There is no way to avoid copying these <strong>undefined</strong> values when copying
from such an image to another image or buffer.
The same behavior applies to the following pairs:
<code>SCREEN_FORMAT_BGRA8888</code> and <code>SCREEN_FORMAT_BGRX8888</code>,
<code>SCREEN_FORMAT_RGBA1010102</code> and <code>SCREEN_FORMAT_RGBX1010102</code>,
<code>SCREEN_FORMAT_BGRA1010102</code> and <code>SCREEN_FORMAT_BGRX1010102</code>,
<code>SCREEN_FORMAT_RGBA5551</code> and <code>SCREEN_FORMAT_RGBX5551</code></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="memory-peer-memory-features"><a class="anchor" href="#memory-peer-memory-features"></a>Peer Memory Features</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><em>Peer memory</em> is memory that is allocated for a given physical device and
then bound to a resource and accessed by a different physical device, in a
logical device that represents multiple physical devices.
Some ways of reading and writing peer memory <strong>may</strong> not be supported by a
device.</p>
</div>
<div class="paragraph">
<p>To determine how peer memory <strong>can</strong> be accessed, call:</p>
</div>
<div id="vkGetDeviceGroupPeerMemoryFeatures" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
void vkGetDeviceGroupPeerMemoryFeatures(
    VkDevice                                    device,
    uint32_t                                    heapIndex,
    uint32_t                                    localDeviceIndex,
    uint32_t                                    remoteDeviceIndex,
    VkPeerMemoryFeatureFlags*                   pPeerMemoryFeatures);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent command</p>
</div>
<div id="vkGetDeviceGroupPeerMemoryFeaturesKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_device_group
void vkGetDeviceGroupPeerMemoryFeaturesKHR(
    VkDevice                                    device,
    uint32_t                                    heapIndex,
    uint32_t                                    localDeviceIndex,
    uint32_t                                    remoteDeviceIndex,
    VkPeerMemoryFeatureFlags*                   pPeerMemoryFeatures);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the memory.</p>
</li>
<li>
<p><code>heapIndex</code> is the index of the memory heap from which the memory is
allocated.</p>
</li>
<li>
<p><code>localDeviceIndex</code> is the device index of the physical device that
performs the memory access.</p>
</li>
<li>
<p><code>remoteDeviceIndex</code> is the device index of the physical device that
the memory is allocated for.</p>
</li>
<li>
<p><code>pPeerMemoryFeatures</code> is a pointer to a
<a href="#VkPeerMemoryFeatureFlags">VkPeerMemoryFeatureFlags</a> bitmask indicating which types of memory
accesses are supported for the combination of heap, local, and remote
devices.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceGroupPeerMemoryFeatures-heapIndex-00691" href="#VUID-vkGetDeviceGroupPeerMemoryFeatures-heapIndex-00691"></a> <span class="vuid">VUID-vkGetDeviceGroupPeerMemoryFeatures-heapIndex-00691</span><br>

<code>heapIndex</code> <strong>must</strong> be less than <code>memoryHeapCount</code></p>
</li>
<li>
<p><a id="VUID-vkGetDeviceGroupPeerMemoryFeatures-localDeviceIndex-00692" href="#VUID-vkGetDeviceGroupPeerMemoryFeatures-localDeviceIndex-00692"></a> <span class="vuid">VUID-vkGetDeviceGroupPeerMemoryFeatures-localDeviceIndex-00692</span><br>

<code>localDeviceIndex</code> <strong>must</strong> be a valid device index</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceGroupPeerMemoryFeatures-remoteDeviceIndex-00693" href="#VUID-vkGetDeviceGroupPeerMemoryFeatures-remoteDeviceIndex-00693"></a> <span class="vuid">VUID-vkGetDeviceGroupPeerMemoryFeatures-remoteDeviceIndex-00693</span><br>

<code>remoteDeviceIndex</code> <strong>must</strong> be a valid device index</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceGroupPeerMemoryFeatures-localDeviceIndex-00694" href="#VUID-vkGetDeviceGroupPeerMemoryFeatures-localDeviceIndex-00694"></a> <span class="vuid">VUID-vkGetDeviceGroupPeerMemoryFeatures-localDeviceIndex-00694</span><br>

<code>localDeviceIndex</code> <strong>must</strong> not equal <code>remoteDeviceIndex</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceGroupPeerMemoryFeatures-device-parameter" href="#VUID-vkGetDeviceGroupPeerMemoryFeatures-device-parameter"></a> <span class="vuid">VUID-vkGetDeviceGroupPeerMemoryFeatures-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceGroupPeerMemoryFeatures-pPeerMemoryFeatures-parameter" href="#VUID-vkGetDeviceGroupPeerMemoryFeatures-pPeerMemoryFeatures-parameter"></a> <span class="vuid">VUID-vkGetDeviceGroupPeerMemoryFeatures-pPeerMemoryFeatures-parameter</span><br>
 <code>pPeerMemoryFeatures</code> <strong>must</strong> be a valid pointer to a <a href="#VkPeerMemoryFeatureFlags">VkPeerMemoryFeatureFlags</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong>may</strong> be set in
<a href="#vkGetDeviceGroupPeerMemoryFeatures">vkGetDeviceGroupPeerMemoryFeatures</a>::<code>pPeerMemoryFeatures</code>,
indicating supported peer memory features, are:</p>
</div>
<div id="VkPeerMemoryFeatureFlagBits" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
typedef enum VkPeerMemoryFeatureFlagBits {
    VK_PEER_MEMORY_FEATURE_COPY_SRC_BIT = 0x00000001,
    VK_PEER_MEMORY_FEATURE_COPY_DST_BIT = 0x00000002,
    VK_PEER_MEMORY_FEATURE_GENERIC_SRC_BIT = 0x00000004,
    VK_PEER_MEMORY_FEATURE_GENERIC_DST_BIT = 0x00000008,
  // Provided by VK_KHR_device_group
    VK_PEER_MEMORY_FEATURE_COPY_SRC_BIT_KHR = VK_PEER_MEMORY_FEATURE_COPY_SRC_BIT,
  // Provided by VK_KHR_device_group
    VK_PEER_MEMORY_FEATURE_COPY_DST_BIT_KHR = VK_PEER_MEMORY_FEATURE_COPY_DST_BIT,
  // Provided by VK_KHR_device_group
    VK_PEER_MEMORY_FEATURE_GENERIC_SRC_BIT_KHR = VK_PEER_MEMORY_FEATURE_GENERIC_SRC_BIT,
  // Provided by VK_KHR_device_group
    VK_PEER_MEMORY_FEATURE_GENERIC_DST_BIT_KHR = VK_PEER_MEMORY_FEATURE_GENERIC_DST_BIT,
} VkPeerMemoryFeatureFlagBits;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkPeerMemoryFeatureFlagBitsKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_device_group
typedef VkPeerMemoryFeatureFlagBits VkPeerMemoryFeatureFlagBitsKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_PEER_MEMORY_FEATURE_COPY_SRC_BIT</code> specifies that the memory <strong>can</strong>
be accessed as the source of any <code>vkCmdCopy*</code> command.</p>
</li>
<li>
<p><code>VK_PEER_MEMORY_FEATURE_COPY_DST_BIT</code> specifies that the memory <strong>can</strong>
be accessed as the destination of any <code>vkCmdCopy*</code> command.</p>
</li>
<li>
<p><code>VK_PEER_MEMORY_FEATURE_GENERIC_SRC_BIT</code> specifies that the memory
<strong>can</strong> be read as any memory access type.</p>
</li>
<li>
<p><code>VK_PEER_MEMORY_FEATURE_GENERIC_DST_BIT</code> specifies that the memory
<strong>can</strong> be written as any memory access type.
Shader atomics are considered to be writes.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The peer memory features of a memory heap also apply to any accesses that
<strong>may</strong> be performed during <a href="synchronization.html#synchronization-image-layout-transitions" class="xref page">imagelayout transitions</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>VK_PEER_MEMORY_FEATURE_COPY_DST_BIT</code> <strong>must</strong> be supported for all host
local heaps and for at least one device-local memory heap.</p>
</div>
<div class="paragraph">
<p>If a device does not support a peer memory feature, it is still valid to use
a resource that includes both local and peer memory bindings with the
corresponding access type as long as only the local bindings are actually
accessed.
For example, an application doing split-frame rendering would use
framebuffer attachments that include both local and peer memory bindings,
but would scissor the rendering to only update local memory.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkPeerMemoryFeatureFlags" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
typedef VkFlags VkPeerMemoryFeatureFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkPeerMemoryFeatureFlagsKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_device_group
typedef VkPeerMemoryFeatureFlags VkPeerMemoryFeatureFlagsKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkPeerMemoryFeatureFlags</code> is a bitmask type for setting a mask of zero
or more <a href="#VkPeerMemoryFeatureFlagBits">VkPeerMemoryFeatureFlagBits</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_opaque_capture_address_query"><a class="anchor" href="#_opaque_capture_address_query"></a>Opaque Capture Address Query</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query a 64-bit opaque capture address value from a memory object, call:</p>
</div>
<div id="vkGetDeviceMemoryOpaqueCaptureAddress" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_2
uint64_t vkGetDeviceMemoryOpaqueCaptureAddress(
    VkDevice                                    device,
    const VkDeviceMemoryOpaqueCaptureAddressInfo* pInfo);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent command</p>
</div>
<div id="vkGetDeviceMemoryOpaqueCaptureAddressKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_buffer_device_address
uint64_t vkGetDeviceMemoryOpaqueCaptureAddressKHR(
    VkDevice                                    device,
    const VkDeviceMemoryOpaqueCaptureAddressInfo* pInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that the memory object was allocated
on.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="#VkDeviceMemoryOpaqueCaptureAddressInfo">VkDeviceMemoryOpaqueCaptureAddressInfo</a> structure specifying the
memory object to retrieve an address for.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The 64-bit return value is an opaque address representing the start of
<code>pInfo-&gt;memory</code>.</p>
</div>
<div class="paragraph">
<p>If the memory object was allocated with a non-zero value of
<a href="#VkMemoryOpaqueCaptureAddressAllocateInfo">VkMemoryOpaqueCaptureAddressAllocateInfo</a>::<code>opaqueCaptureAddress</code>,
the return value <strong>must</strong> be the same address.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The expected usage for these opaque addresses is only for trace
capture/replay tools to store these addresses in a trace and subsequently
specify them during replay.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceMemoryOpaqueCaptureAddress-None-03334" href="#VUID-vkGetDeviceMemoryOpaqueCaptureAddress-None-03334"></a> <span class="vuid">VUID-vkGetDeviceMemoryOpaqueCaptureAddress-None-03334</span><br>

The <a href="features.html#features-bufferDeviceAddress" class="xref page"><code>bufferDeviceAddress</code></a> feature
<strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceMemoryOpaqueCaptureAddress-device-03335" href="#VUID-vkGetDeviceMemoryOpaqueCaptureAddress-device-03335"></a> <span class="vuid">VUID-vkGetDeviceMemoryOpaqueCaptureAddress-device-03335</span><br>

If <code>device</code> was created with multiple physical devices, then the
<a href="features.html#features-bufferDeviceAddressMultiDevice" class="xref page">    <code>bufferDeviceAddressMultiDevice</code></a> feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceMemoryOpaqueCaptureAddress-device-parameter" href="#VUID-vkGetDeviceMemoryOpaqueCaptureAddress-device-parameter"></a> <span class="vuid">VUID-vkGetDeviceMemoryOpaqueCaptureAddress-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceMemoryOpaqueCaptureAddress-pInfo-parameter" href="#VUID-vkGetDeviceMemoryOpaqueCaptureAddress-pInfo-parameter"></a> <span class="vuid">VUID-vkGetDeviceMemoryOpaqueCaptureAddress-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkDeviceMemoryOpaqueCaptureAddressInfo">VkDeviceMemoryOpaqueCaptureAddressInfo</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkDeviceMemoryOpaqueCaptureAddressInfo</code> structure is defined as:</p>
</div>
<div id="VkDeviceMemoryOpaqueCaptureAddressInfo" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_2
typedef struct VkDeviceMemoryOpaqueCaptureAddressInfo {
    VkStructureType    sType;
    const void*        pNext;
    VkDeviceMemory     memory;
} VkDeviceMemoryOpaqueCaptureAddressInfo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkDeviceMemoryOpaqueCaptureAddressInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_buffer_device_address
typedef VkDeviceMemoryOpaqueCaptureAddressInfo VkDeviceMemoryOpaqueCaptureAddressInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>memory</code> specifies the memory whose address is being queried.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkDeviceMemoryOpaqueCaptureAddressInfo-memory-03336" href="#VUID-VkDeviceMemoryOpaqueCaptureAddressInfo-memory-03336"></a> <span class="vuid">VUID-VkDeviceMemoryOpaqueCaptureAddressInfo-memory-03336</span><br>

<code>memory</code> <strong>must</strong> have been allocated with
<code>VK_MEMORY_ALLOCATE_DEVICE_ADDRESS_BIT</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkDeviceMemoryOpaqueCaptureAddressInfo-sType-sType" href="#VUID-VkDeviceMemoryOpaqueCaptureAddressInfo-sType-sType"></a> <span class="vuid">VUID-VkDeviceMemoryOpaqueCaptureAddressInfo-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_DEVICE_MEMORY_OPAQUE_CAPTURE_ADDRESS_INFO</code></p>
</li>
<li>
<p><a id="VUID-VkDeviceMemoryOpaqueCaptureAddressInfo-pNext-pNext" href="#VUID-VkDeviceMemoryOpaqueCaptureAddressInfo-pNext-pNext"></a> <span class="vuid">VUID-VkDeviceMemoryOpaqueCaptureAddressInfo-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkDeviceMemoryOpaqueCaptureAddressInfo-memory-parameter" href="#VUID-VkDeviceMemoryOpaqueCaptureAddressInfo-memory-parameter"></a> <span class="vuid">VUID-VkDeviceMemoryOpaqueCaptureAddressInfo-memory-parameter</span><br>
 <code>memory</code> <strong>must</strong> be a valid <a href="#VkDeviceMemory">VkDeviceMemory</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
    <!--
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
    -->
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
