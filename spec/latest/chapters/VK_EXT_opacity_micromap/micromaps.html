<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Micromap :: Vulkan Documentation Project</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../_/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../_/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../_/img/favicon-16x16.png">
    <link rel="manifest" href="../../../../_/static/site.webmanifest">
    <link rel="mask-icon" href="../../../../_/img/safari-pinned-tab.svg" color="#a41e22">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../.."><img class="navbar-item" alt="Vulkan White Label" src="../../../../_/Vulkan_Docs.svg" /></a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field has-filter">
          <label for="search-input"></label>
          <input id="search-input" type="text" placeholder="Search the docs">
          <label class="filter checkbox">
            <input type="checkbox" data-facet-filter="component:spec" checked> In this component
          </label>
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../spec/latest/chapters/introduction.html">Vulkan 1.3</a>
            <a class="navbar-item" href="https://registry.khronos.org/OpenGL/specs/gl/GLSLangSpec.4.60.html">GLSL</a>
            <a class="navbar-item" href="../../../../guide/latest/hlsl.html">HLSL</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Education</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../features/latest/features/index.html">Vulkan Feature Descriptions</a>
            <a class="navbar-item" href="../../../../guide/latest/index.html">Vulkan Guide</a>
            <a class="navbar-item" href="../../../../samples/latest/README.html">Vulkan Samples</a>
            <a class="navbar-item" href="../../../../tutorial/latest/index.html">Vulkan Tutorial</a>
            <a class="navbar-item" href="https://www.youtube.com/c/vulkan">YouTube</a>
            <a class="navbar-item" href="https://vulkan.org">More Info at Vulkan.org</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Feedback</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://github.com/KhronosGroup/Vulkan-Site/issues/new/choose" target="_blank">Report a Problem</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://reddit.com/r/vulkan">Reddit</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/vulkan">Stack Overflow</a>
            <a class="navbar-item" href="https://fosstodon.org/@vulkan">Mastodon</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="spec" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../../index.html">Vulkan Specification</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fundamentals.html">Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../initialization.html">Initialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../devsandqueues.html">Devices and Queues</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../cmdbuffers.html">Command Buffers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../synchronization.html">Synchronization and Cache Control</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../renderpass.html">Render Pass</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../shaders.html">Shaders</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../pipelines.html">Pipelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../memory.html">Memory Allocation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../resources.html">Resource Creation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../samplers.html">Samplers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../descriptorsets.html">Resource Descriptors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../interfaces.html">Shader Interfaces</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../textures.html">Image Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fragmentdensitymapops.html">Fragment Density Map Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../queries.html">Queries</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../clears.html">Clear Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../copies.html">Copy Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../drawing.html">Drawing Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fxvertex.html">Fixed-Function Vertex Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tessellation.html">Tessellation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../geometry.html">Geometry Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../VK_NV_mesh_shader/mesh.html">Mesh Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../VK_HUAWEI_cluster_culling_shader/clusterculling.html">Cluster Culling Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../vertexpostproc.html">Fixed-Function Vertex Post-Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../primsrast.html">Rasterization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fragops.html">Fragment Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../framebuffer.html">The Framebuffer</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../dispatch.html">Dispatching Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../device_generated_commands/generatedcommands.html">Device-Generated Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../sparsemem.html">Sparse Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../VK_KHR_surface/wsi.html">Window System Integration (WSI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../VK_KHR_deferred_host_operations/deferred_host_operations.html">Deferred Host Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../VK_EXT_private_data.html">Private Data</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../accelstructures.html">Acceleration Structures</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="micromaps.html">Micromap</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../raytraversal.html">Ray Traversal</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../raytracing.html">Ray Tracing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../VK_NV_memory_decompression.html">Memory Decompression</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../videocoding.html">Video Coding</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../VK_NV_optical_flow/optical_flow.html">Optical Flow</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../executiongraphs.html">Execution Graphs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extensions.html">Extending Vulkan</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../limits.html">Limits</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../formats.html">Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../capabilities.html">Additional Capabilities</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../debugging.html">Debugging</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/spirvenv.html">Vulkan Environment for SPIR-V</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/memorymodel.html">Memory Model</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/compressedtex.html">Compressed Image Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/versions.html">Core Revisions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/extensions.html">Layers &amp; Extensions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/roadmap.html">Vulkan Roadmap Milestones</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/boilerplate.html">API Boilerplate</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/invariance.html">Invariance</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/glossary.html">Lexicon</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../appendices/credits.html">Credits (Informative)</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Vulkan Specification</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../../tutorial/latest/00_Introduction.html">Khronos Vulkan Tutorial</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../tutorial/latest/00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../../features/latest/features/index.html">Vulkan Feature Descriptions</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../features/latest/features/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../../guide/latest/index.html">Vulkan Guide</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../../samples/latest/README.html">Vulkan Samples</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../samples/latest/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../../index.html">Vulkan Specification</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Vulkan Specification</a></li>
    <li><a href="micromaps.html">Micromap</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Micromap</h1>
<div class="sect1">
<h2 id="micromap-def"><a class="anchor" href="#micromap-def"></a>Micromaps</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Acceleration structures</em> store and organize geometry for ray tracing, but
in some cases it is beneficial to include some information within the
geometry, particularly for triangles.
A <em>micromap</em> organizes this data around a map of values corresponding to
subdivided microtriangles which can be added to a triangle geometry when
building a <em>bottom level acceleration structure</em>.</p>
</div>
<div class="paragraph">
<p>An <em>opacity micromap</em> is a type of micromap which stores information to
control intersection opacity as described in <a href="#ray-opacity-micromap">Ray Opacity Micromap</a>.</p>
</div>
<div class="paragraph">
<p>A micromap is considered to be constructed if a <a href="#micromap-building">micromap build command</a> or <a href="#micromap-copying">copy command</a> has been executed with
the given acceleration structure as the destination.</p>
</div>
<div class="sect2">
<h3 id="micromap-building"><a class="anchor" href="#micromap-building"></a>Building Micromaps</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build micromaps call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/protos/vkCmdBuildMicromapsEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>infoCount</code> is the number of micromaps to build.
It specifies the number of the <code>pInfos</code> structures that <strong>must</strong> be
provided.</p>
</li>
<li>
<p><code>pInfos</code> is a pointer to an array of <code>infoCount</code>
<code>VkMicromapBuildInfoEXT</code> structures defining the data used to build
each micromap.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>vkCmdBuildMicromapsEXT</code> command provides the ability to initiate
multiple micromaps builds, however there is no ordering or synchronization
implied between any of the individual micromap builds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This means that there <strong>cannot</strong> be any memory aliasing between any micromap
memories or scratch memories being used by any of the builds.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="micromap-scratch" class="paragraph">
<p>Accesses to the micromap scratch buffers as identified by the
<code>VkMicromapBuildInfoEXT</code>::<code>scratchData</code> buffer device addresses
<strong>must</strong> be <a href="../synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_MICROMAP_BUILD_BIT_EXT</code>
<a href="../synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="../synchronization.html#synchronization-access-types" class="xref page">access type</a> of
(<code>VK_ACCESS_2_MICROMAP_READ_BIT_EXT</code> |
<code>VK_ACCESS_2_MICROMAP_WRITE_BIT_EXT</code>).
Accesses to <code>VkMicromapBuildInfoEXT</code>::<code>dstMicromap</code> <strong>must</strong> be
<a href="../synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_MICROMAP_BUILD_BIT_EXT</code>
<a href="../synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="../synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_2_MICROMAP_WRITE_BIT_EXT</code>.</p>
</div>
<div class="paragraph">
<p>Accesses to other input buffers as identified by any used values of
<code>VkMicromapBuildInfoEXT</code>::<code>data</code> or
<code>VkMicromapBuildInfoEXT</code>::<code>triangleArray</code> <strong>must</strong> be
<a href="../synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_MICROMAP_BUILD_BIT_EXT</code>
<a href="../synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="../synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_SHADER_READ_BIT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-pInfos-07461" href="#VUID-vkCmdBuildMicromapsEXT-pInfos-07461"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-pInfos-07461</span><br>

For each <code>pInfos</code>[i], <code>dstMicromap</code> <strong>must</strong> have been created with
a value of <code>VkMicromapCreateInfoEXT</code>::<code>size</code> greater than or
equal to the memory size required by the build operation, as returned by
<code>vkGetMicromapBuildSizesEXT</code> with <span class="eq"><code>pBuildInfo</code> =
<code>pInfos</code>[i]</span></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-mode-07462" href="#VUID-vkCmdBuildMicromapsEXT-mode-07462"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-mode-07462</span><br>

The <code>mode</code> member of each element of <code>pInfos</code> <strong>must</strong> be a valid
<code>VkBuildMicromapModeEXT</code> value</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-dstMicromap-07463" href="#VUID-vkCmdBuildMicromapsEXT-dstMicromap-07463"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-dstMicromap-07463</span><br>

The <code>dstMicromap</code> member of any element of <code>pInfos</code> <strong>must</strong> be a
valid <code>VkMicromapEXT</code> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-pInfos-07464" href="#VUID-vkCmdBuildMicromapsEXT-pInfos-07464"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-pInfos-07464</span><br>

For each element of <code>pInfos</code> its <code>type</code> member <strong>must</strong> match the
value of <code>VkMicromapCreateInfoEXT</code>::<code>type</code> when its
<code>dstMicromap</code> was created</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-dstMicromap-07465" href="#VUID-vkCmdBuildMicromapsEXT-dstMicromap-07465"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-dstMicromap-07465</span><br>

The range of memory backing the <code>dstMicromap</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>dstMicromap</code> member of any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-dstMicromap-07466" href="#VUID-vkCmdBuildMicromapsEXT-dstMicromap-07466"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-dstMicromap-07466</span><br>

The range of memory backing the <code>dstMicromap</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>scratchData</code> member of any element of
<code>pInfos</code> (including the same element), which is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-scratchData-07467" href="#VUID-vkCmdBuildMicromapsEXT-scratchData-07467"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-scratchData-07467</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>scratchData</code> member of any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-pInfos-07508" href="#VUID-vkCmdBuildMicromapsEXT-pInfos-07508"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-pInfos-07508</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstMicromap</code> member <strong>must</strong> be bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-pInfos-07509" href="#VUID-vkCmdBuildMicromapsEXT-pInfos-07509"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-pInfos-07509</span><br>

If <code>pInfos</code>[i].<code>mode</code> is <code>VK_BUILD_MICROMAP_MODE_BUILD_EXT</code>,
all addresses between <code>pInfos</code>[i].<code>scratchData.deviceAddress</code>
and <code>pInfos</code>[i].<code>scratchData.deviceAddress</code> +  N - 1 <strong>must</strong>
be in the buffer device address range of the same buffer, where N is
given by the <code>buildScratchSize</code> member of the
<code>VkMicromapBuildSizesInfoEXT</code> structure returned from a call to
<code>vkGetMicromapBuildSizesEXT</code> with an identical
<code>VkMicromapBuildInfoEXT</code> structure and primitive count</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-data-07510" href="#VUID-vkCmdBuildMicromapsEXT-data-07510"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-data-07510</span><br>

The buffers from which the buffer device addresses for all of the
<code>data</code> and <code>triangleArray</code> members of all <code>pInfos</code>[i] are
queried <strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_MICROMAP_BUILD_INPUT_READ_ONLY_BIT_EXT</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-pInfos-07511" href="#VUID-vkCmdBuildMicromapsEXT-pInfos-07511"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-pInfos-07511</span><br>

For each element of <code>pInfos</code>[i] the buffer from which the buffer
device address <code>pInfos</code>[i].<code>scratchData.deviceAddress</code> is
queried <strong>must</strong> have been created with
<code>VK_BUFFER_USAGE_STORAGE_BUFFER_BIT</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-pInfos-07512" href="#VUID-vkCmdBuildMicromapsEXT-pInfos-07512"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-pInfos-07512</span><br>

For each element of <code>pInfos</code>, its <code>scratchData.deviceAddress</code>,
<code>data.deviceAddress</code>, and <code>triangleArray.deviceAddress</code> members
<strong>must</strong> be valid device addresses obtained from
<a href="../descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-pInfos-07513" href="#VUID-vkCmdBuildMicromapsEXT-pInfos-07513"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-pInfos-07513</span><br>

For each element of <code>pInfos</code>, if <code>scratchData.deviceAddress</code>,
<code>data.deviceAddress</code>, or <code>triangleArray.deviceAddress</code> is the
address of a non-sparse buffer then it <strong>must</strong> be bound completely and
contiguously to a single <a href="../memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-pInfos-07514" href="#VUID-vkCmdBuildMicromapsEXT-pInfos-07514"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-pInfos-07514</span><br>

For each element of <code>pInfos</code>, its <code>scratchData.deviceAddress</code>
member <strong>must</strong> be a multiple of
<code>VkPhysicalDeviceAccelerationStructurePropertiesKHR</code>::<code>minAccelerationStructureScratchOffsetAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildMicromapsEXT-pInfos-07515" href="#VUID-vkCmdBuildMicromapsEXT-pInfos-07515"></a> <span class="vuid">VUID-vkCmdBuildMicromapsEXT-pInfos-07515</span><br>

For each element of <code>pInfos</code>, its <code>triangleArray.deviceAddress</code>
and <code>data.deviceAddress</code> members <strong>must</strong> be a multiple of <code>256</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/protos/vkCmdBuildMicromapsEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Formats which <strong>can</strong> be set in <code>VkMicromapUsageEXT</code>::<code>format</code> and
<code>VkMicromapTriangleEXT</code>::<code>format</code> for micromap builds, are:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/enums/VkOpacityMicromapFormatEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_OPACITY_MICROMAP_FORMAT_2_STATE_EXT</code> indicates that the given
micromap format has one bit per subtriangle encoding either fully opaque
or fully transparent.</p>
</li>
<li>
<p><code>VK_OPACITY_MICROMAP_FORMAT_4_STATE_EXT</code> indicates that the given
micromap format has two bits per subtriangle encoding four modes which
can be interpreted as described in <a href="#ray-opacity-micromap">ray    traversal</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For compactness, these values are stored as 16-bit in some structures.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMicromapBuildInfoEXT</code> structure is defined as:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/structs/VkMicromapBuildInfoEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="../fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>type</code> is a <code>VkMicromapTypeEXT</code> value specifying the type of
micromap being built.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <code>VkBuildMicromapFlagBitsEXT</code> specifying
additional parameters of the micromap.</p>
</li>
<li>
<p><code>mode</code> is a <code>VkBuildMicromapModeEXT</code> value specifying the type
of operation to perform.</p>
</li>
<li>
<p><code>dstMicromap</code> is a pointer to the target micromap for the build.</p>
</li>
<li>
<p><code>usageCountsCount</code> specifies the number of usage counts structures
that will be used to determine the size of this micromap.</p>
</li>
<li>
<p><code>pUsageCounts</code> is a pointer to an array of <code>VkMicromapUsageEXT</code>
structures.</p>
</li>
<li>
<p><code>ppUsageCounts</code> is a pointer to an array of pointers to
<code>VkMicromapUsageEXT</code> structures.</p>
</li>
<li>
<p><code>data</code> is the device or host address to memory which contains the
data for the micromap.</p>
</li>
<li>
<p><code>scratchData</code> is the device or host address to memory that will be
used as scratch memory for the build.</p>
</li>
<li>
<p><code>triangleArray</code> is the device or host address to memory containing
the <code>VkMicromapTriangleEXT</code> data</p>
</li>
<li>
<p><code>triangleArrayStride</code> is the stride in bytes between each element of
<code>triangleArray</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only one of <code>pUsageCounts</code> or <code>ppUsageCounts</code> <strong>can</strong> be a valid
pointer, the other <strong>must</strong> be <code>NULL</code>.
The elements of the non-<code>NULL</code> array describe the total counts used to build
each micromap.
Each element contains a <code>count</code> which is the number of micromap
triangles of that <code>format</code> and <code>subdivisionLevel</code> contained in the
micromap.
Multiple elements with the same <code>format</code> and <code>subdivisionLevel</code> are
allowed and the total count for that <code>format</code> and <code>subdivisionLevel</code>
is the sum of the <code>count</code> for each element.</p>
</div>
<div class="paragraph">
<p>Each micromap triangle refers to one element in <code>triangleArray</code> which
contains the <code>format</code> and <code>subdivisionLevel</code> for that particular
triangle as well as a <code>dataOffset</code> in bytes which is the location
relative to <code>data</code> where that triangle&#8217;s micromap data begins.
The data at <code>triangleArray</code> is laid out as a 4 byte unsigned integer for
the <code>dataOffset</code> followed by a 2 byte unsigned integer for the
subdivision level then a 2 byte unsigned integer for the format.
In practice, compilers compile <code>VkMicromapTriangleEXT</code> to match this
pattern.</p>
</div>
<div class="paragraph">
<p>For opacity micromaps, the data at <code>data</code> is packed as either one bit
per element for <code>VK_OPACITY_MICROMAP_FORMAT_2_STATE_EXT</code> or two bits per
element for <code>VK_OPACITY_MICROMAP_FORMAT_4_STATE_EXT</code> and is packed from
LSB to MSB in each byte.
The data at each index in those bytes is interpreted as discussed in
<a href="#ray-opacity-micromap">Ray Opacity Micromap</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMicromapBuildInfoEXT-pUsageCounts-07516" href="#VUID-VkMicromapBuildInfoEXT-pUsageCounts-07516"></a> <span class="vuid">VUID-VkMicromapBuildInfoEXT-pUsageCounts-07516</span><br>

Only one of <code>pUsageCounts</code> or <code>ppUsageCounts</code> <strong>can</strong> be a valid
pointer, the other <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkMicromapBuildInfoEXT-type-07517" href="#VUID-VkMicromapBuildInfoEXT-type-07517"></a> <span class="vuid">VUID-VkMicromapBuildInfoEXT-type-07517</span><br>

If <code>type</code> is <code>VK_MICROMAP_TYPE_OPACITY_MICROMAP_EXT</code> the
<code>format</code> member of <code>VkMicromapUsageEXT</code> <strong>must</strong> be a valid value
from <code>VkOpacityMicromapFormatEXT</code></p>
</li>
<li>
<p><a id="VUID-VkMicromapBuildInfoEXT-type-07518" href="#VUID-VkMicromapBuildInfoEXT-type-07518"></a> <span class="vuid">VUID-VkMicromapBuildInfoEXT-type-07518</span><br>

If <code>type</code> is <code>VK_MICROMAP_TYPE_OPACITY_MICROMAP_EXT</code> the
<code>format</code> member of <code>VkMicromapTriangleEXT</code> <strong>must</strong> be a valid
value from <code>VkOpacityMicromapFormatEXT</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/structs/VkMicromapBuildInfoEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkBuildMicromapModeEXT</code> enumeration is defined as:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/enums/VkBuildMicromapModeEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_BUILD_MICROMAP_MODE_BUILD_EXT</code> specifies that the destination
micromap will be built using the specified data.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMicromapUsageEXT</code> structure is defined as:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/structs/VkMicromapUsageEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>count</code> is the number of triangles in the usage format defined by
the <code>subdivisionLevel</code> and <code>format</code> below in the micromap</p>
</li>
<li>
<p><code>subdivisionLevel</code> is the subdivision level of this usage format</p>
</li>
<li>
<p><code>format</code> is the format of this usage format</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMicromapUsageEXT-format-07519" href="#VUID-VkMicromapUsageEXT-format-07519"></a> <span class="vuid">VUID-VkMicromapUsageEXT-format-07519</span><br>

If the <code>VkMicromapTypeEXT</code> of the micromap is
<code>VK_MICROMAP_TYPE_OPACITY_MICROMAP_EXT</code> then <code>format</code> <strong>must</strong> be
<code>VK_OPACITY_MICROMAP_FORMAT_2_STATE_EXT</code> or
<code>VK_OPACITY_MICROMAP_FORMAT_4_STATE_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkMicromapUsageEXT-format-07520" href="#VUID-VkMicromapUsageEXT-format-07520"></a> <span class="vuid">VUID-VkMicromapUsageEXT-format-07520</span><br>

If the <code>VkMicromapTypeEXT</code> of the micromap is
<code>VK_MICROMAP_TYPE_OPACITY_MICROMAP_EXT</code> and <code>format</code> is
<code>VK_OPACITY_MICROMAP_FORMAT_2_STATE_EXT</code> then <code>subdivisionLevel</code>
<strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceOpacityMicromapPropertiesEXT</code>::<code>maxOpacity2StateSubdivisionLevel</code></p>
</li>
<li>
<p><a id="VUID-VkMicromapUsageEXT-format-07521" href="#VUID-VkMicromapUsageEXT-format-07521"></a> <span class="vuid">VUID-VkMicromapUsageEXT-format-07521</span><br>

If the <code>VkMicromapTypeEXT</code> of the micromap is
<code>VK_MICROMAP_TYPE_OPACITY_MICROMAP_EXT</code> and <code>format</code> is
<code>VK_OPACITY_MICROMAP_FORMAT_4_STATE_EXT</code> then <code>subdivisionLevel</code>
<strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceOpacityMicromapPropertiesEXT</code>::<code>maxOpacity4StateSubdivisionLevel</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>format</code> is interpreted based on the <code>type</code> of the micromap
using it.</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/structs/VkMicromapUsageEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMicromapTriangleEXT</code> structure is defined as:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/structs/VkMicromapTriangleEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dataOffset</code> is the offset in bytes of the start of the data for
this triangle.
This is a byte aligned value.</p>
</li>
<li>
<p><code>subdivisionLevel</code> is the subdivision level of this triangle</p>
</li>
<li>
<p><code>format</code> is the format of this triangle</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMicromapTriangleEXT-format-07522" href="#VUID-VkMicromapTriangleEXT-format-07522"></a> <span class="vuid">VUID-VkMicromapTriangleEXT-format-07522</span><br>

If the <code>VkMicromapTypeEXT</code> of the micromap is
<code>VK_MICROMAP_TYPE_OPACITY_MICROMAP_EXT</code> then <code>format</code> <strong>must</strong> be
<code>VK_OPACITY_MICROMAP_FORMAT_2_STATE_EXT</code> or
<code>VK_OPACITY_MICROMAP_FORMAT_4_STATE_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkMicromapTriangleEXT-format-07523" href="#VUID-VkMicromapTriangleEXT-format-07523"></a> <span class="vuid">VUID-VkMicromapTriangleEXT-format-07523</span><br>

If the <code>VkMicromapTypeEXT</code> of the micromap is
<code>VK_MICROMAP_TYPE_OPACITY_MICROMAP_EXT</code> and <code>format</code> is
<code>VK_OPACITY_MICROMAP_FORMAT_2_STATE_EXT</code> then <code>subdivisionLevel</code>
<strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceOpacityMicromapPropertiesEXT</code>::<code>maxOpacity2StateSubdivisionLevel</code></p>
</li>
<li>
<p><a id="VUID-VkMicromapTriangleEXT-format-07524" href="#VUID-VkMicromapTriangleEXT-format-07524"></a> <span class="vuid">VUID-VkMicromapTriangleEXT-format-07524</span><br>

If the <code>VkMicromapTypeEXT</code> of the micromap is
<code>VK_MICROMAP_TYPE_OPACITY_MICROMAP_EXT</code> and <code>format</code> is
<code>VK_OPACITY_MICROMAP_FORMAT_4_STATE_EXT</code> then <code>subdivisionLevel</code>
<strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceOpacityMicromapPropertiesEXT</code>::<code>maxOpacity4StateSubdivisionLevel</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>format</code> is interpreted based on the <code>type</code> of the micromap
using it.</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/structs/VkMicromapTriangleEXT.adoc[]</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="micromap-copying"><a class="anchor" href="#micromap-copying"></a>Copying Micromaps</h3>
<div class="paragraph">
<p>An additional command exists for copying micromaps without updating their
contents.
Before copying, an application <strong>must</strong> query the size of the resulting
micromap.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query micromap size parameters call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/protos/vkCmdWriteMicromapsPropertiesEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>micromapCount</code> is the count of micromaps for which to query the
property.</p>
</li>
<li>
<p><code>pMicromaps</code> is a pointer to an array of existing previously built
micromaps.</p>
</li>
<li>
<p><code>queryType</code> is a <a href="../queries.html#VkQueryType" class="xref page">VkQueryType</a> value specifying the type of
queries managed by the pool.</p>
</li>
<li>
<p><code>queryPool</code> is the query pool that will manage the results of the
query.</p>
</li>
<li>
<p><code>firstQuery</code> is the first query index within the query pool that
will contain the <code>micromapCount</code> number of results.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to any of the micromaps listed in <code>pMicromaps</code> <strong>must</strong> be
<a href="../synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_MICROMAP_BUILD_BIT_EXT</code>
<a href="../synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="../synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_2_MICROMAP_READ_BIT_EXT</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>queryType</code> is
<code>VK_QUERY_TYPE_MICROMAP_SERIALIZATION_SIZE_EXT</code>, then the value
written out is the number of bytes required by a serialized micromap.</p>
</li>
<li>
<p>If <code>queryType</code> is <code>VK_QUERY_TYPE_MICROMAP_COMPACTED_SIZE_EXT</code>,
then the value written out is the number of bytes required by a
compacted micromap.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteMicromapsPropertiesEXT-queryPool-07525" href="#VUID-vkCmdWriteMicromapsPropertiesEXT-queryPool-07525"></a> <span class="vuid">VUID-vkCmdWriteMicromapsPropertiesEXT-queryPool-07525</span><br>

<code>queryPool</code> <strong>must</strong> have been created with a <code>queryType</code> matching
<code>queryType</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteMicromapsPropertiesEXT-queryPool-07526" href="#VUID-vkCmdWriteMicromapsPropertiesEXT-queryPool-07526"></a> <span class="vuid">VUID-vkCmdWriteMicromapsPropertiesEXT-queryPool-07526</span><br>

The queries identified by <code>queryPool</code> and <code>firstQuery</code> <strong>must</strong> be
<em>unavailable</em></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteMicromapsPropertiesEXT-buffer-07527" href="#VUID-vkCmdWriteMicromapsPropertiesEXT-buffer-07527"></a> <span class="vuid">VUID-vkCmdWriteMicromapsPropertiesEXT-buffer-07527</span><br>

The <code>buffer</code> used to create each micromap in <code>pMicrmaps</code> <strong>must</strong>
be bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteMicromapsPropertiesEXT-query-07528" href="#VUID-vkCmdWriteMicromapsPropertiesEXT-query-07528"></a> <span class="vuid">VUID-vkCmdWriteMicromapsPropertiesEXT-query-07528</span><br>

The sum of <code>query</code> plus <code>micromapCount</code> <strong>must</strong> be less than or
equal to the number of queries in <code>queryPool</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteMicromapsPropertiesEXT-pMicromaps-07501" href="#VUID-vkCmdWriteMicromapsPropertiesEXT-pMicromaps-07501"></a> <span class="vuid">VUID-vkCmdWriteMicromapsPropertiesEXT-pMicromaps-07501</span><br>

All micromaps in <code>pMicromaps</code> <strong>must</strong> have been constructed prior to
the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteMicromapsPropertiesEXT-pMicromaps-07502" href="#VUID-vkCmdWriteMicromapsPropertiesEXT-pMicromaps-07502"></a> <span class="vuid">VUID-vkCmdWriteMicromapsPropertiesEXT-pMicromaps-07502</span><br>

All micromaps in <code>pMicromaps</code> <strong>must</strong> have been constructed with
<code>VK_BUILD_MICROMAP_ALLOW_COMPACTION_BIT_EXT</code> if <code>queryType</code> is
<code>VK_QUERY_TYPE_MICROMAP_COMPACTED_SIZE_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteMicromapsPropertiesEXT-queryType-07503" href="#VUID-vkCmdWriteMicromapsPropertiesEXT-queryType-07503"></a> <span class="vuid">VUID-vkCmdWriteMicromapsPropertiesEXT-queryType-07503</span><br>

<code>queryType</code> <strong>must</strong> be <code>VK_QUERY_TYPE_MICROMAP_COMPACTED_SIZE_EXT</code>
or <code>VK_QUERY_TYPE_MICROMAP_SERIALIZATION_SIZE_EXT</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/protos/vkCmdWriteMicromapsPropertiesEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy a micromap call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/protos/vkCmdCopyMicromapEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <code>VkCopyMicromapInfoEXT</code> structure
defining the copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command copies the <code>pInfo-&gt;src</code> micromap to the <code>pInfo-&gt;dst</code>
micromap in the manner specified by <code>pInfo-&gt;mode</code>.</p>
</div>
<div class="paragraph">
<p>Accesses to <code>pInfo-&gt;src</code> and <code>pInfo-&gt;dst</code> <strong>must</strong> be
<a href="../synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_MICROMAP_BUILD_BIT_EXT</code>
<a href="../synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="../synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_2_MICROMAP_READ_BIT_EXT</code> or
<code>VK_ACCESS_2_MICROMAP_WRITE_BIT_EXT</code> as appropriate.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyMicromapEXT-buffer-07529" href="#VUID-vkCmdCopyMicromapEXT-buffer-07529"></a> <span class="vuid">VUID-vkCmdCopyMicromapEXT-buffer-07529</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMicromapEXT-buffer-07530" href="#VUID-vkCmdCopyMicromapEXT-buffer-07530"></a> <span class="vuid">VUID-vkCmdCopyMicromapEXT-buffer-07530</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
device memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/protos/vkCmdCopyMicromapEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkCopyMicromapInfoEXT</code> structure is defined as:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/structs/VkCopyMicromapInfoEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="../fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>src</code> is the source micromap for the copy.</p>
</li>
<li>
<p><code>dst</code> is the target micromap for the copy.</p>
</li>
<li>
<p><code>mode</code> is a <code>VkCopyMicromapModeEXT</code> value specifying additional
operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyMicromapInfoEXT-mode-07531" href="#VUID-VkCopyMicromapInfoEXT-mode-07531"></a> <span class="vuid">VUID-VkCopyMicromapInfoEXT-mode-07531</span><br>

<code>mode</code> <strong>must</strong> be <code>VK_COPY_MICROMAP_MODE_COMPACT_EXT</code> or
<code>VK_COPY_MICROMAP_MODE_CLONE_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMicromapInfoEXT-src-07532" href="#VUID-VkCopyMicromapInfoEXT-src-07532"></a> <span class="vuid">VUID-VkCopyMicromapInfoEXT-src-07532</span><br>

The source acceleration structure <code>src</code> <strong>must</strong> have been constructed
prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-VkCopyMicromapInfoEXT-mode-07533" href="#VUID-VkCopyMicromapInfoEXT-mode-07533"></a> <span class="vuid">VUID-VkCopyMicromapInfoEXT-mode-07533</span><br>

If <code>mode</code> is <code>VK_COPY_MICROMAP_MODE_COMPACT_EXT</code>, <code>src</code>
<strong>must</strong> have been constructed with
<code>VK_BUILD_MICROMAP_ALLOW_COMPACTION_BIT_EXT</code> in the build</p>
</li>
<li>
<p><a id="VUID-VkCopyMicromapInfoEXT-buffer-07534" href="#VUID-VkCopyMicromapInfoEXT-buffer-07534"></a> <span class="vuid">VUID-VkCopyMicromapInfoEXT-buffer-07534</span><br>

The <code>buffer</code> used to create <code>src</code> <strong>must</strong> be bound to device
memory</p>
</li>
<li>
<p><a id="VUID-VkCopyMicromapInfoEXT-buffer-07535" href="#VUID-VkCopyMicromapInfoEXT-buffer-07535"></a> <span class="vuid">VUID-VkCopyMicromapInfoEXT-buffer-07535</span><br>

The <code>buffer</code> used to create <code>dst</code> <strong>must</strong> be bound to device
memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/structs/VkCopyMicromapInfoEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Possible values of <code>mode</code> specifying additional operations to perform
during the copy, are:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/enums/VkCopyMicromapModeEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_COPY_MICROMAP_MODE_CLONE_EXT</code> creates a direct copy of the
micromap specified in <code>src</code> into the one specified by <code>dst</code>.
The <code>dst</code> micromap <strong>must</strong> have been created with the same parameters
as <code>src</code>.</p>
</li>
<li>
<p><code>VK_COPY_MICROMAP_MODE_SERIALIZE_EXT</code> serializes the micromap to a
semi-opaque format which can be reloaded on a compatible implementation.</p>
</li>
<li>
<p><code>VK_COPY_MICROMAP_MODE_DESERIALIZE_EXT</code> deserializes the semi-opaque
serialization format in the buffer to the micromap.</p>
</li>
<li>
<p><code>VK_COPY_MICROMAP_MODE_COMPACT_EXT</code> creates a more compact version
of a micromap <code>src</code> into <code>dst</code>.
The micromap <code>dst</code> <strong>must</strong> have been created with a size at least as
large as that returned by <code>vkCmdWriteMicromapsPropertiesEXT</code> after
the build of the micromap specified by <code>src</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy a micromap to device memory call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/protos/vkCmdCopyMicromapToMemoryEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> is an a pointer to a <code>VkCopyMicromapToMemoryInfoEXT</code>
structure defining the copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>pInfo-&gt;src</code> <strong>must</strong> be <a href="../synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the <code>VK_PIPELINE_STAGE_2_MICROMAP_BUILD_BIT_EXT</code>
<a href="../synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="../synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_2_MICROMAP_READ_BIT_EXT</code>.
Accesses to the buffer indicated by <code>pInfo-&gt;dst.deviceAddress</code> <strong>must</strong> be
synchronized with the <code>VK_PIPELINE_STAGE_2_MICROMAP_BUILD_BIT_EXT</code>
pipeline stage and an access type of <code>VK_ACCESS_TRANSFER_WRITE_BIT</code>.</p>
</div>
<div class="paragraph">
<p>This command produces the same results as <code>vkCopyMicromapToMemoryEXT</code>,
but writes its result to a device address, and is executed on the device
rather than the host.
The output <strong>may</strong> not necessarily be bit-for-bit identical, but it can be
equally used by either <code>vkCmdCopyMemoryToMicromapEXT</code> or
<code>vkCopyMemoryToMicromapEXT</code>.</p>
</div>
<div id="serialized-micromap-header" class="paragraph">
<p>The defined header structure for the serialized data consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_UUID_SIZE</code> bytes of data matching
<code>VkPhysicalDeviceIDProperties</code>::<code>driverUUID</code></p>
</li>
<li>
<p><code>VK_UUID_SIZE</code> bytes of data identifying the compatibility for
    comparison using <code>vkGetDeviceMicromapCompatibilityEXT</code>
The serialized data is written to the buffer (or read from the buffer)
according to the host endianness.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyMicromapToMemoryEXT-pInfo-07536" href="#VUID-vkCmdCopyMicromapToMemoryEXT-pInfo-07536"></a> <span class="vuid">VUID-vkCmdCopyMicromapToMemoryEXT-pInfo-07536</span><br>

<code>pInfo-&gt;dst.deviceAddress</code> <strong>must</strong> be a valid device address for a
buffer bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMicromapToMemoryEXT-pInfo-07537" href="#VUID-vkCmdCopyMicromapToMemoryEXT-pInfo-07537"></a> <span class="vuid">VUID-vkCmdCopyMicromapToMemoryEXT-pInfo-07537</span><br>

<code>pInfo-&gt;dst.deviceAddress</code> <strong>must</strong> be aligned to <code>256</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMicromapToMemoryEXT-pInfo-07538" href="#VUID-vkCmdCopyMicromapToMemoryEXT-pInfo-07538"></a> <span class="vuid">VUID-vkCmdCopyMicromapToMemoryEXT-pInfo-07538</span><br>

If the buffer pointed to by <code>pInfo-&gt;dst.deviceAddress</code> is non-sparse
then it <strong>must</strong> be bound completely and contiguously to a single
<a href="../memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMicromapToMemoryEXT-buffer-07539" href="#VUID-vkCmdCopyMicromapToMemoryEXT-buffer-07539"></a> <span class="vuid">VUID-vkCmdCopyMicromapToMemoryEXT-buffer-07539</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
device memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/protos/vkCmdCopyMicromapToMemoryEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/structs/VkCopyMicromapToMemoryInfoEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="../fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>src</code> is the source micromap for the copy</p>
</li>
<li>
<p><code>dst</code> is the device or host address to memory which is the target
for the copy</p>
</li>
<li>
<p><code>mode</code> is a <code>VkCopyMicromapModeEXT</code> value specifying additional
operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyMicromapToMemoryInfoEXT-src-07540" href="#VUID-VkCopyMicromapToMemoryInfoEXT-src-07540"></a> <span class="vuid">VUID-VkCopyMicromapToMemoryInfoEXT-src-07540</span><br>

The source micromap <code>src</code> <strong>must</strong> have been constructed prior to the
execution of this command</p>
</li>
<li>
<p><a id="VUID-VkCopyMicromapToMemoryInfoEXT-dst-07541" href="#VUID-VkCopyMicromapToMemoryInfoEXT-dst-07541"></a> <span class="vuid">VUID-VkCopyMicromapToMemoryInfoEXT-dst-07541</span><br>

The memory pointed to by <code>dst</code> <strong>must</strong> be at least as large as the
serialization size of <code>src</code>, as reported by
<code>vkWriteMicromapsPropertiesEXT</code> or
<code>vkCmdWriteMicromapsPropertiesEXT</code> with a query type of
<code>VK_QUERY_TYPE_MICROMAP_SERIALIZATION_SIZE_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMicromapToMemoryInfoEXT-mode-07542" href="#VUID-VkCopyMicromapToMemoryInfoEXT-mode-07542"></a> <span class="vuid">VUID-VkCopyMicromapToMemoryInfoEXT-mode-07542</span><br>

<code>mode</code> <strong>must</strong> be <code>VK_COPY_MICROMAP_MODE_SERIALIZE_EXT</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/structs/VkCopyMicromapToMemoryInfoEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy device memory to a micromap call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/protos/vkCmdCopyMemoryToMicromapEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <code>VkCopyMicromapToMemoryInfoEXT</code>
structure defining the copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>pInfo-&gt;dst</code> <strong>must</strong> be <a href="../synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the <code>VK_PIPELINE_STAGE_2_MICROMAP_BUILD_BIT_EXT</code>
<a href="../synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="../synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_2_MICROMAP_READ_BIT_EXT</code>.
Accesses to the buffer indicated by <code>pInfo-&gt;src.deviceAddress</code> <strong>must</strong> be
synchronized with the <code>VK_PIPELINE_STAGE_2_MICROMAP_BUILD_BIT_EXT</code>
pipeline stage and an access type of <code>VK_ACCESS_TRANSFER_READ_BIT</code>.</p>
</div>
<div class="paragraph">
<p>This command can accept micromaps produced by either
<code>vkCmdCopyMicromapToMemoryEXT</code> or <code>vkCopyMicromapToMemoryEXT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyMemoryToMicromapEXT-pInfo-07543" href="#VUID-vkCmdCopyMemoryToMicromapEXT-pInfo-07543"></a> <span class="vuid">VUID-vkCmdCopyMemoryToMicromapEXT-pInfo-07543</span><br>

<code>pInfo-&gt;src.deviceAddress</code> <strong>must</strong> be a valid device address for a
buffer bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToMicromapEXT-pInfo-07544" href="#VUID-vkCmdCopyMemoryToMicromapEXT-pInfo-07544"></a> <span class="vuid">VUID-vkCmdCopyMemoryToMicromapEXT-pInfo-07544</span><br>

<code>pInfo-&gt;src.deviceAddress</code> <strong>must</strong> be aligned to <code>256</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToMicromapEXT-pInfo-07545" href="#VUID-vkCmdCopyMemoryToMicromapEXT-pInfo-07545"></a> <span class="vuid">VUID-vkCmdCopyMemoryToMicromapEXT-pInfo-07545</span><br>

If the buffer pointed to by <code>pInfo-&gt;src.deviceAddress</code> is non-sparse
then it <strong>must</strong> be bound completely and contiguously to a single
<a href="../memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToMicromapEXT-buffer-07546" href="#VUID-vkCmdCopyMemoryToMicromapEXT-buffer-07546"></a> <span class="vuid">VUID-vkCmdCopyMemoryToMicromapEXT-buffer-07546</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
device memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/protos/vkCmdCopyMemoryToMicromapEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkCopyMemoryToMicromapInfoEXT</code> structure is defined as:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/structs/VkCopyMemoryToMicromapInfoEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="../fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>src</code> is the device or host address to memory containing the source
data for the copy.</p>
</li>
<li>
<p><code>dst</code> is the target micromap for the copy.</p>
</li>
<li>
<p><code>mode</code> is a <code>VkCopyMicromapModeEXT</code> value specifying additional
operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyMemoryToMicromapInfoEXT-src-07547" href="#VUID-VkCopyMemoryToMicromapInfoEXT-src-07547"></a> <span class="vuid">VUID-VkCopyMemoryToMicromapInfoEXT-src-07547</span><br>

The source memory pointed to by <code>src</code> <strong>must</strong> contain data previously
serialized using <code>vkCmdCopyMicromapToMemoryEXT</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToMicromapInfoEXT-mode-07548" href="#VUID-VkCopyMemoryToMicromapInfoEXT-mode-07548"></a> <span class="vuid">VUID-VkCopyMemoryToMicromapInfoEXT-mode-07548</span><br>

<code>mode</code> <strong>must</strong> be <code>VK_COPY_MICROMAP_MODE_DESERIALIZE_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToMicromapInfoEXT-src-07549" href="#VUID-VkCopyMemoryToMicromapInfoEXT-src-07549"></a> <span class="vuid">VUID-VkCopyMemoryToMicromapInfoEXT-src-07549</span><br>

The data in <code>src</code> <strong>must</strong> have a format compatible with the
destination physical device as returned by
<code>vkGetDeviceMicromapCompatibilityEXT</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToMicromapInfoEXT-dst-07550" href="#VUID-VkCopyMemoryToMicromapInfoEXT-dst-07550"></a> <span class="vuid">VUID-VkCopyMemoryToMicromapInfoEXT-dst-07550</span><br>

<code>dst</code> <strong>must</strong> have been created with a <code>size</code> greater than or
equal to that used to serialize the data in <code>src</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/structs/VkCopyMemoryToMicromapInfoEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To check if a serialized micromap is compatible with the current device
call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/protos/vkGetDeviceMicromapCompatibilityEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device to check the version against.</p>
</li>
<li>
<p><code>pVersionInfo</code> is a pointer to a <code>VkMicromapVersionInfoEXT</code>
structure specifying version information to check against the device.</p>
</li>
<li>
<p><code>pCompatibility</code> is a pointer to a
<code>VkAccelerationStructureCompatibilityKHR</code> value in which
compatibility information is returned.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceMicromapCompatibilityEXT-micromap-07551" href="#VUID-vkGetDeviceMicromapCompatibilityEXT-micromap-07551"></a> <span class="vuid">VUID-vkGetDeviceMicromapCompatibilityEXT-micromap-07551</span><br>

The <a href="#features-micromap"><code>micromap</code></a> feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/protos/vkGetDeviceMicromapCompatibilityEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMicromapVersionInfoEXT</code> structure is defined as:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/structs/VkMicromapVersionInfoEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="../fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>pVersionData</code> is a pointer to the version header of a micromap as
defined in <code>vkCmdCopyMicromapToMemoryEXT</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>pVersionData</code> is a <em>pointer</em> to an array of 2<code>VK_UUID_SIZE</code>
<code>uint8_t</code> values instead of two <code>VK_UUID_SIZE</code> arrays as the expected
use case for this member is to be pointed at the header of a previously
serialized micromap (via <code>vkCmdCopyMicromapToMemoryEXT</code> or
<code>vkCopyMicromapToMemoryEXT</code>) that is loaded in memory.
Using arrays would necessitate extra memory copies of the UUIDs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/structs/VkMicromapVersionInfoEXT.adoc[]</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="host-micromap"><a class="anchor" href="#host-micromap"></a>Host Micromap Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Implementations are also required to provide host implementations of the
micromap operations if the <a href="#features-micromapHostCommands"><code>micromapHostCommands</code></a> feature is enabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>vkBuildMicromapsEXT</code> corresponding to <code>vkCmdBuildMicromapsEXT</code></p>
</li>
<li>
<p><code>vkCopyMicromapEXT</code> corresponding to <code>vkCmdCopyMicromapEXT</code></p>
</li>
<li>
<p><code>vkCopyMicromapToMemoryEXT</code> corresponding to
<code>vkCmdCopyMicromapToMemoryEXT</code></p>
</li>
<li>
<p><code>vkCopyMemoryToMicromapEXT</code> corresponding to
<code>vkCmdCopyMemoryToMicromapEXT</code></p>
</li>
<li>
<p><code>vkWriteMicromapsPropertiesEXT</code> corresponding to
<code>vkCmdWriteMicromapsPropertiesEXT</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These commands are functionally equivalent to their device counterparts,
except that they are executed on the host timeline, rather than being
enqueued into command buffers.</p>
</div>
<div class="paragraph">
<p>All micromaps used by the host commands <strong>must</strong> be bound to host-visible
memory, and all input data for micromap builds <strong>must</strong> be referenced using
host addresses instead of device addresses.
Applications are not required to map micromap memory when using the host
commands.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>vkBuildMicromapsEXT</code> and <code>vkCmdBuildMicromapsEXT</code> <strong>may</strong> use
different algorithms, and thus are not required to produce identical
structures.</p>
</div>
<div class="paragraph">
<p>Apart from these details, the host and device operations are
interchangeable.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For efficient execution, micromaps manipulated using these commands should
always be bound to host cached memory, as the implementation may need to
repeatedly read and write this memory during the execution of the command.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build micromaps on the host, call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/protos/vkBuildMicromapsEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the <code>VkDevice</code> for which the micromaps are being
built.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <code>VkDeferredOperationKHR</code> to
<a href="#deferred-host-operations-requesting">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>infoCount</code> is the number of micromaps to build.
It specifies the number of the <code>pInfos</code> that <strong>must</strong> be provided.</p>
</li>
<li>
<p><code>pInfos</code> is a pointer to an array of <code>infoCount</code>
<code>VkMicromapBuildInfoEXT</code> structures defining the geometry used to
build each micromap.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as <code>vkCmdBuildMicromapsEXT</code> but is
executed by the host.</p>
</div>
<div class="paragraph">
<p>The <code>vkBuildMicromapsEXT</code> command provides the ability to initiate
multiple micromaps builds, however there is no ordering or synchronization
implied between any of the individual micromap builds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This means that there <strong>cannot</strong> be any memory aliasing between any micromap
memories or scratch memories being used by any of the builds.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildMicromapsEXT-pInfos-07461" href="#VUID-vkBuildMicromapsEXT-pInfos-07461"></a> <span class="vuid">VUID-vkBuildMicromapsEXT-pInfos-07461</span><br>

For each <code>pInfos</code>[i], <code>dstMicromap</code> <strong>must</strong> have been created with
a value of <code>VkMicromapCreateInfoEXT</code>::<code>size</code> greater than or
equal to the memory size required by the build operation, as returned by
<code>vkGetMicromapBuildSizesEXT</code> with <span class="eq"><code>pBuildInfo</code> =
<code>pInfos</code>[i]</span></p>
</li>
<li>
<p><a id="VUID-vkBuildMicromapsEXT-mode-07462" href="#VUID-vkBuildMicromapsEXT-mode-07462"></a> <span class="vuid">VUID-vkBuildMicromapsEXT-mode-07462</span><br>

The <code>mode</code> member of each element of <code>pInfos</code> <strong>must</strong> be a valid
<code>VkBuildMicromapModeEXT</code> value</p>
</li>
<li>
<p><a id="VUID-vkBuildMicromapsEXT-dstMicromap-07463" href="#VUID-vkBuildMicromapsEXT-dstMicromap-07463"></a> <span class="vuid">VUID-vkBuildMicromapsEXT-dstMicromap-07463</span><br>

The <code>dstMicromap</code> member of any element of <code>pInfos</code> <strong>must</strong> be a
valid <code>VkMicromapEXT</code> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildMicromapsEXT-pInfos-07464" href="#VUID-vkBuildMicromapsEXT-pInfos-07464"></a> <span class="vuid">VUID-vkBuildMicromapsEXT-pInfos-07464</span><br>

For each element of <code>pInfos</code> its <code>type</code> member <strong>must</strong> match the
value of <code>VkMicromapCreateInfoEXT</code>::<code>type</code> when its
<code>dstMicromap</code> was created</p>
</li>
<li>
<p><a id="VUID-vkBuildMicromapsEXT-dstMicromap-07465" href="#VUID-vkBuildMicromapsEXT-dstMicromap-07465"></a> <span class="vuid">VUID-vkBuildMicromapsEXT-dstMicromap-07465</span><br>

The range of memory backing the <code>dstMicromap</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>dstMicromap</code> member of any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildMicromapsEXT-dstMicromap-07466" href="#VUID-vkBuildMicromapsEXT-dstMicromap-07466"></a> <span class="vuid">VUID-vkBuildMicromapsEXT-dstMicromap-07466</span><br>

The range of memory backing the <code>dstMicromap</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>scratchData</code> member of any element of
<code>pInfos</code> (including the same element), which is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkBuildMicromapsEXT-scratchData-07467" href="#VUID-vkBuildMicromapsEXT-scratchData-07467"></a> <span class="vuid">VUID-vkBuildMicromapsEXT-scratchData-07467</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>scratchData</code> member of any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildMicromapsEXT-pInfos-07552" href="#VUID-vkBuildMicromapsEXT-pInfos-07552"></a> <span class="vuid">VUID-vkBuildMicromapsEXT-pInfos-07552</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstMicromap</code> member <strong>must</strong> be bound to host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkBuildMicromapsEXT-pInfos-07553" href="#VUID-vkBuildMicromapsEXT-pInfos-07553"></a> <span class="vuid">VUID-vkBuildMicromapsEXT-pInfos-07553</span><br>

For each element of <code>pInfos</code>, all referenced addresses of
<code>pInfos</code>[i].<code>data.hostAddress</code> <strong>must</strong> be valid host memory</p>
</li>
<li>
<p><a id="VUID-vkBuildMicromapsEXT-pInfos-07554" href="#VUID-vkBuildMicromapsEXT-pInfos-07554"></a> <span class="vuid">VUID-vkBuildMicromapsEXT-pInfos-07554</span><br>

For each element of <code>pInfos</code>, all referenced addresses of
<code>pInfos</code>[i].<code>triangleArray.hostAddress</code> <strong>must</strong> be valid host
memory</p>
</li>
<li>
<p><a id="VUID-vkBuildMicromapsEXT-micromapHostCommands-07555" href="#VUID-vkBuildMicromapsEXT-micromapHostCommands-07555"></a> <span class="vuid">VUID-vkBuildMicromapsEXT-micromapHostCommands-07555</span><br>

The <a href="#features-micromapHostCommands">    <code>VkPhysicalDeviceOpacityMicromapFeaturesEXT</code>::<code>micromapHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkBuildMicromapsEXT-pInfos-07556" href="#VUID-vkBuildMicromapsEXT-pInfos-07556"></a> <span class="vuid">VUID-vkBuildMicromapsEXT-pInfos-07556</span><br>

If <code>pInfos</code>[i].<code>mode</code> is <code>VK_BUILD_MICROMAP_MODE_BUILD_EXT</code>,
all addresses between <code>pInfos</code>[i].<code>scratchData.hostAddress</code> and
<code>pInfos</code>[i].<code>scratchData.hostAddress</code> + N - 1 <strong>must</strong> be valid
host memory, where N is given by the <code>buildScratchSize</code> member of
the <code>VkMicromapBuildSizesInfoEXT</code> structure returned from a call to
<code>vkGetMicromapBuildSizesEXT</code> with an identical
<code>VkMicromapBuildInfoEXT</code> structure and primitive count</p>
</li>
<li>
<p><a id="VUID-vkBuildMicromapsEXT-pInfos-07557" href="#VUID-vkBuildMicromapsEXT-pInfos-07557"></a> <span class="vuid">VUID-vkBuildMicromapsEXT-pInfos-07557</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstMicromap</code> member <strong>must</strong> be bound to memory that was not allocated
with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/protos/vkBuildMicromapsEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy or compact a micromap on the host, call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/protos/vkCopyMicromapEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns the micromaps.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <code>VkDeferredOperationKHR</code> to
<a href="#deferred-host-operations-requesting">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <code>VkCopyMicromapInfoEXT</code> structure
defining the copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as <code>vkCmdCopyMicromapEXT</code> but is
executed by the host.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyMicromapEXT-deferredOperation-03678" href="#VUID-vkCopyMicromapEXT-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyMicromapEXT-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyMicromapEXT-buffer-07558" href="#VUID-vkCopyMicromapEXT-buffer-07558"></a> <span class="vuid">VUID-vkCopyMicromapEXT-buffer-07558</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyMicromapEXT-buffer-07559" href="#VUID-vkCopyMicromapEXT-buffer-07559"></a> <span class="vuid">VUID-vkCopyMicromapEXT-buffer-07559</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyMicromapEXT-micromapHostCommands-07560" href="#VUID-vkCopyMicromapEXT-micromapHostCommands-07560"></a> <span class="vuid">VUID-vkCopyMicromapEXT-micromapHostCommands-07560</span><br>

The <a href="#features-micromapHostCommands">    <code>VkPhysicalDeviceOpacityMicromapFeaturesEXT</code>::<code>micromapHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCopyMicromapEXT-buffer-07561" href="#VUID-vkCopyMicromapEXT-buffer-07561"></a> <span class="vuid">VUID-vkCopyMicromapEXT-buffer-07561</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkCopyMicromapEXT-buffer-07562" href="#VUID-vkCopyMicromapEXT-buffer-07562"></a> <span class="vuid">VUID-vkCopyMicromapEXT-buffer-07562</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/protos/vkCopyMicromapEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy host accessible memory to a micromap, call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/protos/vkCopyMemoryToMicromapEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns <code>pInfo-&gt;dst</code>.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <code>VkDeferredOperationKHR</code> to
<a href="#deferred-host-operations-requesting">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <code>VkCopyMemoryToMicromapInfoEXT</code>
structure defining the copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as <code>vkCmdCopyMemoryToMicromapEXT</code>
but is executed by the host.</p>
</div>
<div class="paragraph">
<p>This command can accept micromaps produced by either
<code>vkCmdCopyMicromapToMemoryEXT</code> or <code>vkCopyMicromapToMemoryEXT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyMemoryToMicromapEXT-deferredOperation-03678" href="#VUID-vkCopyMemoryToMicromapEXT-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyMemoryToMicromapEXT-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToMicromapEXT-pInfo-07563" href="#VUID-vkCopyMemoryToMicromapEXT-pInfo-07563"></a> <span class="vuid">VUID-vkCopyMemoryToMicromapEXT-pInfo-07563</span><br>

<code>pInfo-&gt;src.hostAddress</code> <strong>must</strong> be a valid host pointer</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToMicromapEXT-pInfo-07564" href="#VUID-vkCopyMemoryToMicromapEXT-pInfo-07564"></a> <span class="vuid">VUID-vkCopyMemoryToMicromapEXT-pInfo-07564</span><br>

<code>pInfo-&gt;src.hostAddress</code> <strong>must</strong> be aligned to 16 bytes</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToMicromapEXT-buffer-07565" href="#VUID-vkCopyMemoryToMicromapEXT-buffer-07565"></a> <span class="vuid">VUID-vkCopyMemoryToMicromapEXT-buffer-07565</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToMicromapEXT-micromapHostCommands-07566" href="#VUID-vkCopyMemoryToMicromapEXT-micromapHostCommands-07566"></a> <span class="vuid">VUID-vkCopyMemoryToMicromapEXT-micromapHostCommands-07566</span><br>

The <a href="#features-micromapHostCommands">    <code>VkPhysicalDeviceOpacityMicromapFeaturesEXT</code>::<code>micromapHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToMicromapEXT-buffer-07567" href="#VUID-vkCopyMemoryToMicromapEXT-buffer-07567"></a> <span class="vuid">VUID-vkCopyMemoryToMicromapEXT-buffer-07567</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/protos/vkCopyMemoryToMicromapEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy a micromap to host accessible memory, call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/protos/vkCopyMicromapToMemoryEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns <code>pInfo-&gt;src</code>.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <code>VkDeferredOperationKHR</code> to
<a href="#deferred-host-operations-requesting">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <code>VkCopyMicromapToMemoryInfoEXT</code>
structure defining the copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as <code>vkCmdCopyMicromapToMemoryEXT</code>
but is executed by the host.</p>
</div>
<div class="paragraph">
<p>This command produces the same results as
<code>vkCmdCopyMicromapToMemoryEXT</code>, but writes its result directly to a host
pointer, and is executed on the host rather than the device.
The output <strong>may</strong> not necessarily be bit-for-bit identical, but it can be
equally used by either <code>vkCmdCopyMemoryToMicromapEXT</code> or
<code>vkCopyMemoryToMicromapEXT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyMicromapToMemoryEXT-deferredOperation-03678" href="#VUID-vkCopyMicromapToMemoryEXT-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyMicromapToMemoryEXT-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyMicromapToMemoryEXT-buffer-07568" href="#VUID-vkCopyMicromapToMemoryEXT-buffer-07568"></a> <span class="vuid">VUID-vkCopyMicromapToMemoryEXT-buffer-07568</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyMicromapToMemoryEXT-pInfo-07569" href="#VUID-vkCopyMicromapToMemoryEXT-pInfo-07569"></a> <span class="vuid">VUID-vkCopyMicromapToMemoryEXT-pInfo-07569</span><br>

<code>pInfo-&gt;dst.hostAddress</code> <strong>must</strong> be a valid host pointer</p>
</li>
<li>
<p><a id="VUID-vkCopyMicromapToMemoryEXT-pInfo-07570" href="#VUID-vkCopyMicromapToMemoryEXT-pInfo-07570"></a> <span class="vuid">VUID-vkCopyMicromapToMemoryEXT-pInfo-07570</span><br>

<code>pInfo-&gt;dst.hostAddress</code> <strong>must</strong> be aligned to 16 bytes</p>
</li>
<li>
<p><a id="VUID-vkCopyMicromapToMemoryEXT-micromapHostCommands-07571" href="#VUID-vkCopyMicromapToMemoryEXT-micromapHostCommands-07571"></a> <span class="vuid">VUID-vkCopyMicromapToMemoryEXT-micromapHostCommands-07571</span><br>

The <a href="#features-micromapHostCommands">    <code>VkPhysicalDeviceOpacityMicromapFeaturesEXT</code>::<code>micromapHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCopyMicromapToMemoryEXT-buffer-07572" href="#VUID-vkCopyMicromapToMemoryEXT-buffer-07572"></a> <span class="vuid">VUID-vkCopyMicromapToMemoryEXT-buffer-07572</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/protos/vkCopyMicromapToMemoryEXT.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query micromap size parameters on the host, call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/api/protos/vkWriteMicromapsPropertiesEXT.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns the micromaps in <code>pMicromaps</code>.</p>
</li>
<li>
<p><code>micromapCount</code> is the count of micromaps for which to query the
property.</p>
</li>
<li>
<p><code>pMicromaps</code> is a pointer to an array of existing previously built
micromaps.</p>
</li>
<li>
<p><code>queryType</code> is a <a href="../queries.html#VkQueryType" class="xref page">VkQueryType</a> value specifying the property to
be queried.</p>
</li>
<li>
<p><code>dataSize</code> is the size in bytes of the buffer pointed to by
<code>pData</code>.</p>
</li>
<li>
<p><code>pData</code> is a pointer to an application-allocated buffer where the
results will be written.</p>
</li>
<li>
<p><code>stride</code> is the stride in bytes between results for individual
queries within <code>pData</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<code>vkCmdWriteMicromapsPropertiesEXT</code> but is executed by the host.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkWriteMicromapsPropertiesEXT-pMicromaps-07501" href="#VUID-vkWriteMicromapsPropertiesEXT-pMicromaps-07501"></a> <span class="vuid">VUID-vkWriteMicromapsPropertiesEXT-pMicromaps-07501</span><br>

All micromaps in <code>pMicromaps</code> <strong>must</strong> have been constructed prior to
the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkWriteMicromapsPropertiesEXT-pMicromaps-07502" href="#VUID-vkWriteMicromapsPropertiesEXT-pMicromaps-07502"></a> <span class="vuid">VUID-vkWriteMicromapsPropertiesEXT-pMicromaps-07502</span><br>

All micromaps in <code>pMicromaps</code> <strong>must</strong> have been constructed with
<code>VK_BUILD_MICROMAP_ALLOW_COMPACTION_BIT_EXT</code> if <code>queryType</code> is
<code>VK_QUERY_TYPE_MICROMAP_COMPACTED_SIZE_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkWriteMicromapsPropertiesEXT-queryType-07503" href="#VUID-vkWriteMicromapsPropertiesEXT-queryType-07503"></a> <span class="vuid">VUID-vkWriteMicromapsPropertiesEXT-queryType-07503</span><br>

<code>queryType</code> <strong>must</strong> be <code>VK_QUERY_TYPE_MICROMAP_COMPACTED_SIZE_EXT</code>
or <code>VK_QUERY_TYPE_MICROMAP_SERIALIZATION_SIZE_EXT</code></p>
</li>
<li>
<p><a id="VUID-vkWriteMicromapsPropertiesEXT-queryType-10071" href="#VUID-vkWriteMicromapsPropertiesEXT-queryType-10071"></a> <span class="vuid">VUID-vkWriteMicromapsPropertiesEXT-queryType-10071</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_MICROMAP_SERIALIZATION_SIZE_EXT</code> or
<code>VK_QUERY_TYPE_MICROMAP_COMPACTED_SIZE_EXT</code> then <code>stride</code> <strong>must</strong>
be a multiple of the size of <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteMicromapsPropertiesEXT-queryType-10072" href="#VUID-vkWriteMicromapsPropertiesEXT-queryType-10072"></a> <span class="vuid">VUID-vkWriteMicromapsPropertiesEXT-queryType-10072</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_MICROMAP_SERIALIZATION_SIZE_EXT</code> or
<code>VK_QUERY_TYPE_MICROMAP_COMPACTED_SIZE_EXT</code> then <code>pData</code> <strong>must</strong>
point to a <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteMicromapsPropertiesEXT-dataSize-07576" href="#VUID-vkWriteMicromapsPropertiesEXT-dataSize-07576"></a> <span class="vuid">VUID-vkWriteMicromapsPropertiesEXT-dataSize-07576</span><br>

<code>dataSize</code> <strong>must</strong> be greater than or equal to
<span class="eq"><code>micromapCount</code>*<code>stride</code></span></p>
</li>
<li>
<p><a id="VUID-vkWriteMicromapsPropertiesEXT-buffer-07577" href="#VUID-vkWriteMicromapsPropertiesEXT-buffer-07577"></a> <span class="vuid">VUID-vkWriteMicromapsPropertiesEXT-buffer-07577</span><br>

The <code>buffer</code> used to create each micromap in <code>pMicromaps</code> <strong>must</strong>
be bound to host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkWriteMicromapsPropertiesEXT-micromapHostCommands-07578" href="#VUID-vkWriteMicromapsPropertiesEXT-micromapHostCommands-07578"></a> <span class="vuid">VUID-vkWriteMicromapsPropertiesEXT-micromapHostCommands-07578</span><br>

The <a href="#features-micromapHostCommands">    <code>VkPhysicalDeviceOpacityMicromapFeaturesEXT</code>::<code>micromapHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkWriteMicromapsPropertiesEXT-buffer-07579" href="#VUID-vkWriteMicromapsPropertiesEXT-buffer-07579"></a> <span class="vuid">VUID-vkWriteMicromapsPropertiesEXT-buffer-07579</span><br>

The <code>buffer</code> used to create each micromap in <code>pMicromaps</code> <strong>must</strong>
be bound to memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/VK_EXT_opacity_micromap/micromaps.adoc - include::partial$gen/validity/protos/vkWriteMicromapsPropertiesEXT.adoc[]</p>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
  </body>
</html>
