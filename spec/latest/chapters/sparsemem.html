<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sparse Resources :: Vulkan Documentation Project</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../_/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../_/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../_/img/favicon-16x16.png">
    <link rel="manifest" href="../../../_/static/site.webmanifest">
    <link rel="mask-icon" href="../../../_/img/safari-pinned-tab.svg" color="#a41e22">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../.."><img class="navbar-item" alt="Vulkan White Label" src="../../../_/Vulkan_Docs.svg" /></a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field has-filter">
          <label for="search-input"></label>
          <input id="search-input" type="text" placeholder="Search the docs">
          <label class="filter checkbox">
            <input type="checkbox" data-facet-filter="component:spec" checked> In this component
          </label>
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../spec/latest/chapters/introduction.html">Vulkan 1.3</a>
            <a class="navbar-item" href="https://registry.khronos.org/OpenGL/specs/gl/GLSLangSpec.4.60.html">GLSL</a>
            <a class="navbar-item" href="../../../guide/latest/hlsl.html">HLSL</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Education</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../features/latest/features/index.html">Vulkan Feature Descriptions</a>
            <a class="navbar-item" href="../../../guide/latest/index.html">Vulkan Guide</a>
            <a class="navbar-item" href="../../../samples/latest/README.html">Vulkan Samples</a>
            <a class="navbar-item" href="../../../tutorial/latest/index.html">Vulkan Tutorial</a>
            <a class="navbar-item" href="https://www.youtube.com/c/vulkan">YouTube</a>
            <a class="navbar-item" href="https://vulkan.org">More Info at Vulkan.org</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Feedback</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://github.com/KhronosGroup/Vulkan-Site/issues/new/choose" target="_blank">Report a Problem</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://reddit.com/r/vulkan">Reddit</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/vulkan">Stack Overflow</a>
            <a class="navbar-item" href="https://fosstodon.org/@vulkan">Mastodon</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="spec" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Vulkan Specification</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fundamentals.html">Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="initialization.html">Initialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="devsandqueues.html">Devices and Queues</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cmdbuffers.html">Command Buffers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="synchronization.html">Synchronization and Cache Control</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="renderpass.html">Render Pass</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="shaders.html">Shaders</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pipelines.html">Pipelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="memory.html">Memory Allocation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="resources.html">Resource Creation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="samplers.html">Samplers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="descriptorsets.html">Resource Descriptors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="interfaces.html">Shader Interfaces</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="textures.html">Image Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fragmentdensitymapops.html">Fragment Density Map Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="queries.html">Queries</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="clears.html">Clear Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="copies.html">Copy Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="drawing.html">Drawing Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fxvertex.html">Fixed-Function Vertex Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tessellation.html">Tessellation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="geometry.html">Geometry Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_mesh_shader/mesh.html">Mesh Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_HUAWEI_cluster_culling_shader/clusterculling.html">Cluster Culling Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="vertexpostproc.html">Fixed-Function Vertex Post-Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="primsrast.html">Rasterization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fragops.html">Fragment Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="framebuffer.html">The Framebuffer</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="dispatch.html">Dispatching Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="device_generated_commands/generatedcommands.html">Device-Generated Commands</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="sparsemem.html">Sparse Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_KHR_surface/wsi.html">Window System Integration (WSI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_KHR_deferred_host_operations/deferred_host_operations.html">Deferred Host Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_EXT_private_data.html">Private Data</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="accelstructures.html">Acceleration Structures</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_EXT_opacity_micromap/micromaps.html">Micromap</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="raytraversal.html">Ray Traversal</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="raytracing.html">Ray Tracing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_memory_decompression.html">Memory Decompression</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="videocoding.html">Video Coding</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_optical_flow/optical_flow.html">Optical Flow</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="executiongraphs.html">Execution Graphs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extensions.html">Extending Vulkan</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="limits.html">Limits</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="formats.html">Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="capabilities.html">Additional Capabilities</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="debugging.html">Debugging</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/spirvenv.html">Vulkan Environment for SPIR-V</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/memorymodel.html">Memory Model</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/compressedtex.html">Compressed Image Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/versions.html">Core Revisions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/extensions.html">Layers &amp; Extensions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/roadmap.html">Vulkan Roadmap Milestones</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/boilerplate.html">API Boilerplate</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/invariance.html">Invariance</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/glossary.html">Lexicon</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/credits.html">Credits (Informative)</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Vulkan Specification</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../tutorial/latest/00_Introduction.html">Khronos Vulkan Tutorial</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tutorial/latest/00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../features/latest/features/index.html">Vulkan Feature Descriptions</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../features/latest/features/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../guide/latest/index.html">Vulkan Guide</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../samples/latest/README.html">Vulkan Samples</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/latest/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../index.html">Vulkan Specification</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Vulkan Specification</a></li>
    <li><a href="sparsemem.html">Sparse Resources</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Sparse Resources</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>As documented in <a href="resources.html#resources-association" class="xref page">Resource Memory Association</a>,
<code>VkBuffer</code> and <code>VkImage</code> resources in Vulkan <strong>must</strong> be bound
completely and contiguously to a single <code>VkDeviceMemory</code> object.
This binding <strong>must</strong> be done before the resource is used, and the binding is
immutable for the lifetime of the resource.</p>
</div>
<div class="paragraph">
<p><em>Sparse resources</em> relax these restrictions and provide these additional
features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sparse resources <strong>can</strong> be bound non-contiguously to one or more
<code>VkDeviceMemory</code> allocations.</p>
</li>
<li>
<p>Sparse resources <strong>can</strong> be re-bound to different memory allocations over
the lifetime of the resource.</p>
</li>
<li>
<p>Sparse resources <strong>can</strong> have descriptors generated and used orthogonally
with memory binding commands.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sparsememory-sparseresourcefeatures"><a class="anchor" href="#sparsememory-sparseresourcefeatures"></a>Sparse Resource Features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sparse resources have several features that <strong>must</strong> be enabled explicitly at
resource creation time.
The features are enabled by including bits in the <code>flags</code> parameter of
<a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a> or <a href="resources.html#VkBufferCreateInfo" class="xref page">VkBufferCreateInfo</a>.
Each feature also has one or more corresponding feature enables specified in
<a href="features.html#VkPhysicalDeviceFeatures" class="xref page">VkPhysicalDeviceFeatures</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="features.html#features-sparseBinding" class="xref page"><code>sparseBinding</code></a> feature is the base,
and provides the following capabilities:</p>
<div class="ulist">
<ul>
<li>
<p>Resources <strong>can</strong> be bound at some defined (sparse block) granularity.</p>
</li>
<li>
<p>The entire resource <strong>must</strong> be bound to memory before use regardless of
regions actually accessed.</p>
</li>
<li>
<p>No specific mapping of image region to memory offset is defined, i.e.
the location that each texel corresponds to in memory is
implementation-dependent.</p>
</li>
<li>
<p>Sparse buffers have a well-defined mapping of buffer range to memory
range, where an offset into a range of the buffer that is bound to a
single contiguous range of memory corresponds to an identical offset
within that range of memory.</p>
</li>
<li>
<p>Requested via the <code>VK_IMAGE_CREATE_SPARSE_BINDING_BIT</code> and
<code>VK_BUFFER_CREATE_SPARSE_BINDING_BIT</code> bits.</p>
</li>
<li>
<p>A sparse image created using <code>VK_IMAGE_CREATE_SPARSE_BINDING_BIT</code>
(but not <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>) supports all
formats that non-sparse usage supports, and supports both
<code>VK_IMAGE_TILING_OPTIMAL</code> and <code>VK_IMAGE_TILING_LINEAR</code> tiling.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Sparse Residency</em> builds on (and requires) the <code>sparseBinding</code>
feature.
It includes the following capabilities:</p>
<div class="ulist">
<ul>
<li>
<p>Resources do not have to be completely bound to memory before use on
the device.</p>
</li>
<li>
<p>Images have a prescribed sparse image block layout, allowing specific
rectangular regions of the image to be bound to specific offsets in
memory allocations.</p>
</li>
<li>
<p>Consistency of access to unbound regions of the resource is defined by
the absence or presence of
<code>VkPhysicalDeviceSparseProperties</code>::<code>residencyNonResidentStrict</code>.
If this property is present, accesses to unbound regions of the
resource are well defined and behave as if the data bound is populated
with all zeros; writes are discarded.
When this property is absent, accesses are considered safe, but reads
will return <strong>undefined</strong> values.</p>
</li>
<li>
<p>Requested via the <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code> and
<code>VK_BUFFER_CREATE_SPARSE_RESIDENCY_BIT</code> bits.</p>
</li>
<li>
<p><a id="features-sparseResidency"></a> Sparse residency support is advertised on
a finer grain via the following features:</p>
<div class="ulist">
<ul>
<li>
<p>The <a href="features.html#features-sparseResidencyBuffer" class="xref page"><code>sparseResidencyBuffer</code></a>
feature provides support for creating <code>VkBuffer</code> objects with the
<code>VK_BUFFER_CREATE_SPARSE_RESIDENCY_BIT</code>.</p>
</li>
<li>
<p>The <a href="features.html#features-sparseResidencyImage2D" class="xref page"><code>sparseResidencyImage2D</code></a>
feature provides support for creating 2D single-sampled <code>VkImage</code>
objects with <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>.</p>
</li>
<li>
<p>The <a href="features.html#features-sparseResidencyImage3D" class="xref page"><code>sparseResidencyImage3D</code></a>
feature provides support for creating 3D <code>VkImage</code> objects with
<code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>.</p>
</li>
<li>
<p>The <a href="features.html#features-sparseResidency2Samples" class="xref page">      <code>sparseResidency2Samples</code></a> feature provides support for creating
2D <code>VkImage</code> objects with 2 samples and
<code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>.</p>
</li>
<li>
<p>The <a href="features.html#features-sparseResidency4Samples" class="xref page">      <code>sparseResidency4Samples</code></a> feature provides support for creating
2D <code>VkImage</code> objects with 4 samples and
<code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>.</p>
</li>
<li>
<p>The <a href="features.html#features-sparseResidency8Samples" class="xref page">      <code>sparseResidency8Samples</code></a> feature provides support for creating
2D <code>VkImage</code> objects with 8 samples and
<code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>.</p>
</li>
<li>
<p>The <a href="features.html#features-sparseResidency16Samples" class="xref page">      <code>sparseResidency16Samples</code></a> feature provides support for creating
2D <code>VkImage</code> objects with 16 samples and
<code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Implementations supporting <code>sparseResidencyImage2D</code> are only <strong>required</strong>
to support sparse 2D, single-sampled images.
Support for sparse 3D and MSAA images is <strong>optional</strong> and <strong>can</strong> be enabled via
<code>sparseResidencyImage3D</code>, <code>sparseResidency2Samples</code>,
<code>sparseResidency4Samples</code>, <code>sparseResidency8Samples</code>, and
<code>sparseResidency16Samples</code>.</p>
</div>
</li>
<li>
<p>A sparse image created using <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>
supports all non-compressed color formats with power-of-two element
size that non-sparse usage supports.
Additional formats <strong>may</strong> also be supported and <strong>can</strong> be queried via
<a href="#vkGetPhysicalDeviceSparseImageFormatProperties">vkGetPhysicalDeviceSparseImageFormatProperties</a>.
<code>VK_IMAGE_TILING_LINEAR</code> tiling is not supported.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <a href="features.html#features-sparseResidencyAliased" class="xref page"><code>sparseResidencyAliased</code></a>
feature provides the following capability that <strong>can</strong> be enabled per
resource:</p>
<div class="paragraph">
<p>Allows physical memory ranges to be shared between multiple locations in the
same sparse resource or between multiple sparse resources, with each binding
of a memory location observing a consistent interpretation of the memory
contents.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>See <a href="#sparsememory-sparse-memory-aliasing">Sparse Memory Aliasing</a> for more
information.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sparsememory-fully-resident"><a class="anchor" href="#sparsememory-fully-resident"></a>Sparse Buffers and Fully-Resident Images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Both <code>VkBuffer</code> and <code>VkImage</code> objects created with the
<code>VK_IMAGE_CREATE_SPARSE_BINDING_BIT</code> or
<code>VK_BUFFER_CREATE_SPARSE_BINDING_BIT</code> bits <strong>can</strong> be thought of as a
linear region of address space.
In the <code>VkImage</code> case if <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code> is
not used, this linear region is entirely opaque, meaning that there is no
application-visible mapping between texel location and memory offset.</p>
</div>
<div class="paragraph">
<p>Unless <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code> or
<code>VK_BUFFER_CREATE_SPARSE_RESIDENCY_BIT</code> are also used, the entire
resource <strong>must</strong> be bound to one or more <code>VkDeviceMemory</code> objects before
use.</p>
</div>
<div class="sect2">
<h3 id="_sparse_buffer_and_fully_resident_image_block_size"><a class="anchor" href="#_sparse_buffer_and_fully_resident_image_block_size"></a>Sparse Buffer and Fully-Resident Image Block Size</h3>
<div class="paragraph">
<p>The sparse block size in bytes for sparse buffers and fully-resident images
is reported as <code>VkMemoryRequirements</code>::<code>alignment</code>.
<code>alignment</code> represents both the memory alignment requirement and the
binding granularity (in bytes) for sparse resources.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sparsememory-partially-resident-buffers"><a class="anchor" href="#sparsememory-partially-resident-buffers"></a>Sparse Partially-Resident Buffers</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>VkBuffer</code> objects created with the
<code>VK_BUFFER_CREATE_SPARSE_RESIDENCY_BIT</code> bit allow the buffer to be made
only partially resident.
Partially resident <code>VkBuffer</code> objects are allocated and bound
identically to <code>VkBuffer</code> objects using only the
<code>VK_BUFFER_CREATE_SPARSE_BINDING_BIT</code> feature.
The only difference is the ability for some regions of the buffer to be
unbound during device use.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sparsememory-partially-resident-images"><a class="anchor" href="#sparsememory-partially-resident-images"></a>Sparse Partially-Resident Images</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>VkImage</code> objects created with the
<code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code> bit allow specific rectangular
regions of the image called sparse image blocks to be bound to specific
ranges of memory.
This allows the application to manage residency at either image subresource
or sparse image block granularity.
Each image subresource (outside of the <a href="#sparsememory-miptail">mip tail</a>)
starts on a sparse block boundary and has dimensions that are integer
multiples of the corresponding dimensions of the sparse image block.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Applications <strong>can</strong> use these types of images to control LOD based on total
memory consumption.
If memory pressure becomes an issue the application <strong>can</strong> unbind and disable
specific mipmap levels of images without having to recreate resources or
modify texel data of unaffected levels.</p>
</div>
<div class="paragraph">
<p>The application <strong>can</strong> also use this functionality to access subregions of the
image in a &#8220;megatexture&#8221; fashion.
The application <strong>can</strong> create a large image and only populate the region of
the image that is currently being used in the scene.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="sparsememory-accessing-unbound"><a class="anchor" href="#sparsememory-accessing-unbound"></a>Accessing Unbound Regions</h3>
<div class="paragraph">
<p>The following member of <code>VkPhysicalDeviceSparseProperties</code> affects how
data in unbound regions of sparse resources are handled by the
implementation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>residencyNonResidentStrict</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If this property is not present, reads of unbound regions of the image will
return <strong>undefined</strong> values.
Both reads and writes are still considered <em>safe</em> and will not affect other
resources or populated regions of the image.</p>
</div>
<div class="paragraph">
<p>If this property is present, all reads of unbound regions of the image will
behave as if the region was bound to memory populated with all zeros; writes
will be discarded.</p>
</div>
<div class="paragraph">
<p><a href="textures.html#textures" class="xref page">Image operations</a> performed on unbound memory <strong>may</strong> still alter
some component values in the natural way for those accesses, e.g.
substituting a value of one for alpha in formats that do not have an alpha
component.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Example: Reading the alpha component of an unbacked <code>VK_FORMAT_R8_UNORM</code>
image will return a value of <span class="eq">1.0f</span>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="devsandqueues.html#devsandqueues-physical-device-enumeration" class="xref page">Physical Device Enumeration</a> for instructions for retrieving physical device properties.</p>
</div>
</div>
<div class="sect2">
<h3 id="sparsememory-miptail"><a class="anchor" href="#sparsememory-miptail"></a>Mip Tail Regions</h3>
<div class="paragraph">
<p>Sparse images created using <code>VK_IMAGE_CREATE_SPARSE_BINDING_BIT</code>
(without also using <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>) have no
specific mapping of image region or image subresource to memory offset
defined, so the entire image <strong>can</strong> be thought of as a linear opaque address
region.
However, images created with <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code> do
have a prescribed sparse image block layout, and hence each image
subresource <strong>must</strong> start on a sparse block boundary.
Within each array layer, the set of mip levels that have a smaller size than
the sparse block size in bytes are grouped together into a <em>mip tail
region</em>.</p>
</div>
<div class="paragraph">
<p>If the <code>VK_SPARSE_IMAGE_FORMAT_ALIGNED_MIP_SIZE_BIT</code> flag is present in
the <code>flags</code> member of <code>VkSparseImageFormatProperties</code>, for the
image&#8217;s <code>format</code>, then any mip level which has dimensions that are not
integer multiples of the corresponding dimensions of the sparse image block,
and all subsequent mip levels, are also included in the mip tail region.</p>
</div>
<div class="paragraph">
<p>The following member of <code>VkPhysicalDeviceSparseProperties</code> <strong>may</strong> affect
how the implementation places mip levels in the mip tail region:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>residencyAlignedMipSize</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each mip tail region is bound to memory as an opaque region (i.e. <strong>must</strong> be
bound using a <a href="#VkSparseImageOpaqueMemoryBindInfo">VkSparseImageOpaqueMemoryBindInfo</a> structure) and <strong>may</strong> be
of a size greater than or equal to the sparse block size in bytes.
This size is guaranteed to be an integer multiple of the sparse block size
in bytes.</p>
</div>
<div class="paragraph">
<p>An implementation <strong>may</strong> choose to allow each array-layer&#8217;s mip tail region to
be bound to memory independently or require that all array-layer&#8217;s mip tail
regions be treated as one.
This is dictated by <code>VK_SPARSE_IMAGE_FORMAT_SINGLE_MIPTAIL_BIT</code> in
<code>VkSparseImageMemoryRequirements</code>::<code>flags</code>.</p>
</div>
<div class="paragraph">
<p>The following diagrams depict how
<code>VK_SPARSE_IMAGE_FORMAT_ALIGNED_MIP_SIZE_BIT</code> and
<code>VK_SPARSE_IMAGE_FORMAT_SINGLE_MIPTAIL_BIT</code> alter memory usage and
requirements.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sparseimage.svg" alt="sparseimage">
</div>
<div class="title">Figure 1. Sparse Image</div>
</div>
<div class="paragraph">
<p>In the absence of <code>VK_SPARSE_IMAGE_FORMAT_ALIGNED_MIP_SIZE_BIT</code> and
<code>VK_SPARSE_IMAGE_FORMAT_SINGLE_MIPTAIL_BIT</code>, each array layer contains a
mip tail region containing texel data for all mip levels smaller than the
sparse image block in any dimension.</p>
</div>
<div class="paragraph">
<p>Mip levels that are as large or larger than a sparse image block in all
dimensions <strong>can</strong> be bound individually.
Right-edges and bottom-edges of each level are allowed to have partially
used sparse blocks.
Any bound partially-used-sparse-blocks <strong>must</strong> still have their full sparse
block size in bytes allocated in memory.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sparseimage_singlemiptail.svg" alt="sparseimage singlemiptail">
</div>
<div class="title">Figure 2. Sparse Image with Single Mip Tail</div>
</div>
<div class="paragraph">
<p>When <code>VK_SPARSE_IMAGE_FORMAT_SINGLE_MIPTAIL_BIT</code> is present all array
layers will share a single mip tail region.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sparseimage_alignedmipsize.svg" alt="sparseimage alignedmipsize">
</div>
<div class="title">Figure 3. Sparse Image with Aligned Mip Size</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The mip tail regions are presented here in 2D arrays simply for figure size
reasons.
Each mip tail is logically a single array of sparse blocks with an
implementation-dependent mapping of texels or compressed texel blocks to
sparse blocks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When <code>VK_SPARSE_IMAGE_FORMAT_ALIGNED_MIP_SIZE_BIT</code> is present the first
mip level that would contain partially used sparse blocks begins the mip
tail region.
This level and all subsequent levels are placed in the mip tail.
Only the first <span class="eq">N</span> mip levels whose dimensions are an exact multiple of
the sparse image block dimensions <strong>can</strong> be bound and unbound on a sparse
block basis.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sparseimage_alignedmipsize_singlemiptail.svg" alt="sparseimage alignedmipsize singlemiptail">
</div>
<div class="title">Figure 4. Sparse Image with Aligned Mip Size and Single Mip Tail</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The mip tail region is presented here in a 2D array simply for figure size
reasons.
It is logically a single array of sparse blocks with an
implementation-dependent mapping of texels or compressed texel blocks to
sparse blocks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When both <code>VK_SPARSE_IMAGE_FORMAT_ALIGNED_MIP_SIZE_BIT</code> and
<code>VK_SPARSE_IMAGE_FORMAT_SINGLE_MIPTAIL_BIT</code> are present the constraints
from each of these flags are in effect.</p>
</div>
</div>
<div class="sect2">
<h3 id="sparsememory-standard-shapes"><a class="anchor" href="#sparsememory-standard-shapes"></a>Standard Sparse Image Block Shapes</h3>
<div class="paragraph">
<p>Standard sparse image block shapes define a standard set of dimensions for
sparse image blocks that depend on the format of the image.
Layout of texels or compressed texel blocks within a sparse image block is
implementation-dependent.
All currently defined standard sparse image block shapes are 64 KB in size.</p>
</div>
<div class="paragraph">
<p>For block-compressed formats (e.g. <code>VK_FORMAT_BC5_UNORM_BLOCK</code>), the
texel size is the size of the compressed texel block (e.g. 128-bit for
<code>BC5</code>) thus the dimensions of the standard sparse image block shapes
apply in terms of compressed texel blocks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For block-compressed formats, the dimensions of a sparse image block in
terms of texels <strong>can</strong> be calculated by multiplying the sparse image block
dimensions by the compressed texel block dimensions.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<table id="sparsememory-sparseblockshapessingle" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Standard Sparse Image Block Shapes (Single Sample)</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">TEXEL SIZE (bits)</th>
<th class="tableblock halign-left valign-top">Block Shape (2D)</th>
<th class="tableblock halign-left valign-top">Block Shape (3D)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>8-Bit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">256 × 256 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 × 32 × 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>16-Bit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">256 × 128 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 × 32 × 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>32-Bit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 × 128 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 × 32 × 16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>64-Bit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 × 64 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 × 16 × 16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>128-Bit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 × 64 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 × 16 × 16</p></td>
</tr>
</tbody>
</table>
<table id="sparsememory-sparseblockshapesmsaa" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Standard Sparse Image Block Shapes (MSAA)</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">TEXEL SIZE (bits)</th>
<th class="tableblock halign-left valign-top">Block Shape (2X)</th>
<th class="tableblock halign-left valign-top">Block Shape (4X)</th>
<th class="tableblock halign-left valign-top">Block Shape (8X)</th>
<th class="tableblock halign-left valign-top">Block Shape (16X)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>8-Bit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 × 256 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 × 128 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 × 128 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 × 64 × 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>16-Bit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 × 128 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 × 64 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 × 64 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 × 32 × 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>32-Bit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 × 128 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 × 64 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 × 64 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 × 32 × 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>64-Bit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 × 64 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 × 32 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 × 32 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 × 16 × 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>128-Bit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 × 64 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 × 32 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 × 32 × 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 × 16 × 1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Implementations that support the standard sparse image block shape for all
formats listed in the <a href="#sparsememory-sparseblockshapessingle">Standard Sparse Image Block Shapes (Single Sample)</a> and
<a href="#sparsememory-sparseblockshapesmsaa">Standard Sparse Image Block Shapes (MSAA)</a> tables <strong>may</strong> advertise the following
<code>VkPhysicalDeviceSparseProperties</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>residencyStandard2DBlockShape</code></p>
</li>
<li>
<p><code>residencyStandard2DMultisampleBlockShape</code></p>
</li>
<li>
<p><code>residencyStandard3DBlockShape</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Reporting each of these features does <em>not</em> imply that all possible image
types are supported as sparse.
Instead, this indicates that no supported sparse image of the corresponding
type will use custom sparse image block dimensions for any formats that have
a corresponding standard sparse image block shape.</p>
</div>
</div>
<div class="sect2">
<h3 id="sparsememory-custom-shapes"><a class="anchor" href="#sparsememory-custom-shapes"></a>Custom Sparse Image Block Shapes</h3>
<div class="paragraph">
<p>An implementation that does not support a standard image block shape for a
particular sparse partially-resident image <strong>may</strong> choose to support a custom
sparse image block shape for it instead.
The dimensions of such a custom sparse image block shape are reported in
<code>VkSparseImageFormatProperties</code>::<code>imageGranularity</code>.
As with standard sparse image block shapes, the size in bytes of the custom
sparse image block shape will be reported in
<code>VkMemoryRequirements</code>::<code>alignment</code>.</p>
</div>
<div class="paragraph">
<p>Custom sparse image block dimensions are reported through
<code>vkGetPhysicalDeviceSparseImageFormatProperties</code> and
<code>vkGetImageSparseMemoryRequirements</code>.</p>
</div>
<div class="paragraph">
<p>An implementation <strong>must</strong> not support both the standard sparse image block
shape and a custom sparse image block shape for the same image.
The standard sparse image block shape <strong>must</strong> be used if it is supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="sparsememory-multiaspect"><a class="anchor" href="#sparsememory-multiaspect"></a>Multiple Aspects</h3>
<div class="paragraph">
<p>Partially resident images are allowed to report separate sparse properties
for different aspects of the image.
One example is for depth/stencil images where the implementation separates
the depth and stencil data into separate planes.
Another reason for multiple aspects is to allow the application to manage
memory allocation for implementation-private <em>metadata</em> associated with the
image.
See the figure below:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sparseimage_multiaspect.svg" alt="sparseimage multiaspect">
</div>
<div class="title">Figure 5. Multiple Aspect Sparse Image</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The mip tail regions are presented here in 2D arrays simply for figure size
reasons.
Each mip tail is logically a single array of sparse blocks with an
implementation-dependent mapping of texels or compressed texel blocks to
sparse blocks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the figure above the depth, stencil, and metadata aspects all have unique
sparse properties.
The per-texel stencil data is <span class="eq">¼</span> the size of the depth data,
hence the stencil sparse blocks include <span class="eq">4 ×</span> the number of
texels.
The sparse block size in bytes for all of the aspects is identical and
defined by <code>VkMemoryRequirements</code>::<code>alignment</code>.</p>
</div>
<div class="sect3">
<h4 id="_metadata"><a class="anchor" href="#_metadata"></a>Metadata</h4>
<div class="paragraph">
<p>The metadata aspect of an image has the following constraints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All metadata is reported in the mip tail region of the metadata aspect.</p>
</li>
<li>
<p>All metadata <strong>must</strong> be bound prior to device use of the sparse image.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sparsememory-sparse-memory-aliasing"><a class="anchor" href="#sparsememory-sparse-memory-aliasing"></a>Sparse Memory Aliasing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default sparse resources have the same aliasing rules as non-sparse
resources.
See <a href="resources.html#resources-memory-aliasing" class="xref page">Memory Aliasing</a> for more information.</p>
</div>
<div class="paragraph">
<p><code>VkDevice</code> objects that have the <a href="features.html#features-sparseResidencyAliased" class="xref page"><code>sparseResidencyAliased</code></a> feature enabled are able to use the
<code>VK_BUFFER_CREATE_SPARSE_ALIASED_BIT</code> and
<code>VK_IMAGE_CREATE_SPARSE_ALIASED_BIT</code> flags for resource creation.
These flags allow resources to access physical memory bound into multiple
locations within one or more sparse resources in a <em>data consistent</em>
fashion.
This means that reading physical memory from multiple aliased locations will
return the same value.</p>
</div>
<div class="paragraph">
<p>Care <strong>must</strong> be taken when performing a write operation to aliased physical
memory.
Memory dependencies <strong>must</strong> be used to separate writes to one alias from reads
or writes to another alias.
Writes to aliased memory that are not properly guarded against accesses to
different aliases will have <strong>undefined</strong> results for all accesses to the
aliased memory.</p>
</div>
<div class="paragraph">
<p>Applications that wish to make use of data consistent sparse memory aliasing
<strong>must</strong> abide by the following guidelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All sparse resources that are bound to aliased physical memory <strong>must</strong> be
created with the <code>VK_BUFFER_CREATE_SPARSE_ALIASED_BIT</code> /
<code>VK_IMAGE_CREATE_SPARSE_ALIASED_BIT</code> flag.</p>
</li>
<li>
<p>All resources that access aliased physical memory <strong>must</strong> interpret the
memory in the same way.
This implies the following:</p>
<div class="ulist">
<ul>
<li>
<p>Buffers and images <strong>cannot</strong> alias the same physical memory in a data
consistent fashion.
The physical memory ranges <strong>must</strong> be used exclusively by buffers or used
exclusively by images for data consistency to be guaranteed.</p>
</li>
<li>
<p>Memory in sparse image mip tail regions <strong>cannot</strong> access aliased memory
in a data consistent fashion.</p>
</li>
<li>
<p>Sparse images that alias the same physical memory <strong>must</strong> have compatible
formats and be using the same sparse image block shape in order to
access aliased memory in a data consistent fashion.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Failure to follow any of the above guidelines will require the application
to abide by the normal, non-sparse resource <a href="resources.html#resources-memory-aliasing" class="xref page">aliasing rules</a>.
In this case memory <strong>cannot</strong> be accessed in a data consistent fashion.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Enabling sparse resource memory aliasing <strong>can</strong> be a way to lower physical
memory use, but it <strong>may</strong> reduce performance on some implementations.
An application developer <strong>can</strong> test on their target HW and balance the memory
/ performance trade-offs measured.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sparsememory-resourceapi"><a class="anchor" href="#sparsememory-resourceapi"></a>Sparse Resource API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The APIs related to sparse resources are grouped into the following
categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#sparsememory-physicalfeatures">Physical Device Features</a></p>
</li>
<li>
<p><a href="#sparsememory-physicalprops">Physical Device Sparse Properties</a></p>
</li>
<li>
<p><a href="#sparsememory-format-props">Sparse Image Format Properties</a></p>
</li>
<li>
<p><a href="#sparsememory-resource-creation">Sparse Resource Creation</a></p>
</li>
<li>
<p><a href="#sparsememory-memory-requirements">Sparse Resource Memory Requirements</a></p>
</li>
<li>
<p><a href="#sparsememory-resource-binding">Binding Resource Memory</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="sparsememory-physicalfeatures"><a class="anchor" href="#sparsememory-physicalfeatures"></a>Physical Device Features</h3>
<div class="paragraph">
<p>Some sparse-resource related features are reported and enabled in
<code>VkPhysicalDeviceFeatures</code>.
These features <strong>must</strong> be supported and enabled on the <code>VkDevice</code> object
before applications <strong>can</strong> use them.
See <a href="features.html#features" class="xref page">Physical Device Features</a> for information on how to get and
set enabled device features, and for more detailed explanations of these
features.</p>
</div>
<div class="sect3">
<h4 id="_sparse_physical_device_features"><a class="anchor" href="#_sparse_physical_device_features"></a>Sparse Physical Device Features</h4>
<div class="ulist">
<ul>
<li>
<p><code>sparseBinding</code>: Support for creating <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> and
<code>VkImage</code> objects with the <code>VK_BUFFER_CREATE_SPARSE_BINDING_BIT</code>
and <code>VK_IMAGE_CREATE_SPARSE_BINDING_BIT</code> flags, respectively.</p>
</li>
<li>
<p><code>sparseResidencyBuffer</code>: Support for creating <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> objects
with the <code>VK_BUFFER_CREATE_SPARSE_RESIDENCY_BIT</code> flag.</p>
</li>
<li>
<p><code>sparseResidencyImage2D</code>: Support for creating 2D single-sampled
<code>VkImage</code> objects with <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>.</p>
</li>
<li>
<p><code>sparseResidencyImage3D</code>: Support for creating 3D <a href="resources.html#VkImage" class="xref page">VkImage</a>
objects with <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>.</p>
</li>
<li>
<p><code>sparseResidency2Samples</code>: Support for creating 2D <a href="resources.html#VkImage" class="xref page">VkImage</a>
objects with 2 samples and <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>.</p>
</li>
<li>
<p><code>sparseResidency4Samples</code>: Support for creating 2D <a href="resources.html#VkImage" class="xref page">VkImage</a>
objects with 4 samples and <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>.</p>
</li>
<li>
<p><code>sparseResidency8Samples</code>: Support for creating 2D <a href="resources.html#VkImage" class="xref page">VkImage</a>
objects with 8 samples and <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>.</p>
</li>
<li>
<p><code>sparseResidency16Samples</code>: Support for creating 2D <a href="resources.html#VkImage" class="xref page">VkImage</a>
objects with 16 samples and <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>.</p>
</li>
<li>
<p><code>sparseResidencyAliased</code>: Support for creating <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> and
<code>VkImage</code> objects with the <code>VK_BUFFER_CREATE_SPARSE_ALIASED_BIT</code>
and <code>VK_IMAGE_CREATE_SPARSE_ALIASED_BIT</code> flags, respectively.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sparsememory-physicalprops"><a class="anchor" href="#sparsememory-physicalprops"></a>Physical Device Sparse Properties</h3>
<div class="paragraph">
<p>Some features of the implementation are not possible to disable, and are
reported to allow applications to alter their sparse resource usage
accordingly.
These read-only capabilities are reported in the
<a href="devsandqueues.html#VkPhysicalDeviceProperties" class="xref page">VkPhysicalDeviceProperties</a>::<code>sparseProperties</code> member, which is a
<code>VkPhysicalDeviceSparseProperties</code> structure.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkPhysicalDeviceSparseProperties</code> structure is defined as:</p>
</div>
<div id="VkPhysicalDeviceSparseProperties" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkPhysicalDeviceSparseProperties {
    VkBool32    residencyStandard2DBlockShape;
    VkBool32    residencyStandard2DMultisampleBlockShape;
    VkBool32    residencyStandard3DBlockShape;
    VkBool32    residencyAlignedMipSize;
    VkBool32    residencyNonResidentStrict;
} VkPhysicalDeviceSparseProperties;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>residencyStandard2DBlockShape</code>
is <code>VK_TRUE</code> if the physical device will access all single-sample 2D
sparse resources using the standard sparse image block shapes (based on
image format), as described in the
<a href="#sparsememory-sparseblockshapessingle">Standard Sparse Image Block    Shapes (Single Sample)</a> table.
If this property is not supported the value returned in the
<code>imageGranularity</code> member of the <code>VkSparseImageFormatProperties</code>
structure for single-sample 2D images is not <strong>required</strong> to match the
standard sparse image block dimensions listed in the table.</p>
</li>
<li>
<p><code>residencyStandard2DMultisampleBlockShape</code>
is <code>VK_TRUE</code> if the physical device will access all multisample 2D
sparse resources using the standard sparse image block shapes (based on
image format), as described in the
<a href="#sparsememory-sparseblockshapesmsaa">Standard Sparse Image Block Shapes    (MSAA)</a> table.
If this property is not supported, the value returned in the
<code>imageGranularity</code> member of the <code>VkSparseImageFormatProperties</code>
structure for multisample 2D images is not <strong>required</strong> to match the
standard sparse image block dimensions listed in the table.</p>
</li>
<li>
<p><code>residencyStandard3DBlockShape</code>
is <code>VK_TRUE</code> if the physical device will access all 3D sparse
resources using the standard sparse image block shapes (based on image
format), as described in the
<a href="#sparsememory-sparseblockshapessingle">Standard Sparse Image Block    Shapes (Single Sample)</a> table.
If this property is not supported, the value returned in the
<code>imageGranularity</code> member of the <code>VkSparseImageFormatProperties</code>
structure for 3D images is not <strong>required</strong> to match the standard sparse
image block dimensions listed in the table.</p>
</li>
<li>
<p><code>residencyAlignedMipSize</code>
is <code>VK_TRUE</code> if images with mip level dimensions that are not
integer multiples of the corresponding dimensions of the sparse image
block <strong>may</strong> be placed in the mip tail.
If this property is not reported, only mip levels with dimensions
smaller than the <code>imageGranularity</code> member of the
<code>VkSparseImageFormatProperties</code> structure will be placed in the mip
tail.
If this property is reported the implementation is allowed to return
<code>VK_SPARSE_IMAGE_FORMAT_ALIGNED_MIP_SIZE_BIT</code> in the <code>flags</code>
member of <code>VkSparseImageFormatProperties</code>, indicating that mip level
dimensions that are not integer multiples of the corresponding
dimensions of the sparse image block will be placed in the mip tail.</p>
</li>
<li>
<p><code>residencyNonResidentStrict</code>
specifies whether the physical device <strong>can</strong> consistently access
non-resident regions of a resource.
If this property is <code>VK_TRUE</code>, access to non-resident regions of
resources will be guaranteed to return values as if the resource was
populated with 0; writes to non-resident regions will be discarded.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sparsememory-format-props"><a class="anchor" href="#sparsememory-format-props"></a>Sparse Image Format Properties</h3>
<div class="paragraph">
<p>Given that certain aspects of sparse image support, including the sparse
image block dimensions, <strong>may</strong> be implementation-dependent,
<a href="#vkGetPhysicalDeviceSparseImageFormatProperties">vkGetPhysicalDeviceSparseImageFormatProperties</a> <strong>can</strong> be used to query
for sparse image format properties prior to resource creation.
This command is used to check whether a given set of sparse image parameters
is supported and what the sparse image block shape will be.</p>
</div>
<div class="sect3">
<h4 id="_sparse_image_format_properties_api"><a class="anchor" href="#_sparse_image_format_properties_api"></a>Sparse Image Format Properties API</h4>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkSparseImageFormatProperties</code> structure is defined as:</p>
</div>
<div id="VkSparseImageFormatProperties" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkSparseImageFormatProperties {
    VkImageAspectFlags          aspectMask;
    VkExtent3D                  imageGranularity;
    VkSparseImageFormatFlags    flags;
} VkSparseImageFormatProperties;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>aspectMask</code> is a bitmask <a href="resources.html#VkImageAspectFlagBits" class="xref page">VkImageAspectFlagBits</a> specifying
which aspects of the image the properties apply to.</p>
</li>
<li>
<p><code>imageGranularity</code> is the width, height, and depth of the sparse
image block in texels or compressed texel blocks.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="#VkSparseImageFormatFlagBits">VkSparseImageFormatFlagBits</a> specifying
additional information about the sparse resource.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong>may</strong> be set in <a href="#VkSparseImageFormatProperties">VkSparseImageFormatProperties</a>::<code>flags</code>,
specifying additional information about the sparse resource, are:</p>
</div>
<div id="VkSparseImageFormatFlagBits" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef enum VkSparseImageFormatFlagBits {
    VK_SPARSE_IMAGE_FORMAT_SINGLE_MIPTAIL_BIT = 0x00000001,
    VK_SPARSE_IMAGE_FORMAT_ALIGNED_MIP_SIZE_BIT = 0x00000002,
    VK_SPARSE_IMAGE_FORMAT_NONSTANDARD_BLOCK_SIZE_BIT = 0x00000004,
} VkSparseImageFormatFlagBits;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_SPARSE_IMAGE_FORMAT_SINGLE_MIPTAIL_BIT</code> specifies that the image
uses a single mip tail region for all array layers.</p>
</li>
<li>
<p><code>VK_SPARSE_IMAGE_FORMAT_ALIGNED_MIP_SIZE_BIT</code> specifies that the
first mip level whose dimensions are not integer multiples of the
corresponding dimensions of the sparse image block begins the mip tail
region.</p>
</li>
<li>
<p><code>VK_SPARSE_IMAGE_FORMAT_NONSTANDARD_BLOCK_SIZE_BIT</code> specifies that
the image uses non-standard sparse image block dimensions, and the
<code>imageGranularity</code> values do not match the standard sparse image
block dimensions for the given format.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkSparseImageFormatFlags" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef VkFlags VkSparseImageFormatFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkSparseImageFormatFlags</code> is a bitmask type for setting a mask of zero
or more <a href="#VkSparseImageFormatFlagBits">VkSparseImageFormatFlagBits</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><code>vkGetPhysicalDeviceSparseImageFormatProperties</code> returns an array of
<a href="#VkSparseImageFormatProperties">VkSparseImageFormatProperties</a>.
Each element describes properties for one set of image aspects that are
bound simultaneously for a <code>VkImage</code> created with the provided image
creation parameters.
This is usually one element for each aspect in the image, but for
interleaved depth/stencil images there is only one element describing the
combined aspects.</p>
</div>
<div id="vkGetPhysicalDeviceSparseImageFormatProperties" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
void vkGetPhysicalDeviceSparseImageFormatProperties(
    VkPhysicalDevice                            physicalDevice,
    VkFormat                                    format,
    VkImageType                                 type,
    VkSampleCountFlagBits                       samples,
    VkImageUsageFlags                           usage,
    VkImageTiling                               tiling,
    uint32_t*                                   pPropertyCount,
    VkSparseImageFormatProperties*              pProperties);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>physicalDevice</code> is the physical device from which to query the
sparse image format properties.</p>
</li>
<li>
<p><code>format</code> is the image format.</p>
</li>
<li>
<p><code>type</code> is the dimensionality of the image.</p>
</li>
<li>
<p><code>samples</code> is a <a href="limits.html#VkSampleCountFlagBits" class="xref page">VkSampleCountFlagBits</a> value specifying the
number of samples per texel.</p>
</li>
<li>
<p><code>usage</code> is a bitmask describing the intended usage of the image.</p>
</li>
<li>
<p><code>tiling</code> is the tiling arrangement of the texel blocks in memory.</p>
</li>
<li>
<p><code>pPropertyCount</code> is a pointer to an integer related to the number of
sparse format properties available or queried, as described below.</p>
</li>
<li>
<p><code>pProperties</code> is either <code>NULL</code> or a pointer to an array of
<a href="#VkSparseImageFormatProperties">VkSparseImageFormatProperties</a> structures.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>pProperties</code> is <code>NULL</code>, then the number of sparse format properties
available is returned in <code>pPropertyCount</code>.
Otherwise, <code>pPropertyCount</code> <strong>must</strong> point to a variable set by the
application to the number of elements in the <code>pProperties</code> array, and on
return the variable is overwritten with the number of structures actually
written to <code>pProperties</code>.
If <code>pPropertyCount</code> is less than the number of sparse format properties
available, at most <code>pPropertyCount</code> structures will be written.</p>
</div>
<div class="paragraph">
<p>If <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code> is not supported for the given
arguments, <code>pPropertyCount</code> will be zero upon return, and no data will
be written to <code>pProperties</code>.</p>
</div>
<div class="paragraph">
<p>Multiple aspects are returned for depth/stencil images that are implemented
as separate planes by the implementation.
The depth and stencil data planes each have unique
<code>VkSparseImageFormatProperties</code> data.</p>
</div>
<div class="paragraph">
<p>Depth/stencil images with depth and stencil data interleaved into a single
plane will return a single <code>VkSparseImageFormatProperties</code> structure
with the <code>aspectMask</code> set to <code>VK_IMAGE_ASPECT_DEPTH_BIT</code> |
<code>VK_IMAGE_ASPECT_STENCIL_BIT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetPhysicalDeviceSparseImageFormatProperties-samples-01094" href="#VUID-vkGetPhysicalDeviceSparseImageFormatProperties-samples-01094"></a> <span class="vuid">VUID-vkGetPhysicalDeviceSparseImageFormatProperties-samples-01094</span><br>

<code>samples</code> <strong>must</strong> be a valid <a href="limits.html#VkSampleCountFlagBits" class="xref page">VkSampleCountFlagBits</a> value that is
set in <code>VkImageFormatProperties</code>::<code>sampleCounts</code> returned by
<code>vkGetPhysicalDeviceImageFormatProperties</code> with <code>format</code>,
<code>type</code>, <code>tiling</code>, and <code>usage</code> equal to those in this command</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetPhysicalDeviceSparseImageFormatProperties-physicalDevice-parameter" href="#VUID-vkGetPhysicalDeviceSparseImageFormatProperties-physicalDevice-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceSparseImageFormatProperties-physicalDevice-parameter</span><br>
 <code>physicalDevice</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkPhysicalDevice" class="xref page">VkPhysicalDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetPhysicalDeviceSparseImageFormatProperties-format-parameter" href="#VUID-vkGetPhysicalDeviceSparseImageFormatProperties-format-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceSparseImageFormatProperties-format-parameter</span><br>
 <code>format</code> <strong>must</strong> be a valid <a href="formats.html#VkFormat" class="xref page">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-vkGetPhysicalDeviceSparseImageFormatProperties-type-parameter" href="#VUID-vkGetPhysicalDeviceSparseImageFormatProperties-type-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceSparseImageFormatProperties-type-parameter</span><br>
 <code>type</code> <strong>must</strong> be a valid <a href="resources.html#VkImageType" class="xref page">VkImageType</a> value</p>
</li>
<li>
<p><a id="VUID-vkGetPhysicalDeviceSparseImageFormatProperties-samples-parameter" href="#VUID-vkGetPhysicalDeviceSparseImageFormatProperties-samples-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceSparseImageFormatProperties-samples-parameter</span><br>
 <code>samples</code> <strong>must</strong> be a valid <a href="limits.html#VkSampleCountFlagBits" class="xref page">VkSampleCountFlagBits</a> value</p>
</li>
<li>
<p><a id="VUID-vkGetPhysicalDeviceSparseImageFormatProperties-usage-parameter" href="#VUID-vkGetPhysicalDeviceSparseImageFormatProperties-usage-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceSparseImageFormatProperties-usage-parameter</span><br>
 <code>usage</code> <strong>must</strong> be a valid combination of <a href="resources.html#VkImageUsageFlagBits" class="xref page">VkImageUsageFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-vkGetPhysicalDeviceSparseImageFormatProperties-usage-requiredbitmask" href="#VUID-vkGetPhysicalDeviceSparseImageFormatProperties-usage-requiredbitmask"></a> <span class="vuid">VUID-vkGetPhysicalDeviceSparseImageFormatProperties-usage-requiredbitmask</span><br>
 <code>usage</code> <strong>must</strong> not be <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkGetPhysicalDeviceSparseImageFormatProperties-tiling-parameter" href="#VUID-vkGetPhysicalDeviceSparseImageFormatProperties-tiling-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceSparseImageFormatProperties-tiling-parameter</span><br>
 <code>tiling</code> <strong>must</strong> be a valid <a href="resources.html#VkImageTiling" class="xref page">VkImageTiling</a> value</p>
</li>
<li>
<p><a id="VUID-vkGetPhysicalDeviceSparseImageFormatProperties-pPropertyCount-parameter" href="#VUID-vkGetPhysicalDeviceSparseImageFormatProperties-pPropertyCount-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceSparseImageFormatProperties-pPropertyCount-parameter</span><br>
 <code>pPropertyCount</code> <strong>must</strong> be a valid pointer to a <code>uint32_t</code> value</p>
</li>
<li>
<p><a id="VUID-vkGetPhysicalDeviceSparseImageFormatProperties-pProperties-parameter" href="#VUID-vkGetPhysicalDeviceSparseImageFormatProperties-pProperties-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceSparseImageFormatProperties-pProperties-parameter</span><br>
 If the value referenced by <code>pPropertyCount</code> is not <code>0</code>, and <code>pProperties</code> is not <code>NULL</code>, <code>pProperties</code> <strong>must</strong> be a valid pointer to an array of <code>pPropertyCount</code> <a href="#VkSparseImageFormatProperties">VkSparseImageFormatProperties</a> structures</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><code>vkGetPhysicalDeviceSparseImageFormatProperties2</code> returns an array of
<a href="#VkSparseImageFormatProperties2">VkSparseImageFormatProperties2</a>.
Each element describes properties for one set of image aspects that are
bound simultaneously for a <code>VkImage</code> created with the provided image
creation parameters.
This is usually one element for each aspect in the image, but for
interleaved depth/stencil images there is only one element describing the
combined aspects.</p>
</div>
<div id="vkGetPhysicalDeviceSparseImageFormatProperties2" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
void vkGetPhysicalDeviceSparseImageFormatProperties2(
    VkPhysicalDevice                            physicalDevice,
    const VkPhysicalDeviceSparseImageFormatInfo2* pFormatInfo,
    uint32_t*                                   pPropertyCount,
    VkSparseImageFormatProperties2*             pProperties);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent command</p>
</div>
<div id="vkGetPhysicalDeviceSparseImageFormatProperties2KHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_get_physical_device_properties2
void vkGetPhysicalDeviceSparseImageFormatProperties2KHR(
    VkPhysicalDevice                            physicalDevice,
    const VkPhysicalDeviceSparseImageFormatInfo2* pFormatInfo,
    uint32_t*                                   pPropertyCount,
    VkSparseImageFormatProperties2*             pProperties);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>physicalDevice</code> is the physical device from which to query the
sparse image format properties.</p>
</li>
<li>
<p><code>pFormatInfo</code> is a pointer to a
<a href="#VkPhysicalDeviceSparseImageFormatInfo2">VkPhysicalDeviceSparseImageFormatInfo2</a> structure containing input
parameters to the command.</p>
</li>
<li>
<p><code>pPropertyCount</code> is a pointer to an integer related to the number of
sparse format properties available or queried, as described below.</p>
</li>
<li>
<p><code>pProperties</code> is either <code>NULL</code> or a pointer to an array of
<a href="#VkSparseImageFormatProperties2">VkSparseImageFormatProperties2</a> structures.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>vkGetPhysicalDeviceSparseImageFormatProperties2</code> behaves identically to
<a href="#vkGetPhysicalDeviceSparseImageFormatProperties">vkGetPhysicalDeviceSparseImageFormatProperties</a>, with the ability to
return extended information by adding extending structures to the
<code>pNext</code> chain of its <code>pProperties</code> parameter.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetPhysicalDeviceSparseImageFormatProperties2-physicalDevice-parameter" href="#VUID-vkGetPhysicalDeviceSparseImageFormatProperties2-physicalDevice-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceSparseImageFormatProperties2-physicalDevice-parameter</span><br>
 <code>physicalDevice</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkPhysicalDevice" class="xref page">VkPhysicalDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetPhysicalDeviceSparseImageFormatProperties2-pFormatInfo-parameter" href="#VUID-vkGetPhysicalDeviceSparseImageFormatProperties2-pFormatInfo-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceSparseImageFormatProperties2-pFormatInfo-parameter</span><br>
 <code>pFormatInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkPhysicalDeviceSparseImageFormatInfo2">VkPhysicalDeviceSparseImageFormatInfo2</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetPhysicalDeviceSparseImageFormatProperties2-pPropertyCount-parameter" href="#VUID-vkGetPhysicalDeviceSparseImageFormatProperties2-pPropertyCount-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceSparseImageFormatProperties2-pPropertyCount-parameter</span><br>
 <code>pPropertyCount</code> <strong>must</strong> be a valid pointer to a <code>uint32_t</code> value</p>
</li>
<li>
<p><a id="VUID-vkGetPhysicalDeviceSparseImageFormatProperties2-pProperties-parameter" href="#VUID-vkGetPhysicalDeviceSparseImageFormatProperties2-pProperties-parameter"></a> <span class="vuid">VUID-vkGetPhysicalDeviceSparseImageFormatProperties2-pProperties-parameter</span><br>
 If the value referenced by <code>pPropertyCount</code> is not <code>0</code>, and <code>pProperties</code> is not <code>NULL</code>, <code>pProperties</code> <strong>must</strong> be a valid pointer to an array of <code>pPropertyCount</code> <a href="#VkSparseImageFormatProperties2">VkSparseImageFormatProperties2</a> structures</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkPhysicalDeviceSparseImageFormatInfo2</code> structure is defined as:</p>
</div>
<div id="VkPhysicalDeviceSparseImageFormatInfo2" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
typedef struct VkPhysicalDeviceSparseImageFormatInfo2 {
    VkStructureType          sType;
    const void*              pNext;
    VkFormat                 format;
    VkImageType              type;
    VkSampleCountFlagBits    samples;
    VkImageUsageFlags        usage;
    VkImageTiling            tiling;
} VkPhysicalDeviceSparseImageFormatInfo2;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkPhysicalDeviceSparseImageFormatInfo2KHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_get_physical_device_properties2
typedef VkPhysicalDeviceSparseImageFormatInfo2 VkPhysicalDeviceSparseImageFormatInfo2KHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>format</code> is the image format.</p>
</li>
<li>
<p><code>type</code> is the dimensionality of the image.</p>
</li>
<li>
<p><code>samples</code> is a <a href="limits.html#VkSampleCountFlagBits" class="xref page">VkSampleCountFlagBits</a> value specifying the
number of samples per texel.</p>
</li>
<li>
<p><code>usage</code> is a bitmask describing the intended usage of the image.</p>
</li>
<li>
<p><code>tiling</code> is the tiling arrangement of the texel blocks in memory.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPhysicalDeviceSparseImageFormatInfo2-samples-01095" href="#VUID-VkPhysicalDeviceSparseImageFormatInfo2-samples-01095"></a> <span class="vuid">VUID-VkPhysicalDeviceSparseImageFormatInfo2-samples-01095</span><br>

<code>samples</code> <strong>must</strong> be a valid <a href="limits.html#VkSampleCountFlagBits" class="xref page">VkSampleCountFlagBits</a> value that is
set in <code>VkImageFormatProperties</code>::<code>sampleCounts</code> returned by
<code>vkGetPhysicalDeviceImageFormatProperties</code> with <code>format</code>,
<code>type</code>, <code>tiling</code>, and <code>usage</code> equal to those in this command</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPhysicalDeviceSparseImageFormatInfo2-sType-sType" href="#VUID-VkPhysicalDeviceSparseImageFormatInfo2-sType-sType"></a> <span class="vuid">VUID-VkPhysicalDeviceSparseImageFormatInfo2-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_SPARSE_IMAGE_FORMAT_INFO_2</code></p>
</li>
<li>
<p><a id="VUID-VkPhysicalDeviceSparseImageFormatInfo2-pNext-pNext" href="#VUID-VkPhysicalDeviceSparseImageFormatInfo2-pNext-pNext"></a> <span class="vuid">VUID-VkPhysicalDeviceSparseImageFormatInfo2-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkPhysicalDeviceSparseImageFormatInfo2-format-parameter" href="#VUID-VkPhysicalDeviceSparseImageFormatInfo2-format-parameter"></a> <span class="vuid">VUID-VkPhysicalDeviceSparseImageFormatInfo2-format-parameter</span><br>
 <code>format</code> <strong>must</strong> be a valid <a href="formats.html#VkFormat" class="xref page">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkPhysicalDeviceSparseImageFormatInfo2-type-parameter" href="#VUID-VkPhysicalDeviceSparseImageFormatInfo2-type-parameter"></a> <span class="vuid">VUID-VkPhysicalDeviceSparseImageFormatInfo2-type-parameter</span><br>
 <code>type</code> <strong>must</strong> be a valid <a href="resources.html#VkImageType" class="xref page">VkImageType</a> value</p>
</li>
<li>
<p><a id="VUID-VkPhysicalDeviceSparseImageFormatInfo2-samples-parameter" href="#VUID-VkPhysicalDeviceSparseImageFormatInfo2-samples-parameter"></a> <span class="vuid">VUID-VkPhysicalDeviceSparseImageFormatInfo2-samples-parameter</span><br>
 <code>samples</code> <strong>must</strong> be a valid <a href="limits.html#VkSampleCountFlagBits" class="xref page">VkSampleCountFlagBits</a> value</p>
</li>
<li>
<p><a id="VUID-VkPhysicalDeviceSparseImageFormatInfo2-usage-parameter" href="#VUID-VkPhysicalDeviceSparseImageFormatInfo2-usage-parameter"></a> <span class="vuid">VUID-VkPhysicalDeviceSparseImageFormatInfo2-usage-parameter</span><br>
 <code>usage</code> <strong>must</strong> be a valid combination of <a href="resources.html#VkImageUsageFlagBits" class="xref page">VkImageUsageFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-VkPhysicalDeviceSparseImageFormatInfo2-usage-requiredbitmask" href="#VUID-VkPhysicalDeviceSparseImageFormatInfo2-usage-requiredbitmask"></a> <span class="vuid">VUID-VkPhysicalDeviceSparseImageFormatInfo2-usage-requiredbitmask</span><br>
 <code>usage</code> <strong>must</strong> not be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkPhysicalDeviceSparseImageFormatInfo2-tiling-parameter" href="#VUID-VkPhysicalDeviceSparseImageFormatInfo2-tiling-parameter"></a> <span class="vuid">VUID-VkPhysicalDeviceSparseImageFormatInfo2-tiling-parameter</span><br>
 <code>tiling</code> <strong>must</strong> be a valid <a href="resources.html#VkImageTiling" class="xref page">VkImageTiling</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkSparseImageFormatProperties2</code> structure is defined as:</p>
</div>
<div id="VkSparseImageFormatProperties2" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
typedef struct VkSparseImageFormatProperties2 {
    VkStructureType                  sType;
    void*                            pNext;
    VkSparseImageFormatProperties    properties;
} VkSparseImageFormatProperties2;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkSparseImageFormatProperties2KHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_get_physical_device_properties2
typedef VkSparseImageFormatProperties2 VkSparseImageFormatProperties2KHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>properties</code> is a <a href="#VkSparseImageFormatProperties">VkSparseImageFormatProperties</a> structure
which is populated with the same values as in
<a href="#vkGetPhysicalDeviceSparseImageFormatProperties">vkGetPhysicalDeviceSparseImageFormatProperties</a>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSparseImageFormatProperties2-sType-sType" href="#VUID-VkSparseImageFormatProperties2-sType-sType"></a> <span class="vuid">VUID-VkSparseImageFormatProperties2-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_SPARSE_IMAGE_FORMAT_PROPERTIES_2</code></p>
</li>
<li>
<p><a id="VUID-VkSparseImageFormatProperties2-pNext-pNext" href="#VUID-VkSparseImageFormatProperties2-pNext-pNext"></a> <span class="vuid">VUID-VkSparseImageFormatProperties2-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sparsememory-resource-creation"><a class="anchor" href="#sparsememory-resource-creation"></a>Sparse Resource Creation</h3>
<div class="paragraph">
<p>Sparse resources require that one or more sparse feature flags be specified
(as part of the <code>VkPhysicalDeviceFeatures</code> structure described
previously in the <a href="#sparsememory-physicalfeatures">Physical Device Features</a>
section) when calling <a href="devsandqueues.html#vkCreateDevice" class="xref page">vkCreateDevice</a>.
When the appropriate device features are enabled, the
<code>VK_BUFFER_CREATE_SPARSE_*</code> and <code>VK_IMAGE_CREATE_SPARSE_*</code> flags
<strong>can</strong> be used.
See <a href="resources.html#vkCreateBuffer" class="xref page">vkCreateBuffer</a> and <a href="resources.html#vkCreateImage" class="xref page">vkCreateImage</a> for details of the resource
creation APIs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Specifying <code>VK_BUFFER_CREATE_SPARSE_RESIDENCY_BIT</code> or
<code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code> requires specifying
<code>VK_BUFFER_CREATE_SPARSE_BINDING_BIT</code> or
<code>VK_IMAGE_CREATE_SPARSE_BINDING_BIT</code>, respectively, as well.
This means that resources <strong>must</strong> be created with the appropriate
<code>*_SPARSE_BINDING_BIT</code> to be used with the sparse binding command
(<code>vkQueueBindSparse</code>).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sparsememory-memory-requirements"><a class="anchor" href="#sparsememory-memory-requirements"></a>Sparse Resource Memory Requirements</h3>
<div class="paragraph">
<p>Sparse resources have specific memory requirements related to binding sparse
memory.
These memory requirements are reported differently for <code>VkBuffer</code>
objects and <code>VkImage</code> objects.</p>
</div>
<div class="sect3">
<h4 id="sparsememory-memory-buffer-fully-resident"><a class="anchor" href="#sparsememory-memory-buffer-fully-resident"></a>Buffer and Fully-Resident Images</h4>
<div class="paragraph">
<p>Buffers (both fully and partially resident) and fully-resident images <strong>can</strong>
be bound to memory using only the data from <code>VkMemoryRequirements</code>.
For all sparse resources the <code>VkMemoryRequirements</code>::<code>alignment</code>
member specifies both the binding granularity in bytes and the <strong>required</strong>
alignment of <code>VkDeviceMemory</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sparsememory-memory-partially-resident"><a class="anchor" href="#sparsememory-memory-partially-resident"></a>Partially Resident Images</h4>
<div class="paragraph">
<p>Partially resident images have a different method for binding memory.
As with buffers and fully resident images, the
<code>VkMemoryRequirements</code>::<code>alignment</code> field specifies the binding
granularity in bytes for the image.</p>
</div>
<div class="paragraph">
<p>Requesting sparse memory requirements for <code>VkImage</code> objects using
<code>vkGetImageSparseMemoryRequirements</code> will return an array of one or more
<code>VkSparseImageMemoryRequirements</code> structures.
Each structure describes the sparse memory requirements for a group of
aspects of the image.</p>
</div>
<div class="paragraph">
<p>The sparse image <strong>must</strong> have been created using the
<code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code> flag to retrieve valid sparse
image memory requirements.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sparse_image_memory_requirements"><a class="anchor" href="#_sparse_image_memory_requirements"></a>Sparse Image Memory Requirements</h4>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkSparseImageMemoryRequirements</code> structure is defined as:</p>
</div>
<div id="VkSparseImageMemoryRequirements" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkSparseImageMemoryRequirements {
    VkSparseImageFormatProperties    formatProperties;
    uint32_t                         imageMipTailFirstLod;
    VkDeviceSize                     imageMipTailSize;
    VkDeviceSize                     imageMipTailOffset;
    VkDeviceSize                     imageMipTailStride;
} VkSparseImageMemoryRequirements;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>formatProperties</code> is a <a href="#VkSparseImageFormatProperties">VkSparseImageFormatProperties</a>
structure specifying properties of the image format.</p>
</li>
<li>
<p><code>imageMipTailFirstLod</code> is the first mip level at which image
subresources are included in the mip tail region.</p>
</li>
<li>
<p><code>imageMipTailSize</code> is the memory size (in bytes) of the mip tail
region.
If <code>formatProperties.flags</code> contains
<code>VK_SPARSE_IMAGE_FORMAT_SINGLE_MIPTAIL_BIT</code>, this is the size of the
whole mip tail, otherwise this is the size of the mip tail of a single
array layer.
This value is guaranteed to be a multiple of the sparse block size in
bytes.</p>
</li>
<li>
<p><code>imageMipTailOffset</code> is the opaque memory offset used with
<a href="#VkSparseImageOpaqueMemoryBindInfo">VkSparseImageOpaqueMemoryBindInfo</a> to bind the mip tail region(s).</p>
</li>
<li>
<p><code>imageMipTailStride</code> is the offset stride between each array-layer&#8217;s
mip tail, if <code>formatProperties.flags</code> does not contain
<code>VK_SPARSE_IMAGE_FORMAT_SINGLE_MIPTAIL_BIT</code> (otherwise the value is
<strong>undefined</strong>).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query sparse memory requirements for an image, call:</p>
</div>
<div id="vkGetImageSparseMemoryRequirements" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
void vkGetImageSparseMemoryRequirements(
    VkDevice                                    device,
    VkImage                                     image,
    uint32_t*                                   pSparseMemoryRequirementCount,
    VkSparseImageMemoryRequirements*            pSparseMemoryRequirements);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the image.</p>
</li>
<li>
<p><code>image</code> is the <a href="resources.html#VkImage" class="xref page">VkImage</a> object to get the memory requirements
for.</p>
</li>
<li>
<p><code>pSparseMemoryRequirementCount</code> is a pointer to an integer related
to the number of sparse memory requirements available or queried, as
described below.</p>
</li>
<li>
<p><code>pSparseMemoryRequirements</code> is either <code>NULL</code> or a pointer to an
array of <code>VkSparseImageMemoryRequirements</code> structures.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>pSparseMemoryRequirements</code> is <code>NULL</code>, then the number of sparse
memory requirements available is returned in
<code>pSparseMemoryRequirementCount</code>.
Otherwise, <code>pSparseMemoryRequirementCount</code> <strong>must</strong> point to a variable set
by the application to the number of elements in the
<code>pSparseMemoryRequirements</code> array, and on return the variable is
overwritten with the number of structures actually written to
<code>pSparseMemoryRequirements</code>.
If <code>pSparseMemoryRequirementCount</code> is less than the number of sparse
memory requirements available, at most <code>pSparseMemoryRequirementCount</code>
structures will be written.</p>
</div>
<div class="paragraph">
<p>If the image was not created with <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code>
then <code>pSparseMemoryRequirementCount</code> will be zero and
<code>pSparseMemoryRequirements</code> will not be written to.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is legal for an implementation to report a larger value in
<code>VkMemoryRequirements</code>::<code>size</code> than would be obtained by adding
together memory sizes for all <code>VkSparseImageMemoryRequirements</code> returned
by <code>vkGetImageSparseMemoryRequirements</code>.
This <strong>may</strong> occur when the implementation requires unused padding in the
address range describing the resource.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetImageSparseMemoryRequirements-device-parameter" href="#VUID-vkGetImageSparseMemoryRequirements-device-parameter"></a> <span class="vuid">VUID-vkGetImageSparseMemoryRequirements-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetImageSparseMemoryRequirements-image-parameter" href="#VUID-vkGetImageSparseMemoryRequirements-image-parameter"></a> <span class="vuid">VUID-vkGetImageSparseMemoryRequirements-image-parameter</span><br>
 <code>image</code> <strong>must</strong> be a valid <a href="resources.html#VkImage" class="xref page">VkImage</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetImageSparseMemoryRequirements-pSparseMemoryRequirementCount-parameter" href="#VUID-vkGetImageSparseMemoryRequirements-pSparseMemoryRequirementCount-parameter"></a> <span class="vuid">VUID-vkGetImageSparseMemoryRequirements-pSparseMemoryRequirementCount-parameter</span><br>
 <code>pSparseMemoryRequirementCount</code> <strong>must</strong> be a valid pointer to a <code>uint32_t</code> value</p>
</li>
<li>
<p><a id="VUID-vkGetImageSparseMemoryRequirements-pSparseMemoryRequirements-parameter" href="#VUID-vkGetImageSparseMemoryRequirements-pSparseMemoryRequirements-parameter"></a> <span class="vuid">VUID-vkGetImageSparseMemoryRequirements-pSparseMemoryRequirements-parameter</span><br>
 If the value referenced by <code>pSparseMemoryRequirementCount</code> is not <code>0</code>, and <code>pSparseMemoryRequirements</code> is not <code>NULL</code>, <code>pSparseMemoryRequirements</code> <strong>must</strong> be a valid pointer to an array of <code>pSparseMemoryRequirementCount</code> <a href="#VkSparseImageMemoryRequirements">VkSparseImageMemoryRequirements</a> structures</p>
</li>
<li>
<p><a id="VUID-vkGetImageSparseMemoryRequirements-image-parent" href="#VUID-vkGetImageSparseMemoryRequirements-image-parent"></a> <span class="vuid">VUID-vkGetImageSparseMemoryRequirements-image-parent</span><br>
 <code>image</code> <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query sparse memory requirements for an image, call:</p>
</div>
<div id="vkGetImageSparseMemoryRequirements2" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
void vkGetImageSparseMemoryRequirements2(
    VkDevice                                    device,
    const VkImageSparseMemoryRequirementsInfo2* pInfo,
    uint32_t*                                   pSparseMemoryRequirementCount,
    VkSparseImageMemoryRequirements2*           pSparseMemoryRequirements);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent command</p>
</div>
<div id="vkGetImageSparseMemoryRequirements2KHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_get_memory_requirements2
void vkGetImageSparseMemoryRequirements2KHR(
    VkDevice                                    device,
    const VkImageSparseMemoryRequirementsInfo2* pInfo,
    uint32_t*                                   pSparseMemoryRequirementCount,
    VkSparseImageMemoryRequirements2*           pSparseMemoryRequirements);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the image.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <code>VkImageSparseMemoryRequirementsInfo2</code>
structure containing parameters required for the memory requirements
query.</p>
</li>
<li>
<p><code>pSparseMemoryRequirementCount</code> is a pointer to an integer related
to the number of sparse memory requirements available or queried, as
described below.</p>
</li>
<li>
<p><code>pSparseMemoryRequirements</code> is either <code>NULL</code> or a pointer to an
array of <code>VkSparseImageMemoryRequirements2</code> structures.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetImageSparseMemoryRequirements2-device-parameter" href="#VUID-vkGetImageSparseMemoryRequirements2-device-parameter"></a> <span class="vuid">VUID-vkGetImageSparseMemoryRequirements2-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetImageSparseMemoryRequirements2-pInfo-parameter" href="#VUID-vkGetImageSparseMemoryRequirements2-pInfo-parameter"></a> <span class="vuid">VUID-vkGetImageSparseMemoryRequirements2-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkImageSparseMemoryRequirementsInfo2">VkImageSparseMemoryRequirementsInfo2</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetImageSparseMemoryRequirements2-pSparseMemoryRequirementCount-parameter" href="#VUID-vkGetImageSparseMemoryRequirements2-pSparseMemoryRequirementCount-parameter"></a> <span class="vuid">VUID-vkGetImageSparseMemoryRequirements2-pSparseMemoryRequirementCount-parameter</span><br>
 <code>pSparseMemoryRequirementCount</code> <strong>must</strong> be a valid pointer to a <code>uint32_t</code> value</p>
</li>
<li>
<p><a id="VUID-vkGetImageSparseMemoryRequirements2-pSparseMemoryRequirements-parameter" href="#VUID-vkGetImageSparseMemoryRequirements2-pSparseMemoryRequirements-parameter"></a> <span class="vuid">VUID-vkGetImageSparseMemoryRequirements2-pSparseMemoryRequirements-parameter</span><br>
 If the value referenced by <code>pSparseMemoryRequirementCount</code> is not <code>0</code>, and <code>pSparseMemoryRequirements</code> is not <code>NULL</code>, <code>pSparseMemoryRequirements</code> <strong>must</strong> be a valid pointer to an array of <code>pSparseMemoryRequirementCount</code> <a href="#VkSparseImageMemoryRequirements2">VkSparseImageMemoryRequirements2</a> structures</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To determine the sparse memory requirements for an image resource without
creating an object, call:</p>
</div>
<div id="vkGetDeviceImageSparseMemoryRequirements" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_3
void vkGetDeviceImageSparseMemoryRequirements(
    VkDevice                                    device,
    const VkDeviceImageMemoryRequirements*      pInfo,
    uint32_t*                                   pSparseMemoryRequirementCount,
    VkSparseImageMemoryRequirements2*           pSparseMemoryRequirements);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent command</p>
</div>
<div id="vkGetDeviceImageSparseMemoryRequirementsKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_maintenance4
void vkGetDeviceImageSparseMemoryRequirementsKHR(
    VkDevice                                    device,
    const VkDeviceImageMemoryRequirements*      pInfo,
    uint32_t*                                   pSparseMemoryRequirementCount,
    VkSparseImageMemoryRequirements2*           pSparseMemoryRequirements);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device intended to own the image.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <a href="resources.html#VkDeviceImageMemoryRequirements" class="xref page">VkDeviceImageMemoryRequirements</a>
structure containing parameters required for the memory requirements
query.</p>
</li>
<li>
<p><code>pSparseMemoryRequirementCount</code> is a pointer to an integer related
to the number of sparse memory requirements available or queried, as
described below.</p>
</li>
<li>
<p><code>pSparseMemoryRequirements</code> is either <code>NULL</code> or a pointer to an
array of <code>VkSparseImageMemoryRequirements2</code> structures.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceImageSparseMemoryRequirements-device-parameter" href="#VUID-vkGetDeviceImageSparseMemoryRequirements-device-parameter"></a> <span class="vuid">VUID-vkGetDeviceImageSparseMemoryRequirements-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceImageSparseMemoryRequirements-pInfo-parameter" href="#VUID-vkGetDeviceImageSparseMemoryRequirements-pInfo-parameter"></a> <span class="vuid">VUID-vkGetDeviceImageSparseMemoryRequirements-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="resources.html#VkDeviceImageMemoryRequirements" class="xref page">VkDeviceImageMemoryRequirements</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceImageSparseMemoryRequirements-pSparseMemoryRequirementCount-parameter" href="#VUID-vkGetDeviceImageSparseMemoryRequirements-pSparseMemoryRequirementCount-parameter"></a> <span class="vuid">VUID-vkGetDeviceImageSparseMemoryRequirements-pSparseMemoryRequirementCount-parameter</span><br>
 <code>pSparseMemoryRequirementCount</code> <strong>must</strong> be a valid pointer to a <code>uint32_t</code> value</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceImageSparseMemoryRequirements-pSparseMemoryRequirements-parameter" href="#VUID-vkGetDeviceImageSparseMemoryRequirements-pSparseMemoryRequirements-parameter"></a> <span class="vuid">VUID-vkGetDeviceImageSparseMemoryRequirements-pSparseMemoryRequirements-parameter</span><br>
 If the value referenced by <code>pSparseMemoryRequirementCount</code> is not <code>0</code>, and <code>pSparseMemoryRequirements</code> is not <code>NULL</code>, <code>pSparseMemoryRequirements</code> <strong>must</strong> be a valid pointer to an array of <code>pSparseMemoryRequirementCount</code> <a href="#VkSparseImageMemoryRequirements2">VkSparseImageMemoryRequirements2</a> structures</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkImageSparseMemoryRequirementsInfo2</code> structure is defined as:</p>
</div>
<div id="VkImageSparseMemoryRequirementsInfo2" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
typedef struct VkImageSparseMemoryRequirementsInfo2 {
    VkStructureType    sType;
    const void*        pNext;
    VkImage            image;
} VkImageSparseMemoryRequirementsInfo2;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkImageSparseMemoryRequirementsInfo2KHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_get_memory_requirements2
typedef VkImageSparseMemoryRequirementsInfo2 VkImageSparseMemoryRequirementsInfo2KHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>image</code> is the image to query.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImageSparseMemoryRequirementsInfo2-sType-sType" href="#VUID-VkImageSparseMemoryRequirementsInfo2-sType-sType"></a> <span class="vuid">VUID-VkImageSparseMemoryRequirementsInfo2-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_IMAGE_SPARSE_MEMORY_REQUIREMENTS_INFO_2</code></p>
</li>
<li>
<p><a id="VUID-VkImageSparseMemoryRequirementsInfo2-pNext-pNext" href="#VUID-VkImageSparseMemoryRequirementsInfo2-pNext-pNext"></a> <span class="vuid">VUID-VkImageSparseMemoryRequirementsInfo2-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkImageSparseMemoryRequirementsInfo2-image-parameter" href="#VUID-VkImageSparseMemoryRequirementsInfo2-image-parameter"></a> <span class="vuid">VUID-VkImageSparseMemoryRequirementsInfo2-image-parameter</span><br>
 <code>image</code> <strong>must</strong> be a valid <a href="resources.html#VkImage" class="xref page">VkImage</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkSparseImageMemoryRequirements2</code> structure is defined as:</p>
</div>
<div id="VkSparseImageMemoryRequirements2" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
typedef struct VkSparseImageMemoryRequirements2 {
    VkStructureType                    sType;
    void*                              pNext;
    VkSparseImageMemoryRequirements    memoryRequirements;
} VkSparseImageMemoryRequirements2;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkSparseImageMemoryRequirements2KHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_get_memory_requirements2
typedef VkSparseImageMemoryRequirements2 VkSparseImageMemoryRequirements2KHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>memoryRequirements</code> is a <a href="#VkSparseImageMemoryRequirements">VkSparseImageMemoryRequirements</a>
structure describing the memory requirements of the sparse image.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSparseImageMemoryRequirements2-sType-sType" href="#VUID-VkSparseImageMemoryRequirements2-sType-sType"></a> <span class="vuid">VUID-VkSparseImageMemoryRequirements2-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_SPARSE_IMAGE_MEMORY_REQUIREMENTS_2</code></p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryRequirements2-pNext-pNext" href="#VUID-VkSparseImageMemoryRequirements2-pNext-pNext"></a> <span class="vuid">VUID-VkSparseImageMemoryRequirements2-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sparsememory-resource-binding"><a class="anchor" href="#sparsememory-resource-binding"></a>Binding Resource Memory</h3>
<div class="paragraph">
<p>Non-sparse resources are backed by a single physical allocation prior to
device use (via <code>vkBindImageMemory</code> or <code>vkBindBufferMemory</code>), and
their backing <strong>must</strong> not be changed.
On the other hand, sparse resources <strong>can</strong> be bound to memory non-contiguously
and these bindings <strong>can</strong> be altered during the lifetime of the resource.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is important to note that freeing a <code>VkDeviceMemory</code> object with
<code>vkFreeMemory</code> will not cause resources (or resource regions) bound to
the memory object to become unbound.
Applications <strong>must</strong> not access resources bound to memory that has been freed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sparse memory bindings execute on a queue that includes the
<code>VK_QUEUE_SPARSE_BINDING_BIT</code> bit.
Applications <strong>must</strong> use <a href="synchronization.html#synchronization" class="xref page">synchronization primitives</a> to
guarantee that other queues do not access ranges of memory concurrently with
a binding change.
Applications <strong>can</strong> access other ranges of the same resource while a bind
operation is executing.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Implementations <strong>must</strong> provide a guarantee that simultaneously binding sparse
blocks while another queue accesses those same sparse blocks via a sparse
resource <strong>must</strong> not access memory owned by another process or otherwise
corrupt the system.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>While some implementations <strong>may</strong> include <code>VK_QUEUE_SPARSE_BINDING_BIT</code>
support in queue families that also include graphics and compute support,
other implementations <strong>may</strong> only expose a
<code>VK_QUEUE_SPARSE_BINDING_BIT</code>-only queue family.
In either case, applications <strong>must</strong> use <a href="synchronization.html#synchronization" class="xref page">synchronization primitives</a> to explicitly request any ordering dependencies between sparse
memory binding operations and other graphics/compute/transfer operations, as
sparse binding operations are not automatically ordered against command
buffer execution, even within a single queue.</p>
</div>
<div class="paragraph">
<p>When binding memory explicitly for the <code>VK_IMAGE_ASPECT_METADATA_BIT</code>
the application <strong>must</strong> use the <code>VK_SPARSE_MEMORY_BIND_METADATA_BIT</code> in
the <code>VkSparseMemoryBind</code>::<code>flags</code> field when binding memory.
Binding memory for metadata is done the same way as binding memory for the
mip tail, with the addition of the <code>VK_SPARSE_MEMORY_BIND_METADATA_BIT</code>
flag.</p>
</div>
<div class="paragraph">
<p>Binding the mip tail for any aspect <strong>must</strong> only be performed using
<a href="#VkSparseImageOpaqueMemoryBindInfo">VkSparseImageOpaqueMemoryBindInfo</a>.
If <code>formatProperties.flags</code> contains
<code>VK_SPARSE_IMAGE_FORMAT_SINGLE_MIPTAIL_BIT</code>, then it <strong>can</strong> be bound with
a single <a href="#VkSparseMemoryBind">VkSparseMemoryBind</a> structure, with <code>resourceOffset</code> =
<code>imageMipTailOffset</code> and <code>size</code> = <code>imageMipTailSize</code>.</p>
</div>
<div class="paragraph">
<p>If <code>formatProperties.flags</code> does not contain
<code>VK_SPARSE_IMAGE_FORMAT_SINGLE_MIPTAIL_BIT</code> then the offset for the mip
tail in each array layer is given as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">arrayMipTailOffset = imageMipTailOffset + arrayLayer * imageMipTailStride;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the mip tail <strong>can</strong> be bound with <code>layerCount</code> <a href="#VkSparseMemoryBind">VkSparseMemoryBind</a>
structures, each using <code>size</code> = <code>imageMipTailSize</code> and
<code>resourceOffset</code> = <code>arrayMipTailOffset</code> as defined above.</p>
</div>
<div class="paragraph">
<p>Sparse memory binding is handled by the following APIs and related data
structures.</p>
</div>
<div class="sect3">
<h4 id="sparsemem-memory-binding"><a class="anchor" href="#sparsemem-memory-binding"></a>Sparse Memory Binding Functions</h4>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkSparseMemoryBind</code> structure is defined as:</p>
</div>
<div id="VkSparseMemoryBind" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkSparseMemoryBind {
    VkDeviceSize               resourceOffset;
    VkDeviceSize               size;
    VkDeviceMemory             memory;
    VkDeviceSize               memoryOffset;
    VkSparseMemoryBindFlags    flags;
} VkSparseMemoryBind;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>resourceOffset</code> is the offset into the resource.</p>
</li>
<li>
<p><code>size</code> is the size of the memory region to be bound.</p>
</li>
<li>
<p><code>memory</code> is the <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object that the range of the
resource is bound to.
If <code>memory</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the range is unbound.</p>
</li>
<li>
<p><code>memoryOffset</code> is the offset into the <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object to
bind the resource range to.
If <code>memory</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, this value is ignored.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="#VkSparseMemoryBindFlagBits">VkSparseMemoryBindFlagBits</a> specifying
usage of the binding operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>binding range</em> <span class="eq">[<code>resourceOffset</code>, <code>resourceOffset</code> + 
<code>size</code>)</span> has different constraints based on <code>flags</code>.
If <code>flags</code> contains <code>VK_SPARSE_MEMORY_BIND_METADATA_BIT</code>, the
binding range <strong>must</strong> be within the mip tail region of the metadata aspect.
This metadata region is defined by:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq">metadataRegion = [base, base + 
<code>imageMipTailSize</code>)</span></p>
</dd>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq">base = <code>imageMipTailOffset</code> + 
<code>imageMipTailStride</code> × n</span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>and <code>imageMipTailOffset</code>, <code>imageMipTailSize</code>, and
<code>imageMipTailStride</code> values are from the
<a href="#VkSparseImageMemoryRequirements">VkSparseImageMemoryRequirements</a> corresponding to the metadata aspect
of the image, and <span class="eq">n</span> is a valid array layer index for the image,</p>
</div>
<div class="paragraph">
<p><code>imageMipTailStride</code> is considered to be zero for aspects where
<code>VkSparseImageMemoryRequirements</code>::<code>formatProperties.flags</code> contains
<code>VK_SPARSE_IMAGE_FORMAT_SINGLE_MIPTAIL_BIT</code>.</p>
</div>
<div class="paragraph">
<p>If <code>flags</code> does not contain <code>VK_SPARSE_MEMORY_BIND_METADATA_BIT</code>,
the binding range <strong>must</strong> be within the range
<span class="eq">[0,<a href="resources.html#VkMemoryRequirements" class="xref page">VkMemoryRequirements</a>::<code>size</code>)</span>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSparseMemoryBind-memory-01096" href="#VUID-VkSparseMemoryBind-memory-01096"></a> <span class="vuid">VUID-VkSparseMemoryBind-memory-01096</span><br>

If <code>memory</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>memory</code> and
<code>memoryOffset</code> <strong>must</strong> match the memory requirements of the resource,
as described in section <a href="resources.html#resources-association" class="xref page">Resource Memory Association</a></p>
</li>
<li>
<p><a id="VUID-VkSparseMemoryBind-resourceOffset-09491" href="#VUID-VkSparseMemoryBind-resourceOffset-09491"></a> <span class="vuid">VUID-VkSparseMemoryBind-resourceOffset-09491</span><br>

If the resource being bound is a <code>VkBuffer</code>, <code>resourceOffset</code>,
<code>memoryOffset</code> and <code>size</code> <strong>must</strong> be an integer multiple of the
<code>alignment</code> of the <a href="resources.html#VkMemoryRequirements" class="xref page">VkMemoryRequirements</a> structure returned
from a call to <a href="resources.html#vkGetBufferMemoryRequirements" class="xref page">vkGetBufferMemoryRequirements</a> with the buffer
resource</p>
</li>
<li>
<p><a id="VUID-VkSparseMemoryBind-resourceOffset-09492" href="#VUID-VkSparseMemoryBind-resourceOffset-09492"></a> <span class="vuid">VUID-VkSparseMemoryBind-resourceOffset-09492</span><br>

If the resource being bound is a <code>VkImage</code>, <code>resourceOffset</code> and
<code>memoryOffset</code> <strong>must</strong> be an integer multiple of the <code>alignment</code>
of the <a href="resources.html#VkMemoryRequirements" class="xref page">VkMemoryRequirements</a> structure returned from a call to
<a href="resources.html#vkGetImageMemoryRequirements" class="xref page">vkGetImageMemoryRequirements</a> with the image resource</p>
</li>
<li>
<p><a id="VUID-VkSparseMemoryBind-memory-01097" href="#VUID-VkSparseMemoryBind-memory-01097"></a> <span class="vuid">VUID-VkSparseMemoryBind-memory-01097</span><br>

If <code>memory</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>memory</code> <strong>must</strong> not have
been created with a memory type that reports
<code>VK_MEMORY_PROPERTY_LAZILY_ALLOCATED_BIT</code> bit set</p>
</li>
<li>
<p><a id="VUID-VkSparseMemoryBind-size-01098" href="#VUID-VkSparseMemoryBind-size-01098"></a> <span class="vuid">VUID-VkSparseMemoryBind-size-01098</span><br>

<code>size</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkSparseMemoryBind-resourceOffset-01099" href="#VUID-VkSparseMemoryBind-resourceOffset-01099"></a> <span class="vuid">VUID-VkSparseMemoryBind-resourceOffset-01099</span><br>

<code>resourceOffset</code> <strong>must</strong> be less than the size of the resource</p>
</li>
<li>
<p><a id="VUID-VkSparseMemoryBind-size-01100" href="#VUID-VkSparseMemoryBind-size-01100"></a> <span class="vuid">VUID-VkSparseMemoryBind-size-01100</span><br>

<code>size</code> <strong>must</strong> be less than or equal to the size of the resource minus
<code>resourceOffset</code></p>
</li>
<li>
<p><a id="VUID-VkSparseMemoryBind-memoryOffset-01101" href="#VUID-VkSparseMemoryBind-memoryOffset-01101"></a> <span class="vuid">VUID-VkSparseMemoryBind-memoryOffset-01101</span><br>

<code>memoryOffset</code> <strong>must</strong> be less than the size of <code>memory</code></p>
</li>
<li>
<p><a id="VUID-VkSparseMemoryBind-size-01102" href="#VUID-VkSparseMemoryBind-size-01102"></a> <span class="vuid">VUID-VkSparseMemoryBind-size-01102</span><br>

<code>size</code> <strong>must</strong> be less than or equal to the size of <code>memory</code> minus
<code>memoryOffset</code></p>
</li>
<li>
<p><a id="VUID-VkSparseMemoryBind-memory-02730" href="#VUID-VkSparseMemoryBind-memory-02730"></a> <span class="vuid">VUID-VkSparseMemoryBind-memory-02730</span><br>

If <code>memory</code> was created with
<a href="memory.html#VkExportMemoryAllocateInfo" class="xref page">VkExportMemoryAllocateInfo</a>::<code>handleTypes</code> not equal to <code>0</code>, at
least one handle type it contained <strong>must</strong> also have been set in
<a href="resources.html#VkExternalMemoryBufferCreateInfo" class="xref page">VkExternalMemoryBufferCreateInfo</a>::<code>handleTypes</code> or
<a href="resources.html#VkExternalMemoryImageCreateInfo" class="xref page">VkExternalMemoryImageCreateInfo</a>::<code>handleTypes</code> when the
resource was created</p>
</li>
<li>
<p><a id="VUID-VkSparseMemoryBind-memory-02731" href="#VUID-VkSparseMemoryBind-memory-02731"></a> <span class="vuid">VUID-VkSparseMemoryBind-memory-02731</span><br>

If <code>memory</code> was created by a memory import operation, the external
handle type of the imported memory <strong>must</strong> also have been set in
<a href="resources.html#VkExternalMemoryBufferCreateInfo" class="xref page">VkExternalMemoryBufferCreateInfo</a>::<code>handleTypes</code> or
<a href="resources.html#VkExternalMemoryImageCreateInfo" class="xref page">VkExternalMemoryImageCreateInfo</a>::<code>handleTypes</code> when the
resource was created</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSparseMemoryBind-memory-parameter" href="#VUID-VkSparseMemoryBind-memory-parameter"></a> <span class="vuid">VUID-VkSparseMemoryBind-memory-parameter</span><br>
 If <code>memory</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>memory</code> <strong>must</strong> be a valid <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> handle</p>
</li>
<li>
<p><a id="VUID-VkSparseMemoryBind-flags-parameter" href="#VUID-VkSparseMemoryBind-flags-parameter"></a> <span class="vuid">VUID-VkSparseMemoryBind-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="#VkSparseMemoryBindFlagBits">VkSparseMemoryBindFlagBits</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong>can</strong> be set in <a href="#VkSparseMemoryBind">VkSparseMemoryBind</a>::<code>flags</code>, specifying
usage of a sparse memory binding operation, are:</p>
</div>
<div id="VkSparseMemoryBindFlagBits" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef enum VkSparseMemoryBindFlagBits {
    VK_SPARSE_MEMORY_BIND_METADATA_BIT = 0x00000001,
} VkSparseMemoryBindFlagBits;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_SPARSE_MEMORY_BIND_METADATA_BIT</code> specifies that the memory being
bound is only for the metadata aspect.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkSparseMemoryBindFlags" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef VkFlags VkSparseMemoryBindFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkSparseMemoryBindFlags</code> is a bitmask type for setting a mask of zero
or more <a href="#VkSparseMemoryBindFlagBits">VkSparseMemoryBindFlagBits</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Memory is bound to <code>VkBuffer</code> objects created with the
<code>VK_BUFFER_CREATE_SPARSE_BINDING_BIT</code> flag using the following
structure:</p>
</div>
<div id="VkSparseBufferMemoryBindInfo" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkSparseBufferMemoryBindInfo {
    VkBuffer                     buffer;
    uint32_t                     bindCount;
    const VkSparseMemoryBind*    pBinds;
} VkSparseBufferMemoryBindInfo;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>buffer</code> is the <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> object to be bound.</p>
</li>
<li>
<p><code>bindCount</code> is the number of <a href="#VkSparseMemoryBind">VkSparseMemoryBind</a> structures in
the <code>pBinds</code> array.</p>
</li>
<li>
<p><code>pBinds</code> is a pointer to an array of <a href="#VkSparseMemoryBind">VkSparseMemoryBind</a>
structures.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSparseBufferMemoryBindInfo-buffer-parameter" href="#VUID-VkSparseBufferMemoryBindInfo-buffer-parameter"></a> <span class="vuid">VUID-VkSparseBufferMemoryBindInfo-buffer-parameter</span><br>
 <code>buffer</code> <strong>must</strong> be a valid <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-VkSparseBufferMemoryBindInfo-pBinds-parameter" href="#VUID-VkSparseBufferMemoryBindInfo-pBinds-parameter"></a> <span class="vuid">VUID-VkSparseBufferMemoryBindInfo-pBinds-parameter</span><br>
 <code>pBinds</code> <strong>must</strong> be a valid pointer to an array of <code>bindCount</code> valid <a href="#VkSparseMemoryBind">VkSparseMemoryBind</a> structures</p>
</li>
<li>
<p><a id="VUID-VkSparseBufferMemoryBindInfo-bindCount-arraylength" href="#VUID-VkSparseBufferMemoryBindInfo-bindCount-arraylength"></a> <span class="vuid">VUID-VkSparseBufferMemoryBindInfo-bindCount-arraylength</span><br>
 <code>bindCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Memory is bound to opaque regions of <code>VkImage</code> objects created with the
<code>VK_IMAGE_CREATE_SPARSE_BINDING_BIT</code> flag using the following structure:</p>
</div>
<div id="VkSparseImageOpaqueMemoryBindInfo" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkSparseImageOpaqueMemoryBindInfo {
    VkImage                      image;
    uint32_t                     bindCount;
    const VkSparseMemoryBind*    pBinds;
} VkSparseImageOpaqueMemoryBindInfo;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>image</code> is the <a href="resources.html#VkImage" class="xref page">VkImage</a> object to be bound.</p>
</li>
<li>
<p><code>bindCount</code> is the number of <a href="#VkSparseMemoryBind">VkSparseMemoryBind</a> structures in
the <code>pBinds</code> array.</p>
</li>
<li>
<p><code>pBinds</code> is a pointer to an array of <a href="#VkSparseMemoryBind">VkSparseMemoryBind</a>
structures.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This structure is normally used to bind memory to fully-resident sparse
images or for mip tail regions of partially resident images.
However, it <strong>can</strong> also be used to bind memory for the entire binding range of
partially resident images.</p>
</div>
<div class="paragraph">
<p>If the <code>pBinds</code>[i].flags of an element <em>i</em> of <code>pBinds</code> does not
contain <code>VK_SPARSE_MEMORY_BIND_METADATA_BIT</code>, the <code>resourceOffset</code>
is in the range <span class="eq">[0, <a href="resources.html#VkMemoryRequirements" class="xref page">VkMemoryRequirements</a>::<code>size</code>)</span>, This
range includes data from all aspects of the image, including metadata.
For most implementations this will probably mean that the
<code>resourceOffset</code> is a simple device address offset within the resource.
It is possible for an application to bind a range of memory that includes
both resource data and metadata.
However, the application would not know what part of the image the memory is
used for, or if any range is being used for metadata.</p>
</div>
<div class="paragraph">
<p>If the <code>pBinds</code>[i].flags of an element <em>i</em> of <code>pBinds</code> contains
<code>VK_SPARSE_MEMORY_BIND_METADATA_BIT</code>, the binding range specified <strong>must</strong>
be within the mip tail region of the metadata aspect.
In this case the <code>resourceOffset</code> is not <strong>required</strong> to be a simple device
address offset within the resource.
However, it <em>is</em> defined to be within <span class="eq">[<code>imageMipTailOffset</code>,
<code>imageMipTailOffset</code> +  <code>imageMipTailSize</code>)</span> for the metadata
aspect.
See <a href="#VkSparseMemoryBind">VkSparseMemoryBind</a> for the full constraints on binding region with
this flag present.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSparseImageOpaqueMemoryBindInfo-pBinds-01103" href="#VUID-VkSparseImageOpaqueMemoryBindInfo-pBinds-01103"></a> <span class="vuid">VUID-VkSparseImageOpaqueMemoryBindInfo-pBinds-01103</span><br>

If the <code>flags</code> member of any element of <code>pBinds</code> contains
<code>VK_SPARSE_MEMORY_BIND_METADATA_BIT</code>, the binding range defined
<strong>must</strong> be within the mip tail region of the metadata aspect of
<code>image</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSparseImageOpaqueMemoryBindInfo-image-parameter" href="#VUID-VkSparseImageOpaqueMemoryBindInfo-image-parameter"></a> <span class="vuid">VUID-VkSparseImageOpaqueMemoryBindInfo-image-parameter</span><br>
 <code>image</code> <strong>must</strong> be a valid <a href="resources.html#VkImage" class="xref page">VkImage</a> handle</p>
</li>
<li>
<p><a id="VUID-VkSparseImageOpaqueMemoryBindInfo-pBinds-parameter" href="#VUID-VkSparseImageOpaqueMemoryBindInfo-pBinds-parameter"></a> <span class="vuid">VUID-VkSparseImageOpaqueMemoryBindInfo-pBinds-parameter</span><br>
 <code>pBinds</code> <strong>must</strong> be a valid pointer to an array of <code>bindCount</code> valid <a href="#VkSparseMemoryBind">VkSparseMemoryBind</a> structures</p>
</li>
<li>
<p><a id="VUID-VkSparseImageOpaqueMemoryBindInfo-bindCount-arraylength" href="#VUID-VkSparseImageOpaqueMemoryBindInfo-bindCount-arraylength"></a> <span class="vuid">VUID-VkSparseImageOpaqueMemoryBindInfo-bindCount-arraylength</span><br>
 <code>bindCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Memory <strong>can</strong> be bound to sparse image blocks of <code>VkImage</code> objects created
with the <code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code> flag using the following
structure:</p>
</div>
<div id="VkSparseImageMemoryBindInfo" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkSparseImageMemoryBindInfo {
    VkImage                           image;
    uint32_t                          bindCount;
    const VkSparseImageMemoryBind*    pBinds;
} VkSparseImageMemoryBindInfo;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>image</code> is the <a href="resources.html#VkImage" class="xref page">VkImage</a> object to be bound</p>
</li>
<li>
<p><code>bindCount</code> is the number of <a href="#VkSparseImageMemoryBind">VkSparseImageMemoryBind</a>
structures in <code>pBinds</code> array</p>
</li>
<li>
<p><code>pBinds</code> is a pointer to an array of <a href="#VkSparseImageMemoryBind">VkSparseImageMemoryBind</a>
structures</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSparseImageMemoryBindInfo-subresource-01722" href="#VUID-VkSparseImageMemoryBindInfo-subresource-01722"></a> <span class="vuid">VUID-VkSparseImageMemoryBindInfo-subresource-01722</span><br>

The <code>subresource.mipLevel</code> member of each element of <code>pBinds</code>
<strong>must</strong> be less than the <code>mipLevels</code> specified in
<a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a> when <code>image</code> was created</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBindInfo-subresource-01723" href="#VUID-VkSparseImageMemoryBindInfo-subresource-01723"></a> <span class="vuid">VUID-VkSparseImageMemoryBindInfo-subresource-01723</span><br>

The <code>subresource.arrayLayer</code> member of each element of <code>pBinds</code>
<strong>must</strong> be less than the <code>arrayLayers</code> specified in
<a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a> when <code>image</code> was created</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBindInfo-subresource-01106" href="#VUID-VkSparseImageMemoryBindInfo-subresource-01106"></a> <span class="vuid">VUID-VkSparseImageMemoryBindInfo-subresource-01106</span><br>

The <code>subresource.aspectMask</code> member of each element of <code>pBinds</code>
<strong>must</strong> be valid for the <code>format</code> specified in <a href="resources.html#VkImageCreateInfo" class="xref page">VkImageCreateInfo</a>
when <code>image</code> was created</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBindInfo-image-02901" href="#VUID-VkSparseImageMemoryBindInfo-image-02901"></a> <span class="vuid">VUID-VkSparseImageMemoryBindInfo-image-02901</span><br>

<code>image</code> <strong>must</strong> have been created with
<code>VK_IMAGE_CREATE_SPARSE_RESIDENCY_BIT</code> set</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSparseImageMemoryBindInfo-image-parameter" href="#VUID-VkSparseImageMemoryBindInfo-image-parameter"></a> <span class="vuid">VUID-VkSparseImageMemoryBindInfo-image-parameter</span><br>
 <code>image</code> <strong>must</strong> be a valid <a href="resources.html#VkImage" class="xref page">VkImage</a> handle</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBindInfo-pBinds-parameter" href="#VUID-VkSparseImageMemoryBindInfo-pBinds-parameter"></a> <span class="vuid">VUID-VkSparseImageMemoryBindInfo-pBinds-parameter</span><br>
 <code>pBinds</code> <strong>must</strong> be a valid pointer to an array of <code>bindCount</code> valid <a href="#VkSparseImageMemoryBind">VkSparseImageMemoryBind</a> structures</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBindInfo-bindCount-arraylength" href="#VUID-VkSparseImageMemoryBindInfo-bindCount-arraylength"></a> <span class="vuid">VUID-VkSparseImageMemoryBindInfo-bindCount-arraylength</span><br>
 <code>bindCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkSparseImageMemoryBind</code> structure is defined as:</p>
</div>
<div id="VkSparseImageMemoryBind" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkSparseImageMemoryBind {
    VkImageSubresource         subresource;
    VkOffset3D                 offset;
    VkExtent3D                 extent;
    VkDeviceMemory             memory;
    VkDeviceSize               memoryOffset;
    VkSparseMemoryBindFlags    flags;
} VkSparseImageMemoryBind;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>subresource</code> is the image <em>aspect</em> and region of interest in the
image.</p>
</li>
<li>
<p><code>offset</code> are the coordinates of the first texel within the image
subresource to bind.</p>
</li>
<li>
<p><code>extent</code> is the size in texels of the region within the image
subresource to bind.
The extent <strong>must</strong> be a multiple of the sparse image block dimensions,
except when binding sparse image blocks along the edge of an image
subresource it <strong>can</strong> instead be such that any coordinate of
<span class="eq"><code>offset</code> +  <code>extent</code></span> equals the corresponding
dimensions of the image subresource.</p>
</li>
<li>
<p><code>memory</code> is the <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object that the sparse image
blocks of the image are bound to.
If <code>memory</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the sparse image blocks are
unbound.</p>
</li>
<li>
<p><code>memoryOffset</code> is an offset into <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object.
If <code>memory</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, this value is ignored.</p>
</li>
<li>
<p><code>flags</code> are sparse memory binding flags.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-memory-01104" href="#VUID-VkSparseImageMemoryBind-memory-01104"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-memory-01104</span><br>

If the <a href="features.html#features-sparseResidencyAliased" class="xref page"><code>sparseResidencyAliased</code></a>
feature is not enabled, and if any other resources are bound to ranges
of <code>memory</code>, the range of <code>memory</code> being bound <strong>must</strong> not overlap
with those bound ranges</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-memory-01105" href="#VUID-VkSparseImageMemoryBind-memory-01105"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-memory-01105</span><br>

<code>memory</code> and <code>memoryOffset</code> <strong>must</strong> match the memory requirements
of the calling command&#8217;s <code>image</code>, as described in section
<a href="resources.html#resources-association" class="xref page">Resource Memory Association</a></p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-offset-01107" href="#VUID-VkSparseImageMemoryBind-offset-01107"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-offset-01107</span><br>

<code>offset.x</code> <strong>must</strong> be a multiple of the sparse image block width
(<code>VkSparseImageFormatProperties</code>::<code>imageGranularity.width</code>) of
the image</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-extent-09388" href="#VUID-VkSparseImageMemoryBind-extent-09388"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-extent-09388</span><br>

<code>extent.width</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-extent-01108" href="#VUID-VkSparseImageMemoryBind-extent-01108"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-extent-01108</span><br>

<code>extent.width</code> <strong>must</strong> either be a multiple of the sparse image block
width of the image, or else <span class="eq">(<code>extent.width</code> + 
<code>offset.x</code>)</span> <strong>must</strong> equal the width of the image subresource</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-offset-01109" href="#VUID-VkSparseImageMemoryBind-offset-01109"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-offset-01109</span><br>

<code>offset.y</code> <strong>must</strong> be a multiple of the sparse image block height
(<code>VkSparseImageFormatProperties</code>::<code>imageGranularity.height</code>) of
the image</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-extent-09389" href="#VUID-VkSparseImageMemoryBind-extent-09389"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-extent-09389</span><br>

<code>extent.height</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-extent-01110" href="#VUID-VkSparseImageMemoryBind-extent-01110"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-extent-01110</span><br>

<code>extent.height</code> <strong>must</strong> either be a multiple of the sparse image block
height of the image, or else <span class="eq">(<code>extent.height</code> + 
<code>offset.y</code>)</span> <strong>must</strong> equal the height of the image subresource</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-offset-01111" href="#VUID-VkSparseImageMemoryBind-offset-01111"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-offset-01111</span><br>

<code>offset.z</code> <strong>must</strong> be a multiple of the sparse image block depth
(<code>VkSparseImageFormatProperties</code>::<code>imageGranularity.depth</code>) of
the image</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-extent-09390" href="#VUID-VkSparseImageMemoryBind-extent-09390"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-extent-09390</span><br>

<code>extent.depth</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-extent-01112" href="#VUID-VkSparseImageMemoryBind-extent-01112"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-extent-01112</span><br>

<code>extent.depth</code> <strong>must</strong> either be a multiple of the sparse image block
depth of the image, or else <span class="eq">(<code>extent.depth</code> + 
<code>offset.z</code>)</span> <strong>must</strong> equal the depth of the image subresource</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-memory-02732" href="#VUID-VkSparseImageMemoryBind-memory-02732"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-memory-02732</span><br>

If <code>memory</code> was created with
<a href="memory.html#VkExportMemoryAllocateInfo" class="xref page">VkExportMemoryAllocateInfo</a>::<code>handleTypes</code> not equal to <code>0</code>, at
least one handle type it contained <strong>must</strong> also have been set in
<a href="resources.html#VkExternalMemoryImageCreateInfo" class="xref page">VkExternalMemoryImageCreateInfo</a>::<code>handleTypes</code> when the image
was created</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-memory-02733" href="#VUID-VkSparseImageMemoryBind-memory-02733"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-memory-02733</span><br>

If <code>memory</code> was created by a memory import operation, the external
handle type of the imported memory <strong>must</strong> also have been set in
<a href="resources.html#VkExternalMemoryImageCreateInfo" class="xref page">VkExternalMemoryImageCreateInfo</a>::<code>handleTypes</code> when
<code>image</code> was created</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-subresource-parameter" href="#VUID-VkSparseImageMemoryBind-subresource-parameter"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-subresource-parameter</span><br>
 <code>subresource</code> <strong>must</strong> be a valid <a href="resources.html#VkImageSubresource" class="xref page">VkImageSubresource</a> structure</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-memory-parameter" href="#VUID-VkSparseImageMemoryBind-memory-parameter"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-memory-parameter</span><br>
 If <code>memory</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>memory</code> <strong>must</strong> be a valid <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> handle</p>
</li>
<li>
<p><a id="VUID-VkSparseImageMemoryBind-flags-parameter" href="#VUID-VkSparseImageMemoryBind-flags-parameter"></a> <span class="vuid">VUID-VkSparseImageMemoryBind-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="#VkSparseMemoryBindFlagBits">VkSparseMemoryBindFlagBits</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To submit sparse binding operations to a queue, call:</p>
</div>
<div id="vkQueueBindSparse" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
VkResult vkQueueBindSparse(
    VkQueue                                     queue,
    uint32_t                                    bindInfoCount,
    const VkBindSparseInfo*                     pBindInfo,
    VkFence                                     fence);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>queue</code> is the queue that the sparse binding operations will be
submitted to.</p>
</li>
<li>
<p><code>bindInfoCount</code> is the number of elements in the <code>pBindInfo</code>
array.</p>
</li>
<li>
<p><code>pBindInfo</code> is a pointer to an array of <a href="#VkBindSparseInfo">VkBindSparseInfo</a>
structures, each specifying a sparse binding submission batch.</p>
</li>
<li>
<p><code>fence</code> is an <strong>optional</strong> handle to a fence to be signaled.
If <code>fence</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, it defines a
<a href="synchronization.html#synchronization-fences-signaling" class="xref page">fence signal operation</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>vkQueueBindSparse</code> is a <a href="devsandqueues.html#devsandqueues-submission" class="xref page">queue submission command</a>, with each batch defined by an element of <code>pBindInfo</code> as a
<a href="#VkBindSparseInfo">VkBindSparseInfo</a> structure.
Batches begin execution in the order they appear in <code>pBindInfo</code>, but
<strong>may</strong> complete out of order.</p>
</div>
<div class="paragraph">
<p>Within a batch, a given range of a resource <strong>must</strong> not be bound more than
once.
Across batches, if a range is to be bound to one allocation and offset and
then to another allocation and offset, then the application <strong>must</strong> guarantee
(usually using semaphores) that the binding operations are executed in the
correct order, as well as to order binding operations against the execution
of command buffer submissions.</p>
</div>
<div class="paragraph">
<p>As no operation to <a href="#vkQueueBindSparse">vkQueueBindSparse</a> causes any pipeline stage to
access memory, synchronization primitives used in this command effectively
only define execution dependencies.</p>
</div>
<div class="paragraph">
<p>Additional information about fence and semaphore operation is described in
<a href="synchronization.html#synchronization" class="xref page">the synchronization chapter</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkQueueBindSparse-fence-01113" href="#VUID-vkQueueBindSparse-fence-01113"></a> <span class="vuid">VUID-vkQueueBindSparse-fence-01113</span><br>

If <code>fence</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>fence</code> <strong>must</strong> be
unsignaled</p>
</li>
<li>
<p><a id="VUID-vkQueueBindSparse-fence-01114" href="#VUID-vkQueueBindSparse-fence-01114"></a> <span class="vuid">VUID-vkQueueBindSparse-fence-01114</span><br>

If <code>fence</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>fence</code> <strong>must</strong> not be
associated with any other queue command that has not yet completed
execution on that queue</p>
</li>
<li>
<p><a id="VUID-vkQueueBindSparse-pSignalSemaphores-01115" href="#VUID-vkQueueBindSparse-pSignalSemaphores-01115"></a> <span class="vuid">VUID-vkQueueBindSparse-pSignalSemaphores-01115</span><br>

Each element of the <code>pSignalSemaphores</code> member of each element of
<code>pBindInfo</code> <strong>must</strong> be unsignaled when the semaphore signal operation
it defines is executed on the device</p>
</li>
<li>
<p><a id="VUID-vkQueueBindSparse-pWaitSemaphores-01116" href="#VUID-vkQueueBindSparse-pWaitSemaphores-01116"></a> <span class="vuid">VUID-vkQueueBindSparse-pWaitSemaphores-01116</span><br>

When a semaphore wait operation referring to a binary semaphore defined
by any element of the <code>pWaitSemaphores</code> member of any element of
<code>pBindInfo</code> executes on <code>queue</code>, there <strong>must</strong> be no other queues
waiting on the same semaphore</p>
</li>
<li>
<p><a id="VUID-vkQueueBindSparse-pWaitSemaphores-03245" href="#VUID-vkQueueBindSparse-pWaitSemaphores-03245"></a> <span class="vuid">VUID-vkQueueBindSparse-pWaitSemaphores-03245</span><br>

All elements of the <code>pWaitSemaphores</code> member of all elements of
<code>pBindInfo</code> referring to a semaphore
created with a <a href="synchronization.html#VkSemaphoreType" class="xref page">VkSemaphoreType</a> of <code>VK_SEMAPHORE_TYPE_BINARY</code>
<strong>must</strong> reference a semaphore signal operation that has been submitted for
execution and any <a href="synchronization.html#synchronization-semaphores-signaling" class="xref page">semaphore    signal operations</a> on which it depends <strong>must</strong> have also been submitted
for execution</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkQueueBindSparse-queue-parameter" href="#VUID-vkQueueBindSparse-queue-parameter"></a> <span class="vuid">VUID-vkQueueBindSparse-queue-parameter</span><br>
 <code>queue</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkQueue" class="xref page">VkQueue</a> handle</p>
</li>
<li>
<p><a id="VUID-vkQueueBindSparse-pBindInfo-parameter" href="#VUID-vkQueueBindSparse-pBindInfo-parameter"></a> <span class="vuid">VUID-vkQueueBindSparse-pBindInfo-parameter</span><br>
 If <code>bindInfoCount</code> is not <code>0</code>, <code>pBindInfo</code> <strong>must</strong> be a valid pointer to an array of <code>bindInfoCount</code> valid <a href="#VkBindSparseInfo">VkBindSparseInfo</a> structures</p>
</li>
<li>
<p><a id="VUID-vkQueueBindSparse-fence-parameter" href="#VUID-vkQueueBindSparse-fence-parameter"></a> <span class="vuid">VUID-vkQueueBindSparse-fence-parameter</span><br>
 If <code>fence</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>fence</code> <strong>must</strong> be a valid <a href="synchronization.html#VkFence" class="xref page">VkFence</a> handle</p>
</li>
<li>
<p><a id="VUID-vkQueueBindSparse-queuetype" href="#VUID-vkQueueBindSparse-queuetype"></a> <span class="vuid">VUID-vkQueueBindSparse-queuetype</span><br>
 The <code>queue</code> <strong>must</strong> support sparse binding operations</p>
</li>
<li>
<p><a id="VUID-vkQueueBindSparse-commonparent" href="#VUID-vkQueueBindSparse-commonparent"></a> <span class="vuid">VUID-vkQueueBindSparse-commonparent</span><br>
 Both of <code>fence</code>, and <code>queue</code> that are valid handles of non-ignored parameters <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>queue</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to <code>fence</code> <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPARSE_BINDING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_DEVICE_LOST</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkBindSparseInfo</code> structure is defined as:</p>
</div>
<div id="VkBindSparseInfo" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_0
typedef struct VkBindSparseInfo {
    VkStructureType                             sType;
    const void*                                 pNext;
    uint32_t                                    waitSemaphoreCount;
    const VkSemaphore*                          pWaitSemaphores;
    uint32_t                                    bufferBindCount;
    const VkSparseBufferMemoryBindInfo*         pBufferBinds;
    uint32_t                                    imageOpaqueBindCount;
    const VkSparseImageOpaqueMemoryBindInfo*    pImageOpaqueBinds;
    uint32_t                                    imageBindCount;
    const VkSparseImageMemoryBindInfo*          pImageBinds;
    uint32_t                                    signalSemaphoreCount;
    const VkSemaphore*                          pSignalSemaphores;
} VkBindSparseInfo;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>waitSemaphoreCount</code> is the number of semaphores upon which to wait
before executing the sparse binding operations for the batch.</p>
</li>
<li>
<p><code>pWaitSemaphores</code> is a pointer to an array of semaphores upon which
to wait on before the sparse binding operations for this batch begin
execution.
If semaphores to wait on are provided, they define a
<a href="synchronization.html#synchronization-semaphores-waiting" class="xref page">semaphore wait operation</a>.</p>
</li>
<li>
<p><code>bufferBindCount</code> is the number of sparse buffer bindings to perform
in the batch.</p>
</li>
<li>
<p><code>pBufferBinds</code> is a pointer to an array of
<a href="#VkSparseBufferMemoryBindInfo">VkSparseBufferMemoryBindInfo</a> structures.</p>
</li>
<li>
<p><code>imageOpaqueBindCount</code> is the number of opaque sparse image bindings
to perform.</p>
</li>
<li>
<p><code>pImageOpaqueBinds</code> is a pointer to an array of
<a href="#VkSparseImageOpaqueMemoryBindInfo">VkSparseImageOpaqueMemoryBindInfo</a> structures, indicating opaque
sparse image bindings to perform.</p>
</li>
<li>
<p><code>imageBindCount</code> is the number of sparse image bindings to perform.</p>
</li>
<li>
<p><code>pImageBinds</code> is a pointer to an array of
<a href="#VkSparseImageMemoryBindInfo">VkSparseImageMemoryBindInfo</a> structures, indicating sparse image
bindings to perform.</p>
</li>
<li>
<p><code>signalSemaphoreCount</code> is the number of semaphores to be signaled
once the sparse binding operations specified by the structure have
completed execution.</p>
</li>
<li>
<p><code>pSignalSemaphores</code> is a pointer to an array of semaphores which
will be signaled when the sparse binding operations for this batch have
completed execution.
If semaphores to be signaled are provided, they define a
<a href="synchronization.html#synchronization-semaphores-signaling" class="xref page">semaphore signal operation</a>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkBindSparseInfo-pWaitSemaphores-03246" href="#VUID-VkBindSparseInfo-pWaitSemaphores-03246"></a> <span class="vuid">VUID-VkBindSparseInfo-pWaitSemaphores-03246</span><br>

If any element of <code>pWaitSemaphores</code> or <code>pSignalSemaphores</code> was
created with a <a href="synchronization.html#VkSemaphoreType" class="xref page">VkSemaphoreType</a> of <code>VK_SEMAPHORE_TYPE_TIMELINE</code>
then the <code>pNext</code> chain <strong>must</strong> include a
<a href="cmdbuffers.html#VkTimelineSemaphoreSubmitInfo" class="xref page">VkTimelineSemaphoreSubmitInfo</a> structure</p>
</li>
<li>
<p><a id="VUID-VkBindSparseInfo-pNext-03247" href="#VUID-VkBindSparseInfo-pNext-03247"></a> <span class="vuid">VUID-VkBindSparseInfo-pNext-03247</span><br>

If the <code>pNext</code> chain of this structure includes a
<a href="cmdbuffers.html#VkTimelineSemaphoreSubmitInfo" class="xref page">VkTimelineSemaphoreSubmitInfo</a> structure and any element of
<code>pWaitSemaphores</code> was created with a <a href="synchronization.html#VkSemaphoreType" class="xref page">VkSemaphoreType</a> of
<code>VK_SEMAPHORE_TYPE_TIMELINE</code> then its <code>waitSemaphoreValueCount</code>
member <strong>must</strong> equal <code>waitSemaphoreCount</code></p>
</li>
<li>
<p><a id="VUID-VkBindSparseInfo-pNext-03248" href="#VUID-VkBindSparseInfo-pNext-03248"></a> <span class="vuid">VUID-VkBindSparseInfo-pNext-03248</span><br>

If the <code>pNext</code> chain of this structure includes a
<a href="cmdbuffers.html#VkTimelineSemaphoreSubmitInfo" class="xref page">VkTimelineSemaphoreSubmitInfo</a> structure and any element of
<code>pSignalSemaphores</code> was created with a <a href="synchronization.html#VkSemaphoreType" class="xref page">VkSemaphoreType</a> of
<code>VK_SEMAPHORE_TYPE_TIMELINE</code> then its
<code>signalSemaphoreValueCount</code> member <strong>must</strong> equal
<code>signalSemaphoreCount</code></p>
</li>
<li>
<p><a id="VUID-VkBindSparseInfo-pSignalSemaphores-03249" href="#VUID-VkBindSparseInfo-pSignalSemaphores-03249"></a> <span class="vuid">VUID-VkBindSparseInfo-pSignalSemaphores-03249</span><br>

For each element of <code>pSignalSemaphores</code> created with a
<a href="synchronization.html#VkSemaphoreType" class="xref page">VkSemaphoreType</a> of <code>VK_SEMAPHORE_TYPE_TIMELINE</code> the
corresponding element of
<a href="cmdbuffers.html#VkTimelineSemaphoreSubmitInfo" class="xref page">VkTimelineSemaphoreSubmitInfo</a>::<code>pSignalSemaphoreValues</code> <strong>must</strong>
have a value greater than the current value of the semaphore when the
<a href="synchronization.html#synchronization-semaphores-signaling" class="xref page">semaphore signal operation</a> is
executed</p>
</li>
<li>
<p><a id="VUID-VkBindSparseInfo-pWaitSemaphores-03250" href="#VUID-VkBindSparseInfo-pWaitSemaphores-03250"></a> <span class="vuid">VUID-VkBindSparseInfo-pWaitSemaphores-03250</span><br>

For each element of <code>pWaitSemaphores</code> created with a
<a href="synchronization.html#VkSemaphoreType" class="xref page">VkSemaphoreType</a> of <code>VK_SEMAPHORE_TYPE_TIMELINE</code> the
corresponding element of
<a href="cmdbuffers.html#VkTimelineSemaphoreSubmitInfo" class="xref page">VkTimelineSemaphoreSubmitInfo</a>::<code>pWaitSemaphoreValues</code> <strong>must</strong>
have a value which does not differ from the current value of the
semaphore or from the value of any outstanding semaphore wait or signal
operation on that semaphore by more than
<a href="devsandqueues.html#limits-maxTimelineSemaphoreValueDifference" class="xref page">    <code>maxTimelineSemaphoreValueDifference</code></a></p>
</li>
<li>
<p><a id="VUID-VkBindSparseInfo-pSignalSemaphores-03251" href="#VUID-VkBindSparseInfo-pSignalSemaphores-03251"></a> <span class="vuid">VUID-VkBindSparseInfo-pSignalSemaphores-03251</span><br>

For each element of <code>pSignalSemaphores</code> created with a
<a href="synchronization.html#VkSemaphoreType" class="xref page">VkSemaphoreType</a> of <code>VK_SEMAPHORE_TYPE_TIMELINE</code> the
corresponding element of
<a href="cmdbuffers.html#VkTimelineSemaphoreSubmitInfo" class="xref page">VkTimelineSemaphoreSubmitInfo</a>::<code>pSignalSemaphoreValues</code> <strong>must</strong>
have a value which does not differ from the current value of the
semaphore or from the value of any outstanding semaphore wait or signal
operation on that semaphore by more than
<a href="devsandqueues.html#limits-maxTimelineSemaphoreValueDifference" class="xref page">    <code>maxTimelineSemaphoreValueDifference</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkBindSparseInfo-sType-sType" href="#VUID-VkBindSparseInfo-sType-sType"></a> <span class="vuid">VUID-VkBindSparseInfo-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_BIND_SPARSE_INFO</code></p>
</li>
<li>
<p><a id="VUID-VkBindSparseInfo-pNext-pNext" href="#VUID-VkBindSparseInfo-pNext-pNext"></a> <span class="vuid">VUID-VkBindSparseInfo-pNext-pNext</span><br>
 Each <code>pNext</code> member of any structure (including this one) in the <code>pNext</code> chain <strong>must</strong> be either <code>NULL</code> or a pointer to a valid instance of <a href="#VkDeviceGroupBindSparseInfo">VkDeviceGroupBindSparseInfo</a>, <a href="debugging.html#VkFrameBoundaryEXT" class="xref page">VkFrameBoundaryEXT</a>, or <a href="cmdbuffers.html#VkTimelineSemaphoreSubmitInfo" class="xref page">VkTimelineSemaphoreSubmitInfo</a></p>
</li>
<li>
<p><a id="VUID-VkBindSparseInfo-sType-unique" href="#VUID-VkBindSparseInfo-sType-unique"></a> <span class="vuid">VUID-VkBindSparseInfo-sType-unique</span><br>
 The <code>sType</code> value of each struct in the <code>pNext</code> chain <strong>must</strong> be unique</p>
</li>
<li>
<p><a id="VUID-VkBindSparseInfo-pWaitSemaphores-parameter" href="#VUID-VkBindSparseInfo-pWaitSemaphores-parameter"></a> <span class="vuid">VUID-VkBindSparseInfo-pWaitSemaphores-parameter</span><br>
 If <code>waitSemaphoreCount</code> is not <code>0</code>, <code>pWaitSemaphores</code> <strong>must</strong> be a valid pointer to an array of <code>waitSemaphoreCount</code> valid <a href="synchronization.html#VkSemaphore" class="xref page">VkSemaphore</a> handles</p>
</li>
<li>
<p><a id="VUID-VkBindSparseInfo-pBufferBinds-parameter" href="#VUID-VkBindSparseInfo-pBufferBinds-parameter"></a> <span class="vuid">VUID-VkBindSparseInfo-pBufferBinds-parameter</span><br>
 If <code>bufferBindCount</code> is not <code>0</code>, <code>pBufferBinds</code> <strong>must</strong> be a valid pointer to an array of <code>bufferBindCount</code> valid <a href="#VkSparseBufferMemoryBindInfo">VkSparseBufferMemoryBindInfo</a> structures</p>
</li>
<li>
<p><a id="VUID-VkBindSparseInfo-pImageOpaqueBinds-parameter" href="#VUID-VkBindSparseInfo-pImageOpaqueBinds-parameter"></a> <span class="vuid">VUID-VkBindSparseInfo-pImageOpaqueBinds-parameter</span><br>
 If <code>imageOpaqueBindCount</code> is not <code>0</code>, <code>pImageOpaqueBinds</code> <strong>must</strong> be a valid pointer to an array of <code>imageOpaqueBindCount</code> valid <a href="#VkSparseImageOpaqueMemoryBindInfo">VkSparseImageOpaqueMemoryBindInfo</a> structures</p>
</li>
<li>
<p><a id="VUID-VkBindSparseInfo-pImageBinds-parameter" href="#VUID-VkBindSparseInfo-pImageBinds-parameter"></a> <span class="vuid">VUID-VkBindSparseInfo-pImageBinds-parameter</span><br>
 If <code>imageBindCount</code> is not <code>0</code>, <code>pImageBinds</code> <strong>must</strong> be a valid pointer to an array of <code>imageBindCount</code> valid <a href="#VkSparseImageMemoryBindInfo">VkSparseImageMemoryBindInfo</a> structures</p>
</li>
<li>
<p><a id="VUID-VkBindSparseInfo-pSignalSemaphores-parameter" href="#VUID-VkBindSparseInfo-pSignalSemaphores-parameter"></a> <span class="vuid">VUID-VkBindSparseInfo-pSignalSemaphores-parameter</span><br>
 If <code>signalSemaphoreCount</code> is not <code>0</code>, <code>pSignalSemaphores</code> <strong>must</strong> be a valid pointer to an array of <code>signalSemaphoreCount</code> valid <a href="synchronization.html#VkSemaphore" class="xref page">VkSemaphore</a> handles</p>
</li>
<li>
<p><a id="VUID-VkBindSparseInfo-commonparent" href="#VUID-VkBindSparseInfo-commonparent"></a> <span class="vuid">VUID-VkBindSparseInfo-commonparent</span><br>
 Both of the elements of <code>pSignalSemaphores</code>, and the elements of <code>pWaitSemaphores</code> that are valid handles of non-ignored parameters <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To specify the values to use when waiting for and signaling semaphores
created with a <a href="synchronization.html#VkSemaphoreType" class="xref page">VkSemaphoreType</a> of <code>VK_SEMAPHORE_TYPE_TIMELINE</code>,
add a <a href="cmdbuffers.html#VkTimelineSemaphoreSubmitInfo" class="xref page">VkTimelineSemaphoreSubmitInfo</a> structure to the <code>pNext</code> chain
of the <a href="#VkBindSparseInfo">VkBindSparseInfo</a> structure.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If the <code>pNext</code> chain of <a href="#VkBindSparseInfo">VkBindSparseInfo</a> includes a
<code>VkDeviceGroupBindSparseInfo</code> structure, then that structure includes
device indices specifying which instance of the resources and memory are
bound.</p>
</div>
<div class="paragraph">
<p>The <code>VkDeviceGroupBindSparseInfo</code> structure is defined as:</p>
</div>
<div id="VkDeviceGroupBindSparseInfo" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_VERSION_1_1
typedef struct VkDeviceGroupBindSparseInfo {
    VkStructureType    sType;
    const void*        pNext;
    uint32_t           resourceDeviceIndex;
    uint32_t           memoryDeviceIndex;
} VkDeviceGroupBindSparseInfo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkDeviceGroupBindSparseInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_device_group
typedef VkDeviceGroupBindSparseInfo VkDeviceGroupBindSparseInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>resourceDeviceIndex</code> is a device index indicating which instance of
the resource is bound.</p>
</li>
<li>
<p><code>memoryDeviceIndex</code> is a device index indicating which instance of
the memory the resource instance is bound to.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These device indices apply to all buffer and image memory binds included in
the batch pointing to this structure.
The semaphore waits and signals for the batch are executed only by the
physical device specified by the <code>resourceDeviceIndex</code>.</p>
</div>
<div class="paragraph">
<p>If this structure is not present, <code>resourceDeviceIndex</code> and
<code>memoryDeviceIndex</code> are assumed to be zero.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkDeviceGroupBindSparseInfo-resourceDeviceIndex-01118" href="#VUID-VkDeviceGroupBindSparseInfo-resourceDeviceIndex-01118"></a> <span class="vuid">VUID-VkDeviceGroupBindSparseInfo-resourceDeviceIndex-01118</span><br>

<code>resourceDeviceIndex</code> and <code>memoryDeviceIndex</code> <strong>must</strong> both be
valid device indices</p>
</li>
<li>
<p><a id="VUID-VkDeviceGroupBindSparseInfo-memoryDeviceIndex-01119" href="#VUID-VkDeviceGroupBindSparseInfo-memoryDeviceIndex-01119"></a> <span class="vuid">VUID-VkDeviceGroupBindSparseInfo-memoryDeviceIndex-01119</span><br>

Each memory allocation bound in this batch <strong>must</strong> have allocated an
instance for <code>memoryDeviceIndex</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkDeviceGroupBindSparseInfo-sType-sType" href="#VUID-VkDeviceGroupBindSparseInfo-sType-sType"></a> <span class="vuid">VUID-VkDeviceGroupBindSparseInfo-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_DEVICE_GROUP_BIND_SPARSE_INFO</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
