<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Acceleration Structures :: Vulkan Documentation Project</title>
    <meta name="generator" content="Antora 3.1.10">
    <script>
      !function (theme) {
        if (theme === 'dark') document.documentElement.classList.add('dark')
        else document.documentElement.classList.add('light')
      }(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)')?.matches && 'dark'))
    </script>
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../_/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../_/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../_/img/favicon-16x16.png">
    <link rel="manifest" href="../../../_/static/site.webmanifest">
    <link rel="mask-icon" href="../../../_/img/safari-pinned-tab.svg" color="#a41e22">
    <meta name="msapplication-TileColor" content="#ffc40d">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../.."><img class="navbar-item" alt="Vulkan White Label" src="../../../_/Vulkan_Docs.svg" /></a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field has-filter">
          <label for="search-input"></label>
          <input id="search-input" type="text" placeholder="Search the docs">
          <label class="filter checkbox">
            <input type="checkbox" data-facet-filter="component:spec" checked> In this component
          </label>
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../spec/latest/chapters/introduction.html">Vulkan API</a>
            <a class="navbar-item" href="../../../glsl/latest/index.html">GLSL</a>
            <a class="navbar-item" href="../../../guide/latest/hlsl.html">HLSL</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Education</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../features/latest/features/index.html">Vulkan Feature Descriptions</a>
            <a class="navbar-item" href="../../../guide/latest/index.html">Vulkan Guide</a>
            <a class="navbar-item" href="../../../samples/latest/README.html">Vulkan Samples</a>
            <a class="navbar-item" href="../../../tutorial/latest/index.html">Vulkan Tutorial</a>
            <a class="navbar-item" href="https://www.youtube.com/c/vulkan">YouTube</a>
            <a class="navbar-item" href="https://vulkan.org">More Info at Vulkan.org</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Feedback</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://github.com/KhronosGroup/Vulkan-Site/issues/new/choose" target="_blank">Report a Problem</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://reddit.com/r/vulkan">Reddit</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/vulkan">Stack Overflow</a>
            <a class="navbar-item" href="https://fosstodon.org/@vulkan">Mastodon</a>
          </div>
        </div>
      </div>
    </div>
    <label class="theme-toggler">
      <input type="checkbox" id="switch-theme-checkbox" name="switch-theme-checkbox"/>
      <span class="icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="moon" class="svg-inline--fa fa-moon moon" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"></path>
        </svg>
        <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="sun" class="svg-inline--fa fa-sun sun" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"></path>
        </svg></span>
    </label>
  </nav>
</header>
<script>
  window.onload = function() {
    let e = document.getElementById("switch-theme-checkbox")
    e.checked = document.documentElement.classList.contains("dark");
    e.checked ? e.parentElement.classList.add("active") : e.parentElement.classList.remove("active")
  }
  !function() {
    let e = document.getElementById("switch-theme-checkbox")
    e.checked = document.documentElement.classList.contains("dark")
    e.addEventListener("change", function() {
      if (document.documentElement.classList.contains("light")) {
        document.documentElement.classList.remove("light")
        document.documentElement.classList.add("dark")
      } else if (document.documentElement.classList.contains("dark")) {
        document.documentElement.classList.remove("dark")
        document.documentElement.classList.add("light")
      } else {
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          document.documentElement.classList.add("dark")
        } else {
          document.documentElement.classList.add("light")
        }
      }
      document.documentElement.setAttribute("data-theme", this.checked ? "dark" : "light"),
        function(e) {
          window.localStorage && window.localStorage.setItem("theme", e)
        }(this.checked ? "dark" : "light"), this.checked ? this.parentElement.classList.add("active") : this.parentElement.classList.remove("active")
    }.bind(e))
  }();
</script>
<div class="body">
<div class="nav-container" data-component="spec" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Vulkan Specification</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fundamentals.html">Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="initialization.html">Initialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="devsandqueues.html">Devices and Queues</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cmdbuffers.html">Command Buffers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="synchronization.html">Synchronization and Cache Control</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="renderpass.html">Render Pass</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="shaders.html">Shaders</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pipelines.html">Pipelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="memory.html">Memory Allocation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="resources.html">Resource Creation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="samplers.html">Samplers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="descriptorsets.html">Resource Descriptors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="interfaces.html">Shader Interfaces</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="textures.html">Image Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fragmentdensitymapops.html">Fragment Density Map Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="queries.html">Queries</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="clears.html">Clear Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="copies.html">Copy Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="drawing.html">Drawing Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fxvertex.html">Fixed-Function Vertex Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tessellation.html">Tessellation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="geometry.html">Geometry Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_mesh_shader/mesh.html">Mesh Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_HUAWEI_cluster_culling_shader/clusterculling.html">Cluster Culling Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="vertexpostproc.html">Fixed-Function Vertex Post-Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="primsrast.html">Rasterization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fragops.html">Fragment Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="framebuffer.html">The Framebuffer</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="dispatch.html">Dispatching Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="device_generated_commands/generatedcommands.html">Device-Generated Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="sparsemem.html">Sparse Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_KHR_surface/wsi.html">Window System Integration (WSI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_KHR_deferred_host_operations/deferred_host_operations.html">Deferred Host Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_EXT_private_data.html">Private Data</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="accelstructures.html">Acceleration Structures</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_EXT_opacity_micromap/micromaps.html">Micromap</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="raytraversal.html">Ray Traversal</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="raytracing.html">Ray Tracing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_memory_decompression.html">Memory Decompression</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="videocoding.html">Video Coding</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_optical_flow/optical_flow.html">Optical Flow</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="executiongraphs.html">Execution Graphs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extensions.html">Extending Vulkan</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="limits.html">Limits</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="formats.html">Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="capabilities.html">Additional Capabilities</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="debugging.html">Debugging</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/spirvenv.html">Vulkan Environment for SPIR-V</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/memorymodel.html">Memory Model</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/compressedtex.html">Compressed Image Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/versions.html">Core Revisions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/extensions.html">Layers &amp; Extensions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/roadmap.html">Vulkan Roadmap Milestones</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/boilerplate.html">API Boilerplate</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/invariance.html">Invariance</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/glossary.html">Lexicon</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/credits.html">Credits (Informative)</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Vulkan Specification</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../tutorial/latest/00_Introduction.html">Khronos Vulkan Tutorial</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tutorial/latest/00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../glsl/latest/index.html">OpenGL Shading Language Specification</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../glsl/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../features/latest/features/index.html">Vulkan Feature Descriptions</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../features/latest/features/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../guide/latest/index.html">Vulkan Guide</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../samples/latest/README.html">Vulkan Samples</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/latest/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../index.html">Vulkan Specification</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Vulkan Specification</a></li>
    <li><a href="accelstructures.html">Acceleration Structures</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Acceleration Structures</h1>
<div class="sect1">
<h2 id="acceleration-structure-def"><a class="anchor" href="#acceleration-structure-def"></a>Acceleration Structures</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Acceleration structures</em> are data structures used by the implementation to
efficiently manage scene geometry as it is <a href="raytraversal.html#ray-traversal" class="xref page">traversed during a ray tracing query</a>.
The application is responsible for managing acceleration structure objects
(see <a href="resources.html#resources-acceleration-structures" class="xref page">Acceleration Structures</a>),
including allocation, destruction, executing builds or updates, and
synchronizing resources used during ray tracing queries.</p>
</div>
<div class="paragraph">
<p>There are two types of acceleration structures, <em>top level acceleration
structures</em> and <em>bottom level acceleration structures</em>.</p>
</div>
<div class="paragraph">
<p>An acceleration structure is considered to be constructed if an
<a href="#acceleration-structure-building">acceleration structure build command</a> or
<a href="#acceleration-structure-copying">copy command</a> has been executed with the
given acceleration structure as the destination.</p>
</div>
<div id="fig-accelstruct" class="imageblock text-center">
<div class="content">
<img src="../_images/accelstruct.svg" alt="accelstruct">
</div>
<div class="title">Figure 1. Acceleration Structure</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Caption</div>
<div class="paragraph">
<p>The diagram shows the relationship between top and bottom level acceleration
structures.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-geometry"><a class="anchor" href="#acceleration-structure-geometry"></a>Geometry</h3>
<div class="paragraph">
<p><em>Geometries</em> refer to a triangle,
sphere, linear swept sphere (LSS),
or axis-aligned bounding box.</p>
</div>
<div id="ray-tracing-triangle-primitive" class="paragraph">
<p>A triangle is a fundamental geometric primitive defined by three vertices in
3D space, forming a flat, planar surface.</p>
</div>
<div id="aabb-primitive" class="paragraph">
<p>An axis-aligned bounding box (AABB) is a rectangular box defined by two
points (minimum and maximum corners) that encloses a 3D object or scene.
Its faces are aligned with the coordinate axes, making intersection tests
efficient for spatial partitioning and acceleration structures.</p>
</div>
<div id="sphere-primitive" class="paragraph">
<p>A sphere primitive is defined by a position and a radius.</p>
</div>
<div id="linear-swept-sphere-primitive" class="paragraph">
<p>The linear swept sphere (LSS) primitive is comprised of two sphere endcaps
and a truncated cone midsection.
The midsection is constructed so that it tangentially intersects with the
endcaps.
Two points, <span class="eq">P<sub>0</sub></span> and <span class="eq">P<sub>1</sub></span>, and two radii, <span class="eq">r<sub>0</sub></span> and
<span class="eq">r<sub>1</sub></span>, fully describe the primitive.</p>
</div>
<div class="paragraph">
<p>The following figure shows an example of the LSS primitive composed of two
sphere endcaps connected by a midsection.
The solid non-dotted outline indicates the intersectable portion of the
primitive.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/lss_primitive.svg" alt="lss primitive">
</div>
<div class="title">Figure 2. LSS primitive</div>
</div>
<div class="paragraph">
<p>Endcaps on LSS primitives are optional and are controlled by
<a href="#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>endCapsMode</code>.
The following figure shows an example of the LSS primitive without the
endcaps with only the midsection present.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/lss_primitive_no_endcaps.svg" alt="lss primitive no endcaps">
</div>
<div class="title">Figure 3. LSS primitive with no endcaps</div>
</div>
<div class="paragraph">
<p>A LSS geometry can be defined in multiple ways.
If only the vertex and radius data are specified in
<a href="#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a> without
specifying the index data, LSS primitives are drawn in pairs of vertices.
Each primitive <span class="eq">i</span> is defined by entries <span class="eq">(i × 2, i × 2
+  1)</span> in the vertex and radius buffers.
For example, if a vertex buffer contains vertices <span class="eq">A, B, C, D, E, F and
G</span>, (assuming each character represents a position vector) with
corresponding radii as <span class="eq">rA, rB, rC, rD, rE, rF and rG</span> respectively, the
LSS primitives drawn will be as shown below with <span class="eq">G</span> skipped because it
does not have a corresponding vertex pair.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/lssWithVertexBuffers.svg" alt="lssWithVertexBuffers">
</div>
<div class="title">Figure 4. Lss primitives drawn with only vertex data</div>
</div>
<div class="paragraph">
<p>LSS primitives <strong>can</strong> be chained together by specifying an index buffer and
indexing mode in the
<a href="#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a> structure.</p>
</div>
<div class="paragraph">
<p>If the <a href="#VkRayTracingLssIndexingModeNV">VkRayTracingLssIndexingModeNV</a>::<code>indexingMode</code> is set to
<code>VK_RAY_TRACING_LSS_INDEXING_MODE_LIST_NV</code>, then the consecutive pair of
indices in the index buffer select the vertices that define the LSS chain.
For example, assuming the same vertex buffer as before, if the index buffer
contains indices <span class="eq">[6, 5, 5, 4, 4, 3, 2, 1]</span>, the LSS primitives will be
chained as shown:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/lssWithListIndexingMode.svg" alt="lssWithListIndexingMode">
</div>
<div class="title">Figure 5. Lss primitives drawn with VK_RAY_TRACING_LSS_INDEXING_MODE_LIST_NV indexing mode</div>
</div>
<div class="paragraph">
<p>Note that due to the lack of a <span class="eq">[3, 2]</span> pair, there is a break in the
chain and <span class="eq">D</span> is not connected to <span class="eq">C</span>.</p>
</div>
<div class="paragraph">
<p>If the <a href="#VkRayTracingLssIndexingModeNV">VkRayTracingLssIndexingModeNV</a>::<code>indexingMode</code> is set to
<code>VK_RAY_TRACING_LSS_INDEXING_MODE_SUCCESSIVE_NV</code>, then each LSS
primitive is defined by two successive positions and radii, <span class="eq">(k, k<br>
1)</span>, where <span class="eq">k</span> is a single index in the index buffer.
For example, if the index buffer contains indices <span class="eq">[0, 1, 2, 4]</span>, the
LSS primitives will be chained as shown below.
Note that due to the absence of index 3 in the index buffer, there is a
break in the chain and D is not connected to E.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/lssWithSuccessiveIndexingMode.svg" alt="lssWithSuccessiveIndexingMode">
</div>
<div class="title">Figure 6. Lss primitives drawn with VK_RAY_TRACING_LSS_INDEXING_MODE_SUCCESSIVE_NV indexing mode</div>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-top-level"><a class="anchor" href="#acceleration-structure-top-level"></a>Top Level Acceleration Structures</h3>
<div class="paragraph">
<p>Opaque acceleration structure for an array of instances.
The descriptor or device address referencing this is the starting point for
traversal.</p>
</div>
<div class="paragraph">
<p>The top level acceleration structure takes a reference to any bottom level
acceleration structure referenced by its instances.
Those bottom level acceleration structure objects <strong>must</strong> be valid when the
top level acceleration structure is accessed.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-bottom-level"><a class="anchor" href="#acceleration-structure-bottom-level"></a>Bottom Level Acceleration Structures</h3>
<div class="paragraph">
<p>Opaque acceleration structure for an array of geometries.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-update"><a class="anchor" href="#acceleration-structure-update"></a>Acceleration Structure Update Rules</h3>
<div class="paragraph">
<p>The API defines two types of operations to produce acceleration structures
from geometry:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>build</em> operation is used to construct an acceleration structure.</p>
</li>
<li>
<p>An <em>update</em> operation is used to modify an existing acceleration
structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An update operation imposes certain constraints on the input, in exchange
for considerably faster execution.
When performing an update, the application is required to provide a full
description of the acceleration structure, but is prohibited from changing
anything other than instance definitions, transform matrices, and vertex or
AABB positions.
All other aspects of the description <strong>must</strong> exactly match the one from the
original build.</p>
</div>
<div class="paragraph">
<p>More precisely, the application <strong>must</strong> not use an update operation to do any
of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change primitives or instances from <em>active</em> to <em>inactive</em>, or vice
versa (as defined in <a href="#acceleration-structure-inactive-prims">Inactive Primitives and Instances</a>).</p>
</li>
<li>
<p>Change the index or vertex formats of triangle geometry.</p>
</li>
<li>
<p>Change triangle geometry transform pointers from null to non-null or
vice versa.</p>
</li>
<li>
<p>Change the number of geometries or instances in the structure.</p>
</li>
<li>
<p>Change the geometry flags for any geometry in the structure.</p>
</li>
<li>
<p>Change the number of vertices or primitives for any geometry in the
structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using opacity micromaps and
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_DATA_UPDATE_EXT</code>
was set in <code>flags</code>, the application <strong>must</strong> provide a micromap matching
the original micromap in structure with only opacity values updated.
The application is prohibited from changing anything other than the specific
opacity values assigned to the triangles.</p>
</div>
<div class="paragraph">
<p>More precisely, the application <strong>must</strong> not use an update operation to do any
of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove micromaps or <a href="#VkOpacityMicromapSpecialIndexEXT">VkOpacityMicromapSpecialIndexEXT</a> values from a
geometry which previously had them, or vice versa.</p>
</li>
<li>
<p>Change between use of <a href="#VkOpacityMicromapSpecialIndexEXT">VkOpacityMicromapSpecialIndexEXT</a> values and
explicit micro-map triangles.</p>
</li>
<li>
<p>Change the subdivision level or format of the micromap triangle
associated with any acceleration-structure triangle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using opacity micromaps and
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_UPDATE_EXT</code> was
set in <code>flags</code>, the application <strong>must</strong> provide a micromap to the update
operation.</p>
</div>
<div class="paragraph">
<p>If <a href="resources.html#VkMicromapBuildSizesInfoEXT" class="xref page">VkMicromapBuildSizesInfoEXT</a>::<code>discardable</code> is <code>VK_FALSE</code>, a
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_DATA_UPDATE_EXT</code>
or <code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_UPDATE_EXT</code>
operation transfers the reference in the acceleration structure to the new
micromap.</p>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using opacity micromaps and
neither opacity micromap update flag is set the application <strong>must</strong> provide
the original micromap to the update operation.</p>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using displacement
micromaps and
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_DISPLACEMENT_MICROMAP_UPDATE_NV</code>
was set in <code>flags</code>, the application <strong>must</strong> provide a displacement
micromap to the update operation.</p>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using displacement
micromaps and the displacement micromap update flag is not set the
application <strong>must</strong> provide the original micromap to the update operation.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-inactive-prims"><a class="anchor" href="#acceleration-structure-inactive-prims"></a>Inactive Primitives and Instances</h3>
<div class="paragraph">
<p>Acceleration structures allow the use of particular input values to signal
<em>inactive</em> primitives or instances.</p>
</div>
<div class="paragraph">
<p>An <em>inactive</em> triangle is one for which the first (X) component of any
vertex is NaN.
If any other vertex component is NaN, and the first is not, the behavior is
<strong>undefined</strong>.
If the vertex format does not have a NaN representation, then all triangles
are considered active.</p>
</div>
<div class="paragraph">
<p>An <em>inactive</em> instance is one whose acceleration structure reference is <code>0</code>.</p>
</div>
<div class="paragraph">
<p>An <em>inactive</em> AABB is one for which the minimum X coordinate is NaN.
If any other component is NaN, and the first is not, the behavior is
<strong>undefined</strong>.</p>
</div>
<div class="paragraph">
<p>An <em>inactive</em> LSS or sphere is one where any of the radius or position
component is NaN.</p>
</div>
<div class="paragraph">
<p>In the above definitions, &#8220;NaN&#8221; refers to any type of NaN.
Signaling, non-signaling, quiet, loud, or otherwise.</p>
</div>
<div class="paragraph">
<p>An inactive object is considered invisible to all rays, and <strong>should</strong> not be
represented in the acceleration structure.
Implementations <strong>should</strong> ensure that the presence of inactive objects does
not seriously degrade traversal performance.</p>
</div>
<div class="paragraph">
<p>Inactive objects are counted in the auto-generated index sequences which are
provided to shaders via <code>InstanceId</code> and <code>PrimitiveId</code> SPIR-V
decorations.
This allows objects in the scene to change freely between the active and
inactive states, without affecting the layout of any arrays which are being
indexed using the ID values.</p>
</div>
<div class="paragraph">
<p>Any transition between the active and inactive states requires a full
acceleration structure rebuild.
Applications <strong>must</strong> not perform an acceleration structure update where an
object is active in the source acceleration structure but would be inactive
in the destination, or vice versa.</p>
</div>
<div class="paragraph">
<p>The active/inactive state of primitives <strong>must</strong> not be changed with
acceleration structure updates.
For chained LSS, using the
<code>VK_RAY_TRACING_LSS_PRIMITIVE_END_CAPS_MODE_CHAINED_NV</code> mode, entire
chains <strong>must</strong> be either active or inactive.
If any chain contains both active and inactive primitives, the behavior is
<strong>undefined</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-degenerate-prims"><a class="anchor" href="#acceleration-structure-degenerate-prims"></a>Degenerate Primitives and Instances</h3>
<div class="paragraph">
<p><em>Degenerate</em> primitives and instances behave differently to
<a href="#acceleration-structure-inactive-prims">inactive primitives and instances</a>,
and are defined as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>triangles that have one or more vertices whose respective (X), (Y), (Z)
components are identical, or have three vertices that have at least two
of the (X), (Y), or (Z) components identical, therefore forming a line
or point.
Degenerate triangles do not generate any intersections.</p>
</li>
<li>
<p>AABBs whose <code>minX</code>=<code>maxX</code>, <code>minY</code>=<code>maxY</code>, and
<code>minZ</code>=<code>maxZ</code>.
Degenerate AABBs <strong>may</strong> invoke the intersection shader.</p>
</li>
<li>
<p>LSS primitives where both the radii are set to <code>0</code>.</p>
</li>
<li>
<p>sphere primitives whose radius is set to <code>0</code>.</p>
</li>
<li>
<p>instances that reference bottom level acceleration structures that
contain no active primitives.
When building an acceleration structure, implementations <strong>should</strong> treat
degenerate instances as though they are a point at the instance origin,
specified by <a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>transform</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unlike <em>inactive</em> primitives and instances, <em>degenerate</em> primitives and
instances <strong>may</strong> transition from the degenerate to the non-degenerate state,
or vice versa, when performing an acceleration structure update.</p>
</div>
<div class="paragraph">
<p>If an acceleration structure is built without
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_KHR</code> set in
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a>::<code>flags</code>
or
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code>
, degenerate primitives <strong>may</strong> be discarded.
Primitives that are defined with the same index value for more than one
vertex <strong>can</strong> always be discarded.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-building"><a class="anchor" href="#acceleration-structure-building"></a>Building Acceleration Structures</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build an acceleration structure call:</p>
</div>
<div id="vkCmdBuildAccelerationStructureNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
void vkCmdBuildAccelerationStructureNV(
    VkCommandBuffer                             commandBuffer,
    const VkAccelerationStructureInfoNV*        pInfo,
    VkBuffer                                    instanceData,
    VkDeviceSize                                instanceOffset,
    VkBool32                                    update,
    VkAccelerationStructureNV                   dst,
    VkAccelerationStructureNV                   src,
    VkBuffer                                    scratch,
    VkDeviceSize                                scratchOffset);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> contains the shared information for the acceleration
structure&#8217;s structure.</p>
</li>
<li>
<p><code>instanceData</code> is the buffer containing an array of
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a> structures defining
acceleration structures.
This parameter <strong>must</strong> be <code>NULL</code> for bottom level acceleration structures.</p>
</li>
<li>
<p><code>instanceOffset</code> is the offset in bytes (relative to the start of
<code>instanceData</code>) at which the instance data is located.</p>
</li>
<li>
<p><code>update</code> specifies whether to update the <code>dst</code> acceleration
structure with the data in <code>src</code>.</p>
</li>
<li>
<p><code>dst</code> is a pointer to the target acceleration structure for the
build.</p>
</li>
<li>
<p><code>src</code> is a pointer to an existing acceleration structure that is to
be used to update the <code>dst</code> acceleration structure.</p>
</li>
<li>
<p><code>scratch</code> is the <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> that will be used as scratch memory
for the build.</p>
</li>
<li>
<p><code>scratchOffset</code> is the offset in bytes relative to the start of
<code>scratch</code> that will be used as a scratch memory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>dst</code>, <code>src</code>, and <code>scratch</code> <strong>must</strong> be
<a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> or
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-geometryCount-02241" href="#VUID-vkCmdBuildAccelerationStructureNV-geometryCount-02241"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-geometryCount-02241</span><br>

<code>geometryCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceRayTracingPropertiesNV" class="xref page">VkPhysicalDeviceRayTracingPropertiesNV</a>::<code>maxGeometryCount</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-dst-02488" href="#VUID-vkCmdBuildAccelerationStructureNV-dst-02488"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-dst-02488</span><br>

<code>dst</code> <strong>must</strong> have been created with compatible
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a> where
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a>::<code>type</code> and
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a>::<code>flags</code> are identical,
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a>::<code>instanceCount</code> and
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a>::<code>geometryCount</code> for <code>dst</code>
are greater than or equal to the build size and each geometry in
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a>::<code>pGeometries</code> for <code>dst</code> has
greater than or equal to the number of vertices, indices, and AABBs</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-02489" href="#VUID-vkCmdBuildAccelerationStructureNV-update-02489"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-02489</span><br>

If <code>update</code> is <code>VK_TRUE</code>, <code>src</code> <strong>must</strong> not be
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-02490" href="#VUID-vkCmdBuildAccelerationStructureNV-update-02490"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-02490</span><br>

If <code>update</code> is <code>VK_TRUE</code>, <code>src</code> <strong>must</strong> have previously been
constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_NV</code> set in
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a>::<code>flags</code> in the original build</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-02491" href="#VUID-vkCmdBuildAccelerationStructureNV-update-02491"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-02491</span><br>

If <code>update</code> is <code>VK_FALSE</code>, the <code>size</code> member of the
<a href="resources.html#VkMemoryRequirements" class="xref page">VkMemoryRequirements</a> structure returned from a call to
<a href="resources.html#vkGetAccelerationStructureMemoryRequirementsNV" class="xref page">vkGetAccelerationStructureMemoryRequirementsNV</a> with
<a href="resources.html#VkAccelerationStructureMemoryRequirementsInfoNV" class="xref page">VkAccelerationStructureMemoryRequirementsInfoNV</a>::<code>accelerationStructure</code>
set to <code>dst</code> and
<a href="resources.html#VkAccelerationStructureMemoryRequirementsInfoNV" class="xref page">VkAccelerationStructureMemoryRequirementsInfoNV</a>::<code>type</code> set to
<code>VK_ACCELERATION_STRUCTURE_MEMORY_REQUIREMENTS_TYPE_BUILD_SCRATCH_NV</code>
<strong>must</strong> be less than or equal to the size of <code>scratch</code> minus
<code>scratchOffset</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-02492" href="#VUID-vkCmdBuildAccelerationStructureNV-update-02492"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-02492</span><br>

If <code>update</code> is <code>VK_TRUE</code>, the <code>size</code> member of the
<a href="resources.html#VkMemoryRequirements" class="xref page">VkMemoryRequirements</a> structure returned from a call to
<a href="resources.html#vkGetAccelerationStructureMemoryRequirementsNV" class="xref page">vkGetAccelerationStructureMemoryRequirementsNV</a> with
<a href="resources.html#VkAccelerationStructureMemoryRequirementsInfoNV" class="xref page">VkAccelerationStructureMemoryRequirementsInfoNV</a>::<code>accelerationStructure</code>
set to <code>dst</code> and
<a href="resources.html#VkAccelerationStructureMemoryRequirementsInfoNV" class="xref page">VkAccelerationStructureMemoryRequirementsInfoNV</a>::<code>type</code> set to
<code>VK_ACCELERATION_STRUCTURE_MEMORY_REQUIREMENTS_TYPE_UPDATE_SCRATCH_NV</code>
<strong>must</strong> be less than or equal to the size of <code>scratch</code> minus
<code>scratchOffset</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-scratch-03522" href="#VUID-vkCmdBuildAccelerationStructureNV-scratch-03522"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-scratch-03522</span><br>

<code>scratch</code> <strong>must</strong> have been created with
<code>VK_BUFFER_USAGE_RAY_TRACING_BIT_NV</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-instanceData-03523" href="#VUID-vkCmdBuildAccelerationStructureNV-instanceData-03523"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-instanceData-03523</span><br>

If <code>instanceData</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>instanceData</code>
<strong>must</strong> have been created with <code>VK_BUFFER_USAGE_RAY_TRACING_BIT_NV</code>
usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-accelerationStructureReference-03786" href="#VUID-vkCmdBuildAccelerationStructureNV-accelerationStructureReference-03786"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-accelerationStructureReference-03786</span><br>

Each
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>accelerationStructureReference</code>
value in <code>instanceData</code> <strong>must</strong> be a valid device address containing a
value obtained from <a href="resources.html#vkGetAccelerationStructureHandleNV" class="xref page">vkGetAccelerationStructureHandleNV</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-03524" href="#VUID-vkCmdBuildAccelerationStructureNV-update-03524"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-03524</span><br>

If <code>update</code> is <code>VK_TRUE</code>, then objects that were previously
active <strong>must</strong> not be made inactive as per
<a href="#acceleration-structure-inactive-prims">Inactive Primitives and Instances</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-03525" href="#VUID-vkCmdBuildAccelerationStructureNV-update-03525"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-03525</span><br>

If <code>update</code> is <code>VK_TRUE</code>, then objects that were previously
inactive <strong>must</strong> not be made active as per
<a href="#acceleration-structure-inactive-prims">Inactive Primitives and Instances</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-03526" href="#VUID-vkCmdBuildAccelerationStructureNV-update-03526"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-03526</span><br>

If <code>update</code> is <code>VK_TRUE</code>, the <code>src</code> and <code>dst</code> objects
<strong>must</strong> either be the same object or not have any
<a href="resources.html#resources-memory-aliasing" class="xref page">memory aliasing</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-dst-07787" href="#VUID-vkCmdBuildAccelerationStructureNV-dst-07787"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-dst-07787</span><br>

<code>dst</code> <strong>must</strong> be bound completely and contiguously to a single
<code>VkDeviceMemory</code> object via
<a href="resources.html#vkBindAccelerationStructureMemoryNV" class="xref page">vkBindAccelerationStructureMemoryNV</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-parameter" href="#VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-pInfo-parameter" href="#VUID-vkCmdBuildAccelerationStructureNV-pInfo-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-instanceData-parameter" href="#VUID-vkCmdBuildAccelerationStructureNV-instanceData-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-instanceData-parameter</span><br>
 If <code>instanceData</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>instanceData</code> <strong>must</strong> be a valid <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-dst-parameter" href="#VUID-vkCmdBuildAccelerationStructureNV-dst-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-dst-parameter</span><br>
 <code>dst</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureNV" class="xref page">VkAccelerationStructureNV</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-src-parameter" href="#VUID-vkCmdBuildAccelerationStructureNV-src-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-src-parameter</span><br>
 If <code>src</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>src</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureNV" class="xref page">VkAccelerationStructureNV</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-scratch-parameter" href="#VUID-vkCmdBuildAccelerationStructureNV-scratch-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-scratch-parameter</span><br>
 <code>scratch</code> <strong>must</strong> be a valid <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-recording" href="#VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-cmdpool" href="#VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-renderpass" href="#VUID-vkCmdBuildAccelerationStructureNV-renderpass"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-videocoding" href="#VUID-vkCmdBuildAccelerationStructureNV-videocoding"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-commonparent" href="#VUID-vkCmdBuildAccelerationStructureNV-commonparent"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-commonparent</span><br>
 Each of <code>commandBuffer</code>, <code>dst</code>, <code>instanceData</code>, <code>scratch</code>, and <code>src</code> that are valid handles of non-ignored parameters <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build acceleration structures call:</p>
</div>
<div id="vkCmdBuildAccelerationStructuresKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
void vkCmdBuildAccelerationStructuresKHR(
    VkCommandBuffer                             commandBuffer,
    uint32_t                                    infoCount,
    const VkAccelerationStructureBuildGeometryInfoKHR* pInfos,
    const VkAccelerationStructureBuildRangeInfoKHR* const* ppBuildRangeInfos);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>infoCount</code> is the number of acceleration structures to build.
It specifies the number of the <code>pInfos</code> structures and
<code>ppBuildRangeInfos</code> pointers that <strong>must</strong> be provided.</p>
</li>
<li>
<p><code>pInfos</code> is a pointer to an array of <code>infoCount</code>
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures defining
the geometry used to build each acceleration structure.</p>
</li>
<li>
<p><code>ppBuildRangeInfos</code> is a pointer to an array of <code>infoCount</code>
pointers to arrays of <a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a>
structures.
Each <code>ppBuildRangeInfos</code>[i] is a pointer to an array of
<code>pInfos</code>[i].<code>geometryCount</code>
<a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures defining
dynamic offsets to the addresses where geometry data is stored, as
defined by <code>pInfos</code>[i].</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>vkCmdBuildAccelerationStructuresKHR</code> command provides the ability
to initiate multiple acceleration structures builds, however there is no
ordering or synchronization implied between any of the individual
acceleration structure builds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This means that an application <strong>cannot</strong> build a top-level acceleration
structure in the same <a href="#vkCmdBuildAccelerationStructuresKHR">vkCmdBuildAccelerationStructuresKHR</a> call as the
associated bottom-level or instance acceleration structures are being built.
There also <strong>cannot</strong> be any memory aliasing between any acceleration structure
memories or scratch memories being used by any of the builds.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="acceleration-structure-scratch" class="paragraph">
<p>Accesses to the acceleration structure scratch buffers as identified by the
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>scratchData</code> buffer
device addresses <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with
the <code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
(<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> |
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>).
Accesses to each
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>srcAccelerationStructure</code>
and
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>dstAccelerationStructure</code>
<strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> or
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>, as appropriate.</p>
</div>
<div class="paragraph">
<p>Accesses to other input buffers as identified by any used values of
<a href="#VkAccelerationStructureGeometryMotionTrianglesDataNV">VkAccelerationStructureGeometryMotionTrianglesDataNV</a>::<code>vertexData</code>,
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexData</code>,
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>indexData</code>,
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>transformData</code>,
<a href="#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a>::<code>data</code>, and
<a href="#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>data</code> <strong>must</strong> be
<a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_SHADER_READ_BIT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-accelerationStructure-08923" href="#VUID-vkCmdBuildAccelerationStructuresKHR-accelerationStructure-08923"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-accelerationStructure-08923</span><br>

The <a href="features.html#features-accelerationStructure" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-mode-04628" href="#VUID-vkCmdBuildAccelerationStructuresKHR-mode-04628"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-mode-04628</span><br>

The <code>mode</code> member of each element of <code>pInfos</code> <strong>must</strong> be a valid
<a href="#VkBuildAccelerationStructureModeKHR">VkBuildAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-srcAccelerationStructure-04629" href="#VUID-vkCmdBuildAccelerationStructuresKHR-srcAccelerationStructure-04629"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-srcAccelerationStructure-04629</span><br>

If the <code>srcAccelerationStructure</code> member of any element of
<code>pInfos</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the
<code>srcAccelerationStructure</code> member <strong>must</strong> be a valid
<a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-04630" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-04630"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-04630</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong>must</strong> not be <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03403" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03403"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03403</span><br>

The <code>srcAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03698" href="#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03698"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03698</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03800" href="#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03800"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03800</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03699" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03699"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03699</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong>must</strong> have been created with a
value of <a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03700" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03700"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03700</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong>must</strong> have been created with a
value of <a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03663" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03663"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03663</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>,
<a href="#acceleration-structure-inactive-prims">inactive primitives</a> in its
<code>srcAccelerationStructure</code> member <strong>must</strong> not be made active</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03664" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03664"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03664</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, active primitives
in its <code>srcAccelerationStructure</code> member <strong>must</strong> not be made
<a href="#acceleration-structure-inactive-prims">inactive</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-None-03407" href="#VUID-vkCmdBuildAccelerationStructuresKHR-None-03407"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-None-03407</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be referenced by the <code>geometry.instances.data</code> member of
any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other
element of <code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03701" href="#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03701"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03701</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>srcAccelerationStructure</code> member of
any other element of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, which is accessed
by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03702" href="#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03702"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03702</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>dstAccelerationStructure</code> member of
any other element of <code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03703" href="#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03703"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03703</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> (including the same element), which is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03704" href="#VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03704"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03704</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>scratchData</code> member of any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03705" href="#VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03705"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03705</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>srcAccelerationStructure</code> member of any element
of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> (including the
same element), which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03706" href="#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03706"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03706</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing any acceleration structure referenced by the
<code>geometry.instances.data</code> member of any element of <code>pGeometries</code>
or <code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03667" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03667"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03667</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong>must</strong> have previously been
constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_KHR</code> set in
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code> in the
build</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03668" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03668"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03668</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> and <code>dstAccelerationStructure</code>
members <strong>must</strong> either be the same <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a>, or
not have any <a href="resources.html#resources-memory-aliasing" class="xref page">memory aliasing</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03758" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03758"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03758</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>geometryCount</code> member <strong>must</strong> have the same value which was specified
when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03759" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03759"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03759</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>flags</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03760" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03760"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03760</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>type</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03761" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03761"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03761</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>geometryType</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03762" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03762"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03762</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>flags</code> member
<strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03763" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03763"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03763</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.vertexFormat</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03764" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03764"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03764</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.maxVertex</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03765" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03765"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03765</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.indexType</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03766" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03766"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03766</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03767" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03767"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03767</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was not <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong>must</strong> not be
<code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03768" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03768"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03768</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
then the value of each index referenced <strong>must</strong> be the same as the
corresponding index value when <code>srcAccelerationStructure</code> was last
built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-primitiveCount-03769" href="#VUID-vkCmdBuildAccelerationStructuresKHR-primitiveCount-03769"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-primitiveCount-03769</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, the
<code>primitiveCount</code> member of its corresponding
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structure <strong>must</strong> have the
same value which was specified when <code>srcAccelerationStructure</code> was
last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03801" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03801"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03801</span><br>

For each element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the corresponding
<code>ppBuildRangeInfos</code>[i][j].<code>primitiveCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxInstanceCount</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03707" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03707"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03707</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstAccelerationStructure</code> member <strong>must</strong> be bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03708" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03708"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03708</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> the <code>buffer</code>
used to create its <code>srcAccelerationStructure</code> member <strong>must</strong> be bound
to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03709" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03709"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03709</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create each
acceleration structure referenced by the <code>geometry.instances.data</code>
member of any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> <strong>must</strong> be
bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03671" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03671"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03671</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.deviceAddress</code> and
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> +  N - 1 <strong>must</strong> be in
the buffer device address range of the same buffer, where N is given by
the <code>buildScratchSize</code> member of the
<a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned from a
call to <a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with an identical
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure and
primitive count</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03672" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03672"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03672</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.deviceAddress</code> and
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> +  N - 1 <strong>must</strong> be in
the buffer device address range of the same buffer, where N is given by
the <code>updateScratchSize</code> member of the
<a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned from a
call to <a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with an identical
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure and
primitive count</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-geometry-03673" href="#VUID-vkCmdBuildAccelerationStructuresKHR-geometry-03673"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-geometry-03673</span><br>

The buffers from which the buffer device addresses for all of the
<code>geometry.triangles.vertexData</code>, <code>geometry.triangles.indexData</code>,
<code>geometry.triangles.transformData</code>, <code>geometry.aabbs.data</code>, and
<code>geometry.instances.data</code> members of all
<code>pInfos</code>[i].<code>pGeometries</code> and <code>pInfos</code>[i].<code>ppGeometries</code>
are queried <strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_BUILD_INPUT_READ_ONLY_BIT_KHR</code>
usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03674" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03674"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03674</span><br>

The buffer from which the buffer device address
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> is queried <strong>must</strong> have
been created with <code>VK_BUFFER_USAGE_STORAGE_BUFFER_BIT</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03802" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03802"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03802</span><br>

For each element of <code>pInfos</code>, its <code>scratchData.deviceAddress</code>
member <strong>must</strong> be a valid device address obtained from
<a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03803" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03803"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03803</span><br>

For each element of <code>pInfos</code>, if <code>scratchData.deviceAddress</code> is
the address of a non-sparse buffer then it <strong>must</strong> be bound completely and
contiguously to a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03710" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03710"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03710</span><br>

For each element of <code>pInfos</code>, its <code>scratchData.deviceAddress</code>
member <strong>must</strong> be a multiple of
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>minAccelerationStructureScratchOffsetAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03804" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03804"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03804</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.deviceAddress</code> <strong>must</strong> be a valid
device address obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03805" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03805"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03805</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.vertexData.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03711" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03711"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03711</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.deviceAddress</code> <strong>must</strong> be aligned to
the size in bytes of the smallest component of the format in
<code>vertexFormat</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03806" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03806"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03806</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.deviceAddress</code> <strong>must</strong> be a valid device
address obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03807" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03807"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03807</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
if <code>geometry.triangles.indexData.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03712" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03712"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03712</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and with
<code>geometry.triangles.indexType</code> not equal to
<code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.deviceAddress</code> <strong>must</strong> be aligned to the
size in bytes of the type in <code>indexType</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03808" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03808"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03808</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is not <code>0</code>, it
<strong>must</strong> be a valid device address obtained from
<a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03809" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03809"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03809</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03810" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03810"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03810</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is not <code>0</code>, it
<strong>must</strong> be aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03811" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03811"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03811</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>geometry.aabbs.data.deviceAddress</code> <strong>must</strong> be a valid device address
obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03812" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03812"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03812</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, if
<code>geometry.aabbs.data.deviceAddress</code> is the address of a non-sparse
buffer then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03714" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03714"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03714</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>geometry.aabbs.data.deviceAddress</code> <strong>must</strong> be aligned to <code>8</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03715" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03715"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03715</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_FALSE</code>, <code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be
aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03716" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03716"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03716</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_TRUE</code>, <code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be
aligned to <code>8</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03717" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03717"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03717</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_TRUE</code>, each element of
<code>geometry.instances.data.deviceAddress</code> in device memory <strong>must</strong> be
aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03813" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03813"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03813</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>,
<code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be a valid device
address obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03814" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03814"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03814</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if
<code>geometry.instances.data.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-06707" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-06707"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-06707</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, each
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>accelerationStructureReference</code>
value in <code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be a valid
device address containing a value obtained from
<a href="resources.html#vkGetAccelerationStructureDeviceAddressKHR" class="xref page">vkGetAccelerationStructureDeviceAddressKHR</a> or <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10607" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10607"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10607</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if
<code>VK_GEOMETRY_INSTANCE_DISABLE_OPACITY_MICROMAPS_EXT</code> is set in
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>flags</code> then
<code>geometry.instances.data.deviceAddress</code> <strong>must</strong> refer to an
acceleration structure that was built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_DISABLE_OPACITY_MICROMAPS_EXT</code>
set in <a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-09547" href="#VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-09547"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-09547</span><br>

<code>commandBuffer</code> <strong>must</strong> not be a protected command buffer</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10126" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10126"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10126</span><br>

For each <code>pInfos</code>[i], <code>dstAccelerationStructure</code> <strong>must</strong> have been
created with a value of
<a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>size</code> greater than or
equal to either:</p>
<div class="ulist">
<ul>
<li>
<p>the memory size required by the build operation, as returned by
<a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with
<span class="eq"><code>pBuildInfo</code> = <code>pInfos</code>[i]</span> and with each element of the
<code>pMaxPrimitiveCounts</code> array greater than or equal to the equivalent
<code>ppBuildRangeInfos</code>[i][j].<code>primitiveCount</code> values for <code>j</code> in
<span class="eq">[0,<code>pInfos</code>[i].<code>geometryCount</code>)</span> or,</p>
</li>
<li>
<p>the result of querying the corresponding
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, if
updating a compacted acceleration structure</p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676" href="#VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676</span><br>

Each element of <code>ppBuildRangeInfos</code>[i] <strong>must</strong> be a valid pointer to
an array of <code>pInfos</code>[i].<code>geometryCount</code>
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structures</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-parameter" href="#VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-parameter" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-parameter</span><br>
 <code>pInfos</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> valid <a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter" href="#VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter</span><br>
 <code>ppBuildRangeInfos</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> <a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-recording" href="#VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-cmdpool" href="#VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-renderpass" href="#VUID-vkCmdBuildAccelerationStructuresKHR-renderpass"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-videocoding" href="#VUID-vkCmdBuildAccelerationStructuresKHR-videocoding"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-infoCount-arraylength" href="#VUID-vkCmdBuildAccelerationStructuresKHR-infoCount-arraylength"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-infoCount-arraylength</span><br>
 <code>infoCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build acceleration structures with some parameters sourced on the device
call:</p>
</div>
<div id="vkCmdBuildAccelerationStructuresIndirectKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
void vkCmdBuildAccelerationStructuresIndirectKHR(
    VkCommandBuffer                             commandBuffer,
    uint32_t                                    infoCount,
    const VkAccelerationStructureBuildGeometryInfoKHR* pInfos,
    const VkDeviceAddress*                      pIndirectDeviceAddresses,
    const uint32_t*                             pIndirectStrides,
    const uint32_t* const*                      ppMaxPrimitiveCounts);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>infoCount</code> is the number of acceleration structures to build.</p>
</li>
<li>
<p><code>pInfos</code> is a pointer to an array of <code>infoCount</code>
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures defining
the geometry used to build each acceleration structure.</p>
</li>
<li>
<p><code>pIndirectDeviceAddresses</code> is a pointer to an array of
<code>infoCount</code> buffer device addresses which point to
<code>pInfos</code>[i].<code>geometryCount</code>
<a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures defining
dynamic offsets to the addresses where geometry data is stored, as
defined by <code>pInfos</code>[i].</p>
</li>
<li>
<p><code>pIndirectStrides</code> is a pointer to an array of <code>infoCount</code> byte
strides between elements of <code>pIndirectDeviceAddresses</code>.</p>
</li>
<li>
<p><code>ppMaxPrimitiveCounts</code> is a pointer to an array of <code>infoCount</code>
pointers to arrays of <code>pInfos</code>[i].<code>geometryCount</code> values
indicating the maximum number of primitives that will be built by this
command for each geometry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to acceleration structures, scratch buffers, vertex buffers, index
buffers, and instance buffers <strong>must</strong> be synchronized as with
<a href="#acceleration-structure-scratch">vkCmdBuildAccelerationStructuresKHR</a>.</p>
</div>
<div class="paragraph">
<p>Accesses to any element of <code>pIndirectDeviceAddresses</code> <strong>must</strong> be
<a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_INDIRECT_COMMAND_READ_BIT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-accelerationStructureIndirectBuild-03650" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-accelerationStructureIndirectBuild-03650"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-accelerationStructureIndirectBuild-03650</span><br>

The <a href="features.html#features-accelerationStructureIndirectBuild" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureIndirectBuild</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-mode-04628" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-mode-04628"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-mode-04628</span><br>

The <code>mode</code> member of each element of <code>pInfos</code> <strong>must</strong> be a valid
<a href="#VkBuildAccelerationStructureModeKHR">VkBuildAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-srcAccelerationStructure-04629" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-srcAccelerationStructure-04629"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-srcAccelerationStructure-04629</span><br>

If the <code>srcAccelerationStructure</code> member of any element of
<code>pInfos</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the
<code>srcAccelerationStructure</code> member <strong>must</strong> be a valid
<a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-04630" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-04630"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-04630</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong>must</strong> not be <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03403" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03403"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03403</span><br>

The <code>srcAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03698" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03698"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03698</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03800" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03800"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03800</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03699" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03699"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03699</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong>must</strong> have been created with a
value of <a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03700" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03700"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03700</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong>must</strong> have been created with a
value of <a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03663" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03663"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03663</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>,
<a href="#acceleration-structure-inactive-prims">inactive primitives</a> in its
<code>srcAccelerationStructure</code> member <strong>must</strong> not be made active</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03664" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03664"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03664</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, active primitives
in its <code>srcAccelerationStructure</code> member <strong>must</strong> not be made
<a href="#acceleration-structure-inactive-prims">inactive</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-None-03407" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-None-03407"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-None-03407</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be referenced by the <code>geometry.instances.data</code> member of
any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other
element of <code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03701" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03701"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03701</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>srcAccelerationStructure</code> member of
any other element of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, which is accessed
by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03702" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03702"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03702</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>dstAccelerationStructure</code> member of
any other element of <code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03703" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03703"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03703</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> (including the same element), which is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03704" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03704"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03704</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>scratchData</code> member of any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03705" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03705"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03705</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>srcAccelerationStructure</code> member of any element
of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> (including the
same element), which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03706" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03706"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03706</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing any acceleration structure referenced by the
<code>geometry.instances.data</code> member of any element of <code>pGeometries</code>
or <code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03667" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03667"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03667</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong>must</strong> have previously been
constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_KHR</code> set in
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code> in the
build</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03668" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03668"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03668</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> and <code>dstAccelerationStructure</code>
members <strong>must</strong> either be the same <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a>, or
not have any <a href="resources.html#resources-memory-aliasing" class="xref page">memory aliasing</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03758" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03758"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03758</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>geometryCount</code> member <strong>must</strong> have the same value which was specified
when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03759" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03759"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03759</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>flags</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03760" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03760"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03760</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>type</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03761" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03761"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03761</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>geometryType</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03762" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03762"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03762</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>flags</code> member
<strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03763" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03763"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03763</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.vertexFormat</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03764" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03764"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03764</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.maxVertex</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03765" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03765"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03765</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.indexType</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03766" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03766"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03766</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03767" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03767"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03767</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was not <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong>must</strong> not be
<code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03768" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03768"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03768</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
then the value of each index referenced <strong>must</strong> be the same as the
corresponding index value when <code>srcAccelerationStructure</code> was last
built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-primitiveCount-03769" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-primitiveCount-03769"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-primitiveCount-03769</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, the
<code>primitiveCount</code> member of its corresponding
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structure <strong>must</strong> have the
same value which was specified when <code>srcAccelerationStructure</code> was
last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03801" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03801"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03801</span><br>

For each element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the corresponding
<code>ppMaxPrimitiveCounts</code>[i][j] <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxInstanceCount</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03707" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03707"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03707</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstAccelerationStructure</code> member <strong>must</strong> be bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03708" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03708"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03708</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> the <code>buffer</code>
used to create its <code>srcAccelerationStructure</code> member <strong>must</strong> be bound
to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03709" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03709"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03709</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create each
acceleration structure referenced by the <code>geometry.instances.data</code>
member of any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> <strong>must</strong> be
bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03671" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03671"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03671</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.deviceAddress</code> and
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> +  N - 1 <strong>must</strong> be in
the buffer device address range of the same buffer, where N is given by
the <code>buildScratchSize</code> member of the
<a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned from a
call to <a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with an identical
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure and
primitive count</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03672" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03672"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03672</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.deviceAddress</code> and
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> +  N - 1 <strong>must</strong> be in
the buffer device address range of the same buffer, where N is given by
the <code>updateScratchSize</code> member of the
<a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned from a
call to <a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with an identical
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure and
primitive count</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-geometry-03673" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-geometry-03673"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-geometry-03673</span><br>

The buffers from which the buffer device addresses for all of the
<code>geometry.triangles.vertexData</code>, <code>geometry.triangles.indexData</code>,
<code>geometry.triangles.transformData</code>, <code>geometry.aabbs.data</code>, and
<code>geometry.instances.data</code> members of all
<code>pInfos</code>[i].<code>pGeometries</code> and <code>pInfos</code>[i].<code>ppGeometries</code>
are queried <strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_BUILD_INPUT_READ_ONLY_BIT_KHR</code>
usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03674" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03674"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03674</span><br>

The buffer from which the buffer device address
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> is queried <strong>must</strong> have
been created with <code>VK_BUFFER_USAGE_STORAGE_BUFFER_BIT</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03802" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03802"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03802</span><br>

For each element of <code>pInfos</code>, its <code>scratchData.deviceAddress</code>
member <strong>must</strong> be a valid device address obtained from
<a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03803" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03803"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03803</span><br>

For each element of <code>pInfos</code>, if <code>scratchData.deviceAddress</code> is
the address of a non-sparse buffer then it <strong>must</strong> be bound completely and
contiguously to a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03710" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03710"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03710</span><br>

For each element of <code>pInfos</code>, its <code>scratchData.deviceAddress</code>
member <strong>must</strong> be a multiple of
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>minAccelerationStructureScratchOffsetAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03804" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03804"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03804</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.deviceAddress</code> <strong>must</strong> be a valid
device address obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03805" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03805"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03805</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.vertexData.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03711" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03711"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03711</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.deviceAddress</code> <strong>must</strong> be aligned to
the size in bytes of the smallest component of the format in
<code>vertexFormat</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03806" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03806"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03806</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.deviceAddress</code> <strong>must</strong> be a valid device
address obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03807" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03807"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03807</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
if <code>geometry.triangles.indexData.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03712" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03712"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03712</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and with
<code>geometry.triangles.indexType</code> not equal to
<code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.deviceAddress</code> <strong>must</strong> be aligned to the
size in bytes of the type in <code>indexType</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03808" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03808"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03808</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is not <code>0</code>, it
<strong>must</strong> be a valid device address obtained from
<a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03809" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03809"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03809</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03810" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03810"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03810</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is not <code>0</code>, it
<strong>must</strong> be aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03811" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03811"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03811</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>geometry.aabbs.data.deviceAddress</code> <strong>must</strong> be a valid device address
obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03812" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03812"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03812</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, if
<code>geometry.aabbs.data.deviceAddress</code> is the address of a non-sparse
buffer then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03714" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03714"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03714</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>geometry.aabbs.data.deviceAddress</code> <strong>must</strong> be aligned to <code>8</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03715" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03715"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03715</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_FALSE</code>, <code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be
aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03716" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03716"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03716</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_TRUE</code>, <code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be
aligned to <code>8</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03717" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03717"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03717</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_TRUE</code>, each element of
<code>geometry.instances.data.deviceAddress</code> in device memory <strong>must</strong> be
aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03813" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03813"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03813</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>,
<code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be a valid device
address obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03814" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03814"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03814</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if
<code>geometry.instances.data.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-06707" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-06707"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-06707</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, each
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>accelerationStructureReference</code>
value in <code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be a valid
device address containing a value obtained from
<a href="resources.html#vkGetAccelerationStructureDeviceAddressKHR" class="xref page">vkGetAccelerationStructureDeviceAddressKHR</a> or <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10607" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10607"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10607</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if
<code>VK_GEOMETRY_INSTANCE_DISABLE_OPACITY_MICROMAPS_EXT</code> is set in
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>flags</code> then
<code>geometry.instances.data.deviceAddress</code> <strong>must</strong> refer to an
acceleration structure that was built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_DISABLE_OPACITY_MICROMAPS_EXT</code>
set in <a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-09547" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-09547"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-09547</span><br>

<code>commandBuffer</code> <strong>must</strong> not be a protected command buffer</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03645" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03645"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03645</span><br>

For any element of <code>pIndirectDeviceAddresses</code>, if the buffer from
which it was queried is non-sparse then it <strong>must</strong> be bound completely and
contiguously to a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03646" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03646"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03646</span><br>

For any element of <code>pIndirectDeviceAddresses</code>[i], all device
addresses between <code>pIndirectDeviceAddresses</code>[i] and
<span class="eq"><code>pIndirectDeviceAddresses</code>[i] + 
(<code>pInfos</code>[i].<code>geometryCount</code> × <code>pIndirectStrides</code>[i]) -
1</span> <strong>must</strong> be in the buffer device address range of the same buffer</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03647" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03647"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03647</span><br>

For any element of <code>pIndirectDeviceAddresses</code>, the buffer from which
it was queried <strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_INDIRECT_BUFFER_BIT</code> bit set</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03648" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03648"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03648</span><br>

Each element of <code>pIndirectDeviceAddresses</code> <strong>must</strong> be a multiple of
<code>4</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-03787" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-03787"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-03787</span><br>

Each element of <code>pIndirectStrides</code> <strong>must</strong> be a multiple of <code>4</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03651" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03651"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03651</span><br>

Each <a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structure referenced
by any element of <code>pIndirectDeviceAddresses</code> <strong>must</strong> be a valid
<a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03652" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03652"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03652</span><br>

<code>pInfos</code>[i].<code>dstAccelerationStructure</code> <strong>must</strong> have been created
with a value of <a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>size</code>
greater than or equal to the memory size required by the build
operation, as returned by <a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a>
with <span class="eq"><code>pBuildInfo</code> = <code>pInfos</code>[i]</span> and
<span class="eq"><code>pMaxPrimitiveCounts</code> = <code>ppMaxPrimitiveCounts</code>[i]</span></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-03653" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-03653"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-03653</span><br>

Each <code>ppMaxPrimitiveCounts</code>[i][j] <strong>must</strong> be greater than or equal to
the <code>primitiveCount</code> value specified by the
<a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structure located at
<span class="eq"><code>pIndirectDeviceAddresses</code>[i] +  (<code>j</code> ×
<code>pIndirectStrides</code>[i])</span></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-parameter" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-parameter" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-parameter</span><br>
 <code>pInfos</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> valid <a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-parameter" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-parameter</span><br>
 <code>pIndirectDeviceAddresses</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> <code>VkDeviceAddress</code> values</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-parameter" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-parameter</span><br>
 <code>pIndirectStrides</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> <code>uint32_t</code> values</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-parameter" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-parameter</span><br>
 <code>ppMaxPrimitiveCounts</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> <code>uint32_t</code> values</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-recording" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-cmdpool" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-renderpass" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-renderpass"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-videocoding" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-videocoding"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-infoCount-arraylength" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-infoCount-arraylength"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-infoCount-arraylength</span><br>
 <code>infoCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureBuildGeometryInfoKHR</code> structure is defined
as:</p>
</div>
<div id="VkAccelerationStructureBuildGeometryInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureBuildGeometryInfoKHR {
    VkStructureType                                     sType;
    const void*                                         pNext;
    VkAccelerationStructureTypeKHR                      type;
    VkBuildAccelerationStructureFlagsKHR                flags;
    VkBuildAccelerationStructureModeKHR                 mode;
    VkAccelerationStructureKHR                          srcAccelerationStructure;
    VkAccelerationStructureKHR                          dstAccelerationStructure;
    uint32_t                                            geometryCount;
    const VkAccelerationStructureGeometryKHR*           pGeometries;
    const VkAccelerationStructureGeometryKHR* const*    ppGeometries;
    VkDeviceOrHostAddressKHR                            scratchData;
} VkAccelerationStructureBuildGeometryInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>type</code> is a <a href="resources.html#VkAccelerationStructureTypeKHR" class="xref page">VkAccelerationStructureTypeKHR</a> value specifying
the type of acceleration structure being built.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of
<a href="resources.html#VkBuildAccelerationStructureFlagBitsKHR" class="xref page">VkBuildAccelerationStructureFlagBitsKHR</a> specifying additional
parameters of the acceleration structure.</p>
</li>
<li>
<p><code>mode</code> is a <a href="#VkBuildAccelerationStructureModeKHR">VkBuildAccelerationStructureModeKHR</a> value
specifying the type of operation to perform.</p>
</li>
<li>
<p><code>srcAccelerationStructure</code> is a pointer to an existing acceleration
structure that is to be used to update the
<code>dstAccelerationStructure</code> acceleration structure when <code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>.</p>
</li>
<li>
<p><code>dstAccelerationStructure</code> is a pointer to the target acceleration
structure for the build.</p>
</li>
<li>
<p><code>geometryCount</code> specifies the number of geometries that will be
built into <code>dstAccelerationStructure</code>.</p>
</li>
<li>
<p><code>pGeometries</code> is a pointer to an array of
<a href="#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structures.</p>
</li>
<li>
<p><code>ppGeometries</code> is a pointer to an array of pointers to
<a href="#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structures.</p>
</li>
<li>
<p><code>scratchData</code> is the device or host address to memory that will be
used as scratch memory for the build.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only one of <code>pGeometries</code> or <code>ppGeometries</code> <strong>can</strong> be a valid pointer,
the other <strong>must</strong> be <code>NULL</code>.
Each element of the non-<code>NULL</code> array describes the data used to build each
acceleration structure geometry.</p>
</div>
<div id="acceleration-structure-geometry-index" class="paragraph">
<p>The index of each element of the <code>pGeometries</code> or <code>ppGeometries</code>
members of <a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> is used as the
<em>geometry index</em> during ray traversal.
The geometry index is available in ray shaders via the
<a href="interfaces.html#interfaces-builtin-variables-raygeometryindex" class="xref page"><code>RayGeometryIndexKHR</code> built-in</a>, and is <a href="raytracing.html#shader-binding-table-hit-shader-indexing" class="xref page">used to determine hit and intersection shaders executed during traversal</a>.
The geometry index is available to ray queries via the
<code>OpRayQueryGetIntersectionGeometryIndexKHR</code> instruction.</p>
</div>
<div id="acceleration-structure-motion-instances" class="paragraph">
<p>Setting <code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> in <code>flags</code>
indicates that this build is a motion top level acceleration structure.
A motion top level uses instances of format
<a href="#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a> if
<a href="#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>arrayOfPointers</code>
is <code>VK_FALSE</code>.</p>
</div>
<div class="paragraph">
<p>If
<a href="#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>arrayOfPointers</code>
is <code>VK_TRUE</code>, the pointer for each element of the array of instance
pointers consists of 4 bits of
<code>VkAccelerationStructureMotionInstanceTypeNV</code> in the low 4 bits of the
pointer identifying the type of structure at the pointer.
The device address accessed is the value in the array with the low 4 bits
set to zero.
The structure at the pointer is one of
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>,
<a href="#VkAccelerationStructureMatrixMotionInstanceNV">VkAccelerationStructureMatrixMotionInstanceNV</a> or
<a href="#VkAccelerationStructureSRTMotionInstanceNV">VkAccelerationStructureSRTMotionInstanceNV</a>, depending on the type
value encoded in the low 4 bits.</p>
</div>
<div class="paragraph">
<p>A top level acceleration structure with either motion instances or vertex
motion in its instances <strong>must</strong> set
<code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> in <code>flags</code>.</p>
</div>
<div class="paragraph">
<p>Members <code>srcAccelerationStructure</code> and <code>dstAccelerationStructure</code>
<strong>may</strong> be the same or different for an update operation (when <code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>).
If they are the same, the update happens in-place.
Otherwise, the target acceleration structure is updated and the source is
not modified.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03654" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03654"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03654</span><br>

<code>type</code> <strong>must</strong> not be <code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-03788" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-03788"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-03788</span><br>

If <code>geometryCount</code> is not <code>0</code>, exactly one of <code>pGeometries</code> or
<code>ppGeometries</code> <strong>must</strong> be a valid pointer, the other <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03789" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03789"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03789</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>, the
<code>geometryType</code> member of elements of either <code>pGeometries</code> or
<code>ppGeometries</code> <strong>must</strong> be <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03790" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03790"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03790</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>,
<code>geometryCount</code> <strong>must</strong> be <code>1</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03791" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03791"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03791</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
the <code>geometryType</code> member of elements of either <code>pGeometries</code> or
<code>ppGeometries</code> <strong>must</strong> not be <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03792" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03792"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03792</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
then the <code>geometryType</code> member of each geometry in either
<code>pGeometries</code> or <code>ppGeometries</code> <strong>must</strong> be the same</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03793" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03793"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03793</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
then <code>geometryCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxGeometryCount</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03794" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03794"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03794</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
and the <code>geometryType</code> member of either <code>pGeometries</code> or
<code>ppGeometries</code> is <code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, the total number
of AABBs in all geometries <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxPrimitiveCount</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03795" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03795"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03795</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
and the <code>geometryType</code> member of either <code>pGeometries</code> or
<code>ppGeometries</code> is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, the total
number of triangles in all geometries <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxPrimitiveCount</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-03796" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-03796"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-03796</span><br>

If <code>flags</code> has the
<code>VK_BUILD_ACCELERATION_STRUCTURE_PREFER_FAST_TRACE_BIT_KHR</code> bit set,
then it <strong>must</strong> not have the
<code>VK_BUILD_ACCELERATION_STRUCTURE_PREFER_FAST_BUILD_BIT_KHR</code> bit set</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-dstAccelerationStructure-04927" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-dstAccelerationStructure-04927"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-dstAccelerationStructure-04927</span><br>

If <code>dstAccelerationStructure</code> was created with
<code>VK_ACCELERATION_STRUCTURE_CREATE_MOTION_BIT_NV</code> set in
<a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>createFlags</code>,
<code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> <strong>must</strong> be set in
<code>flags</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04928" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04928"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04928</span><br>

If <code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> is set in
<code>flags</code>, <code>dstAccelerationStructure</code> <strong>must</strong> have been created with
<code>VK_ACCELERATION_STRUCTURE_CREATE_MOTION_BIT_NV</code> set in
<a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>createFlags</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04929" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04929"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04929</span><br>

If <code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> is set in
<code>flags</code>, <code>type</code> <strong>must</strong> not be
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-07334" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-07334"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-07334</span><br>

If <code>flags</code> has the
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_UPDATE_EXT</code>
bit set then it <strong>must</strong> not have the
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_DATA_UPDATE_EXT</code>
bit set</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-sType-sType" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_BUILD_GEOMETRY_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-pNext-pNext" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-parameter" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-parameter</span><br>
 <code>type</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureTypeKHR" class="xref page">VkAccelerationStructureTypeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-parameter" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="resources.html#VkBuildAccelerationStructureFlagBitsKHR" class="xref page">VkBuildAccelerationStructureFlagBitsKHR</a> values</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-parameter" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-parameter</span><br>
 If <code>geometryCount</code> is not <code>0</code>, and <code>pGeometries</code> is not <code>NULL</code>, <code>pGeometries</code> <strong>must</strong> be a valid pointer to an array of <code>geometryCount</code> valid <a href="#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-ppGeometries-parameter" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-ppGeometries-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-ppGeometries-parameter</span><br>
 If <code>geometryCount</code> is not <code>0</code>, and <code>ppGeometries</code> is not <code>NULL</code>, <code>ppGeometries</code> <strong>must</strong> be a valid pointer to an array of <code>geometryCount</code> valid pointers to valid <a href="#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-commonparent" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-commonparent"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-commonparent</span><br>
 Both of <code>dstAccelerationStructure</code>, and <code>srcAccelerationStructure</code> that are valid handles of non-ignored parameters <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkBuildAccelerationStructureModeKHR</code> enumeration is defined as:</p>
</div>
<div id="VkBuildAccelerationStructureModeKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef enum VkBuildAccelerationStructureModeKHR {
    VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR = 0,
    VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR = 1,
} VkBuildAccelerationStructureModeKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR</code> specifies that the
destination acceleration structure will be built using the specified
geometries.</p>
</li>
<li>
<p><code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> specifies that the
destination acceleration structure will be built using data in a source
acceleration structure, updated by the specified geometries.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkDeviceOrHostAddressKHR</code> union is defined as:</p>
</div>
<div id="VkDeviceOrHostAddressKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure, VK_NV_cooperative_vector
typedef union VkDeviceOrHostAddressKHR {
    VkDeviceAddress    deviceAddress;
    void*              hostAddress;
} VkDeviceOrHostAddressKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>deviceAddress</code> is a buffer device address as returned by the
<a href="descriptorsets.html#vkGetBufferDeviceAddressKHR" class="xref page">vkGetBufferDeviceAddressKHR</a> command.</p>
</li>
<li>
<p><code>hostAddress</code> is a host memory address.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkDeviceOrHostAddressConstKHR</code> union is defined as:</p>
</div>
<div id="VkDeviceOrHostAddressConstKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure, VK_NV_cooperative_vector
typedef union VkDeviceOrHostAddressConstKHR {
    VkDeviceAddress    deviceAddress;
    const void*        hostAddress;
} VkDeviceOrHostAddressConstKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>deviceAddress</code> is a buffer device address as returned by the
<a href="descriptorsets.html#vkGetBufferDeviceAddressKHR" class="xref page">vkGetBufferDeviceAddressKHR</a> command.</p>
</li>
<li>
<p><code>hostAddress</code> is a const host memory address.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryKHR</code> structure is defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureGeometryKHR {
    VkStructureType                           sType;
    const void*                               pNext;
    VkGeometryTypeKHR                         geometryType;
    VkAccelerationStructureGeometryDataKHR    geometry;
    VkGeometryFlagsKHR                        flags;
} VkAccelerationStructureGeometryKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>geometryType</code> describes which type of geometry this
<code>VkAccelerationStructureGeometryKHR</code> refers to.</p>
</li>
<li>
<p><code>geometry</code> is a <a href="#VkAccelerationStructureGeometryDataKHR">VkAccelerationStructureGeometryDataKHR</a> union
describing the geometry data for the relevant geometry type.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="resources.html#VkGeometryFlagBitsKHR" class="xref page">VkGeometryFlagBitsKHR</a> values
describing additional properties of how the geometry should be built.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-sType-sType" href="#VUID-VkAccelerationStructureGeometryKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-pNext-pNext" href="#VUID-VkAccelerationStructureGeometryKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-pNext-pNext</span><br>
 Each <code>pNext</code> member of any structure (including this one) in the <code>pNext</code> chain <strong>must</strong> be either <code>NULL</code> or a pointer to a valid instance of <a href="#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a> or <a href="#VkAccelerationStructureGeometrySpheresDataNV">VkAccelerationStructureGeometrySpheresDataNV</a></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-sType-unique" href="#VUID-VkAccelerationStructureGeometryKHR-sType-unique"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-sType-unique</span><br>
 The <code>sType</code> value of each structure in the <code>pNext</code> chain <strong>must</strong> be unique</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-geometryType-parameter" href="#VUID-VkAccelerationStructureGeometryKHR-geometryType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-geometryType-parameter</span><br>
 <code>geometryType</code> <strong>must</strong> be a valid <a href="resources.html#VkGeometryTypeKHR" class="xref page">VkGeometryTypeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-triangles-parameter" href="#VUID-VkAccelerationStructureGeometryKHR-triangles-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-triangles-parameter</span><br>
 If <code>geometryType</code> is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, the <code>triangles</code> member of <code>geometry</code> <strong>must</strong> be a valid <a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-aabbs-parameter" href="#VUID-VkAccelerationStructureGeometryKHR-aabbs-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-aabbs-parameter</span><br>
 If <code>geometryType</code> is <code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, the <code>aabbs</code> member of <code>geometry</code> <strong>must</strong> be a valid <a href="#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-instances-parameter" href="#VUID-VkAccelerationStructureGeometryKHR-instances-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-instances-parameter</span><br>
 If <code>geometryType</code> is <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the <code>instances</code> member of <code>geometry</code> <strong>must</strong> be a valid <a href="#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-flags-parameter" href="#VUID-VkAccelerationStructureGeometryKHR-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="resources.html#VkGeometryFlagBitsKHR" class="xref page">VkGeometryFlagBitsKHR</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryDataKHR</code> union is defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryDataKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef union VkAccelerationStructureGeometryDataKHR {
    VkAccelerationStructureGeometryTrianglesDataKHR    triangles;
    VkAccelerationStructureGeometryAabbsDataKHR        aabbs;
    VkAccelerationStructureGeometryInstancesDataKHR    instances;
} VkAccelerationStructureGeometryDataKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>triangles</code> is a
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure.</p>
</li>
<li>
<p><code>aabbs</code> is a <a href="#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a>
structure.</p>
</li>
<li>
<p><code>instances</code> is a
<a href="#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a> structure.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryTrianglesDataKHR</code> structure is
defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryTrianglesDataKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureGeometryTrianglesDataKHR {
    VkStructureType                  sType;
    const void*                      pNext;
    VkFormat                         vertexFormat;
    VkDeviceOrHostAddressConstKHR    vertexData;
    VkDeviceSize                     vertexStride;
    uint32_t                         maxVertex;
    VkIndexType                      indexType;
    VkDeviceOrHostAddressConstKHR    indexData;
    VkDeviceOrHostAddressConstKHR    transformData;
} VkAccelerationStructureGeometryTrianglesDataKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>vertexFormat</code> is the <a href="formats.html#VkFormat" class="xref page">VkFormat</a> of each vertex element.</p>
</li>
<li>
<p><code>vertexData</code> is a device or host address to memory containing vertex
data for this geometry.</p>
</li>
<li>
<p><code>vertexStride</code> is the stride in bytes between each vertex.</p>
</li>
<li>
<p><code>maxVertex</code> is the number of vertices in <code>vertexData</code> minus one.</p>
</li>
<li>
<p><code>indexType</code> is the <a href="drawing.html#VkIndexType" class="xref page">VkIndexType</a> of each index element.</p>
</li>
<li>
<p><code>indexData</code> is a device or host address to memory containing index
data for this geometry.</p>
</li>
<li>
<p><code>transformData</code> is a device or host address to memory containing an
optional reference to a <a href="#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure describing
a transformation from the space in which the vertices in this geometry
are described to the space in which the acceleration structure is
defined.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unlike the stride for vertex buffers in
<a href="fxvertex.html#VkVertexInputBindingDescription" class="xref page">VkVertexInputBindingDescription</a> for graphics pipelines which must not
exceed <code>maxVertexInputBindingStride</code>, <code>vertexStride</code> for
acceleration structure geometry is instead restricted to being a 32-bit
value.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03735" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03735"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03735</span><br>

<code>vertexStride</code> <strong>must</strong> be a multiple of the size in bytes of the
smallest component of <code>vertexFormat</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03819" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03819"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03819</span><br>

<code>vertexStride</code> <strong>must</strong> be less than or equal to <span class="eq">2<sup>32</sup>-1</span></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-03797" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-03797"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-03797</span><br>

The <a href="resources.html#resources-buffer-view-format-features" class="xref page">format features</a> of
<code>vertexFormat</code> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_ACCELERATION_STRUCTURE_VERTEX_BUFFER_BIT_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-03798" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-03798"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-03798</span><br>

<code>indexType</code> <strong>must</strong> be <code>VK_INDEX_TYPE_UINT16</code>,
<code>VK_INDEX_TYPE_UINT32</code>, or <code>VK_INDEX_TYPE_NONE_KHR</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-sType" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_TRIANGLES_DATA_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-pNext-pNext" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-pNext-pNext</span><br>
 Each <code>pNext</code> member of any structure (including this one) in the <code>pNext</code> chain <strong>must</strong> be either <code>NULL</code> or a pointer to a valid instance of <a href="#VkAccelerationStructureGeometryMotionTrianglesDataNV">VkAccelerationStructureGeometryMotionTrianglesDataNV</a>, <a href="#VkAccelerationStructureTrianglesDisplacementMicromapNV">VkAccelerationStructureTrianglesDisplacementMicromapNV</a>, or <a href="#VkAccelerationStructureTrianglesOpacityMicromapEXT">VkAccelerationStructureTrianglesOpacityMicromapEXT</a></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-unique" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-unique"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-unique</span><br>
 The <code>sType</code> value of each structure in the <code>pNext</code> chain <strong>must</strong> be unique</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-parameter" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-parameter</span><br>
 <code>vertexFormat</code> <strong>must</strong> be a valid <a href="formats.html#VkFormat" class="xref page">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-parameter" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-parameter</span><br>
 <code>indexType</code> <strong>must</strong> be a valid <a href="drawing.html#VkIndexType" class="xref page">VkIndexType</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryMotionTrianglesDataNV</code> structure is
defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryMotionTrianglesDataNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef struct VkAccelerationStructureGeometryMotionTrianglesDataNV {
    VkStructureType                  sType;
    const void*                      pNext;
    VkDeviceOrHostAddressConstKHR    vertexData;
} VkAccelerationStructureGeometryMotionTrianglesDataNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>vertexData</code> is a pointer to vertex data for this geometry at time
1.0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>VkAccelerationStructureGeometryMotionTrianglesDataNV</code> is included in
the <code>pNext</code> chain of a
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure, the basic
vertex positions are used for the position of the triangles in the geometry
at time 0.0 and the <code>vertexData</code> in
<code>VkAccelerationStructureGeometryMotionTrianglesDataNV</code> is used for the
vertex positions at time 1.0, with positions linearly interpolated at
intermediate times.</p>
</div>
<div class="paragraph">
<p>Indexing for <code>VkAccelerationStructureGeometryMotionTrianglesDataNV</code>
<code>vertexData</code> is equivalent to the basic vertex position data.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryMotionTrianglesDataNV-sType-sType" href="#VUID-VkAccelerationStructureGeometryMotionTrianglesDataNV-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryMotionTrianglesDataNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_MOTION_TRIANGLES_DATA_NV</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureTrianglesOpacityMicromapEXT</code> structure is
defined as:</p>
</div>
<div id="VkAccelerationStructureTrianglesOpacityMicromapEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_opacity_micromap
typedef struct VkAccelerationStructureTrianglesOpacityMicromapEXT {
    VkStructureType                     sType;
    void*                               pNext;
    VkIndexType                         indexType;
    VkDeviceOrHostAddressConstKHR       indexBuffer;
    VkDeviceSize                        indexStride;
    uint32_t                            baseTriangle;
    uint32_t                            usageCountsCount;
    const VkMicromapUsageEXT*           pUsageCounts;
    const VkMicromapUsageEXT* const*    ppUsageCounts;
    VkMicromapEXT                       micromap;
} VkAccelerationStructureTrianglesOpacityMicromapEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>indexType</code> is the type of triangle indices used when indexing this
micromap</p>
</li>
<li>
<p><code>indexBuffer</code> is the address containing the triangle indices</p>
</li>
<li>
<p><code>indexStride</code> is the byte stride between triangle indices</p>
</li>
<li>
<p><code>baseTriangle</code> is the base value added to the non-negative triangle
indices</p>
</li>
<li>
<p><code>usageCountsCount</code> specifies the number of usage counts structures
that will be used to determine the size of this micromap.</p>
</li>
<li>
<p><code>pUsageCounts</code> is a pointer to an array of <a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a>
structures.</p>
</li>
<li>
<p><code>ppUsageCounts</code> is a pointer to an array of pointers to
<a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a> structures.</p>
</li>
<li>
<p><code>micromap</code> is the handle to the micromap object to include in this
geometry</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>VkAccelerationStructureTrianglesOpacityMicromapEXT</code> is included in
the <code>pNext</code> chain of a
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure, that
geometry will reference that micromap.</p>
</div>
<div class="paragraph">
<p>For each triangle in the geometry, the acceleration structure build fetches
an index from <code>indexBuffer</code> using <code>indexType</code> and <code>indexStride</code>
if present.
If <code>indexBuffer</code> is <code>NULL</code> then the index used is the index of the
triangle in the geometry.</p>
</div>
<div class="paragraph">
<p>If that value is the unsigned cast of one of the values from
<a href="#VkOpacityMicromapSpecialIndexEXT">VkOpacityMicromapSpecialIndexEXT</a> then that triangle behaves as
described for that special value in <a href="raytraversal.html#ray-opacity-micromap" class="xref page">Ray Opacity Micromap</a>.</p>
</div>
<div class="paragraph">
<p>Otherwise that triangle uses the opacity micromap information from
<code>micromap</code> at that index plus <code>baseTriangle</code>.</p>
</div>
<div class="paragraph">
<p>Only one of <code>pUsageCounts</code> or <code>ppUsageCounts</code> <strong>can</strong> be a valid
pointer, the other <strong>must</strong> be <code>NULL</code>.
The elements of the non-<code>NULL</code> array describe the total count used to build
this geometry.
For a given <code>format</code> and <code>subdivisionLevel</code> the number of triangles
in this geometry matching those values after indirection and special index
handling <strong>must</strong> be equal to the sum of matching <code>count</code> provided.</p>
</div>
<div class="paragraph">
<p>If <code>micromap</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, then every value read from
<code>indexBuffer</code> <strong>must</strong> be one of the values in
<code>VkOpacityMicromapSpecialIndexEXT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-07335" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-07335"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-07335</span><br>

Only one of <code>pUsageCounts</code> or <code>ppUsageCounts</code> <strong>can</strong> be a valid
pointer, the other <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10719" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10719"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10719</span><br>

<code>indexType</code> <strong>must</strong> be <code>VK_INDEX_TYPE_UINT16</code>,
<code>VK_INDEX_TYPE_UINT32</code>, or <code>VK_INDEX_TYPE_NONE_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10720" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10720"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10720</span><br>

If <code>indexType</code> is <code>VK_INDEX_TYPE_NONE_KHR</code>, then
<code>indexBuffer</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10721" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10721"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10721</span><br>

If <code>indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>, then
<code>indexBuffer</code> <strong>must</strong> be a valid device address obtained from
<a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10722" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10722"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10722</span><br>

If <code>indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>, then
<code>indexStride</code> <strong>must</strong> be a multiple of the size in bytes of
<code>indexType</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10723" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10723"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10723</span><br>

If <code>indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>, then
<code>indexStride</code> <strong>must</strong> be less than or equal to <span class="eq">2<sup>32</sup>-1</span></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-sType-sType" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_TRIANGLES_OPACITY_MICROMAP_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-parameter" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-parameter</span><br>
 <code>indexType</code> <strong>must</strong> be a valid <a href="drawing.html#VkIndexType" class="xref page">VkIndexType</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-parameter" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-parameter</span><br>
 If <code>usageCountsCount</code> is not <code>0</code>, and <code>pUsageCounts</code> is not <code>NULL</code>, <code>pUsageCounts</code> <strong>must</strong> be a valid pointer to an array of <code>usageCountsCount</code> <a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-ppUsageCounts-parameter" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-ppUsageCounts-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-ppUsageCounts-parameter</span><br>
 If <code>usageCountsCount</code> is not <code>0</code>, and <code>ppUsageCounts</code> is not <code>NULL</code>, <code>ppUsageCounts</code> <strong>must</strong> be a valid pointer to an array of <code>usageCountsCount</code> valid pointers to <a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-micromap-parameter" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-micromap-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-micromap-parameter</span><br>
 If <code>micromap</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>micromap</code> <strong>must</strong> be a valid <a href="resources.html#VkMicromapEXT" class="xref page">VkMicromapEXT</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkOpacityMicromapSpecialIndexEXT</code> enumeration is defined as:</p>
</div>
<div id="VkOpacityMicromapSpecialIndexEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_opacity_micromap
typedef enum VkOpacityMicromapSpecialIndexEXT {
    VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_TRANSPARENT_EXT = -1,
    VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_OPAQUE_EXT = -2,
    VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_UNKNOWN_TRANSPARENT_EXT = -3,
    VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_UNKNOWN_OPAQUE_EXT = -4,
  // Provided by VK_EXT_opacity_micromap with VK_NV_cluster_acceleration_structure
    VK_OPACITY_MICROMAP_SPECIAL_INDEX_CLUSTER_GEOMETRY_DISABLE_OPACITY_MICROMAP_NV = -5,
} VkOpacityMicromapSpecialIndexEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_TRANSPARENT_EXT</code> specifies
that the entire triangle is fully transparent.</p>
</li>
<li>
<p><code>VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_OPAQUE_EXT</code> specifies that
the entire triangle is fully opaque.</p>
</li>
<li>
<p><code>VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_UNKNOWN_TRANSPARENT_EXT</code>
specifies that the entire triangle is unknown-transparent.</p>
</li>
<li>
<p><code>VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_UNKNOWN_OPAQUE_EXT</code>
specifies that the entire triangle is unknown-opaque.</p>
</li>
<li>
<p><code>VK_OPACITY_MICROMAP_SPECIAL_INDEX_CLUSTER_GEOMETRY_DISABLE_OPACITY_MICROMAP_NV</code>
specifies that <a href="raytraversal.html#ray-opacity-micromap" class="xref page">Opacity Micromap</a> will be
disabled for this triangle and opacity value will be picked from
<a href="#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a>::<code>baseGeometryIndexAndGeometryFlags</code>
instead.
Note that this special index is only valid for <a href="#cluster-geometry">    Cluster Geometry</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureTrianglesDisplacementMicromapNV</code> structure
is defined as:</p>
</div>
<div id="VkAccelerationStructureTrianglesDisplacementMicromapNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_displacement_micromap
typedef struct VkAccelerationStructureTrianglesDisplacementMicromapNV {
    VkStructureType                     sType;
    void*                               pNext;
    VkFormat                            displacementBiasAndScaleFormat;
    VkFormat                            displacementVectorFormat;
    VkDeviceOrHostAddressConstKHR       displacementBiasAndScaleBuffer;
    VkDeviceSize                        displacementBiasAndScaleStride;
    VkDeviceOrHostAddressConstKHR       displacementVectorBuffer;
    VkDeviceSize                        displacementVectorStride;
    VkDeviceOrHostAddressConstKHR       displacedMicromapPrimitiveFlags;
    VkDeviceSize                        displacedMicromapPrimitiveFlagsStride;
    VkIndexType                         indexType;
    VkDeviceOrHostAddressConstKHR       indexBuffer;
    VkDeviceSize                        indexStride;
    uint32_t                            baseTriangle;
    uint32_t                            usageCountsCount;
    const VkMicromapUsageEXT*           pUsageCounts;
    const VkMicromapUsageEXT* const*    ppUsageCounts;
    VkMicromapEXT                       micromap;
} VkAccelerationStructureTrianglesDisplacementMicromapNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>displacementBiasAndScaleFormat</code> is the format of displacement bias
and scale used in this displacement micromap reference.</p>
</li>
<li>
<p><code>displacementVectorFormat</code> is the format of displacement vector used
in this displacement micromap reference.</p>
</li>
<li>
<p><code>displacementBiasAndScaleBuffer</code> is the address containing the bias
and scale.</p>
</li>
<li>
<p><code>displacementBiasAndScaleStride</code> is the byte stride between bias and
scale values.</p>
</li>
<li>
<p><code>displacementVectorBuffer</code> is the address containing the
displacement vector values.</p>
</li>
<li>
<p><code>displacementVectorStride</code> is the byte stride between displacement
vector values.</p>
</li>
<li>
<p><code>displacedMicromapPrimitiveFlags</code> is the address containing the
primitive flags.</p>
</li>
<li>
<p><code>displacedMicromapPrimitiveFlagsStride</code> is the byte stride between
primitive flag values.</p>
</li>
<li>
<p><code>indexType</code> is the type of triangle indices used when indexing this
micromap.</p>
</li>
<li>
<p><code>indexBuffer</code> is the address containing the triangle indices.</p>
</li>
<li>
<p><code>indexStride</code> is the byte stride between triangle indices.</p>
</li>
<li>
<p><code>baseTriangle</code> is the base value added to the non-negative triangle
indices.</p>
</li>
<li>
<p><code>usageCountsCount</code> specifies the number of usage counts structures
that will be used to determine the size of this micromap.</p>
</li>
<li>
<p><code>pUsageCounts</code> is a pointer to an array of <a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a>
structures.</p>
</li>
<li>
<p><code>ppUsageCounts</code> is a pointer to an array of pointers to
<a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a> structures.</p>
</li>
<li>
<p><code>micromap</code> is the handle to the micromap object to include in this
geometry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>VkAccelerationStructureTrianglesDisplacementMicromapNV</code> is included
in the <code>pNext</code> chain of a
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure, that
geometry will reference that micromap.</p>
</div>
<div class="paragraph">
<p>For each triangle in the geometry, the acceleration structure build fetches
an index from <code>indexBuffer</code> using <code>indexType</code> and <code>indexStride</code>.
That triangle uses the displacement micromap information from <code>micromap</code>
at that index plus <code>baseTriangle</code>.</p>
</div>
<div class="paragraph">
<p>Only one of <code>pUsageCounts</code> or <code>ppUsageCounts</code> <strong>can</strong> be a valid
pointer, the other <strong>must</strong> be <code>NULL</code>.
The elements of the non-<code>NULL</code> array describe the total count used to build
this geometry.
For a given <code>format</code> and <code>subdivisionLevel</code> the number of triangles
in this geometry matching those values after indirection <strong>must</strong> be equal to
the sum of matching <code>count</code> provided.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-09501" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-09501"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-09501</span><br>

<code>displacementBiasAndScaleFormat</code> <strong>must</strong> not be
<code>VK_FORMAT_UNDEFINED</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-09502" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-09502"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-09502</span><br>

<code>displacementVectorFormat</code> <strong>must</strong> not be <code>VK_FORMAT_UNDEFINED</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-07992" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-07992"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-07992</span><br>

Only one of <code>pUsageCounts</code> or <code>ppUsageCounts</code> <strong>can</strong> be a valid
pointer, the other <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-sType-sType" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_TRIANGLES_DISPLACEMENT_MICROMAP_NV</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-parameter" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-parameter</span><br>
 <code>displacementBiasAndScaleFormat</code> <strong>must</strong> be a valid <a href="formats.html#VkFormat" class="xref page">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-parameter" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-parameter</span><br>
 <code>displacementVectorFormat</code> <strong>must</strong> be a valid <a href="formats.html#VkFormat" class="xref page">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-indexType-parameter" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-indexType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-indexType-parameter</span><br>
 <code>indexType</code> <strong>must</strong> be a valid <a href="drawing.html#VkIndexType" class="xref page">VkIndexType</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-parameter" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-parameter</span><br>
 If <code>usageCountsCount</code> is not <code>0</code>, and <code>pUsageCounts</code> is not <code>NULL</code>, <code>pUsageCounts</code> <strong>must</strong> be a valid pointer to an array of <code>usageCountsCount</code> <a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-ppUsageCounts-parameter" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-ppUsageCounts-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-ppUsageCounts-parameter</span><br>
 If <code>usageCountsCount</code> is not <code>0</code>, and <code>ppUsageCounts</code> is not <code>NULL</code>, <code>ppUsageCounts</code> <strong>must</strong> be a valid pointer to an array of <code>usageCountsCount</code> valid pointers to <a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-micromap-parameter" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-micromap-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-micromap-parameter</span><br>
 If <code>micromap</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>micromap</code> <strong>must</strong> be a valid <a href="resources.html#VkMicromapEXT" class="xref page">VkMicromapEXT</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkTransformMatrixKHR</code> structure is defined as:</p>
</div>
<div id="VkTransformMatrixKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkTransformMatrixKHR {
    float    matrix[3][4];
} VkTransformMatrixKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkTransformMatrixNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
typedef VkTransformMatrixKHR VkTransformMatrixNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>matrix</code> is a 3x4 row-major affine transformation matrix.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkTransformMatrixKHR-matrix-03799" href="#VUID-VkTransformMatrixKHR-matrix-03799"></a> <span class="vuid">VUID-VkTransformMatrixKHR-matrix-03799</span><br>

The first three columns of <code>matrix</code> <strong>must</strong> define an invertible 3x3
matrix</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryAabbsDataKHR</code> structure is defined
as:</p>
</div>
<div id="VkAccelerationStructureGeometryAabbsDataKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureGeometryAabbsDataKHR {
    VkStructureType                  sType;
    const void*                      pNext;
    VkDeviceOrHostAddressConstKHR    data;
    VkDeviceSize                     stride;
} VkAccelerationStructureGeometryAabbsDataKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>data</code> is a device or host address to memory containing
<a href="#VkAabbPositionsKHR">VkAabbPositionsKHR</a> structures containing position data for each
axis-aligned bounding box in the geometry.</p>
</li>
<li>
<p><code>stride</code> is the stride in bytes between each entry in <code>data</code>.
The stride <strong>must</strong> be a multiple of <code>8</code>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03545" href="#VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03545"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03545</span><br>

<code>stride</code> <strong>must</strong> be a multiple of <code>8</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03820" href="#VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03820"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03820</span><br>

<code>stride</code> <strong>must</strong> be less than or equal to <span class="eq">2<sup>32</sup>-1</span></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryAabbsDataKHR-sType-sType" href="#VUID-VkAccelerationStructureGeometryAabbsDataKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryAabbsDataKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_AABBS_DATA_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryAabbsDataKHR-pNext-pNext" href="#VUID-VkAccelerationStructureGeometryAabbsDataKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryAabbsDataKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAabbPositionsKHR</code> structure is defined as:</p>
</div>
<div id="VkAabbPositionsKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAabbPositionsKHR {
    float    minX;
    float    minY;
    float    minZ;
    float    maxX;
    float    maxY;
    float    maxZ;
} VkAabbPositionsKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkAabbPositionsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
typedef VkAabbPositionsKHR VkAabbPositionsNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>minX</code> is the x position of one opposing corner of a bounding box.</p>
</li>
<li>
<p><code>minY</code> is the y position of one opposing corner of a bounding box.</p>
</li>
<li>
<p><code>minZ</code> is the z position of one opposing corner of a bounding box.</p>
</li>
<li>
<p><code>maxX</code> is the x position of the other opposing corner of a bounding
box.</p>
</li>
<li>
<p><code>maxY</code> is the y position of the other opposing corner of a bounding
box.</p>
</li>
<li>
<p><code>maxZ</code> is the z position of the other opposing corner of a bounding
box.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAabbPositionsKHR-minX-03546" href="#VUID-VkAabbPositionsKHR-minX-03546"></a> <span class="vuid">VUID-VkAabbPositionsKHR-minX-03546</span><br>

<code>minX</code> <strong>must</strong> be less than or equal to <code>maxX</code></p>
</li>
<li>
<p><a id="VUID-VkAabbPositionsKHR-minY-03547" href="#VUID-VkAabbPositionsKHR-minY-03547"></a> <span class="vuid">VUID-VkAabbPositionsKHR-minY-03547</span><br>

<code>minY</code> <strong>must</strong> be less than or equal to <code>maxY</code></p>
</li>
<li>
<p><a id="VUID-VkAabbPositionsKHR-minZ-03548" href="#VUID-VkAabbPositionsKHR-minZ-03548"></a> <span class="vuid">VUID-VkAabbPositionsKHR-minZ-03548</span><br>

<code>minZ</code> <strong>must</strong> be less than or equal to <code>maxZ</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryInstancesDataKHR</code> structure is
defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryInstancesDataKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureGeometryInstancesDataKHR {
    VkStructureType                  sType;
    const void*                      pNext;
    VkBool32                         arrayOfPointers;
    VkDeviceOrHostAddressConstKHR    data;
} VkAccelerationStructureGeometryInstancesDataKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>arrayOfPointers</code> specifies whether <code>data</code> is used as an array
of addresses or just an array.</p>
</li>
<li>
<p><code>data</code> is either the address of an array of device or host addresses
referencing individual <a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>
structures
or packed motion instance information as described in
<a href="#acceleration-structure-motion-instances">motion instances</a>
if <code>arrayOfPointers</code> is <code>VK_TRUE</code>, or the address of an array of
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>
or <a href="#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a>
structures.
Addresses and <a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a> structures are
tightly packed.
<a href="#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a> structures have a stride
of 160 bytes.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryInstancesDataKHR-sType-sType" href="#VUID-VkAccelerationStructureGeometryInstancesDataKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryInstancesDataKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_INSTANCES_DATA_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryInstancesDataKHR-pNext-pNext" href="#VUID-VkAccelerationStructureGeometryInstancesDataKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryInstancesDataKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><em>Acceleration structure instances</em> <strong>can</strong> be built into top-level acceleration
structures.
Each acceleration structure instance is a separate entry in the top-level
acceleration structure which includes all the geometry of a bottom-level
acceleration structure at a transformed location.
Multiple instances <strong>can</strong> point to the same bottom level acceleration
structure.</p>
</div>
<div class="paragraph">
<p>An acceleration structure instance is defined by the structure:</p>
</div>
<div id="VkAccelerationStructureInstanceKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureInstanceKHR {
    VkTransformMatrixKHR          transform;
    uint32_t                      instanceCustomIndex:24;
    uint32_t                      mask:8;
    uint32_t                      instanceShaderBindingTableRecordOffset:24;
    VkGeometryInstanceFlagsKHR    flags:8;
    uint64_t                      accelerationStructureReference;
} VkAccelerationStructureInstanceKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkAccelerationStructureInstanceNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
typedef VkAccelerationStructureInstanceKHR VkAccelerationStructureInstanceNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>transform</code> is a <a href="#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure describing a
transformation to be applied to the acceleration structure.</p>
</li>
<li>
<p><code>instanceCustomIndex</code> is a 24-bit application-specified index value
accessible to ray shaders in the <code>InstanceCustomIndexKHR</code> built-in.</p>
</li>
<li>
<p><code>mask</code> is an 8-bit visibility mask for the geometry.
The instance <strong>may</strong> only be hit if <code>Cull Mask &amp; instance.mask != 0</code></p>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> is a 24-bit offset used in
calculating the hit shader binding table index.</p>
</li>
<li>
<p><code>flags</code> is an 8-bit mask of <a href="#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a>
values to apply to this instance.</p>
</li>
<li>
<p><code>accelerationStructureReference</code> is
either
    :</p>
<div class="ulist">
<ul>
<li>
<p>a device address containing the value obtained from
<a href="resources.html#vkGetAccelerationStructureDeviceAddressKHR" class="xref page">vkGetAccelerationStructureDeviceAddressKHR</a>
or
<a href="resources.html#vkGetAccelerationStructureHandleNV" class="xref page">vkGetAccelerationStructureHandleNV</a>
     (used by device operations which reference acceleration structures)
or,</p>
</li>
<li>
<p>a device address containing a bottom level cluster acceleration
structure built using
<a href="#vkCmdBuildClusterAccelerationStructureIndirectNV">vkCmdBuildClusterAccelerationStructureIndirectNV</a></p>
</li>
<li>
<p>a <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> object (used by host operations
which reference acceleration structures).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this structure produces the correct layout with existing
compilers.
The intended bit pattern is for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> and <code>mask</code> occupy the same memory as if a
single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> occupies the 24 least significant bits of
that memory</p>
</li>
<li>
<p><code>mask</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> and <code>flags</code> occupy the
same memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> occupies the 24 least
significant bits of that memory</p>
</li>
<li>
<p><code>flags</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong>must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureInstanceKHR-flags-parameter" href="#VUID-VkAccelerationStructureInstanceKHR-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureInstanceKHR-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Possible values of <code>flags</code> in the instance modifying the behavior of
that instance are:</p>
</div>
<div id="VkGeometryInstanceFlagBitsKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef enum VkGeometryInstanceFlagBitsKHR {
    VK_GEOMETRY_INSTANCE_TRIANGLE_FACING_CULL_DISABLE_BIT_KHR = 0x00000001,
    VK_GEOMETRY_INSTANCE_TRIANGLE_FLIP_FACING_BIT_KHR = 0x00000002,
    VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_KHR = 0x00000004,
    VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_KHR = 0x00000008,
  // Provided by VK_EXT_opacity_micromap
    VK_GEOMETRY_INSTANCE_FORCE_OPACITY_MICROMAP_2_STATE_EXT = 0x00000010,
  // Provided by VK_EXT_opacity_micromap
    VK_GEOMETRY_INSTANCE_DISABLE_OPACITY_MICROMAPS_EXT = 0x00000020,
    VK_GEOMETRY_INSTANCE_TRIANGLE_FRONT_COUNTERCLOCKWISE_BIT_KHR = VK_GEOMETRY_INSTANCE_TRIANGLE_FLIP_FACING_BIT_KHR,
  // Provided by VK_NV_ray_tracing
    VK_GEOMETRY_INSTANCE_TRIANGLE_CULL_DISABLE_BIT_NV = VK_GEOMETRY_INSTANCE_TRIANGLE_FACING_CULL_DISABLE_BIT_KHR,
  // Provided by VK_NV_ray_tracing
    VK_GEOMETRY_INSTANCE_TRIANGLE_FRONT_COUNTERCLOCKWISE_BIT_NV = VK_GEOMETRY_INSTANCE_TRIANGLE_FRONT_COUNTERCLOCKWISE_BIT_KHR,
  // Provided by VK_NV_ray_tracing
    VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_NV = VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_KHR,
  // Provided by VK_NV_ray_tracing
    VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_NV = VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_KHR,
} VkGeometryInstanceFlagBitsKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkGeometryInstanceFlagBitsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
typedef VkGeometryInstanceFlagBitsKHR VkGeometryInstanceFlagBitsNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_GEOMETRY_INSTANCE_TRIANGLE_FACING_CULL_DISABLE_BIT_KHR</code> disables
face culling for this instance.</p>
</li>
<li>
<p><code>VK_GEOMETRY_INSTANCE_TRIANGLE_FLIP_FACING_BIT_KHR</code> specifies that
the <a href="raytraversal.html#ray-traversal-culling-face" class="xref page">facing determination</a> for geometry in
this instance is inverted.
Because the facing is determined in object space, an instance transform
does not change the winding, but a geometry transform does.</p>
</li>
<li>
<p><code>VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_KHR</code> causes this instance to
act as though <code>VK_GEOMETRY_OPAQUE_BIT_KHR</code> were specified on all
geometries referenced by this instance.
This behavior <strong>can</strong> be overridden by the SPIR-V <code>NoOpaqueKHR</code> ray
flag.</p>
</li>
<li>
<p><code>VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_KHR</code> causes this instance
to act as though <code>VK_GEOMETRY_OPAQUE_BIT_KHR</code> were not specified on
all geometries referenced by this instance.
This behavior <strong>can</strong> be overridden by the SPIR-V <code>OpaqueKHR</code> ray flag.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_KHR</code> and
<code>VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_KHR</code> <strong>must</strong> not be used in the
same flag.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkGeometryInstanceFlagsKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef VkFlags VkGeometryInstanceFlagsKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkGeometryInstanceFlagsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
typedef VkGeometryInstanceFlagsKHR VkGeometryInstanceFlagsNV;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkGeometryInstanceFlagsKHR</code> is a bitmask type for setting a mask of
zero or more <a href="#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><em>Acceleration structure motion instances</em> <strong>can</strong> be built into top-level
acceleration structures.
Each acceleration structure instance is a separate entry in the top-level
acceleration structure which includes all the geometry of a bottom-level
acceleration structure at a transformed location including a type of motion
and parameters to determine the motion of the instance over time.</p>
</div>
<div class="paragraph">
<p>An acceleration structure motion instance is defined by the structure:</p>
</div>
<div id="VkAccelerationStructureMotionInstanceNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef struct VkAccelerationStructureMotionInstanceNV {
    VkAccelerationStructureMotionInstanceTypeNV     type;
    VkAccelerationStructureMotionInstanceFlagsNV    flags;
    VkAccelerationStructureMotionInstanceDataNV     data;
} VkAccelerationStructureMotionInstanceNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>type</code> is a <a href="#VkAccelerationStructureMotionInstanceTypeNV">VkAccelerationStructureMotionInstanceTypeNV</a>
enumerant identifying which type of motion instance this is and which
type of the union is valid.</p>
</li>
<li>
<p><code>flags</code> is currently unused, but is required to keep natural
alignment of <code>data</code>.</p>
</li>
<li>
<p><code>data</code> is a <a href="#VkAccelerationStructureMotionInstanceDataNV">VkAccelerationStructureMotionInstanceDataNV</a>
containing motion instance data for this instance.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If writing this other than with a standard C compiler, note that the final
structure should be 152 bytes in size.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-type-parameter" href="#VUID-VkAccelerationStructureMotionInstanceNV-type-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-type-parameter</span><br>
 <code>type</code> <strong>must</strong> be a valid <a href="#VkAccelerationStructureMotionInstanceTypeNV">VkAccelerationStructureMotionInstanceTypeNV</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-flags-zerobitmask" href="#VUID-VkAccelerationStructureMotionInstanceNV-flags-zerobitmask"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-flags-zerobitmask</span><br>
 <code>flags</code> <strong>must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-staticInstance-parameter" href="#VUID-VkAccelerationStructureMotionInstanceNV-staticInstance-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-staticInstance-parameter</span><br>
 If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_STATIC_NV</code>, the <code>staticInstance</code> member of <code>data</code> <strong>must</strong> be a valid <a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-matrixMotionInstance-parameter" href="#VUID-VkAccelerationStructureMotionInstanceNV-matrixMotionInstance-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-matrixMotionInstance-parameter</span><br>
 If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_MATRIX_MOTION_NV</code>, the <code>matrixMotionInstance</code> member of <code>data</code> <strong>must</strong> be a valid <a href="#VkAccelerationStructureMatrixMotionInstanceNV">VkAccelerationStructureMatrixMotionInstanceNV</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-srtMotionInstance-parameter" href="#VUID-VkAccelerationStructureMotionInstanceNV-srtMotionInstance-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-srtMotionInstance-parameter</span><br>
 If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_SRT_MOTION_NV</code>, the <code>srtMotionInstance</code> member of <code>data</code> <strong>must</strong> be a valid <a href="#VkAccelerationStructureSRTMotionInstanceNV">VkAccelerationStructureSRTMotionInstanceNV</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Acceleration structure motion instance is defined by the union:</p>
</div>
<div id="VkAccelerationStructureMotionInstanceDataNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef union VkAccelerationStructureMotionInstanceDataNV {
    VkAccelerationStructureInstanceKHR               staticInstance;
    VkAccelerationStructureMatrixMotionInstanceNV    matrixMotionInstance;
    VkAccelerationStructureSRTMotionInstanceNV       srtMotionInstance;
} VkAccelerationStructureMotionInstanceDataNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>staticInstance</code> is a <a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>
structure containing data for a static instance.</p>
</li>
<li>
<p><code>matrixMotionInstance</code> is a
<a href="#VkAccelerationStructureMatrixMotionInstanceNV">VkAccelerationStructureMatrixMotionInstanceNV</a> structure containing
data for a matrix motion instance.</p>
</li>
<li>
<p><code>srtMotionInstance</code> is a
<a href="#VkAccelerationStructureSRTMotionInstanceNV">VkAccelerationStructureSRTMotionInstanceNV</a> structure containing
data for an SRT motion instance.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkAccelerationStructureMotionInstanceFlagsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef VkFlags VkAccelerationStructureMotionInstanceFlagsNV;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkAccelerationStructureMotionInstanceFlagsNV</code> is a bitmask type for
setting a mask, but is currently reserved for future use.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureMotionInstanceTypeNV</code> enumeration is defined
as:</p>
</div>
<div id="VkAccelerationStructureMotionInstanceTypeNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef enum VkAccelerationStructureMotionInstanceTypeNV {
    VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_STATIC_NV = 0,
    VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_MATRIX_MOTION_NV = 1,
    VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_SRT_MOTION_NV = 2,
} VkAccelerationStructureMotionInstanceTypeNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_STATIC_NV</code> specifies
that the instance is a static instance with no instance motion.</p>
</li>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_MATRIX_MOTION_NV</code>
specifies that the instance is a motion instance with motion specified
by interpolation between two matrices.</p>
</li>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_SRT_MOTION_NV</code>
specifies that the instance is a motion instance with motion specified
by interpolation in the SRT decomposition.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>An acceleration structure matrix motion instance is defined by the
structure:</p>
</div>
<div id="VkAccelerationStructureMatrixMotionInstanceNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef struct VkAccelerationStructureMatrixMotionInstanceNV {
    VkTransformMatrixKHR          transformT0;
    VkTransformMatrixKHR          transformT1;
    uint32_t                      instanceCustomIndex:24;
    uint32_t                      mask:8;
    uint32_t                      instanceShaderBindingTableRecordOffset:24;
    VkGeometryInstanceFlagsKHR    flags:8;
    uint64_t                      accelerationStructureReference;
} VkAccelerationStructureMatrixMotionInstanceNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>transformT0</code> is a <a href="#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure describing a
transformation to be applied to the acceleration structure at time 0.</p>
</li>
<li>
<p><code>transformT1</code> is a <a href="#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure describing a
transformation to be applied to the acceleration structure at time 1.</p>
</li>
<li>
<p><code>instanceCustomIndex</code> is a 24-bit application-specified index value
accessible to ray shaders in the <code>InstanceCustomIndexKHR</code> built-in.</p>
</li>
<li>
<p><code>mask</code> is an 8-bit visibility mask for the geometry.
The instance <strong>may</strong> only be hit if <code>Cull Mask &amp; instance.mask != 0</code></p>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> is a 24-bit offset used in
calculating the hit shader binding table index.</p>
</li>
<li>
<p><code>flags</code> is an 8-bit mask of <a href="#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a>
values to apply to this instance.</p>
</li>
<li>
<p><code>accelerationStructureReference</code> is either:</p>
<div class="ulist">
<ul>
<li>
<p>a device address containing the value obtained from
<a href="resources.html#vkGetAccelerationStructureDeviceAddressKHR" class="xref page">vkGetAccelerationStructureDeviceAddressKHR</a>
or
<a href="resources.html#vkGetAccelerationStructureHandleNV" class="xref page">vkGetAccelerationStructureHandleNV</a>
     (used by device operations which reference acceleration structures) or,</p>
</li>
<li>
<p>a <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> object (used by host operations
which reference acceleration structures).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this structure produces the correct layout with existing
compilers.
The intended bit pattern is for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> and <code>mask</code> occupy the same memory as if a
single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> occupies the 24 least significant bits of
that memory</p>
</li>
<li>
<p><code>mask</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> and <code>flags</code> occupy the
same memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> occupies the 24 least
significant bits of that memory</p>
</li>
<li>
<p><code>flags</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong>must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="paragraph">
<p>The transform for a matrix motion instance at a point in time is derived by
component-wise linear interpolation of the two transforms.
That is, for a <code>time</code> in [0,1] the resulting transform is</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>transformT0</code> × (1 - <code>time</code>) + 
<code>transformT1</code> × <code>time</code></span></p>
</dd>
</dl>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureMatrixMotionInstanceNV-flags-parameter" href="#VUID-VkAccelerationStructureMatrixMotionInstanceNV-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMatrixMotionInstanceNV-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>An acceleration structure SRT motion instance is defined by the structure:</p>
</div>
<div id="VkAccelerationStructureSRTMotionInstanceNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef struct VkAccelerationStructureSRTMotionInstanceNV {
    VkSRTDataNV                   transformT0;
    VkSRTDataNV                   transformT1;
    uint32_t                      instanceCustomIndex:24;
    uint32_t                      mask:8;
    uint32_t                      instanceShaderBindingTableRecordOffset:24;
    VkGeometryInstanceFlagsKHR    flags:8;
    uint64_t                      accelerationStructureReference;
} VkAccelerationStructureSRTMotionInstanceNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>transformT0</code> is a <a href="#VkSRTDataNV">VkSRTDataNV</a> structure describing a
transformation to be applied to the acceleration structure at time 0.</p>
</li>
<li>
<p><code>transformT1</code> is a <a href="#VkSRTDataNV">VkSRTDataNV</a> structure describing a
transformation to be applied to the acceleration structure at time 1.</p>
</li>
<li>
<p><code>instanceCustomIndex</code> is a 24-bit application-specified index value
accessible to ray shaders in the <code>InstanceCustomIndexKHR</code> built-in.</p>
</li>
<li>
<p><code>mask</code> is an 8-bit visibility mask for the geometry.
The instance <strong>may</strong> only be hit if <code>Cull Mask &amp; instance.mask != 0</code></p>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> is a 24-bit offset used in
calculating the hit shader binding table index.</p>
</li>
<li>
<p><code>flags</code> is an 8-bit mask of <a href="#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a>
values to apply to this instance.</p>
</li>
<li>
<p><code>accelerationStructureReference</code> is either:</p>
<div class="ulist">
<ul>
<li>
<p>a device address containing the value obtained from
<a href="resources.html#vkGetAccelerationStructureDeviceAddressKHR" class="xref page">vkGetAccelerationStructureDeviceAddressKHR</a>
or
<a href="resources.html#vkGetAccelerationStructureHandleNV" class="xref page">vkGetAccelerationStructureHandleNV</a>
     (used by device operations which reference acceleration structures) or,</p>
</li>
<li>
<p>a <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> object (used by host operations
which reference acceleration structures).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this structure produces the correct layout with existing
compilers.
The intended bit pattern is for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> and <code>mask</code> occupy the same memory as if a
single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> occupies the 24 least significant bits of
that memory</p>
</li>
<li>
<p><code>mask</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> and <code>flags</code> occupy the
same memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> occupies the 24 least
significant bits of that memory</p>
</li>
<li>
<p><code>flags</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong>must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="paragraph">
<p>The transform for a SRT motion instance at a point in time is derived from
component-wise linear interpolation of the two SRT transforms.
That is, for a <code>time</code> in [0,1] the resulting transform is</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>transformT0</code> × (1 - <code>time</code>) + 
<code>transformT1</code> × <code>time</code></span></p>
</dd>
</dl>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureSRTMotionInstanceNV-flags-parameter" href="#VUID-VkAccelerationStructureSRTMotionInstanceNV-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureSRTMotionInstanceNV-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>An acceleration structure SRT transform is defined by the structure:</p>
</div>
<div id="VkSRTDataNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef struct VkSRTDataNV {
    float    sx;
    float    a;
    float    b;
    float    pvx;
    float    sy;
    float    c;
    float    pvy;
    float    sz;
    float    pvz;
    float    qx;
    float    qy;
    float    qz;
    float    qw;
    float    tx;
    float    ty;
    float    tz;
} VkSRTDataNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sx</code> is the x component of the scale of the transform</p>
</li>
<li>
<p><code>a</code> is one component of the shear for the transform</p>
</li>
<li>
<p><code>b</code> is one component of the shear for the transform</p>
</li>
<li>
<p><code>pvx</code> is the x component of the pivot point of the transform</p>
</li>
<li>
<p><code>sy</code> is the y component of the scale of the transform</p>
</li>
<li>
<p><code>c</code> is one component of the shear for the transform</p>
</li>
<li>
<p><code>pvy</code> is the y component of the pivot point of the transform</p>
</li>
<li>
<p><code>sz</code> is the z component of the scale of the transform</p>
</li>
<li>
<p><code>pvz</code> is the z component of the pivot point of the transform</p>
</li>
<li>
<p><code>qx</code> is the x component of the rotation quaternion</p>
</li>
<li>
<p><code>qy</code> is the y component of the rotation quaternion</p>
</li>
<li>
<p><code>qz</code> is the z component of the rotation quaternion</p>
</li>
<li>
<p><code>qw</code> is the w component of the rotation quaternion</p>
</li>
<li>
<p><code>tx</code> is the x component of the post-rotation translation</p>
</li>
<li>
<p><code>ty</code> is the y component of the post-rotation translation</p>
</li>
<li>
<p><code>tz</code> is the z component of the post-rotation translation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This transform decomposition consists of three elements.
The first is a matrix S, consisting of a scale, shear, and translation,
usually used to define the pivot point of the following rotation.
This matrix is constructed from the parameters above by:</p>
</div>
<div class="stemblock">
  <div class="content halign-center valign-middle" style="padding-top: 1rem">
<svg style="vertical-align: -3.733ex; overflow: visible;" xmlns="http://www.w3.org/2000/svg" width="25.39ex" height="8.597ex" role="img" focusable="false" viewBox="0 -2150 11222.6 3800"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D446" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path></g><g data-mml-node="mo" transform="translate(922.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mrow" transform="translate(1978.6,0)"><g data-mml-node="mo"><path data-c="239B" d="M837 1154Q843 1148 843 1145Q843 1141 818 1106T753 1002T667 841T574 604T494 299Q417 -84 417 -609Q417 -641 416 -647T411 -654Q409 -655 366 -655Q299 -655 297 -654Q292 -652 292 -643T291 -583Q293 -400 304 -242T347 110T432 470T574 813T785 1136Q787 1139 790 1142T794 1147T796 1150T799 1152T802 1153T807 1154T813 1154H819H837Z" transform="translate(0,996)"></path><path data-c="239D" d="M843 -635Q843 -638 837 -644H820Q801 -644 800 -643Q792 -635 785 -626Q684 -503 605 -363T473 -75T385 216T330 518T302 809T291 1093Q291 1144 291 1153T296 1164Q298 1165 366 1165Q409 1165 411 1164Q415 1163 416 1157T417 1119Q417 529 517 109T833 -617Q843 -631 843 -635Z" transform="translate(0,-1006)"></path><svg width="875" height="382" y="59" x="0" viewBox="0 86.3 875 382"><path data-c="239C" d="M413 -9Q412 -9 407 -9T388 -10T354 -10Q300 -10 297 -9Q294 -8 293 -5Q291 5 291 127V300Q291 602 292 605L296 609Q298 610 366 610Q382 610 392 610T407 610T412 609Q416 609 416 592T417 473V127Q417 -9 413 -9Z" transform="scale(1,0.924)"></path></svg></g><g data-mml-node="mtable" transform="translate(875,0)"><g data-mml-node="mtr" transform="translate(0,1400)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g><g data-mml-node="mtd" transform="translate(2256,0)"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g></g><g data-mml-node="mtd" transform="translate(4252.5,0)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g></g><g data-mml-node="mtd" transform="translate(5934,0)"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mi" transform="translate(988,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g></g><g data-mml-node="mtr"><g data-mml-node="mtd" transform="translate(270.5,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(2041,0)"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mtd" transform="translate(4250.5,0)"><g data-mml-node="mi"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g></g><g data-mml-node="mtd" transform="translate(5975,0)"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mi" transform="translate(988,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-1400)"><g data-mml-node="mtd" transform="translate(270.5,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(2270.5,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(4000,0)"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g></g><g data-mml-node="mtd" transform="translate(5987.5,0)"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mi" transform="translate(988,0)"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(8369,0)"><path data-c="239E" d="M31 1143Q31 1154 49 1154H59Q72 1154 75 1152T89 1136Q190 1013 269 873T401 585T489 294T544 -8T572 -299T583 -583Q583 -634 583 -643T577 -654Q575 -655 508 -655Q465 -655 463 -654Q459 -653 458 -647T457 -609Q457 -58 371 340T100 1037Q87 1059 61 1098T31 1143Z" transform="translate(0,996)"></path><path data-c="23A0" d="M56 -644H50Q31 -644 31 -635Q31 -632 37 -622Q69 -579 100 -527Q286 -228 371 170T457 1119Q457 1161 462 1164Q464 1165 520 1165Q575 1165 577 1164Q582 1162 582 1153T583 1093Q581 910 570 752T527 400T442 40T300 -303T89 -626Q78 -640 75 -642T61 -644H56Z" transform="translate(0,-1006)"></path><svg width="875" height="382" y="59" x="0" viewBox="0 86.3 875 382"><path data-c="239F" d="M579 -9Q578 -9 573 -9T554 -10T520 -10Q466 -10 463 -9Q460 -8 459 -5Q457 5 457 127V300Q457 602 458 605L462 609Q464 610 532 610Q548 610 558 610T573 610T578 609Q582 609 582 592T583 473V127Q583 -9 579 -9Z" transform="scale(1,0.924)"></path></svg></g></g></g></g></svg>
  </div>
</div>
<div class="paragraph">
<p>The rotation quaternion is defined as:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>R</code> = [ <code>qx</code>, <code>qy</code>, <code>qz</code>, <code>qw</code> ]</span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This is a rotation around a conceptual normalized axis <span class="eq">[ ax, ay, az ]</span>
of amount <code>theta</code> such that:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq">[ <code>qx</code>, <code>qy</code>, <code>qz</code> ] = sin(<code>theta</code>/2)
× [ <code>ax</code>, <code>ay</code>, <code>az</code> ]</span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>qw</code> = cos(<code>theta</code>/2)</span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Finally, the transform has a translation T constructed from the parameters
above by:</p>
</div>
<div class="stemblock">
  <div class="content halign-center valign-middle" style="padding-top: 1rem">
<svg style="vertical-align: -3.733ex; overflow: visible;" xmlns="http://www.w3.org/2000/svg" width="20.861ex" height="8.597ex" role="img" focusable="false" viewBox="0 -2150 9220.6 3800"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mo" transform="translate(981.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mrow" transform="translate(2037.6,0)"><g data-mml-node="mo"><path data-c="239B" d="M837 1154Q843 1148 843 1145Q843 1141 818 1106T753 1002T667 841T574 604T494 299Q417 -84 417 -609Q417 -641 416 -647T411 -654Q409 -655 366 -655Q299 -655 297 -654Q292 -652 292 -643T291 -583Q293 -400 304 -242T347 110T432 470T574 813T785 1136Q787 1139 790 1142T794 1147T796 1150T799 1152T802 1153T807 1154T813 1154H819H837Z" transform="translate(0,996)"></path><path data-c="239D" d="M843 -635Q843 -638 837 -644H820Q801 -644 800 -643Q792 -635 785 -626Q684 -503 605 -363T473 -75T385 216T330 518T302 809T291 1093Q291 1144 291 1153T296 1164Q298 1165 366 1165Q409 1165 411 1164Q415 1163 416 1157T417 1119Q417 529 517 109T833 -617Q843 -631 843 -635Z" transform="translate(0,-1006)"></path><svg width="875" height="382" y="59" x="0" viewBox="0 86.3 875 382"><path data-c="239C" d="M413 -9Q412 -9 407 -9T388 -10T354 -10Q300 -10 297 -9Q294 -8 293 -5Q291 5 291 127V300Q291 602 292 605L296 609Q298 610 366 610Q382 610 392 610T407 610T412 609Q416 609 416 592T417 473V127Q417 -9 413 -9Z" transform="scale(1,0.924)"></path></svg></g><g data-mml-node="mtable" transform="translate(875,0)"><g data-mml-node="mtr" transform="translate(0,1400)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(4500,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(361,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g></g><g data-mml-node="mtr"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(4541,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(361,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-1400)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(4553.5,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(361,0)"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(6308,0)"><path data-c="239E" d="M31 1143Q31 1154 49 1154H59Q72 1154 75 1152T89 1136Q190 1013 269 873T401 585T489 294T544 -8T572 -299T583 -583Q583 -634 583 -643T577 -654Q575 -655 508 -655Q465 -655 463 -654Q459 -653 458 -647T457 -609Q457 -58 371 340T100 1037Q87 1059 61 1098T31 1143Z" transform="translate(0,996)"></path><path data-c="23A0" d="M56 -644H50Q31 -644 31 -635Q31 -632 37 -622Q69 -579 100 -527Q286 -228 371 170T457 1119Q457 1161 462 1164Q464 1165 520 1165Q575 1165 577 1164Q582 1162 582 1153T583 1093Q581 910 570 752T527 400T442 40T300 -303T89 -626Q78 -640 75 -642T61 -644H56Z" transform="translate(0,-1006)"></path><svg width="875" height="382" y="59" x="0" viewBox="0 86.3 875 382"><path data-c="239F" d="M579 -9Q578 -9 573 -9T554 -10T520 -10Q466 -10 463 -9Q460 -8 459 -5Q457 5 457 127V300Q457 602 458 605L462 609Q464 610 532 610Q548 610 558 610T573 610T578 609Q582 609 582 592T583 473V127Q583 -9 579 -9Z" transform="scale(1,0.924)"></path></svg></g></g></g></g></svg>
  </div>
</div>
<div class="paragraph">
<p>The effective derived transform is then given by</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>T</code> × <code>R</code> × <code>S</code></span></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><code>VkAccelerationStructureBuildRangeInfoKHR</code> is defined as:</p>
</div>
<div id="VkAccelerationStructureBuildRangeInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureBuildRangeInfoKHR {
    uint32_t    primitiveCount;
    uint32_t    primitiveOffset;
    uint32_t    firstVertex;
    uint32_t    transformOffset;
} VkAccelerationStructureBuildRangeInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>primitiveCount</code> defines the number of primitives for a
corresponding acceleration structure geometry.</p>
</li>
<li>
<p><code>primitiveOffset</code> defines an offset in bytes into the memory where
primitive data is defined.</p>
</li>
<li>
<p><code>firstVertex</code> is the index of the first vertex to build from for
triangle geometry.</p>
</li>
<li>
<p><code>transformOffset</code> defines an offset in bytes into the memory where a
transform matrix is defined.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The primitive count and primitive offset are interpreted differently
depending on the <a href="resources.html#VkGeometryTypeKHR" class="xref page">VkGeometryTypeKHR</a> used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For geometries of type <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>primitiveCount</code> is the number of triangles to be built, where each
triangle is treated as 3 vertices.</p>
<div class="ulist">
<ul>
<li>
<p>If the geometry uses indices, <span class="eq"><code>primitiveCount</code> × 3</span>
indices are consumed from
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>indexData</code>,
starting at an offset of <code>primitiveOffset</code>.
The value of <code>firstVertex</code> is added to the index values before
fetching vertices.</p>
</li>
<li>
<p>If the geometry does not use indices, <span class="eq"><code>primitiveCount</code> ×
3</span> vertices are consumed from
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexData</code>,
starting at an offset of <span class="eq"><code>primitiveOffset</code> + 
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexStride</code>
× <code>firstVertex</code></span>.</p>
</li>
<li>
<p>If
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>transformData</code>
is not <code>NULL</code>, a single <a href="#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure is
consumed from
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>transformData</code>,
at an offset of <code>transformOffset</code>.
This matrix describes a transformation from the space in which the
vertices for all triangles in this geometry are described to the space
in which the acceleration structure is defined.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For geometries of type <code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>primitiveCount</code> is the number of axis-aligned bounding boxes.
<code>primitiveCount</code> <a href="#VkAabbPositionsKHR">VkAabbPositionsKHR</a> structures are consumed
from <a href="#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a>::<code>data</code>,
starting at an offset of <code>primitiveOffset</code>.</p>
</li>
<li>
<p>For geometries of type <code>VK_GEOMETRY_TYPE_SPHERES_NV</code>,
<code>primitiveCount</code> is the number of spheres to be built, where each
sphere is treated as 1 vertex.</p>
<div class="ulist">
<ul>
<li>
<p>If the geometry uses indices, <code>primitiveCount</code> indices are consumed
from
<a href="#VkAccelerationStructureGeometrySpheresDataNV">VkAccelerationStructureGeometrySpheresDataNV</a>::<code>indexData</code>,
starting at an offset of <code>primitiveOffset</code>.
The value of <code>firstVertex</code> is added to the index values before
fetching vertices and radii.</p>
</li>
<li>
<p>If the geometry does not use indices, <code>primitiveCount</code> vertices and
radii are consumed from
<a href="#VkAccelerationStructureGeometrySpheresDataNV">VkAccelerationStructureGeometrySpheresDataNV</a>::<code>vertexData</code>,
starting at an offset of <span class="eq"><code>primitiveOffset</code> + 
<a href="#VkAccelerationStructureGeometrySpheresDataNV">VkAccelerationStructureGeometrySpheresDataNV</a>::<code>vertexStride</code>
× <code>firstVertex</code></span> and
<a href="#VkAccelerationStructureGeometrySpheresDataNV">VkAccelerationStructureGeometrySpheresDataNV</a>::<code>radiusData</code>,
starting at an offset of <span class="eq"><code>primitiveOffset</code> + 
<a href="#VkAccelerationStructureGeometrySpheresDataNV">VkAccelerationStructureGeometrySpheresDataNV</a>::<code>radiusStride</code>
× <code>firstVertex</code></span> respectively.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For geometries of type <code>VK_GEOMETRY_TYPE_LINEAR_SWEPT_SPHERES_NV</code>,
<code>primitiveCount</code> is the number of LSS primitives to be built, where
each LSS primitive is treated as 2 vertices.</p>
<div class="ulist">
<ul>
<li>
<p>If the geometry uses indices, <span class="eq"><code>primitiveCount</code> × 2</span>
indices are consumed from
<a href="#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>indexData</code>,
starting at an offset of <code>primitiveOffset</code>.
The value of <code>firstVertex</code> is added to the index values before
fetching vertices and radii.</p>
</li>
<li>
<p>If the geometry does not use indices, <span class="eq"><code>primitiveCount</code> ×
2</span> vertices and radii are consumed from
<a href="#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>vertexData</code>,
starting at an offset of <span class="eq"><code>primitiveOffset</code> + 
<a href="#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>vertexStride</code>
× <code>firstVertex</code></span> and
<a href="#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>radiusData</code>,
starting at an offset of <span class="eq"><code>primitiveOffset</code> + 
<a href="#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>radiusStride</code>
× <code>firstVertex</code></span> respectively.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For geometries of type <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>,
<code>primitiveCount</code> is the number of acceleration structures.
<code>primitiveCount</code> <a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>
or <a href="#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a>
structures are consumed from
<a href="#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>data</code>,
starting at an offset of <code>primitiveOffset</code>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-vertexData-10418" href="#VUID-VkAccelerationStructureBuildRangeInfoKHR-vertexData-10418"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-vertexData-10418</span><br>

The number of vertices consumed from
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexData</code>
<strong>must</strong> be less than or equal to
<span class="eq"><a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>maxVertex</code>
+ 1</span></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03656" href="#VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03656"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03656</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if the
geometry uses indices, the offset <code>primitiveOffset</code> from
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>indexData</code>
<strong>must</strong> be a multiple of the element size of
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>indexType</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03657" href="#VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03657"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03657</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if the
geometry does not use indices, the offset <code>primitiveOffset</code> from
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexData</code>
<strong>must</strong> be a multiple of:</p>
<div class="ulist">
<ul>
<li>
<p>the <a href="formats.html#formats" class="xref page">size of the format</a> specified in
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexFormat</code>,
if that format is a <a href="formats.html#formats-packed" class="xref page">packed format</a></p>
</li>
<li>
<p>the <a href="formats.html#formats" class="xref page">component size</a> of the
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexFormat</code>,
if that format is not a <a href="formats.html#formats-packed" class="xref page">packed format</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-transformOffset-03658" href="#VUID-VkAccelerationStructureBuildRangeInfoKHR-transformOffset-03658"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-transformOffset-03658</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, the offset
<code>transformOffset</code> from
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>transformData</code>
<strong>must</strong> be a multiple of 16</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03659" href="#VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03659"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03659</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, the offset
<code>primitiveOffset</code> from
<a href="#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a>::<code>data</code> <strong>must</strong> be a
multiple of 8</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03660" href="#VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03660"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03660</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the offset
<code>primitiveOffset</code> from
<a href="#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>data</code> <strong>must</strong>
be a multiple of 16</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If <code>VkAccelerationStructureGeometryLinearSweptSpheresDataNV</code> is included
in the <code>pNext</code> chain of a <a href="#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a>
structure, then that structures defines the linear swept sphere&#8217;s (LSS)
geometry data.</p>
</div>
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryLinearSweptSpheresDataNV</code> structure
is defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryLinearSweptSpheresDataNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_linear_swept_spheres
typedef struct VkAccelerationStructureGeometryLinearSweptSpheresDataNV {
    VkStructureType                          sType;
    const void*                              pNext;
    VkFormat                                 vertexFormat;
    VkDeviceOrHostAddressConstKHR            vertexData;
    VkDeviceSize                             vertexStride;
    VkFormat                                 radiusFormat;
    VkDeviceOrHostAddressConstKHR            radiusData;
    VkDeviceSize                             radiusStride;
    VkIndexType                              indexType;
    VkDeviceOrHostAddressConstKHR            indexData;
    VkDeviceSize                             indexStride;
    VkRayTracingLssIndexingModeNV            indexingMode;
    VkRayTracingLssPrimitiveEndCapsModeNV    endCapsMode;
} VkAccelerationStructureGeometryLinearSweptSpheresDataNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>vertexFormat</code> is the <a href="formats.html#VkFormat" class="xref page">VkFormat</a> of each LSS vertex element.</p>
</li>
<li>
<p><code>vertexData</code> is a device or host address to memory containing vertex
data for this geometry.</p>
</li>
<li>
<p><code>vertexStride</code> is the stride in bytes between each vertex element.</p>
</li>
<li>
<p><code>radiusFormat</code> is the <a href="formats.html#VkFormat" class="xref page">VkFormat</a> of each LSS radius.</p>
</li>
<li>
<p><code>radiusData</code> is a device or host address to memory containing LSS
radius data value.</p>
</li>
<li>
<p><code>radiusStride</code> is the stride in bytes between each radius value.</p>
</li>
<li>
<p><code>indexType</code> is the <a href="drawing.html#VkIndexType" class="xref page">VkIndexType</a> of each index element.</p>
</li>
<li>
<p><code>indexData</code> is <code>NULL</code> or a device or host address to memory
containing index data for vertex and radius buffers for this geometry.</p>
</li>
<li>
<p><code>indexStride</code> is the stride in bytes between each index element.</p>
</li>
<li>
<p><code>indexingMode</code> is a <a href="#VkRayTracingLssIndexingModeNV">VkRayTracingLssIndexingModeNV</a> value
specifying the mode of indexing.</p>
</li>
<li>
<p><code>endCapsMode</code> is a <a href="#VkRayTracingLssPrimitiveEndCapsModeNV">VkRayTracingLssPrimitiveEndCapsModeNV</a> value
specifying the endcaps mode for LSS primitives.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an index buffer is not specified in <code>indexData</code>, LSS primitives are
rendered individually using subsequent pairs of vertices similar to
<code>VK_PRIMITIVE_TOPOLOGY_LINE_LIST</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-None-10419" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-None-10419"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-None-10419</span><br>

The <a href="features.html#features-linearSweptSpheres" class="xref page">linearSweptSpheres</a> feature <strong>must</strong> be
enabled</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexData-10420" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexData-10420"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexData-10420</span><br>

The memory address in <code>vertexData</code> <strong>must</strong> not be <code>0</code> or `NULL'</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexStride-10421" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexStride-10421"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexStride-10421</span><br>

<code>vertexStride</code> <strong>must</strong> be a multiple of:</p>
<div class="ulist">
<ul>
<li>
<p>the <a href="formats.html#formats" class="xref page">size of the format</a> specified in <code>vertexFormat</code> if
that format is a <a href="formats.html#formats-packed" class="xref page">packed format</a></p>
</li>
<li>
<p>the <a href="formats.html#formats" class="xref page">component size</a> specified in <code>vertexFormat</code> if that
format is not a <a href="formats.html#formats-packed" class="xref page">packed format</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexStride-10422" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexStride-10422"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexStride-10422</span><br>

<code>vertexStride</code> and <code>radiusStride</code> <strong>must</strong> be less than or equal to
<span class="eq">2<sup>32</sup>-1</span></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexFormat-10423" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexFormat-10423"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexFormat-10423</span><br>

The <a href="resources.html#resources-buffer-view-format-features" class="xref page">format features</a> of
<code>vertexFormat</code> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_ACCELERATION_STRUCTURE_VERTEX_BUFFER_BIT_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusFormat-10424" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusFormat-10424"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusFormat-10424</span><br>

The <a href="resources.html#resources-buffer-view-format-features" class="xref page">format features</a> of
<code>radiusFormat</code> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_ACCELERATION_STRUCTURE_RADIUS_BUFFER_BIT_NV</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-10425" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-10425"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-10425</span><br>

The memory address in <code>radiusData</code> <strong>must</strong> not be <code>0</code> or `NULL'</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-10426" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-10426"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-10426</span><br>

All values referenced in <code>radiusData</code> <strong>must</strong> be greater than or equal
to <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexingMode-10427" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexingMode-10427"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexingMode-10427</span><br>

If <code>indexingMode</code> is
<code>VK_RAY_TRACING_LSS_INDEXING_MODE_SUCCESSIVE_NV</code>, <code>indexData</code>
<strong>must</strong> not be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexData-10428" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexData-10428"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexData-10428</span><br>

If <code>indexData</code> is not <code>NULL</code>, <code>indexType</code> <strong>must</strong> be one of
<code>VK_INDEX_TYPE_UINT16</code> or <code>VK_INDEX_TYPE_UINT32</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-sType-sType" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_LINEAR_SWEPT_SPHERES_DATA_NV</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexFormat-parameter" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexFormat-parameter</span><br>
 <code>vertexFormat</code> <strong>must</strong> be a valid <a href="formats.html#VkFormat" class="xref page">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexData-parameter" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexData-parameter</span><br>
 <code>vertexData</code> <strong>must</strong> be a valid <a href="#VkDeviceOrHostAddressConstKHR">VkDeviceOrHostAddressConstKHR</a> union</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusFormat-parameter" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusFormat-parameter</span><br>
 <code>radiusFormat</code> <strong>must</strong> be a valid <a href="formats.html#VkFormat" class="xref page">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-parameter" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-parameter</span><br>
 <code>radiusData</code> <strong>must</strong> be a valid <a href="#VkDeviceOrHostAddressConstKHR">VkDeviceOrHostAddressConstKHR</a> union</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexType-parameter" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexType-parameter</span><br>
 <code>indexType</code> <strong>must</strong> be a valid <a href="drawing.html#VkIndexType" class="xref page">VkIndexType</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexData-parameter" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexData-parameter</span><br>
 <code>indexData</code> <strong>must</strong> be a valid <a href="#VkDeviceOrHostAddressConstKHR">VkDeviceOrHostAddressConstKHR</a> union</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexingMode-parameter" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexingMode-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexingMode-parameter</span><br>
 <code>indexingMode</code> <strong>must</strong> be a valid <a href="#VkRayTracingLssIndexingModeNV">VkRayTracingLssIndexingModeNV</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-endCapsMode-parameter" href="#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-endCapsMode-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-endCapsMode-parameter</span><br>
 <code>endCapsMode</code> <strong>must</strong> be a valid <a href="#VkRayTracingLssPrimitiveEndCapsModeNV">VkRayTracingLssPrimitiveEndCapsModeNV</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Chaining LSS primitives <strong>can</strong> be achieved by specifying an index buffer in
<a href="#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>indexData</code>
and setting
<a href="#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>indexingMode</code>
to one of <code>VkRayTracingLssIndexingModeNV</code> values:</p>
</div>
<div id="VkRayTracingLssIndexingModeNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_linear_swept_spheres
typedef enum VkRayTracingLssIndexingModeNV {
    VK_RAY_TRACING_LSS_INDEXING_MODE_LIST_NV = 0,
    VK_RAY_TRACING_LSS_INDEXING_MODE_SUCCESSIVE_NV = 1,
} VkRayTracingLssIndexingModeNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_RAY_TRACING_LSS_INDEXING_MODE_LIST_NV</code> specifies that a list of
indices is provided where each consecutive pair of indices define a LSS
primitive.</p>
</li>
<li>
<p><code>VK_RAY_TRACING_LSS_INDEXING_MODE_SUCCESSIVE_NV</code> specifies a
successive implicit indexing format, in which each LSS primitive is
defined by two successive positions and radii, <span class="eq">(k, k + 1)</span>, where
<span class="eq">k</span> is a single index provided in the index buffer.
In this indexing scheme, there is a 1:1 mapping between the index buffer
and primitive index within the geometry.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The default behavior with endcaps in a LSS chain is that both endcaps will
be enabled for all beginning and end points.
To change the LSS chain&#8217;s endcaps mode use
<a href="#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>endCapsMode</code>.
The possible values for <code>endCapsMode</code> are:</p>
</div>
<div id="VkRayTracingLssPrimitiveEndCapsModeNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_linear_swept_spheres
typedef enum VkRayTracingLssPrimitiveEndCapsModeNV {
    VK_RAY_TRACING_LSS_PRIMITIVE_END_CAPS_MODE_NONE_NV = 0,
    VK_RAY_TRACING_LSS_PRIMITIVE_END_CAPS_MODE_CHAINED_NV = 1,
} VkRayTracingLssPrimitiveEndCapsModeNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_RAY_TRACING_LSS_PRIMITIVE_END_CAPS_MODE_NONE_NV</code> disables all
endcaps and the chain boundaries have no influence.</p>
</li>
<li>
<p><code>VK_RAY_TRACING_LSS_PRIMITIVE_END_CAPS_MODE_CHAINED_NV</code> specifies
that when <code>VK_RAY_TRACING_LSS_INDEXING_MODE_SUCCESSIVE_NV</code> is used
as indexing mode for the LSS primitive, the first primitive in each
chain will have both endcaps enabled, and every following primitive in
the chain only has endcaps at the trailing position enabled.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>In addition to LSS primitives, simple sphere geometry is also supported.
Spheres do not have an endcap mode.
If an index buffer is present, each entry represents a single position and
radius describing one sphere primitive.
If no index buffer is provided, the vertex position and radius values are
sequentially read from the corresponding buffers.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If <code>VkAccelerationStructureGeometrySpheresDataNV</code> is included in the
<code>pNext</code> chain of a <a href="#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structure,
then that structures defines the sphere&#8217;s geometry data.</p>
</div>
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometrySpheresDataNV</code> structure is defined
as:</p>
</div>
<div id="VkAccelerationStructureGeometrySpheresDataNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_linear_swept_spheres
typedef struct VkAccelerationStructureGeometrySpheresDataNV {
    VkStructureType                  sType;
    const void*                      pNext;
    VkFormat                         vertexFormat;
    VkDeviceOrHostAddressConstKHR    vertexData;
    VkDeviceSize                     vertexStride;
    VkFormat                         radiusFormat;
    VkDeviceOrHostAddressConstKHR    radiusData;
    VkDeviceSize                     radiusStride;
    VkIndexType                      indexType;
    VkDeviceOrHostAddressConstKHR    indexData;
    VkDeviceSize                     indexStride;
} VkAccelerationStructureGeometrySpheresDataNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>vertexFormat</code> is the <a href="formats.html#VkFormat" class="xref page">VkFormat</a> of each sphere&#8217;s vertex
element.</p>
</li>
<li>
<p><code>vertexData</code> is a device or host address to memory containing vertex
data in form of pairs of centers of spheres that define all sphere
geometry.</p>
</li>
<li>
<p><code>vertexStride</code> is the stride in bytes between each vertex element.</p>
</li>
<li>
<p><code>radiusFormat</code> is the <a href="formats.html#VkFormat" class="xref page">VkFormat</a> of each sphere&#8217;s radius.</p>
</li>
<li>
<p><code>radiusData</code> is a device or host address to memory containing
sphere&#8217;s radius data value.</p>
</li>
<li>
<p><code>radiusStride</code> is the stride in bytes between each radius value.</p>
</li>
<li>
<p><code>indexType</code> is the <a href="drawing.html#VkIndexType" class="xref page">VkIndexType</a> of each index element.</p>
</li>
<li>
<p><code>indexData</code> is <code>NULL</code> or a device or host address to memory
containing index data for vertex and radius buffers for this geometry.</p>
</li>
<li>
<p><code>indexStride</code> is the stride in bytes between each index element.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-None-10429" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-None-10429"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-None-10429</span><br>

The <a href="features.html#features-spheres" class="xref page">spheres</a> feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexData-10430" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexData-10430"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexData-10430</span><br>

The memory address in <code>vertexData</code> <strong>must</strong> not be <code>0</code> or `NULL'</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexStride-10431" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexStride-10431"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexStride-10431</span><br>

<code>vertexStride</code> <strong>must</strong> be a multiple of:</p>
<div class="ulist">
<ul>
<li>
<p>the <a href="formats.html#formats" class="xref page">size of the format</a> specified in <code>vertexFormat</code> if
that format is a <a href="formats.html#formats-packed" class="xref page">packed format</a></p>
</li>
<li>
<p>the smallest <a href="formats.html#formats" class="xref page">component size</a> specified in
<code>vertexFormat</code> if that format is not a <a href="formats.html#formats-packed" class="xref page">packed    format</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexStride-10432" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexStride-10432"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexStride-10432</span><br>

<code>vertexStride</code> and <code>radiusStride</code> <strong>must</strong> be less than or equal to
<span class="eq">2<sup>32</sup>-1</span></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-10433" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-10433"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-10433</span><br>

The memory address in <code>radiusData</code> <strong>must</strong> not be <code>0</code> or `NULL'</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexFormat-10434" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexFormat-10434"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexFormat-10434</span><br>

The <a href="resources.html#resources-buffer-view-format-features" class="xref page">format features</a> of
<code>vertexFormat</code> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_ACCELERATION_STRUCTURE_VERTEX_BUFFER_BIT_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusFormat-10435" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusFormat-10435"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusFormat-10435</span><br>

The <a href="resources.html#resources-buffer-view-format-features" class="xref page">format features</a> of
<code>radiusFormat</code> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_2_ACCELERATION_STRUCTURE_RADIUS_BUFFER_BIT_NV</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-10436" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-10436"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-10436</span><br>

All values referenced in <code>radiusData</code> <strong>must</strong> be greater than or equal
to <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-indexData-10437" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-indexData-10437"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-indexData-10437</span><br>

If <code>indexData</code> is not <code>NULL</code>, <code>indexType</code> <strong>must</strong> be one of
<code>VK_INDEX_TYPE_UINT16</code> or <code>VK_INDEX_TYPE_UINT32</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-sType-sType" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_SPHERES_DATA_NV</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexFormat-parameter" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexFormat-parameter</span><br>
 <code>vertexFormat</code> <strong>must</strong> be a valid <a href="formats.html#VkFormat" class="xref page">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexData-parameter" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexData-parameter</span><br>
 <code>vertexData</code> <strong>must</strong> be a valid <a href="#VkDeviceOrHostAddressConstKHR">VkDeviceOrHostAddressConstKHR</a> union</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusFormat-parameter" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusFormat-parameter</span><br>
 <code>radiusFormat</code> <strong>must</strong> be a valid <a href="formats.html#VkFormat" class="xref page">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-parameter" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-parameter</span><br>
 <code>radiusData</code> <strong>must</strong> be a valid <a href="#VkDeviceOrHostAddressConstKHR">VkDeviceOrHostAddressConstKHR</a> union</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-indexType-parameter" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-indexType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-indexType-parameter</span><br>
 <code>indexType</code> <strong>must</strong> be a valid <a href="drawing.html#VkIndexType" class="xref page">VkIndexType</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-indexData-parameter" href="#VUID-VkAccelerationStructureGeometrySpheresDataNV-indexData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-indexData-parameter</span><br>
 <code>indexData</code> <strong>must</strong> be a valid <a href="#VkDeviceOrHostAddressConstKHR">VkDeviceOrHostAddressConstKHR</a> union</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-copying"><a class="anchor" href="#acceleration-structure-copying"></a>Copying Acceleration Structures</h3>
<div class="paragraph">
<p>An additional command exists for copying acceleration structures without
updating their contents.
The acceleration structure object <strong>can</strong> be compacted in order to improve
performance.
Before copying, an application <strong>must</strong> query the size of the resulting
acceleration structure.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query acceleration structure size parameters call:</p>
</div>
<div id="vkCmdWriteAccelerationStructuresPropertiesKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
void vkCmdWriteAccelerationStructuresPropertiesKHR(
    VkCommandBuffer                             commandBuffer,
    uint32_t                                    accelerationStructureCount,
    const VkAccelerationStructureKHR*           pAccelerationStructures,
    VkQueryType                                 queryType,
    VkQueryPool                                 queryPool,
    uint32_t                                    firstQuery);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>accelerationStructureCount</code> is the count of acceleration structures
for which to query the property.</p>
</li>
<li>
<p><code>pAccelerationStructures</code> is a pointer to an array of existing
previously built acceleration structures.</p>
</li>
<li>
<p><code>queryType</code> is a <a href="queries.html#VkQueryType" class="xref page">VkQueryType</a> value specifying the type of
queries managed by the pool.</p>
</li>
<li>
<p><code>queryPool</code> is the query pool that will manage the results of the
query.</p>
</li>
<li>
<p><code>firstQuery</code> is the first query index within the query pool that
will contain the <code>accelerationStructureCount</code> number of results.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to any of the acceleration structures listed in
<code>pAccelerationStructures</code> <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, then the
value written out is the number of bytes required by a compacted
acceleration structure.</p>
</li>
<li>
<p>If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code>, then
the value written out is the number of bytes required by a serialized
acceleration structure.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructure-08924" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructure-08924"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructure-08924</span><br>

The <a href="features.html#features-accelerationStructure" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02493" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02493"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02493</span><br>

<code>queryPool</code> <strong>must</strong> have been created with a <code>queryType</code> matching
<code>queryType</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02494" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02494"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02494</span><br>

The queries identified by <code>queryPool</code> and <code>firstQuery</code> <strong>must</strong> be
<em>unavailable</em></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-buffer-03736" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-buffer-03736"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-buffer-03736</span><br>

The <code>buffer</code> used to create each acceleration structure in
<code>pAccelerationStructures</code> <strong>must</strong> be bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-query-04880" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-query-04880"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-query-04880</span><br>

The sum of <code>firstQuery</code> plus <code>accelerationStructureCount</code> <strong>must</strong>
be less than or equal to the number of queries in <code>queryPool</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> if
<code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-06742" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-06742"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-06742</span><br>

<code>queryType</code> <strong>must</strong> be
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SIZE_KHR</code>,
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>,
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, or
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter</span><br>
 <code>pAccelerationStructures</code> <strong>must</strong> be a valid pointer to an array of <code>accelerationStructureCount</code> valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handles</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-parameter</span><br>
 <code>queryType</code> <strong>must</strong> be a valid <a href="queries.html#VkQueryType" class="xref page">VkQueryType</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-parameter</span><br>
 <code>queryPool</code> <strong>must</strong> be a valid <a href="queries.html#VkQueryPool" class="xref page">VkQueryPool</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-recording" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-cmdpool" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-renderpass" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-renderpass"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-videocoding" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-videocoding"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength</span><br>
 <code>accelerationStructureCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commonparent" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commonparent"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commonparent</span><br>
 Each of <code>commandBuffer</code>, <code>queryPool</code>, and the elements of <code>pAccelerationStructures</code> <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query acceleration structure size parameters call:</p>
</div>
<div id="vkCmdWriteAccelerationStructuresPropertiesNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
void vkCmdWriteAccelerationStructuresPropertiesNV(
    VkCommandBuffer                             commandBuffer,
    uint32_t                                    accelerationStructureCount,
    const VkAccelerationStructureNV*            pAccelerationStructures,
    VkQueryType                                 queryType,
    VkQueryPool                                 queryPool,
    uint32_t                                    firstQuery);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>accelerationStructureCount</code> is the count of acceleration structures
for which to query the property.</p>
</li>
<li>
<p><code>pAccelerationStructures</code> is a pointer to an array of existing
previously built acceleration structures.</p>
</li>
<li>
<p><code>queryType</code> is a <a href="queries.html#VkQueryType" class="xref page">VkQueryType</a> value specifying the type of
queries managed by the pool.</p>
</li>
<li>
<p><code>queryPool</code> is the query pool that will manage the results of the
query.</p>
</li>
<li>
<p><code>firstQuery</code> is the first query index within the query pool that
will contain the <code>accelerationStructureCount</code> number of results.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to any of the acceleration structures listed in
<code>pAccelerationStructures</code> <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03755" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03755"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03755</span><br>

<code>queryPool</code> <strong>must</strong> have been created with a <code>queryType</code> matching
<code>queryType</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03756" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03756"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03756</span><br>

The queries identified by <code>queryPool</code> and <code>firstQuery</code> <strong>must</strong> be
<em>unavailable</em></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructure-03757" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructure-03757"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructure-03757</span><br>

<code>accelerationStructure</code> <strong>must</strong> be bound completely and contiguously
to a single <code>VkDeviceMemory</code> object via
<a href="resources.html#vkBindAccelerationStructureMemoryNV" class="xref page">vkBindAccelerationStructureMemoryNV</a></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-04958" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-04958"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-04958</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-06215" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-06215"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-06215</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> if
<code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_NV</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-06216" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-06216"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-06216</span><br>

<code>queryType</code> <strong>must</strong> be
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_NV</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-parameter</span><br>
 <code>pAccelerationStructures</code> <strong>must</strong> be a valid pointer to an array of <code>accelerationStructureCount</code> valid <a href="resources.html#VkAccelerationStructureNV" class="xref page">VkAccelerationStructureNV</a> handles</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-parameter</span><br>
 <code>queryType</code> <strong>must</strong> be a valid <a href="queries.html#VkQueryType" class="xref page">VkQueryType</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-parameter</span><br>
 <code>queryPool</code> <strong>must</strong> be a valid <a href="queries.html#VkQueryPool" class="xref page">VkQueryPool</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-recording" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-cmdpool" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-renderpass" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-renderpass"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-videocoding" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-videocoding"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructureCount-arraylength" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructureCount-arraylength"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructureCount-arraylength</span><br>
 <code>accelerationStructureCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commonparent" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commonparent"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commonparent</span><br>
 Each of <code>commandBuffer</code>, <code>queryPool</code>, and the elements of <code>pAccelerationStructures</code> <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy an acceleration structure call:</p>
</div>
<div id="vkCmdCopyAccelerationStructureNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
void vkCmdCopyAccelerationStructureNV(
    VkCommandBuffer                             commandBuffer,
    VkAccelerationStructureNV                   dst,
    VkAccelerationStructureNV                   src,
    VkCopyAccelerationStructureModeKHR          mode);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>dst</code> is the target acceleration structure for the copy.</p>
</li>
<li>
<p><code>src</code> is the source acceleration structure for the copy.</p>
</li>
<li>
<p><code>mode</code> is a <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value
specifying additional operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>src</code> and <code>dst</code> <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> or
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code> as appropriate.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-mode-03410" href="#VUID-vkCmdCopyAccelerationStructureNV-mode-03410"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-mode-03410</span><br>

<code>mode</code> <strong>must</strong> be
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code> or
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-src-04963" href="#VUID-vkCmdCopyAccelerationStructureNV-src-04963"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-src-04963</span><br>

The source acceleration structure <code>src</code> <strong>must</strong> have been constructed
prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-src-03411" href="#VUID-vkCmdCopyAccelerationStructureNV-src-03411"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-src-03411</span><br>

If <code>mode</code> is <code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code>,
<code>src</code> <strong>must</strong> have been constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> in the
build</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-buffer-03718" href="#VUID-vkCmdCopyAccelerationStructureNV-buffer-03718"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-buffer-03718</span><br>

The <code>buffer</code> used to create <code>src</code> <strong>must</strong> be bound to device
memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-buffer-03719" href="#VUID-vkCmdCopyAccelerationStructureNV-buffer-03719"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-buffer-03719</span><br>

The <code>buffer</code> used to create <code>dst</code> <strong>must</strong> be bound to device
memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-dst-07791" href="#VUID-vkCmdCopyAccelerationStructureNV-dst-07791"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-dst-07791</span><br>

The range of memory backing <code>dst</code> that is accessed by this command
<strong>must</strong> not overlap the memory backing <code>src</code> that is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-dst-07792" href="#VUID-vkCmdCopyAccelerationStructureNV-dst-07792"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-dst-07792</span><br>

<code>dst</code> <strong>must</strong> be bound completely and contiguously to a single
<code>VkDeviceMemory</code> object via
<a href="resources.html#vkBindAccelerationStructureMemoryNV" class="xref page">vkBindAccelerationStructureMemoryNV</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-parameter" href="#VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-dst-parameter" href="#VUID-vkCmdCopyAccelerationStructureNV-dst-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-dst-parameter</span><br>
 <code>dst</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureNV" class="xref page">VkAccelerationStructureNV</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-src-parameter" href="#VUID-vkCmdCopyAccelerationStructureNV-src-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-src-parameter</span><br>
 <code>src</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureNV" class="xref page">VkAccelerationStructureNV</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-mode-parameter" href="#VUID-vkCmdCopyAccelerationStructureNV-mode-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-mode-parameter</span><br>
 <code>mode</code> <strong>must</strong> be a valid <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-recording" href="#VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-cmdpool" href="#VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-renderpass" href="#VUID-vkCmdCopyAccelerationStructureNV-renderpass"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-videocoding" href="#VUID-vkCmdCopyAccelerationStructureNV-videocoding"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-commonparent" href="#VUID-vkCmdCopyAccelerationStructureNV-commonparent"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-commonparent</span><br>
 Each of <code>commandBuffer</code>, <code>dst</code>, and <code>src</code> <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy an acceleration structure call:</p>
</div>
<div id="vkCmdCopyAccelerationStructureKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
void vkCmdCopyAccelerationStructureKHR(
    VkCommandBuffer                             commandBuffer,
    const VkCopyAccelerationStructureInfoKHR*   pInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <a href="#VkCopyAccelerationStructureInfoKHR">VkCopyAccelerationStructureInfoKHR</a>
structure defining the copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command copies the <code>pInfo-&gt;src</code> acceleration structure to the
<code>pInfo-&gt;dst</code> acceleration structure in the manner specified by
<code>pInfo-&gt;mode</code>.</p>
</div>
<div class="paragraph">
<p>Accesses to <code>pInfo-&gt;src</code> and <code>pInfo-&gt;dst</code> <strong>must</strong> be
<a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> or
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code> as appropriate.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-accelerationStructure-08925" href="#VUID-vkCmdCopyAccelerationStructureKHR-accelerationStructure-08925"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-accelerationStructure-08925</span><br>

The <a href="features.html#features-accelerationStructure" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-buffer-03737" href="#VUID-vkCmdCopyAccelerationStructureKHR-buffer-03737"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-buffer-03737</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-buffer-03738" href="#VUID-vkCmdCopyAccelerationStructureKHR-buffer-03738"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-buffer-03738</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
device memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-parameter" href="#VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-pInfo-parameter" href="#VUID-vkCmdCopyAccelerationStructureKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkCopyAccelerationStructureInfoKHR">VkCopyAccelerationStructureInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-recording" href="#VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-cmdpool" href="#VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-renderpass" href="#VUID-vkCmdCopyAccelerationStructureKHR-renderpass"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-videocoding" href="#VUID-vkCmdCopyAccelerationStructureKHR-videocoding"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkCopyAccelerationStructureInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkCopyAccelerationStructureInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkCopyAccelerationStructureInfoKHR {
    VkStructureType                       sType;
    const void*                           pNext;
    VkAccelerationStructureKHR            src;
    VkAccelerationStructureKHR            dst;
    VkCopyAccelerationStructureModeKHR    mode;
} VkCopyAccelerationStructureInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>src</code> is the source acceleration structure for the copy.</p>
</li>
<li>
<p><code>dst</code> is the target acceleration structure for the copy.</p>
</li>
<li>
<p><code>mode</code> is a <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value
specifying additional operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-mode-03410" href="#VUID-VkCopyAccelerationStructureInfoKHR-mode-03410"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-mode-03410</span><br>

<code>mode</code> <strong>must</strong> be
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code> or
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-src-04963" href="#VUID-VkCopyAccelerationStructureInfoKHR-src-04963"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-src-04963</span><br>

The source acceleration structure <code>src</code> <strong>must</strong> have been constructed
prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-src-03411" href="#VUID-VkCopyAccelerationStructureInfoKHR-src-03411"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-src-03411</span><br>

If <code>mode</code> is <code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code>,
<code>src</code> <strong>must</strong> have been constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> in the
build</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-buffer-03718" href="#VUID-VkCopyAccelerationStructureInfoKHR-buffer-03718"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-buffer-03718</span><br>

The <code>buffer</code> used to create <code>src</code> <strong>must</strong> be bound to device
memory</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-buffer-03719" href="#VUID-VkCopyAccelerationStructureInfoKHR-buffer-03719"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-buffer-03719</span><br>

The <code>buffer</code> used to create <code>dst</code> <strong>must</strong> be bound to device
memory</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-dst-07791" href="#VUID-VkCopyAccelerationStructureInfoKHR-dst-07791"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-dst-07791</span><br>

The range of memory backing <code>dst</code> that is accessed by this command
<strong>must</strong> not overlap the memory backing <code>src</code> that is accessed by this
command</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-sType-sType" href="#VUID-VkCopyAccelerationStructureInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_COPY_ACCELERATION_STRUCTURE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-pNext-pNext" href="#VUID-VkCopyAccelerationStructureInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-src-parameter" href="#VUID-VkCopyAccelerationStructureInfoKHR-src-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-src-parameter</span><br>
 <code>src</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-dst-parameter" href="#VUID-VkCopyAccelerationStructureInfoKHR-dst-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-dst-parameter</span><br>
 <code>dst</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-mode-parameter" href="#VUID-VkCopyAccelerationStructureInfoKHR-mode-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-mode-parameter</span><br>
 <code>mode</code> <strong>must</strong> be a valid <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-commonparent" href="#VUID-VkCopyAccelerationStructureInfoKHR-commonparent"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-commonparent</span><br>
 Both of <code>dst</code>, and <code>src</code> <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Possible values of <code>mode</code> specifying additional operations to perform
during the copy, are:</p>
</div>
<div id="VkCopyAccelerationStructureModeKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef enum VkCopyAccelerationStructureModeKHR {
    VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR = 0,
    VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR = 1,
  // Provided by VK_KHR_acceleration_structure
    VK_COPY_ACCELERATION_STRUCTURE_MODE_SERIALIZE_KHR = 2,
  // Provided by VK_KHR_acceleration_structure
    VK_COPY_ACCELERATION_STRUCTURE_MODE_DESERIALIZE_KHR = 3,
  // Provided by VK_NV_ray_tracing
    VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_NV = VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR,
  // Provided by VK_NV_ray_tracing
    VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_NV = VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR,
} VkCopyAccelerationStructureModeKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkCopyAccelerationStructureModeNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
typedef VkCopyAccelerationStructureModeKHR VkCopyAccelerationStructureModeNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR</code> creates a direct
copy of the acceleration structure specified in <code>src</code> into the one
specified by <code>dst</code>.
The <code>dst</code> acceleration structure <strong>must</strong> have been created with the
same parameters as <code>src</code>.
If <code>src</code> contains references to other acceleration structures,
<code>dst</code> will reference the same acceleration structures.</p>
</li>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code> creates a more
    compact version of an acceleration structure <code>src</code> into <code>dst</code>.
    The acceleration structure <code>dst</code> <strong>must</strong> have been created with a size
    at least as large as that returned by
<a href="#vkCmdWriteAccelerationStructuresPropertiesNV">vkCmdWriteAccelerationStructuresPropertiesNV</a>
,
    <a href="#vkCmdWriteAccelerationStructuresPropertiesKHR">vkCmdWriteAccelerationStructuresPropertiesKHR</a>, or
    <a href="#vkWriteAccelerationStructuresPropertiesKHR">vkWriteAccelerationStructuresPropertiesKHR</a>
    after the build of the acceleration structure specified by <code>src</code>.
    If <code>src</code> contains references to other acceleration structures,
    <code>dst</code> will reference the same acceleration structures.</p>
</li>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_SERIALIZE_KHR</code> serializes the
acceleration structure to a semi-opaque format which can be reloaded on
a compatible implementation.</p>
</li>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_DESERIALIZE_KHR</code> deserializes
the semi-opaque serialization format in the buffer to the acceleration
structure.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy an acceleration structure to device memory call:</p>
</div>
<div id="vkCmdCopyAccelerationStructureToMemoryKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
void vkCmdCopyAccelerationStructureToMemoryKHR(
    VkCommandBuffer                             commandBuffer,
    const VkCopyAccelerationStructureToMemoryInfoKHR* pInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> is an a pointer to a
<a href="#VkCopyAccelerationStructureToMemoryInfoKHR">VkCopyAccelerationStructureToMemoryInfoKHR</a> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>pInfo-&gt;src</code> <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code>.
Accesses to the buffer indicated by <code>pInfo-&gt;dst.deviceAddress</code> <strong>must</strong> be
synchronized with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an and an access
type of <code>VK_ACCESS_TRANSFER_WRITE_BIT</code>.</p>
</div>
<div class="paragraph">
<p>This command produces the same results as
<a href="#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>, but writes its result to a
device address, and is executed on the device rather than the host.
The output <strong>may</strong> not necessarily be bit-for-bit identical, but it can be
equally used by either <a href="#vkCmdCopyMemoryToAccelerationStructureKHR">vkCmdCopyMemoryToAccelerationStructureKHR</a> or
<a href="#vkCopyMemoryToAccelerationStructureKHR">vkCopyMemoryToAccelerationStructureKHR</a>.</p>
</div>
<div id="serialized-as-header" class="paragraph">
<p>The defined header structure for the serialized data consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_UUID_SIZE</code> bytes of data matching
<code>VkPhysicalDeviceIDProperties</code>::<code>driverUUID</code></p>
</li>
<li>
<p><code>VK_UUID_SIZE</code> bytes of data identifying the compatibility for
comparison using <a href="#vkGetDeviceAccelerationStructureCompatibilityKHR">vkGetDeviceAccelerationStructureCompatibilityKHR</a></p>
</li>
<li>
<p>A 64-bit integer of the total size matching the value queried using
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
<li>
<p>A 64-bit integer of the deserialized size to be passed in to
<code>VkAccelerationStructureCreateInfoKHR</code>::<code>size</code></p>
</li>
<li>
<p>A 64-bit integer of the count of the number of acceleration structure
handles following.
This value matches the value queried using
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>.
This will be zero for a bottom-level acceleration structure.
For top-level acceleration structures this number is
implementation-dependent; the number of and ordering of the handles may
not match the instance descriptions which were used to build the
acceleration structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The corresponding handles matching the values returned by
<a href="resources.html#vkGetAccelerationStructureDeviceAddressKHR" class="xref page">vkGetAccelerationStructureDeviceAddressKHR</a>
or
<a href="resources.html#vkGetAccelerationStructureHandleNV" class="xref page">vkGetAccelerationStructureHandleNV</a>
are tightly packed in the buffer following the count.
The application is expected to store a mapping between those handles and the
original application-generated bottom-level acceleration structures to
provide when deserializing.
The serialized data is written to the buffer (or read from the buffer)
according to the host endianness.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-accelerationStructure-08926" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-accelerationStructure-08926"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-accelerationStructure-08926</span><br>

The <a href="features.html#features-accelerationStructure" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03739" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03739"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03739</span><br>

<code>pInfo-&gt;dst.deviceAddress</code> <strong>must</strong> be a valid device address for a
buffer bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03740" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03740"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03740</span><br>

<code>pInfo-&gt;dst.deviceAddress</code> <strong>must</strong> be aligned to <code>256</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03741" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03741"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03741</span><br>

If the buffer pointed to by <code>pInfo-&gt;dst.deviceAddress</code> is non-sparse
then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-None-03559" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-None-03559"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-None-03559</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
device memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-parameter" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-parameter" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkCopyAccelerationStructureToMemoryInfoKHR">VkCopyAccelerationStructureToMemoryInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-recording" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-cmdpool" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-renderpass" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-renderpass"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-videocoding" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-videocoding"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkCopyAccelerationStructureToMemoryInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkCopyAccelerationStructureToMemoryInfoKHR {
    VkStructureType                       sType;
    const void*                           pNext;
    VkAccelerationStructureKHR            src;
    VkDeviceOrHostAddressKHR              dst;
    VkCopyAccelerationStructureModeKHR    mode;
} VkCopyAccelerationStructureToMemoryInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>src</code> is the source acceleration structure for the copy</p>
</li>
<li>
<p><code>dst</code> is the device or host address to memory which is the target
for the copy</p>
</li>
<li>
<p><code>mode</code> is a <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value
specifying additional operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-04959" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-04959"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-04959</span><br>

The source acceleration structure <code>src</code> <strong>must</strong> have been constructed
prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-dst-03561" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-dst-03561"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-dst-03561</span><br>

The memory pointed to by <code>dst</code> <strong>must</strong> be at least as large as the
serialization size of <code>src</code>, as reported by
<a href="#vkWriteAccelerationStructuresPropertiesKHR">vkWriteAccelerationStructuresPropertiesKHR</a> or
<a href="#vkCmdWriteAccelerationStructuresPropertiesKHR">vkCmdWriteAccelerationStructuresPropertiesKHR</a> with a query type of
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-03412" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-03412"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-03412</span><br>

<code>mode</code> <strong>must</strong> be
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_SERIALIZE_KHR</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-sType-sType" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_COPY_ACCELERATION_STRUCTURE_TO_MEMORY_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-pNext-pNext" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-parameter" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-parameter</span><br>
 <code>src</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-parameter" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-parameter</span><br>
 <code>mode</code> <strong>must</strong> be a valid <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy device memory to an acceleration structure call:</p>
</div>
<div id="vkCmdCopyMemoryToAccelerationStructureKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
void vkCmdCopyMemoryToAccelerationStructureKHR(
    VkCommandBuffer                             commandBuffer,
    const VkCopyMemoryToAccelerationStructureInfoKHR* pInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="#VkCopyMemoryToAccelerationStructureInfoKHR">VkCopyMemoryToAccelerationStructureInfoKHR</a> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>pInfo-&gt;dst</code> <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>.
Accesses to the buffer indicated by <code>pInfo-&gt;src.deviceAddress</code> <strong>must</strong> be
synchronized with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an access type of
<code>VK_ACCESS_TRANSFER_READ_BIT</code>.</p>
</div>
<div class="paragraph">
<p>This command can accept acceleration structures produced by either
<a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a> or
<a href="#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>.</p>
</div>
<div class="paragraph">
<p>The structure provided as input to deserialize is as described in
<a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a>, with any acceleration
structure handles filled in with the newly-queried handles to bottom level
acceleration structures created before deserialization.
These do not need to be built at deserialize time, but <strong>must</strong> be created.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-accelerationStructure-08927" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-accelerationStructure-08927"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-accelerationStructure-08927</span><br>

The <a href="features.html#features-accelerationStructure" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03742" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03742"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03742</span><br>

<code>pInfo-&gt;src.deviceAddress</code> <strong>must</strong> be a valid device address for a
buffer bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03743" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03743"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03743</span><br>

<code>pInfo-&gt;src.deviceAddress</code> <strong>must</strong> be aligned to <code>256</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03744" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03744"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03744</span><br>

If the buffer pointed to by <code>pInfo-&gt;src.deviceAddress</code> is non-sparse
then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-buffer-03745" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-buffer-03745"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-buffer-03745</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
device memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-parameter" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-parameter" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkCopyMemoryToAccelerationStructureInfoKHR">VkCopyMemoryToAccelerationStructureInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-recording" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-cmdpool" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-renderpass" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-renderpass"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-videocoding" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-videocoding"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkCopyMemoryToAccelerationStructureInfoKHR</code> structure is defined
as:</p>
</div>
<div id="VkCopyMemoryToAccelerationStructureInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkCopyMemoryToAccelerationStructureInfoKHR {
    VkStructureType                       sType;
    const void*                           pNext;
    VkDeviceOrHostAddressConstKHR         src;
    VkAccelerationStructureKHR            dst;
    VkCopyAccelerationStructureModeKHR    mode;
} VkCopyMemoryToAccelerationStructureInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>src</code> is the device or host address to memory containing the source
data for the copy.</p>
</li>
<li>
<p><code>dst</code> is the target acceleration structure for the copy.</p>
</li>
<li>
<p><code>mode</code> is a <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value
specifying additional operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-src-04960" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-src-04960"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-src-04960</span><br>

The source memory pointed to by <code>src</code> <strong>must</strong> contain data previously
serialized using <a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a>,
potentially modified to relocate acceleration structure references as
described in that command</p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-03413" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-03413"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-03413</span><br>

<code>mode</code> <strong>must</strong> be
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_DESERIALIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pInfo-03414" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pInfo-03414"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pInfo-03414</span><br>

The data in <code>src</code> <strong>must</strong> have a format compatible with the
destination physical device as returned by
<a href="#vkGetDeviceAccelerationStructureCompatibilityKHR">vkGetDeviceAccelerationStructureCompatibilityKHR</a></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-03746" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-03746"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-03746</span><br>

<code>dst</code> <strong>must</strong> have been created with a <code>size</code> greater than or
equal to that used to serialize the data in <code>src</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-sType-sType" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_COPY_MEMORY_TO_ACCELERATION_STRUCTURE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pNext-pNext" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-parameter" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-parameter"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-parameter</span><br>
 <code>dst</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-parameter" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-parameter"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-parameter</span><br>
 <code>mode</code> <strong>must</strong> be a valid <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To check if a serialized acceleration structure is compatible with the
current device call:</p>
</div>
<div id="vkGetDeviceAccelerationStructureCompatibilityKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
void vkGetDeviceAccelerationStructureCompatibilityKHR(
    VkDevice                                    device,
    const VkAccelerationStructureVersionInfoKHR* pVersionInfo,
    VkAccelerationStructureCompatibilityKHR*    pCompatibility);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device to check the version against.</p>
</li>
<li>
<p><code>pVersionInfo</code> is a pointer to a
<a href="#VkAccelerationStructureVersionInfoKHR">VkAccelerationStructureVersionInfoKHR</a> structure specifying version
information to check against the device.</p>
</li>
<li>
<p><code>pCompatibility</code> is a pointer to a
<a href="#VkAccelerationStructureCompatibilityKHR">VkAccelerationStructureCompatibilityKHR</a> value in which
compatibility information is returned.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-accelerationStructure-08928" href="#VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-accelerationStructure-08928"></a> <span class="vuid">VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-accelerationStructure-08928</span><br>

The <a href="features.html#features-accelerationStructure" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-device-parameter" href="#VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-device-parameter"></a> <span class="vuid">VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pVersionInfo-parameter" href="#VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pVersionInfo-parameter"></a> <span class="vuid">VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pVersionInfo-parameter</span><br>
 <code>pVersionInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkAccelerationStructureVersionInfoKHR">VkAccelerationStructureVersionInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pCompatibility-parameter" href="#VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pCompatibility-parameter"></a> <span class="vuid">VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pCompatibility-parameter</span><br>
 <code>pCompatibility</code> <strong>must</strong> be a valid pointer to a <a href="#VkAccelerationStructureCompatibilityKHR">VkAccelerationStructureCompatibilityKHR</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureVersionInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkAccelerationStructureVersionInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureVersionInfoKHR {
    VkStructureType    sType;
    const void*        pNext;
    const uint8_t*     pVersionData;
} VkAccelerationStructureVersionInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>pVersionData</code> is a pointer to the version header of an acceleration
structure as defined in <a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>pVersionData</code> is a <em>pointer</em> to an array of 2×<code>VK_UUID_SIZE</code>
<code>uint8_t</code> values instead of two <code>VK_UUID_SIZE</code> arrays as the expected
use case for this member is to be pointed at the header of a previously
serialized acceleration structure (via
<a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a> or
<a href="#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>) that is loaded in memory.
Using arrays would necessitate extra memory copies of the UUIDs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureVersionInfoKHR-sType-sType" href="#VUID-VkAccelerationStructureVersionInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureVersionInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_VERSION_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureVersionInfoKHR-pNext-pNext" href="#VUID-VkAccelerationStructureVersionInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureVersionInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureVersionInfoKHR-pVersionData-parameter" href="#VUID-VkAccelerationStructureVersionInfoKHR-pVersionData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureVersionInfoKHR-pVersionData-parameter</span><br>
 <code>pVersionData</code> <strong>must</strong> be a valid pointer to an array of <span class="steminline"> <svg style="vertical-align: -0.215ex; overflow: visible;" xmlns="http://www.w3.org/2000/svg" width="18.15ex" height="1.722ex" role="img" focusable="false" viewBox="0 -666 8022.4 761"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1722.4,0)"><g data-mml-node="mi"><path data-c="1D685" d="M19 578Q19 585 20 590T23 598T29 604T38 608T48 610T62 611T78 612T97 611T119 611H195Q210 602 213 596T217 573Q217 561 216 555T206 542T179 535H164Q166 529 188 435T235 231T261 94L262 84V88Q263 91 263 94Q265 121 289 231T336 438L360 535H345Q308 535 308 566V573Q308 586 308 590T314 600T330 611H484Q499 602 502 595T505 573Q505 560 504 554T493 541T465 535H447L384 278Q321 19 319 14Q309 -7 278 -7H262H246Q215 -7 205 14Q203 19 140 278L78 535H59Q45 535 38 536T25 547T19 573V578Z"></path><path data-c="1D67A" d="M18 549T18 573T29 604T70 611H118H193Q207 603 210 596T214 573Q214 549 198 538Q191 535 172 535H152V421Q152 344 152 326T153 309L242 422L329 534Q327 535 322 536T314 538T308 542T303 548T300 558T298 573Q298 600 316 608Q322 611 392 611H463Q477 602 481 595T485 573Q485 535 446 535H441H420L281 357L436 77L454 76Q473 75 478 73Q495 62 495 38Q495 10 473 1H345Q334 5 329 11T324 21T323 38Q323 51 324 56T332 68T355 77L233 296L152 192V76H172Q191 76 198 73Q214 63 214 38Q214 9 193 1H41Q18 8 18 38Q18 61 35 73Q42 76 61 76H81V535H61Q42 535 35 538Q18 549 18 573Z" transform="translate(525,0)"></path></g><g data-mml-node="mi" transform="translate(1050,0)"><path data-c="5F" d="M57 -60Q57 -33 86 -25H438Q468 -34 468 -60T438 -95H86Q57 -86 57 -60Z"></path></g><g data-mml-node="mi" transform="translate(1575,0)"><path data-c="1D684" d="M-3 573Q-3 597 8 604T50 612Q57 612 77 612T111 611H200Q214 602 218 595T222 573Q222 549 205 538Q198 535 175 535H151V359Q151 333 151 291Q152 177 156 162Q157 160 157 159Q165 123 193 95T262 66Q303 66 330 94T367 159Q371 175 371 191T373 359V535H349H339Q328 535 322 537T309 548T303 573T306 595T325 611H506Q520 602 524 595T528 573Q528 549 511 538Q504 535 481 535H457V364Q457 189 456 182Q448 101 394 45T262 -11Q189 -11 132 43T68 182Q67 189 67 364V535H43H33Q22 535 16 537T3 548T-3 573Z"></path><path data-c="1D684" d="M-3 573Q-3 597 8 604T50 612Q57 612 77 612T111 611H200Q214 602 218 595T222 573Q222 549 205 538Q198 535 175 535H151V359Q151 333 151 291Q152 177 156 162Q157 160 157 159Q165 123 193 95T262 66Q303 66 330 94T367 159Q371 175 371 191T373 359V535H349H339Q328 535 322 537T309 548T303 573T306 595T325 611H506Q520 602 524 595T528 573Q528 549 511 538Q504 535 481 535H457V364Q457 189 456 182Q448 101 394 45T262 -11Q189 -11 132 43T68 182Q67 189 67 364V535H43H33Q22 535 16 537T3 548T-3 573Z" transform="translate(525,0)"></path><path data-c="1D678" d="M400 76Q431 76 441 69T452 38Q452 29 452 26T450 18T443 9T430 1H95Q84 6 79 12T73 23T72 38Q72 65 90 73Q96 76 157 76H220V535H157H124Q93 535 83 542T72 573Q72 603 93 610Q97 611 264 611H430Q432 609 436 607T444 602T449 594Q452 588 452 573Q452 546 434 538Q428 535 367 535H304V76H367H400Z" transform="translate(1050,0)"></path><path data-c="1D673" d="M38 1Q16 8 16 38Q16 62 32 73Q39 76 58 76H78V535H58Q40 535 32 538Q16 548 16 573Q16 587 17 591Q23 604 34 607T83 611H166H176Q188 611 209 611T239 612Q299 612 337 597T415 530Q485 438 485 300Q485 180 431 100T301 3L291 1H38ZM400 301Q400 363 385 410T346 482T303 519T267 534Q261 535 210 535H162V76H214L267 77Q323 89 361 148T400 301Z" transform="translate(1575,0)"></path></g><g data-mml-node="mi" transform="translate(3675,0)"><path data-c="5F" d="M57 -60Q57 -33 86 -25H438Q468 -34 468 -60T438 -95H86Q57 -86 57 -60Z"></path></g><g data-mml-node="mi" transform="translate(4200,0)"><path data-c="1D682" d="M52 454Q52 524 107 572T229 621Q266 621 274 620Q326 610 360 588L371 581Q377 594 379 598T386 610T397 619T412 622Q433 622 439 610T446 570Q446 563 446 545T445 515V479Q445 441 444 432T436 417Q428 408 403 408T370 417Q361 424 361 434Q361 439 360 448T351 476T331 509T295 535T238 546Q194 546 163 522T132 458Q132 435 148 412Q155 401 166 393T192 380T218 371T247 364T270 359Q341 342 349 339Q389 325 418 296T461 229Q472 201 472 164Q469 92 417 41T287 -11Q240 -11 200 -1T143 19L126 29Q117 6 109 -2Q100 -11 84 -11Q64 -11 58 1T51 42Q51 49 51 66T52 95V135Q52 173 53 180T61 194Q70 203 95 203Q119 203 127 194Q136 186 136 168Q143 66 284 66H290Q325 66 350 85Q391 115 391 165Q391 204 369 228T322 260Q320 260 255 275T185 293Q123 309 88 355T52 454Z"></path><path data-c="1D678" d="M400 76Q431 76 441 69T452 38Q452 29 452 26T450 18T443 9T430 1H95Q84 6 79 12T73 23T72 38Q72 65 90 73Q96 76 157 76H220V535H157H124Q93 535 83 542T72 573Q72 603 93 610Q97 611 264 611H430Q432 609 436 607T444 602T449 594Q452 588 452 573Q452 546 434 538Q428 535 367 535H304V76H367H400Z" transform="translate(525,0)"></path><path data-c="1D689" d="M71 1Q60 5 55 11T49 23T48 39V46Q48 56 58 73T131 183Q171 242 197 282L366 535H144V501Q144 470 143 464T135 450Q127 442 102 442H94Q71 442 62 461Q60 466 60 527L61 589Q70 607 83 610H88Q93 610 102 610T124 610T154 610T188 611T227 611T270 611H454Q456 609 461 606T467 601T471 597T474 591T475 584T476 572V565Q476 555 466 538T393 428Q353 369 327 329L158 76H397V120V146Q397 169 405 179T439 189Q470 189 479 169Q481 164 481 95V48Q481 24 478 16T459 1H71Z" transform="translate(1050,0)"></path><path data-c="1D674" d="M374 271Q374 241 367 232T332 223Q307 223 299 231Q290 240 290 263V279H173V76H418V118V144Q418 167 426 176T460 186Q491 186 500 166Q502 161 502 93V52Q502 25 499 17T480 1H41Q19 9 19 32V38Q19 63 36 73Q42 76 65 76H89V535H65H55Q44 535 38 537T25 548T19 573Q19 602 41 610H47Q53 610 63 610T88 610T121 610T160 611T204 611T251 611H458Q460 609 465 606T471 602T475 598T478 593T479 586T480 576T480 562V526V488Q480 452 462 444Q458 442 438 442Q413 442 405 450Q398 457 397 463T396 501V535H173V355H290V371Q290 394 299 403T332 412Q363 412 372 392Q374 387 374 317V271Z" transform="translate(1575,0)"></path></g></g></g></g></svg> </span> <code>uint8_t</code> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Possible values of <code>pCompatibility</code> returned by
<a href="#vkGetDeviceAccelerationStructureCompatibilityKHR">vkGetDeviceAccelerationStructureCompatibilityKHR</a> are:</p>
</div>
<div id="VkAccelerationStructureCompatibilityKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef enum VkAccelerationStructureCompatibilityKHR {
    VK_ACCELERATION_STRUCTURE_COMPATIBILITY_COMPATIBLE_KHR = 0,
    VK_ACCELERATION_STRUCTURE_COMPATIBILITY_INCOMPATIBLE_KHR = 1,
} VkAccelerationStructureCompatibilityKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_COMPATIBILITY_COMPATIBLE_KHR</code> if the
<code>pVersionData</code> version acceleration structure is compatible with
<code>device</code>.</p>
</li>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_COMPATIBILITY_INCOMPATIBLE_KHR</code> if the
<code>pVersionData</code> version acceleration structure is not compatible with
<code>device</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cluster-geometry"><a class="anchor" href="#cluster-geometry"></a>Cluster Level Acceleration Structures</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Acceleration structure build times in ray tracing applications with
extensive geometry <strong>can</strong> be reduced by introducing alternative acceleration
structure types that facilitate bottom-level acceleration structure
construction using pre-generated primitive clusters, improving geometry
reuse.
This <strong>can</strong> be achieved by incorporating additional acceleration structure
types:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#acceleration-structure-clas-geometry">Cluster Level Acceleration    Structure</a></p>
</li>
<li>
<p><a href="#acceleration-structure-clas-template">Cluster Template Acceleration    Structure</a></p>
</li>
<li>
<p><a href="#acceleration-structure-bottom-level-clas">Cluster Level Bottom Level    Acceleration Structure</a></p>
</li>
</ol>
</div>
<div id="acceleration-structure-clas-geometry" class="paragraph">
<p>Cluster Level Acceleration Structure (CLAS) is an intermediate acceleration
structure constructed from triangles, which serves as a building block for
<a href="#acceleration-structure-bottom-level-clas">Cluster Level Bottom Level Acceleration Structure</a>.
A CLAS shares similarities with a traditional
<a href="#acceleration-structure-bottom-level">bottom level acceleration structure</a>
but has several key distinctions.
A CLAS <strong>can</strong> only contain a limited number of <a href="#cluster-geometry-limits">triangles and vertices</a>.
CLAS objects cannot be directly referenced in a top level acceleration
structure, instead, they <strong>must</strong> be part of a
<a href="#acceleration-structure-bottom-level-clas">Cluster Level Bottom Level Acceleration Structure</a>.
The <a href="#cluster-geometry-index-flags">geometry indices</a> within a CLAS are
local to it, potentially non-consecutive, and customizable per primitive.
Each CLAS <strong>can</strong> also have a user-defined 32-bit
<a href="interfaces.html#interfaces-builtin-variables-clusteridnv" class="xref page">ClusterID</a>, which is accessible
in the hit shaders.
The vertex positions within a CLAS <strong>can</strong> be quantized by
<a href="#cluster-vertex-position-truncate">zeroing</a> specific floating-point
mantissa bits to optimize storage.</p>
</div>
<div id="acceleration-structure-clas-template" class="paragraph">
<p>Cluster Template Acceleration Structure is a partially constructed
<a href="#acceleration-structure-clas-geometry">CLAS</a> designed for efficient
instantiation into multiple <a href="#acceleration-structure-clas-geometry">CLAS</a>
objects.
During a cluster template build, some pre-computation is performed
independent of vertex positions, allowing reuse across multiple CLAS objects
with different vertex data.
A cluster template itself does not require vertex positions but it retains
non-positional properties similar to a CLAS, which are then inherited during
instantiation.
A cluster template <strong>must</strong> be instantiated into a CLAS object to be usable.</p>
</div>
<div id="acceleration-structure-bottom-level-clas" class="paragraph">
<p>Cluster Level Bottom Level Acceleration Structure is a new alternative to
the existing <a href="#acceleration-structure-bottom-level">bottom level acceleration structures</a>, which is constructed using references to already
built <a href="#acceleration-structure-clas-geometry">CLAS</a> objects and is the only
cluster acceleration structure that <strong>can</strong> be referenced in a top level
acceleration structure.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>These cluster acceleration structures <strong>can</strong> be built or moved by a single
versatile multi-indirect function
<a href="#vkCmdBuildClusterAccelerationStructureIndirectNV">vkCmdBuildClusterAccelerationStructureIndirectNV</a>.
To determine the memory requirements for executing this function, call:</p>
</div>
<div id="vkGetClusterAccelerationStructureBuildSizesNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
void vkGetClusterAccelerationStructureBuildSizesNV(
    VkDevice                                    device,
    const VkClusterAccelerationStructureInputInfoNV* pInfo,
    VkAccelerationStructureBuildSizesInfoKHR*   pSizeInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the acceleration structure.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a> structure containing
parameters required for the memory requirements query.</p>
</li>
<li>
<p><code>pSizeInfo</code> is a pointer to a
<a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure which returns
the size required for an acceleration structure and scratch buffer,
given the build parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</code>,
acceleration structure and scratch memory sizes are returned for all
<a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>maxAccelerationStructureCount</code>
acceleration structures.
If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>,
scratch memory size for all
<a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>maxAccelerationStructureCount</code>
acceleration structures and the acceleration structure memory size for a
single acceleration structure is returned.
If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_COMPUTE_SIZES_NV</code>, only
scratch memory size is returned for the requested acceleration structures.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetClusterAccelerationStructureBuildSizesNV-clusterAccelerationStructure-10438" href="#VUID-vkGetClusterAccelerationStructureBuildSizesNV-clusterAccelerationStructure-10438"></a> <span class="vuid">VUID-vkGetClusterAccelerationStructureBuildSizesNV-clusterAccelerationStructure-10438</span><br>

The <a href="features.html#features-clusterAccelerationStructure" class="xref page">    <code>VkPhysicalDeviceClusterAccelerationStructureFeaturesNV</code>::<code>clusterAccelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetClusterAccelerationStructureBuildSizesNV-device-parameter" href="#VUID-vkGetClusterAccelerationStructureBuildSizesNV-device-parameter"></a> <span class="vuid">VUID-vkGetClusterAccelerationStructureBuildSizesNV-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetClusterAccelerationStructureBuildSizesNV-pInfo-parameter" href="#VUID-vkGetClusterAccelerationStructureBuildSizesNV-pInfo-parameter"></a> <span class="vuid">VUID-vkGetClusterAccelerationStructureBuildSizesNV-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetClusterAccelerationStructureBuildSizesNV-pSizeInfo-parameter" href="#VUID-vkGetClusterAccelerationStructureBuildSizesNV-pSizeInfo-parameter"></a> <span class="vuid">VUID-vkGetClusterAccelerationStructureBuildSizesNV-pSizeInfo-parameter</span><br>
 <code>pSizeInfo</code> <strong>must</strong> be a valid pointer to a <a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a> structure is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureInputInfoNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef struct VkClusterAccelerationStructureInputInfoNV {
    VkStructureType                            sType;
    void*                                      pNext;
    uint32_t                                   maxAccelerationStructureCount;
    VkBuildAccelerationStructureFlagsKHR       flags;
    VkClusterAccelerationStructureOpTypeNV     opType;
    VkClusterAccelerationStructureOpModeNV     opMode;
    VkClusterAccelerationStructureOpInputNV    opInput;
} VkClusterAccelerationStructureInputInfoNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>maxAccelerationStructureCount</code> is the maximum number of
acceleration structures that will be provided to the multi indirect
operation.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="resources.html#VkBuildAccelerationStructureFlagsKHR" class="xref page">VkBuildAccelerationStructureFlagsKHR</a>
specifying flags for the multi indirect operation.</p>
</li>
<li>
<p><code>opType</code> is a <a href="#VkClusterAccelerationStructureOpTypeNV">VkClusterAccelerationStructureOpTypeNV</a> value
specifying the type of operation to perform.</p>
</li>
<li>
<p><code>opMode</code> is a <a href="#VkClusterAccelerationStructureOpModeNV">VkClusterAccelerationStructureOpModeNV</a> value
specifying the mode of operation.</p>
</li>
<li>
<p><code>opInput</code> is a <a href="#VkClusterAccelerationStructureOpInputNV">VkClusterAccelerationStructureOpInputNV</a> value
specifying the descriptions of the operation.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-sType-sType" href="#VUID-VkClusterAccelerationStructureInputInfoNV-sType-sType"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_CLUSTER_ACCELERATION_STRUCTURE_INPUT_INFO_NV</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-pNext-pNext" href="#VUID-VkClusterAccelerationStructureInputInfoNV-pNext-pNext"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-flags-parameter" href="#VUID-VkClusterAccelerationStructureInputInfoNV-flags-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="resources.html#VkBuildAccelerationStructureFlagBitsKHR" class="xref page">VkBuildAccelerationStructureFlagBitsKHR</a> values</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-opType-parameter" href="#VUID-VkClusterAccelerationStructureInputInfoNV-opType-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-opType-parameter</span><br>
 <code>opType</code> <strong>must</strong> be a valid <a href="#VkClusterAccelerationStructureOpTypeNV">VkClusterAccelerationStructureOpTypeNV</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-opMode-parameter" href="#VUID-VkClusterAccelerationStructureInputInfoNV-opMode-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-opMode-parameter</span><br>
 <code>opMode</code> <strong>must</strong> be a valid <a href="#VkClusterAccelerationStructureOpModeNV">VkClusterAccelerationStructureOpModeNV</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-pClustersBottomLevel-parameter" href="#VUID-VkClusterAccelerationStructureInputInfoNV-pClustersBottomLevel-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-pClustersBottomLevel-parameter</span><br>
 If <code>opType</code> is <code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_CLUSTERS_BOTTOM_LEVEL_NV</code>, the <code>pClustersBottomLevel</code> member of <code>opInput</code> <strong>must</strong> be a valid pointer to a <a href="#VkClusterAccelerationStructureClustersBottomLevelInputNV">VkClusterAccelerationStructureClustersBottomLevelInputNV</a> structure</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-pTriangleClusters-parameter" href="#VUID-VkClusterAccelerationStructureInputInfoNV-pTriangleClusters-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-pTriangleClusters-parameter</span><br>
 If <code>opType</code> is <code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_NV</code>,VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_TEMPLATE_NV,VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_INSTANTIATE_TRIANGLE_CLUSTER_NV, the <code>pTriangleClusters</code> member of <code>opInput</code> <strong>must</strong> be a valid pointer to a <a href="#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a> structure</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-pMoveObjects-parameter" href="#VUID-VkClusterAccelerationStructureInputInfoNV-pMoveObjects-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-pMoveObjects-parameter</span><br>
 If <code>opType</code> is <code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</code>, the <code>pMoveObjects</code> member of <code>opInput</code> <strong>must</strong> be a valid pointer to a <a href="#VkClusterAccelerationStructureMoveObjectsInputNV">VkClusterAccelerationStructureMoveObjectsInputNV</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Values which <strong>can</strong> be set in <code>VkClusterAccelerationStructureOpTypeNV</code>
are:</p>
</div>
<div id="VkClusterAccelerationStructureOpTypeNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef enum VkClusterAccelerationStructureOpTypeNV {
    VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV = 0,
    VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_CLUSTERS_BOTTOM_LEVEL_NV = 1,
    VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_NV = 2,
    VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_TEMPLATE_NV = 3,
    VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_INSTANTIATE_TRIANGLE_CLUSTER_NV = 4,
} VkClusterAccelerationStructureOpTypeNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</code>
specifies that a cluster acceleration structure, cluster acceleration
structure template or a bottom level acceleration structure built from
cluster acceleration structures will be moved.
If a cluster acceleration structure is moved, the bottom level cluster
acceleration structures containing it will have to be re-built.
If used with
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_COMPUTE_SIZES_NV</code>, it
returns the size of existing cluster acceleration structures.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_CLUSTERS_BOTTOM_LEVEL_NV</code>
indicates that bottom level cluster acceleration structures will be
built.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_NV</code>
indicates that cluster acceleration structures will be built.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_TEMPLATE_NV</code>
indicates that a template for cluster acceleration structure will be
built.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_INSTANTIATE_TRIANGLE_CLUSTER_NV</code>
indicates that a template for a cluster acceleration structure will be
instantiated, resulting in a built cluster acceleration structure.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Values which <strong>can</strong> be set in <code>VkClusterAccelerationStructureOpModeNV</code>
are:</p>
</div>
<div id="VkClusterAccelerationStructureOpModeNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef enum VkClusterAccelerationStructureOpModeNV {
    VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV = 0,
    VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV = 1,
    VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_COMPUTE_SIZES_NV = 2,
} VkClusterAccelerationStructureOpModeNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</code>
indicates that the build or move operation will implicitly distribute
built or compacted cluster acceleration structures starting at the
address provided in
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstImplicitData</code>.
If a move operation is being performed, the acceleration structures will
be tightly compacted.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>
indicates that the build or move operation will explicitly write built
or compacted cluster acceleration structures in the array of addresses
provided in
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstAddressesArray</code>.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_COMPUTE_SIZES_NV</code>
indicates that computed cluster acceleration structure sizes will be
written to
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstSizesArray</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkClusterAccelerationStructureOpInputNV</code> union is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureOpInputNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef union VkClusterAccelerationStructureOpInputNV {
    VkClusterAccelerationStructureClustersBottomLevelInputNV*    pClustersBottomLevel;
    VkClusterAccelerationStructureTriangleClusterInputNV*        pTriangleClusters;
    VkClusterAccelerationStructureMoveObjectsInputNV*            pMoveObjects;
} VkClusterAccelerationStructureOpInputNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pClustersBottomLevel</code> is a
<a href="#VkClusterAccelerationStructureClustersBottomLevelInputNV">VkClusterAccelerationStructureClustersBottomLevelInputNV</a> structure
specifying an upper threshold on parameters to build multiple bottom
level acceleration structures from multiple cluster level acceleration
structures.</p>
</li>
<li>
<p><code>pTriangleClusters</code> is a
<a href="#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a> structure
specifying an upper threshold on parameters to build a regular or
templated cluster acceleration structure.</p>
</li>
<li>
<p><code>pMoveObjects</code> is a
<a href="#VkClusterAccelerationStructureMoveObjectsInputNV">VkClusterAccelerationStructureMoveObjectsInputNV</a> structure
specifying an upper threshold on the number of bytes moved and the type
of acceleration structure being moved.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkClusterAccelerationStructureClustersBottomLevelInputNV">VkClusterAccelerationStructureClustersBottomLevelInputNV</a> structure
is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureClustersBottomLevelInputNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef struct VkClusterAccelerationStructureClustersBottomLevelInputNV {
    VkStructureType    sType;
    void*              pNext;
    uint32_t           maxTotalClusterCount;
    uint32_t           maxClusterCountPerAccelerationStructure;
} VkClusterAccelerationStructureClustersBottomLevelInputNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>maxTotalClusterCount</code> is the total number of clusters acceleration
structures that will be built or moved across all input arguments.</p>
</li>
<li>
<p><code>maxClusterCountPerAccelerationStructure</code> is the maximum number of
clusters acceleration structures that will be built or moved per input
argument.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureClustersBottomLevelInputNV-sType-sType" href="#VUID-VkClusterAccelerationStructureClustersBottomLevelInputNV-sType-sType"></a> <span class="vuid">VUID-VkClusterAccelerationStructureClustersBottomLevelInputNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_CLUSTER_ACCELERATION_STRUCTURE_CLUSTERS_BOTTOM_LEVEL_INPUT_NV</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureClustersBottomLevelInputNV-pNext-pNext" href="#VUID-VkClusterAccelerationStructureClustersBottomLevelInputNV-pNext-pNext"></a> <span class="vuid">VUID-VkClusterAccelerationStructureClustersBottomLevelInputNV-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a> structure is
defined as:</p>
</div>
<div id="VkClusterAccelerationStructureTriangleClusterInputNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef struct VkClusterAccelerationStructureTriangleClusterInputNV {
    VkStructureType    sType;
    void*              pNext;
    VkFormat           vertexFormat;
    uint32_t           maxGeometryIndexValue;
    uint32_t           maxClusterUniqueGeometryCount;
    uint32_t           maxClusterTriangleCount;
    uint32_t           maxClusterVertexCount;
    uint32_t           maxTotalTriangleCount;
    uint32_t           maxTotalVertexCount;
    uint32_t           minPositionTruncateBitCount;
} VkClusterAccelerationStructureTriangleClusterInputNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>vertexFormat</code> is the <a href="formats.html#VkFormat" class="xref page">VkFormat</a> of each vertex element.</p>
</li>
<li>
<p><code>maxGeometryIndexValue</code> is the maximum geometry index value for any
constructed geometry.</p>
</li>
<li>
<p><code>maxClusterUniqueGeometryCount</code> is the maximum number of unique
values of the geometry index for each cluster or cluster template.</p>
</li>
<li>
<p><a id="cluster-geometry-limits"></a> <code>maxClusterTriangleCount</code> is the maximum
number of triangles in a cluster or cluster template.</p>
</li>
<li>
<p><code>maxClusterVertexCount</code> is the maximum number of unique vertices in
the cluster&#8217;s index buffer.</p>
</li>
<li>
<p><code>maxTotalTriangleCount</code> is the sum of all triangles across all
clusters or cluster templates.</p>
</li>
<li>
<p><code>maxTotalVertexCount</code> is the maximum number of vertices across all
clusters or cluster templates.</p>
</li>
<li>
<p><a id="cluster-vertex-position-truncate"></a> <code>minPositionTruncateBitCount</code>
is the least value specified in cluster build in
<a href="#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a>::<code>positionTruncateBitCount</code>
or cluster template build in
<a href="#VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV">VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV</a>::<code>positionTruncateBitCount</code>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureTriangleClusterInputNV-vertexFormat-10439" href="#VUID-VkClusterAccelerationStructureTriangleClusterInputNV-vertexFormat-10439"></a> <span class="vuid">VUID-VkClusterAccelerationStructureTriangleClusterInputNV-vertexFormat-10439</span><br>

The <a href="resources.html#resources-buffer-view-format-features" class="xref page">format features</a> of
<code>vertexFormat</code> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_ACCELERATION_STRUCTURE_VERTEX_BUFFER_BIT_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureTriangleClusterInputNV-maxClusterTriangleCount-10440" href="#VUID-VkClusterAccelerationStructureTriangleClusterInputNV-maxClusterTriangleCount-10440"></a> <span class="vuid">VUID-VkClusterAccelerationStructureTriangleClusterInputNV-maxClusterTriangleCount-10440</span><br>

<code>maxClusterTriangleCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxTrianglesPerCluster</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureTriangleClusterInputNV-maxClusterVertexCount-10441" href="#VUID-VkClusterAccelerationStructureTriangleClusterInputNV-maxClusterVertexCount-10441"></a> <span class="vuid">VUID-VkClusterAccelerationStructureTriangleClusterInputNV-maxClusterVertexCount-10441</span><br>

<code>maxClusterVertexCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxVerticesPerCluster</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureTriangleClusterInputNV-minPositionTruncateBitCount-10442" href="#VUID-VkClusterAccelerationStructureTriangleClusterInputNV-minPositionTruncateBitCount-10442"></a> <span class="vuid">VUID-VkClusterAccelerationStructureTriangleClusterInputNV-minPositionTruncateBitCount-10442</span><br>

<code>minPositionTruncateBitCount</code> <strong>must</strong> be less than or equal to <code>32</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureTriangleClusterInputNV-sType-sType" href="#VUID-VkClusterAccelerationStructureTriangleClusterInputNV-sType-sType"></a> <span class="vuid">VUID-VkClusterAccelerationStructureTriangleClusterInputNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_CLUSTER_ACCELERATION_STRUCTURE_TRIANGLE_CLUSTER_INPUT_NV</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureTriangleClusterInputNV-pNext-pNext" href="#VUID-VkClusterAccelerationStructureTriangleClusterInputNV-pNext-pNext"></a> <span class="vuid">VUID-VkClusterAccelerationStructureTriangleClusterInputNV-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureTriangleClusterInputNV-vertexFormat-parameter" href="#VUID-VkClusterAccelerationStructureTriangleClusterInputNV-vertexFormat-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureTriangleClusterInputNV-vertexFormat-parameter</span><br>
 <code>vertexFormat</code> <strong>must</strong> be a valid <a href="formats.html#VkFormat" class="xref page">VkFormat</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkClusterAccelerationStructureMoveObjectsInputNV">VkClusterAccelerationStructureMoveObjectsInputNV</a> structure is
defined as:</p>
</div>
<div id="VkClusterAccelerationStructureMoveObjectsInputNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef struct VkClusterAccelerationStructureMoveObjectsInputNV {
    VkStructureType                         sType;
    void*                                   pNext;
    VkClusterAccelerationStructureTypeNV    type;
    VkBool32                                noMoveOverlap;
    VkDeviceSize                            maxMovedBytes;
} VkClusterAccelerationStructureMoveObjectsInputNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>type</code> is a <a href="#VkClusterAccelerationStructureTypeNV">VkClusterAccelerationStructureTypeNV</a> value
identifying the type of cluster acceleration structure.</p>
</li>
<li>
<p><code>noMoveOverlap</code> specifies if the source and destination cluster
acceleration structures overlap in memory for the move operation.
If set to <code>VK_TRUE</code>, the source cluster acceleration structure
remains valid after the move and move operation acts like a copy.</p>
</li>
<li>
<p><code>maxMovedBytes</code> is the maximum number of bytes that <strong>may</strong> be moved in
this operation.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureMoveObjectsInputNV-sType-sType" href="#VUID-VkClusterAccelerationStructureMoveObjectsInputNV-sType-sType"></a> <span class="vuid">VUID-VkClusterAccelerationStructureMoveObjectsInputNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_CLUSTER_ACCELERATION_STRUCTURE_MOVE_OBJECTS_INPUT_NV</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureMoveObjectsInputNV-pNext-pNext" href="#VUID-VkClusterAccelerationStructureMoveObjectsInputNV-pNext-pNext"></a> <span class="vuid">VUID-VkClusterAccelerationStructureMoveObjectsInputNV-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureMoveObjectsInputNV-type-parameter" href="#VUID-VkClusterAccelerationStructureMoveObjectsInputNV-type-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureMoveObjectsInputNV-type-parameter</span><br>
 <code>type</code> <strong>must</strong> be a valid <a href="#VkClusterAccelerationStructureTypeNV">VkClusterAccelerationStructureTypeNV</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Values which <strong>can</strong> be set in <code>VkClusterAccelerationStructureTypeNV</code> are:</p>
</div>
<div id="VkClusterAccelerationStructureTypeNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef enum VkClusterAccelerationStructureTypeNV {
    VK_CLUSTER_ACCELERATION_STRUCTURE_TYPE_CLUSTERS_BOTTOM_LEVEL_NV = 0,
    VK_CLUSTER_ACCELERATION_STRUCTURE_TYPE_TRIANGLE_CLUSTER_NV = 1,
    VK_CLUSTER_ACCELERATION_STRUCTURE_TYPE_TRIANGLE_CLUSTER_TEMPLATE_NV = 2,
} VkClusterAccelerationStructureTypeNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_TYPE_CLUSTERS_BOTTOM_LEVEL_NV</code>
indicates a bottom level cluster acceleration structure.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_TYPE_TRIANGLE_CLUSTER_NV</code>
specifies a cluster acceleration structure.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_TYPE_TRIANGLE_CLUSTER_TEMPLATE_NV</code>
indicates a template cluster acceleration structure.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build or move a cluster acceleration structure or a cluster acceleration
structure template call:</p>
</div>
<div id="vkCmdBuildClusterAccelerationStructureIndirectNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
void vkCmdBuildClusterAccelerationStructureIndirectNV(
    VkCommandBuffer                             commandBuffer,
    const VkClusterAccelerationStructureCommandsInfoNV* pCommandInfos);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command is
recorded.</p>
</li>
<li>
<p><code>pCommandInfos</code> is a pointer to a
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a> structure containing
parameters required for building or moving the cluster acceleration
structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Similar to <a href="#vkCmdBuildAccelerationStructuresKHR">vkCmdBuildAccelerationStructuresKHR</a>, this command <strong>may</strong>
initiate multiple acceleration structures builds and there is no ordering or
synchronization implied between any of the individual acceleration structure
builds.
Accesses to the acceleration structure scratch memory as identified by the
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>scratchData</code> <strong>must</strong>
be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
(<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> |
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>).</p>
</div>
<div class="paragraph">
<p>Accesses to each
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstImplicitData</code>,
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstAddressesArray</code>
and <a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstSizesArray</code>
<strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>.</p>
</div>
<div class="paragraph">
<p>Accesses to memory with input data as identified by any used values of
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>srcInfosArray</code>,
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>srcInfosCount</code> and
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>addressResolutionFlags</code>
<strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_INDIRECT_COMMAND_READ_BIT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-clusterAccelerationStructure-10443" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-clusterAccelerationStructure-10443"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-clusterAccelerationStructure-10443</span><br>

The <a href="features.html#features-clusterAccelerationStructure" class="xref page">    <code>VkPhysicalDeviceClusterAccelerationStructureFeaturesNV</code>::<code>clusterAccelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pNext-10444" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pNext-10444"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pNext-10444</span><br>

The <code>pNext</code> chain of the bound ray tracing pipeline <strong>must</strong> include a
<a href="pipelines.html#VkRayTracingPipelineClusterAccelerationStructureCreateInfoNV" class="xref page">VkRayTracingPipelineClusterAccelerationStructureCreateInfoNV</a>
structure</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10445" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10445"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10445</span><br>

<code>pCommandInfos-&gt;input</code>::<code>maxAccelerationStructureCount</code> <strong>must</strong> be
less than or equal to the value used in
<code>pInfo-&gt;maxAccelerationStructureCount</code> in
<a href="#vkGetClusterAccelerationStructureBuildSizesNV">vkGetClusterAccelerationStructureBuildSizesNV</a> to determine the
memory requirements for the build operation</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-scratchData-10446" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-scratchData-10446"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-scratchData-10446</span><br>

The scratch memory of the cluster acceleration structure specified in
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>scratchData</code>
<strong>must</strong> be larger than or equal to the scratch size queried with
<a href="#vkGetClusterAccelerationStructureBuildSizesNV">vkGetClusterAccelerationStructureBuildSizesNV</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-scratchData-10447" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-scratchData-10447"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-scratchData-10447</span><br>

The scratch address of the cluster acceleration structure specified in
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>scratchData</code>
<strong>must</strong> be aligned based on the cluster acceleration structure type and
its alignment properties as queried with
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10448" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10448"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10448</span><br>

If <code>pCommandInfos-&gt;input</code>::<code>opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</code>,
<code>pCommandInfos-&gt;srcInfosArray</code> <strong>must</strong> be an array of
<a href="#VkClusterAccelerationStructureMoveObjectsInfoNV">VkClusterAccelerationStructureMoveObjectsInfoNV</a> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10449" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10449"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10449</span><br>

If <code>pCommandInfos-&gt;input</code>::<code>opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_CLUSTERS_BOTTOM_LEVEL_NV</code>,
<code>pCommandInfos-&gt;srcInfosArray</code> <strong>must</strong> be an array of
<a href="#VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV">VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV</a>
structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10450" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10450"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10450</span><br>

If <code>pCommandInfos-&gt;input</code>::<code>opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_NV</code>,
<code>pCommandInfos-&gt;srcInfosArray</code> <strong>must</strong> be an array of
<a href="#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a>
structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10451" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10451"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10451</span><br>

If <code>pCommandInfos-&gt;input</code>::<code>opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_TEMPLATE_NV</code>,
<code>pCommandInfos-&gt;srcInfosArray</code> <strong>must</strong> be an array of
<a href="#VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV">VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV</a>
structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10452" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10452"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10452</span><br>

If <code>pCommandInfos-&gt;input</code>::<code>opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_INSTANTIATE_TRIANGLE_CLUSTER_NV</code>,
<code>pCommandInfos-&gt;srcInfosArray</code> <strong>must</strong> be an array of
<a href="#VkClusterAccelerationStructureInstantiateClusterInfoNV">VkClusterAccelerationStructureInstantiateClusterInfoNV</a> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10453" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10453"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10453</span><br>

The value in <code>pCommandInfos-&gt;srcInfosCount</code> <strong>must</strong> be less than or
equal to <code>pCommandInfos-&gt;input</code>::<code>maxAccelerationStructureCount</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10454" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10454"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10454</span><br>

The number of inputs specified in <code>pCommandInfos-&gt;srcInfosArray</code>
<strong>must</strong> be greater than or equal to <code>pCommandInfos-&gt;srcInfosCount</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-dstAddressesArray-10455" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-dstAddressesArray-10455"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-dstAddressesArray-10455</span><br>

The memory regions specified in
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstAddressesArray</code>
<strong>must</strong> not overlap with each other or with
<code>pCommandInfos-&gt;scratchData</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-dstImplicitData-10456" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-dstImplicitData-10456"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-dstImplicitData-10456</span><br>

The memory region specified in
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstImplicitData</code>
for multiple acceleration structure builds <strong>must</strong> not overlap with
<code>pCommandInfos-&gt;scratchData</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10457" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10457"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10457</span><br>

The buffer from which the buffer device address for
<code>pCommandInfos-&gt;scratchData</code> is queried <strong>must</strong> have been created with
the <code>VK_BUFFER_USAGE_STORAGE_BUFFER_BIT</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10458" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10458"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10458</span><br>

The buffers from which the buffer device addresses for
<code>pCommandInfos-&gt;srcInfosArray</code>, <code>pCommandInfos-&gt;srcInfosCount</code>
and <code>pCommandInfos-&gt;addressResolutionFlags</code> are queried <strong>must</strong> have
been created with the
<code>VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_BUILD_INPUT_READ_ONLY_BIT_KHR</code>
usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10459" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10459"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10459</span><br>

The buffers from which the buffer device addresses for
<code>pCommandInfos-&gt;dstImplicitData</code> and
<code>pCommandInfos-&gt;dstAddressesArray</code> are queried <strong>must</strong> have been
created with the
<code>VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_STORAGE_BIT_KHR</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10460" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10460"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10460</span><br>

If <code>pCommandInfos-&gt;dstImplicitData</code> is the address of a non-sparse
buffer then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10461" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10461"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10461</span><br>

If <code>pCommandInfos-&gt;scratchData</code> is the address of a non-sparse
buffer then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10462" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10462"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10462</span><br>

If <code>pCommandInfos-&gt;srcInfosCount</code> is the address of a non-sparse
buffer then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10463" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10463"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10463</span><br>

If the addresses specified in <code>pCommandInfos-&gt;dstAddressesArray</code> are
the address of a non-sparse buffer then they each <strong>must</strong> be bound
completely and contiguously to a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10464" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10464"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10464</span><br>

If the addresses specified in <code>pCommandInfos-&gt;dstSizesArray</code> are the
address of a non-sparse buffer then they each <strong>must</strong> be bound completely
and contiguously to a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10465" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10465"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10465</span><br>

If the addresses specified in <code>pCommandInfos-&gt;srcInfosArray</code> are the
address of a non-sparse buffer then they each <strong>must</strong> be bound completely
and contiguously to a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-parameter" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-parameter" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-parameter"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-parameter</span><br>
 <code>pCommandInfos</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-recording" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-cmdpool" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-renderpass" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-renderpass"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-videocoding" href="#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-videocoding"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a> structure is defined
as:</p>
</div>
<div id="VkClusterAccelerationStructureCommandsInfoNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef struct VkClusterAccelerationStructureCommandsInfoNV {
    VkStructureType                                           sType;
    void*                                                     pNext;
    VkClusterAccelerationStructureInputInfoNV                 input;
    VkDeviceAddress                                           dstImplicitData;
    VkDeviceAddress                                           scratchData;
    VkStridedDeviceAddressRegionKHR                           dstAddressesArray;
    VkStridedDeviceAddressRegionKHR                           dstSizesArray;
    VkStridedDeviceAddressRegionKHR                           srcInfosArray;
    VkDeviceAddress                                           srcInfosCount;
    VkClusterAccelerationStructureAddressResolutionFlagsNV    addressResolutionFlags;
} VkClusterAccelerationStructureCommandsInfoNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>input</code> is <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a> structure
describing the build or move parameters for the cluster acceleration
structure.</p>
</li>
<li>
<p><code>dstImplicitData</code> is the device address for memory where the
implicit build of cluster acceleration structure will be saved.
If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>
or <code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_COMPUTE_SIZES_NV</code>,
this value is ignored.</p>
</li>
<li>
<p><code>scratchData</code> is the device address of scratch memory that will be
used during cluster acceleration structure move or build.</p>
</li>
<li>
<p><code>dstAddressesArray</code> is a <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a> where
the individual addresses and stride of moved or built cluster
acceleration structures will be saved or read from depending on
<a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code>.
If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</code>
and the address in <code>dstAddressesArray</code> is not <code>0</code>, then the
addresses are saved.
If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>,
then the addresses are read from.
If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_COMPUTE_SIZES_NV</code>, then
this value is ignored and <strong>may</strong> be <code>0</code>.</p>
</li>
<li>
<p><code>dstSizesArray</code> is <code>NULL</code> or a <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a>
containing sizes of moved or built cluster acceleration structures.
Similar to <code>dstAddressesArray</code>, if
<a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</code>,
then the sizes are saved.
If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>,
then the sizes are read from.</p>
</li>
<li>
<p><code>srcInfosArray</code> is a <a href="descriptorsets.html#VkStridedDeviceAddressRegionKHR" class="xref page">VkStridedDeviceAddressRegionKHR</a> where
input data for the build or move operation is read from.
If the stride is <code>0</code>, the structures are assumed to be packed tightly.
Its format is dependent on
<a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opType</code> as per the
table below.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code>::<code>opType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format of <code>srcInfosArray</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#VkClusterAccelerationStructureMoveObjectsInfoNV">VkClusterAccelerationStructureMoveObjectsInfoNV</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_CLUSTERS_BOTTOM_LEVEL_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV">VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_TEMPLATE_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV">VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_INSTANTIATE_TRIANGLE_CLUSTER_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#VkClusterAccelerationStructureInstantiateClusterInfoNV">VkClusterAccelerationStructureInstantiateClusterInfoNV</a></p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p><code>srcInfosCount</code> is the device address of memory containing the count
of number of build or move operations to perform.
The actual value is the minimum of this value and the value specified in
<code>input</code>::<code>maxAccelerationStructureCount</code>.
If this value is <code>0</code>, the count is determined by
<code>input</code>::<code>maxAccelerationStructureCount</code> alone.</p>
</li>
<li>
<p><code>addressResolutionFlags</code> is a bitmask of
<a href="#VkClusterAccelerationStructureAddressResolutionFlagBitsNV">VkClusterAccelerationStructureAddressResolutionFlagBitsNV</a> values
specifying how an implementation will interpret the device addresses in
this structure.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10466" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10466"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10466</span><br>

If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</code>,
<code>dstImplicitData</code> <strong>must</strong> be a valid address</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10467" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10467"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10467</span><br>

If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</code>
and <code>input</code>::<code>opType</code> is not
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</code>, the
memory in <code>dstImplicitData</code> <strong>must</strong> be equal to or larger than the
<a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a>::<code>accelerationStructureSize</code>
value returned from <a href="#vkGetClusterAccelerationStructureBuildSizesNV">vkGetClusterAccelerationStructureBuildSizesNV</a>
with same input parameters</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10468" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10468"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10468</span><br>

If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</code>
and <code>input</code>::<code>opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</code>, the
memory in <code>dstImplicitData</code> <strong>must</strong> be equal to or larger than the sum
of all the built acceleration structures that are being moved</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10469" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10469"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10469</span><br>

If <code>input</code>::<code>opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</code>, the
total memory moved <strong>must</strong> not be larger than the size provided in
<a href="#VkClusterAccelerationStructureMoveObjectsInputNV">VkClusterAccelerationStructureMoveObjectsInputNV</a>::<code>maxMovedBytes</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10470" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10470"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10470</span><br>

If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_COMPUTE_SIZES_NV</code>,
<code>dstSizesArray</code> <strong>must</strong> be a valid address</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10471" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10471"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10471</span><br>

If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>,
the address in <code>dstAddressesArray</code> <strong>must</strong> be a valid address with
sizes of individual buffers large enough to accommodate built or moved
clusters</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10472" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10472"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10472</span><br>

If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>,
the buffers in <code>dstAddressesArray</code> <strong>must</strong> not overlap</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10473" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10473"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10473</span><br>

If <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>,
the addresses in <code>dstAddressesArray</code> <strong>must</strong> be aligned based on the
cluster acceleration structure type and its alignment properties as
described in
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-dstAddressesArray-10474" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-dstAddressesArray-10474"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-dstAddressesArray-10474</span><br>

The stride in <code>dstAddressesArray</code> <strong>must</strong> be greater than or equal to
8</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-dstSizesArray-10475" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-dstSizesArray-10475"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-dstSizesArray-10475</span><br>

The stride in <code>dstSizesArray</code> <strong>must</strong> be greater than or equal to 4</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosArray-10476" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosArray-10476"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosArray-10476</span><br>

The stride in <code>srcInfosArray</code> <strong>must</strong> be greater than the type of
structure the address is describing</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10477" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10477"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10477</span><br>

If <code>input</code>::<code>opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_NV</code>,
then depending on the
<a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code>,
<code>dstImplicitData</code> or addresses specified in <code>dstAddressesArray</code>
<strong>must</strong> be aligned to
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>clusterByteAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10478" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10478"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10478</span><br>

If <code>input</code>::<code>opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_TEMPLATE_NV</code>,
then depending on the
<a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code>,
<code>dstImplicitData</code> or addresses specified in <code>dstAddressesArray</code>
<strong>must</strong> be aligned to
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>clusterTemplateByteAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10479" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10479"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10479</span><br>

If <code>input</code>::<code>opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_INSTANTIATE_TRIANGLE_CLUSTER_NV</code>,
then depending on the
<a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code>,
<code>dstImplicitData</code> or addresses specified in <code>dstAddressesArray</code>
<strong>must</strong> be aligned to
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>clusterByteAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-scratchData-10480" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-scratchData-10480"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-scratchData-10480</span><br>

<code>scratchData</code> <strong>must</strong> be aligned to
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>clusterScratchByteAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosCount-10481" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosCount-10481"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosCount-10481</span><br>

<code>srcInfosCount</code> <strong>must</strong> be 4-byte aligned</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10482" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10482"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10482</span><br>

If <code>input</code>::<code>opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_CLUSTERS_BOTTOM_LEVEL_NV</code>,
the total and per argument number of cluster acceleration structures
referenced in <code>srcInfosArray</code> <strong>must</strong> be equal or less than the
maximum values with which memory requirements were queried in
<a href="#vkGetClusterAccelerationStructureBuildSizesNV">vkGetClusterAccelerationStructureBuildSizesNV</a> with
<a href="#VkClusterAccelerationStructureOpInputNV">VkClusterAccelerationStructureOpInputNV</a>::<code>pClustersBottomLevel</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-sType-sType" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-sType-sType"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_CLUSTER_ACCELERATION_STRUCTURE_COMMANDS_INFO_NV</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-pNext-pNext" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-pNext-pNext"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-input-parameter" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-input-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-input-parameter</span><br>
 <code>input</code> <strong>must</strong> be a valid <a href="#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a> structure</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-addressResolutionFlags-parameter" href="#VUID-VkClusterAccelerationStructureCommandsInfoNV-addressResolutionFlags-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-addressResolutionFlags-parameter</span><br>
 <code>addressResolutionFlags</code> <strong>must</strong> be a valid combination of <a href="#VkClusterAccelerationStructureAddressResolutionFlagBitsNV">VkClusterAccelerationStructureAddressResolutionFlagBitsNV</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong>can</strong> be set in
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>addressResolutionFlags</code>,
specifying how the device address in
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a> are interpreted, are:</p>
</div>
<div id="VkClusterAccelerationStructureAddressResolutionFlagBitsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef enum VkClusterAccelerationStructureAddressResolutionFlagBitsNV {
    VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_DST_IMPLICIT_DATA_BIT_NV = 0x00000001,
    VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_SCRATCH_DATA_BIT_NV = 0x00000002,
    VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_DST_ADDRESS_ARRAY_BIT_NV = 0x00000004,
    VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_DST_SIZES_ARRAY_BIT_NV = 0x00000008,
    VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_SRC_INFOS_ARRAY_BIT_NV = 0x00000010,
    VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_SRC_INFOS_COUNT_BIT_NV = 0x00000020,
} VkClusterAccelerationStructureAddressResolutionFlagBitsNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_DST_IMPLICIT_DATA_BIT_NV</code>
indicates another level of indirection when reading
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstImplicitData</code>.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_SCRATCH_DATA_BIT_NV</code>
indicates another level of indirection when reading
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>scratchData</code>.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_DST_ADDRESS_ARRAY_BIT_NV</code>
indicates another level of indirection when reading
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstAddressesArray</code>.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_DST_SIZES_ARRAY_BIT_NV</code>
indicates another level of indirection when reading
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstSizesArray</code>.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_SRC_INFOS_ARRAY_BIT_NV</code>
indicates another level of indirection when reading
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>srcInfosArray</code>.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_SRC_INFOS_COUNT_BIT_NV</code>
indicates another level of indirection when reading
<a href="#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>srcInfosCount</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkClusterAccelerationStructureAddressResolutionFlagsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef VkFlags VkClusterAccelerationStructureAddressResolutionFlagsNV;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkClusterAccelerationStructureAddressResolutionFlagsNV</code> is a bitmask
type for setting a mask of zero or more
<a href="#VkClusterAccelerationStructureAddressResolutionFlagBitsNV">VkClusterAccelerationStructureAddressResolutionFlagBitsNV</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkClusterAccelerationStructureMoveObjectsInfoNV">VkClusterAccelerationStructureMoveObjectsInfoNV</a> structure is
defined as:</p>
</div>
<div id="VkClusterAccelerationStructureMoveObjectsInfoNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef struct VkClusterAccelerationStructureMoveObjectsInfoNV {
    VkDeviceAddress    srcAccelerationStructure;
} VkClusterAccelerationStructureMoveObjectsInfoNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>srcAccelerationStructure</code> is the device address of the source
cluster acceleration structure that will be moved.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureMoveObjectsInfoNV-srcAccelerationStructure-10483" href="#VUID-VkClusterAccelerationStructureMoveObjectsInfoNV-srcAccelerationStructure-10483"></a> <span class="vuid">VUID-VkClusterAccelerationStructureMoveObjectsInfoNV-srcAccelerationStructure-10483</span><br>

<code>srcAccelerationStructure</code> <strong>must</strong> be a type of <a href="#cluster-geometry">    cluster acceleration structure</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV">VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV</a>
structure is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef struct VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV {
    uint32_t           clusterReferencesCount;
    uint32_t           clusterReferencesStride;
    VkDeviceAddress    clusterReferences;
} VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>clusterReferencesCount</code> is the number of clusters this bottom level
acceleration structure will be built from.</p>
</li>
<li>
<p><code>clusterReferencesStride</code> is the stride in <code>clusterReferences</code>.</p>
</li>
<li>
<p><code>clusterReferences</code> is the device memory containing the address of
the clusters.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-10484" href="#VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-10484"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-10484</span><br>

All cluster references in <code>clusterReferences</code> <strong>must</strong> be unique</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-10485" href="#VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-10485"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-10485</span><br>

<code>clusterReferences</code> <strong>must</strong> have at least <code>clusterReferencesCount</code>
values</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferencesStride-10486" href="#VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferencesStride-10486"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferencesStride-10486</span><br>

<code>clusterReferencesStride</code> <strong>must</strong> be greater than or equal to 8</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong>can</strong> be set in
<a href="#VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</a>::<code>geometryFlags</code>,
specifying geometry flags for cluster acceleration structure, are:</p>
</div>
<div id="VkClusterAccelerationStructureGeometryFlagBitsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef enum VkClusterAccelerationStructureGeometryFlagBitsNV {
    VK_CLUSTER_ACCELERATION_STRUCTURE_GEOMETRY_CULL_DISABLE_BIT_NV = 0x00000001,
    VK_CLUSTER_ACCELERATION_STRUCTURE_GEOMETRY_NO_DUPLICATE_ANYHIT_INVOCATION_BIT_NV = 0x00000002,
    VK_CLUSTER_ACCELERATION_STRUCTURE_GEOMETRY_OPAQUE_BIT_NV = 0x00000004,
} VkClusterAccelerationStructureGeometryFlagBitsNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_GEOMETRY_CULL_DISABLE_BIT_NV</code>
disables face culling for this geometry.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_GEOMETRY_NO_DUPLICATE_ANYHIT_INVOCATION_BIT_NV</code>
indicates that the implementation <strong>must</strong> only call the any-hit shader a
single time for each primitive in this geometry.
If this bit is absent an implementation <strong>may</strong> invoke the any-hit shader
more than once for this geometry.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_GEOMETRY_OPAQUE_BIT_NV</code> specifies
that this geometry does not invoke the any-hit shaders even if present
in a hit group.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkClusterAccelerationStructureGeometryFlagsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef VkFlags VkClusterAccelerationStructureGeometryFlagsNV;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkClusterAccelerationStructureGeometryFlagsNV</code> is a bitmask type for
setting a mask of zero or more
<a href="#VkClusterAccelerationStructureGeometryFlagBitsNV">VkClusterAccelerationStructureGeometryFlagBitsNV</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</a>
structure is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef struct VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV {
    uint32_t    geometryIndex:24;
    uint32_t    reserved:5;
    uint32_t    geometryFlags:3;
} VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>geometryIndex</code> specifies the geometry index for all triangles in
the cluster acceleration structure.</p>
</li>
<li>
<p><code>reserved</code> is reserved for future use.</p>
</li>
<li>
<p><code>geometryFlags</code> is a bitmask of
<a href="#VkClusterAccelerationStructureGeometryFlagBitsNV">VkClusterAccelerationStructureGeometryFlagBitsNV</a> values describing
geometry flags for the cluster acceleration structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this structure produces the correct layout with existing
compilers.
The intended bit pattern is the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>geometryIndex</code>, <code>reserved</code> and <code>mask</code> occupy the same
memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>geometryIndex</code> occupies the 24 least significant bits of that
memory</p>
</li>
<li>
<p><code>geometryFlags</code> occupies the 3 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong>must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV-reserved-10487" href="#VUID-VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV-reserved-10487"></a> <span class="vuid">VUID-VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV-reserved-10487</span><br>

<code>reserved</code> <strong>must</strong> be <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong>can</strong> be set in
<a href="#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a>::<code>clusterFlags</code>,
specifying flags for clusters in an acceleration structure, are:</p>
</div>
<div id="VkClusterAccelerationStructureClusterFlagBitsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef enum VkClusterAccelerationStructureClusterFlagBitsNV {
    VK_CLUSTER_ACCELERATION_STRUCTURE_CLUSTER_ALLOW_DISABLE_OPACITY_MICROMAPS_NV = 0x00000001,
} VkClusterAccelerationStructureClusterFlagBitsNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_CLUSTER_ALLOW_DISABLE_OPACITY_MICROMAPS_NV</code>
indicates that the specified cluster acceleration structure <strong>may</strong> be
referenced in an instance with
<code>VK_GEOMETRY_INSTANCE_DISABLE_OPACITY_MICROMAPS_EXT</code> set.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkClusterAccelerationStructureClusterFlagsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef VkFlags VkClusterAccelerationStructureClusterFlagsNV;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkClusterAccelerationStructureClusterFlagsNV</code> is a bitmask type for
setting a mask of zero or more
<a href="#VkClusterAccelerationStructureClusterFlagBitsNV">VkClusterAccelerationStructureClusterFlagBitsNV</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a> structure
is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureBuildTriangleClusterInfoNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef struct VkClusterAccelerationStructureBuildTriangleClusterInfoNV {
    uint32_t                                                         clusterID;
    VkClusterAccelerationStructureClusterFlagsNV                     clusterFlags;
    uint32_t                                                         triangleCount:9;
    uint32_t                                                         vertexCount:9;
    uint32_t                                                         positionTruncateBitCount:6;
    uint32_t                                                         indexType:4;
    uint32_t                                                         opacityMicromapIndexType:4;
    VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV    baseGeometryIndexAndGeometryFlags;
    uint16_t                                                         indexBufferStride;
    uint16_t                                                         vertexBufferStride;
    uint16_t                                                         geometryIndexAndFlagsBufferStride;
    uint16_t                                                         opacityMicromapIndexBufferStride;
    VkDeviceAddress                                                  indexBuffer;
    VkDeviceAddress                                                  vertexBuffer;
    VkDeviceAddress                                                  geometryIndexAndFlagsBuffer;
    VkDeviceAddress                                                  opacityMicromapArray;
    VkDeviceAddress                                                  opacityMicromapIndexBuffer;
} VkClusterAccelerationStructureBuildTriangleClusterInfoNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>clusterID</code> is a user specified identifier assigned to this cluster.</p>
</li>
<li>
<p><code>clusterFlags</code> is a bitmask of
<a href="#VkClusterAccelerationStructureClusterFlagBitsNV">VkClusterAccelerationStructureClusterFlagBitsNV</a> values describing
flags how the cluster should be built.</p>
</li>
<li>
<p><code>triangleCount</code> is the number of triangles in this cluster.</p>
</li>
<li>
<p><code>vertexCount</code> is the number of unique vertices in this cluster.</p>
</li>
<li>
<p><code>positionTruncateBitCount</code> is the number of bits starting at the
lowest bit (i.e. the LSBs of the mantissa), of each vertex position that
will be truncated to zero to improve floating-point compression.</p>
</li>
<li>
<p><code>indexType</code> is a single
<a href="#VkClusterAccelerationStructureIndexFormatFlagBitsNV">VkClusterAccelerationStructureIndexFormatFlagBitsNV</a> value
specifying the index type in <code>indexBuffer</code>.</p>
</li>
<li>
<p><code>opacityMicromapIndexType</code> is a single
<a href="#VkClusterAccelerationStructureIndexFormatFlagBitsNV">VkClusterAccelerationStructureIndexFormatFlagBitsNV</a> value
specifying the index type in <code>opacityMicromapIndexBuffer</code>.</p>
</li>
<li>
<p><code>baseGeometryIndexAndGeometryFlags</code> is a
<a href="#VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</a>
value specifying the base geometry index and flags for all triangles in
the cluster.</p>
</li>
<li>
<p><code>indexBufferStride</code> is the stride in bytes in <code>indexBuffer</code> with
<code>0</code> meaning the values are tightly-packed.</p>
</li>
<li>
<p><code>vertexBufferStride</code> is the stride in bytes in <code>vertexBuffer</code>
with <code>0</code> meaning the values are tightly-packed.</p>
</li>
<li>
<p><code>geometryIndexAndFlagsBufferStride</code> is the stride in bytes in
<code>geometryIndexAndFlagsBuffer</code> with <code>0</code> meaning the values are
tightly-packed.</p>
</li>
<li>
<p><code>opacityMicromapIndexBufferStride</code> is the stride in bytes in
<code>opacityMicromapIndexBuffer</code> with <code>0</code> meaning the values are
tightly-packed.</p>
</li>
<li>
<p><code>indexBuffer</code> contains the indices of vertices in the cluster and is
of type <code>indexType</code>.</p>
</li>
<li>
<p><code>vertexBuffer</code> specifies the vertex data of the triangles in the
cluster with format specified in
<a href="#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a>::<code>vertexFormat</code>.</p>
</li>
<li>
<p><a id="cluster-geometry-index-flags"></a> <code>geometryIndexAndFlagsBuffer</code> is
either <code>NULL</code> or an address containing strided
<a href="#VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</a>
values specifying the geometry index and flag for every triangle in the
cluster.</p>
</li>
<li>
<p><code>opacityMicromapArray</code> is either <code>NULL</code> or specifies the address of
a valid opacity micromap array to reference from the cluster
acceleration structure.
If it is <code>NULL</code>, then opacity micromaps will be disabled for this
cluster acceleration structure.</p>
</li>
<li>
<p><code>opacityMicromapIndexBuffer</code> is either <code>NULL</code> or specifies the
address of a strided array with size equal to the number of triangles or
indices into the opacity micromap array.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this structure produces the correct layout with existing
compilers.
The intended bit pattern is the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>triangleCount</code>, <code>vertexCount</code>, <code>positionTruncateBitCount</code>,
<code>indexType</code> and <code>opacityMicromapIndexType</code> occupy the same
memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>triangleCount</code> occupies the 9 least significant bits of that
memory</p>
</li>
<li>
<p><code>vertexCount</code> occupies the next 9 least significant bits of that
memory</p>
</li>
<li>
<p><code>positionTruncateBitCount</code> occupies the next 6 least significant
bits of that memory</p>
</li>
<li>
<p><code>indexType</code> occupies the next 4 least significant bits of that
memory</p>
</li>
<li>
<p><code>opacityMicromapIndexType</code> occupies the 4 most significant bits of
that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong>must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-clusterID-10488" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-clusterID-10488"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-clusterID-10488</span><br>

<code>clusterID</code> <strong>must</strong> not be 0xFFFFFFFF</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-triangleCount-10489" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-triangleCount-10489"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-triangleCount-10489</span><br>

<code>triangleCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxTrianglesPerCluster</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexCount-10490" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexCount-10490"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexCount-10490</span><br>

<code>vertexCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxVerticesPerCluster</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexType-10491" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexType-10491"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexType-10491</span><br>

<code>indexType</code> <strong>must</strong> only have a single bit set</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapIndexType-10492" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapIndexType-10492"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapIndexType-10492</span><br>

<code>opacityMicromapIndexType</code> <strong>must</strong> only have a single bit set</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-positionTruncateBitCount-10493" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-positionTruncateBitCount-10493"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-positionTruncateBitCount-10493</span><br>

<code>positionTruncateBitCount</code> <strong>must</strong> be greater than or equal to
<a href="#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a>::<code>minPositionTruncateBitCount</code>
and less than or equal to <code>32</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexBufferStride-10494" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexBufferStride-10494"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexBufferStride-10494</span><br>

<code>indexBufferStride</code> <strong>must</strong> be <code>0</code> or a multiple of <code>indexType</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexBufferStride-10495" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexBufferStride-10495"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexBufferStride-10495</span><br>

<code>vertexBufferStride</code> <strong>must</strong> be <code>0</code> or a multiple of value specified
in
<a href="#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a>::<code>vertexFormat</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-baseGeometryIndex-10496" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-baseGeometryIndex-10496"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-baseGeometryIndex-10496</span><br>

The maximum geometry index after using the values in
<code>baseGeometryIndex</code> and <code>geometryIndexBuffer</code> <strong>must</strong> be less than
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxClusterGeometryIndex</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-clusterFlags-parameter" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-clusterFlags-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-clusterFlags-parameter</span><br>
 <code>clusterFlags</code> <strong>must</strong> be a valid combination of <a href="#VkClusterAccelerationStructureClusterFlagBitsNV">VkClusterAccelerationStructureClusterFlagBitsNV</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits that <strong>can</strong> be set in
<a href="#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a>::<code>indexType</code>,
<a href="#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a>::<code>opacityMicromapIndexType</code>,
<a href="#VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV">VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV</a>::<code>indexType</code>
and
<a href="#VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV">VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV</a>::<code>opacityMicromapIndexType</code>
specifying the index type is one of:</p>
</div>
<div id="VkClusterAccelerationStructureIndexFormatFlagBitsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef enum VkClusterAccelerationStructureIndexFormatFlagBitsNV {
    VK_CLUSTER_ACCELERATION_STRUCTURE_INDEX_FORMAT_8BIT_NV = 0x00000001,
    VK_CLUSTER_ACCELERATION_STRUCTURE_INDEX_FORMAT_16BIT_NV = 0x00000002,
    VK_CLUSTER_ACCELERATION_STRUCTURE_INDEX_FORMAT_32BIT_NV = 0x00000004,
} VkClusterAccelerationStructureIndexFormatFlagBitsNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_INDEX_FORMAT_8BIT_NV</code> specifies
that 8-bit indices will be used.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_INDEX_FORMAT_16BIT_NV</code> specifies
that 16-bit indices will be used.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_INDEX_FORMAT_32BIT_NV</code> specifies
that 32-bit indices will be used.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkClusterAccelerationStructureIndexFormatFlagsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef VkFlags VkClusterAccelerationStructureIndexFormatFlagsNV;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkClusterAccelerationStructureIndexFormatFlagsNV</code> is a bitmask type for
setting a single <a href="#VkClusterAccelerationStructureIndexFormatFlagBitsNV">VkClusterAccelerationStructureIndexFormatFlagBitsNV</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV">VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV</a>
structure is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef struct VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV {
    uint32_t                                                         clusterID;
    VkClusterAccelerationStructureClusterFlagsNV                     clusterFlags;
    uint32_t                                                         triangleCount:9;
    uint32_t                                                         vertexCount:9;
    uint32_t                                                         positionTruncateBitCount:6;
    uint32_t                                                         indexType:4;
    uint32_t                                                         opacityMicromapIndexType:4;
    VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV    baseGeometryIndexAndGeometryFlags;
    uint16_t                                                         indexBufferStride;
    uint16_t                                                         vertexBufferStride;
    uint16_t                                                         geometryIndexAndFlagsBufferStride;
    uint16_t                                                         opacityMicromapIndexBufferStride;
    VkDeviceAddress                                                  indexBuffer;
    VkDeviceAddress                                                  vertexBuffer;
    VkDeviceAddress                                                  geometryIndexAndFlagsBuffer;
    VkDeviceAddress                                                  opacityMicromapArray;
    VkDeviceAddress                                                  opacityMicromapIndexBuffer;
    VkDeviceAddress                                                  instantiationBoundingBoxLimit;
} VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>clusterID</code> is a user specified identifier assigned to this cluster
template.</p>
</li>
<li>
<p><code>clusterFlags</code> is a bitmask of
<a href="#VkClusterAccelerationStructureClusterFlagBitsNV">VkClusterAccelerationStructureClusterFlagBitsNV</a> values describing
flags how the cluster template should be built.</p>
</li>
<li>
<p><code>triangleCount</code> is the number of triangles in this cluster.</p>
</li>
<li>
<p><code>vertexCount</code> is the number of unique vertices in this cluster.</p>
</li>
<li>
<p><code>positionTruncateBitCount</code> is the number of bits starting at the
lowest bit (i.e. the LSBs of the mantissa), of each vertex position that
will be truncated to zero to improve floating-point compression.</p>
</li>
<li>
<p><code>indexType</code> is a single
<a href="#VkClusterAccelerationStructureIndexFormatFlagBitsNV">VkClusterAccelerationStructureIndexFormatFlagBitsNV</a> value
specifying the index type in <code>indexBuffer</code>.</p>
</li>
<li>
<p><code>opacityMicromapIndexType</code> is a single
<a href="#VkClusterAccelerationStructureIndexFormatFlagBitsNV">VkClusterAccelerationStructureIndexFormatFlagBitsNV</a> value
specifying the index type in <code>opacityMicromapIndexBuffer</code>.</p>
</li>
<li>
<p><code>baseGeometryIndexAndGeometryFlags</code> is a
<a href="#VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</a>
value specifying the base geometry index and flags for all triangles in
the cluster template.</p>
</li>
<li>
<p><code>indexBufferStride</code> is the stride in bytes in <code>indexBuffer</code>.</p>
</li>
<li>
<p><code>vertexBufferStride</code> is the stride in bytes in <code>vertexBuffer</code>.</p>
</li>
<li>
<p><code>geometryIndexAndFlagsBufferStride</code> is the stride in bytes in
<code>geometryIndexAndFlagsBuffer</code>.</p>
</li>
<li>
<p><code>opacityMicromapIndexBufferStride</code> is the stride in bytes in
<code>opacityMicromapIndexBuffer</code>.</p>
</li>
<li>
<p><code>indexBuffer</code> contains the indices of vertices in the cluster and is
of type <code>indexType</code>.</p>
</li>
<li>
<p><code>vertexBuffer</code> is either <code>NULL</code> or specifies the vertex data of the
triangles in the cluster template with format specified in
<a href="#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a>::<code>vertexFormat</code>.</p>
</li>
<li>
<p><code>geometryIndexAndFlagsBuffer</code> is either <code>NULL</code> or an address
containing strided
<a href="#VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</a>
values specifying the geometry index and flag for every triangle in the
cluster.</p>
</li>
<li>
<p><code>opacityMicromapArray</code> is either <code>NULL</code> or specifies the address of
a valid opacity micromap array to reference from the cluster
acceleration structure.
If it is <code>NULL</code>, then opacity micromaps will be disabled for this
cluster acceleration structure.</p>
</li>
<li>
<p><code>opacityMicromapIndexBuffer</code> is either <code>NULL</code> or specifies the
address of a strided array with size equal to the number of triangles or
indices into the opacity micromap array.</p>
</li>
<li>
<p><code>instantiationBoundingBoxLimit</code> is either <code>NULL</code> or specifies the
address of a bounding box within which all instantiated clusters <strong>must</strong>
lie.
The bounding box is specified by six 32-bit floating-point values in the
order MinX, MinY, MinZ, MaxX, MaxY, MaxZ.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this structure produces the correct layout with existing
compilers.
The intended bit pattern is the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>triangleCount</code>, <code>vertexCount</code>, <code>positionTruncateBitCount</code>,
<code>indexType</code> and <code>opacityMicromapIndexType</code> occupy the same
memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>triangleCount</code> occupies the 9 least significant bits of that
memory</p>
</li>
<li>
<p><code>vertexCount</code> occupies the next 9 least significant bits of that
memory</p>
</li>
<li>
<p><code>positionTruncateBitCount</code> occupies the next 6 least significant
bits of that memory</p>
</li>
<li>
<p><code>indexType</code> occupies the next 4 least significant bits of that
memory</p>
</li>
<li>
<p><code>opacityMicromapIndexType</code> occupies the 4 most significant bits of
that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong>must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="paragraph">
<p>Cluster templates cannot be directly used to build bottom level acceleration
structures, instead, they <strong>must</strong> be instantiated into
<a href="#acceleration-structure-clas-geometry">CLAS objects</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-clusterID-10497" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-clusterID-10497"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-clusterID-10497</span><br>

<code>clusterID</code> <strong>must</strong> not be 0xFFFFFFFF</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-triangleCount-10498" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-triangleCount-10498"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-triangleCount-10498</span><br>

<code>triangleCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxTrianglesPerCluster</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexCount-10499" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexCount-10499"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexCount-10499</span><br>

<code>vertexCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxVerticesPerCluster</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexType-10500" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexType-10500"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexType-10500</span><br>

<code>indexType</code> <strong>must</strong> only have a single bit set</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapIndexType-10501" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapIndexType-10501"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapIndexType-10501</span><br>

<code>opacityMicromapIndexType</code> <strong>must</strong> only have a single bit set</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-positionTruncateBitCount-10502" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-positionTruncateBitCount-10502"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-positionTruncateBitCount-10502</span><br>

<code>positionTruncateBitCount</code> <strong>must</strong> be greater than or equal to
<a href="#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a>::<code>minPositionTruncateBitCount</code>
and less than or equal to <code>32</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexBufferStride-10503" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexBufferStride-10503"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexBufferStride-10503</span><br>

<code>indexBufferStride</code> <strong>must</strong> be <code>0</code> or a multiple of <code>indexType</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexBufferStride-10504" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexBufferStride-10504"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexBufferStride-10504</span><br>

<code>vertexBufferStride</code> <strong>must</strong> be <code>0</code> or a multiple of value specified
in
<a href="#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a>::<code>vertexFormat</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-instantiationBoundingBoxLimit-10505" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-instantiationBoundingBoxLimit-10505"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-instantiationBoundingBoxLimit-10505</span><br>

<code>instantiationBoundingBoxLimit</code> <strong>must</strong> be aligned to
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>clusterTemplateBoundsByteAlignment</code>.</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-baseGeometryIndex-10506" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-baseGeometryIndex-10506"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-baseGeometryIndex-10506</span><br>

The maximum geometry index after using the values in
<code>baseGeometryIndex</code> and <code>geometryIndexBuffer</code> <strong>must</strong> be less than
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxClusterGeometryIndex</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-clusterFlags-parameter" href="#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-clusterFlags-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-clusterFlags-parameter</span><br>
 <code>clusterFlags</code> <strong>must</strong> be a valid combination of <a href="#VkClusterAccelerationStructureClusterFlagBitsNV">VkClusterAccelerationStructureClusterFlagBitsNV</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkClusterAccelerationStructureInstantiateClusterInfoNV">VkClusterAccelerationStructureInstantiateClusterInfoNV</a> structure
is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureInstantiateClusterInfoNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef struct VkClusterAccelerationStructureInstantiateClusterInfoNV {
    uint32_t                    clusterIdOffset;
    uint32_t                    geometryIndexOffset:24;
    uint32_t                    reserved:8;
    VkDeviceAddress             clusterTemplateAddress;
    VkStridedDeviceAddressNV    vertexBuffer;
} VkClusterAccelerationStructureInstantiateClusterInfoNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>clusterIdOffset</code> is an unsigned offset applied to the
<code>clusterID</code> value stored in the cluster template.</p>
</li>
<li>
<p><code>geometryIndexOffset</code> is a signed offset applied to the geometry
index of each triangle.</p>
</li>
<li>
<p><code>reserved</code> is reserved for future use.</p>
</li>
<li>
<p><code>clusterTemplateAddress</code> is the address of a previously built
cluster template.</p>
</li>
<li>
<p><code>vertexBuffer</code> is either <code>NULL</code> or a <a href="#VkStridedDeviceAddressNV">VkStridedDeviceAddressNV</a>
structure containing the vertex data for the indexed triangles stored in
the cluster template.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-vertexBuffer-10507" href="#VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-vertexBuffer-10507"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-vertexBuffer-10507</span><br>

<code>vertexBuffer</code> <strong>must</strong> not be <code>NULL</code> if the template was built without
vertex data</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-vertexBuffer-10508" href="#VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-vertexBuffer-10508"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-vertexBuffer-10508</span><br>

The format in <code>vertexBuffer</code> <strong>must</strong> match the original format
specified in <a href="#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-reserved-10509" href="#VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-reserved-10509"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-reserved-10509</span><br>

<code>reserved</code> <strong>must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-geometryIndexOffset-10510" href="#VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-geometryIndexOffset-10510"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-geometryIndexOffset-10510</span><br>

The maximum geometry index after using the value in
<code>geometryIndexOffset</code> <strong>must</strong> be less than
<a href="limits.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxClusterGeometryIndex</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkStridedDeviceAddressNV">VkStridedDeviceAddressNV</a> structure is defined as:</p>
</div>
<div id="VkStridedDeviceAddressNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_cluster_acceleration_structure
typedef struct VkStridedDeviceAddressNV {
    VkDeviceAddress    startAddress;
    VkDeviceSize       strideInBytes;
} VkStridedDeviceAddressNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>startAddress</code> is the device address (as returned by the
<a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a> command) at which the region starts, or
zero if the region is unused.</p>
</li>
<li>
<p><code>strideInBytes</code> is the byte stride between consecutive elements.
Only the bottom 32 bits are used.
The field is 64 bits to ensure consistent alignment across all
containing structures.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="partitioned-tlas"><a class="anchor" href="#partitioned-tlas"></a>Partitioned Top Level Acceleration Structures</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Partitioned Top Level Acceleration Structures (PTLAS) allow efficient reuse
of previously constructed sections of the top level acceleration structure
by eliminating a full rebuild when only a few instances are modified.
This reduces build times and supports handling a higher number of instances,
making it more suitable for large and complex scenes.</p>
</div>
<div class="paragraph">
<p>PTLAS organizes instances into partitions, enabling a two-stage build
process: first, it constructs an acceleration structure for each partition
by grouping the instances within it, and second, it combines these partition
structures into a single acceleration structure, similar to the current
top-level acceleration structure.</p>
</div>
<div class="paragraph">
<p>To maintain compatibility, PTLAS behaves identically to the current
top-level acceleration structure from the perspective of ray tracing shaders
and pipelines.</p>
</div>
<div id="ptlas-global-partition" class="paragraph">
<p>PTLAS includes a unique global partition that operates independently of
other partitions.
Instances <strong>can</strong> be assigned to this global partition just like they would to
regular partitions.
The global partition is well-suited for frequently updated instances, such
as animated characters.
During the build process, instances in the global partition are treated as
if they belong to individual partitions, without increasing the maximum
partition count.
However, instances in the global partition may still impact build
performance.
Once these instances become stable, they should be moved to a spatially
optimized, non-global partition to lower build costs and minimize trace
performance issues.</p>
</div>
<div id="ptlas-partition-translation" class="paragraph">
<p>To handle large worlds requiring more precision than 32-bit floating-point
numbers offer, PTLAS offers efficient partition translation.
Typically, applications maintain precision by placing the world center near
the camera.
Partition translation allows an additional translation of instances during
construction without changing their stored transforms.
This method stores instance transforms relative to partitions, applying a
translation to achieve accurate world positions.
Higher precision is maintained using smaller floating-point numbers until
the structure is built.
World space coordinates <strong>can</strong> also be updated efficiently without rebuilding
the entire PTLAS.
Partition translation requires extra memory for untranslated instance
transforms and <strong>must</strong> be explicitly enabled with
<a href="#VkPartitionedAccelerationStructureFlagsNV">VkPartitionedAccelerationStructureFlagsNV</a>::<code>enablePartitionTranslation</code>
flag.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To determine the memory requirements for a PTAS, call:</p>
</div>
<div id="vkGetPartitionedAccelerationStructuresBuildSizesNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_partitioned_acceleration_structure
void vkGetPartitionedAccelerationStructuresBuildSizesNV(
    VkDevice                                    device,
    const VkPartitionedAccelerationStructureInstancesInputNV* pInfo,
    VkAccelerationStructureBuildSizesInfoKHR*   pSizeInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the acceleration structure.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="#VkPartitionedAccelerationStructureInstancesInputNV">VkPartitionedAccelerationStructureInstancesInputNV</a> structure
containing parameters required for the memory requirements query.</p>
</li>
<li>
<p><code>pSizeInfo</code> is a pointer to a
<a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure which returns
the size required for an acceleration structure and the sizes required
for the scratch buffers, given the build parameters.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-partitionedAccelerationStructure-10534" href="#VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-partitionedAccelerationStructure-10534"></a> <span class="vuid">VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-partitionedAccelerationStructure-10534</span><br>

The <a href="features.html#features-partitionedAccelerationStructure" class="xref page">    <code>VkPhysicalDevicePartitionedAccelerationStructureFeaturesNV</code>::<code>partitionedAccelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-device-parameter" href="#VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-device-parameter"></a> <span class="vuid">VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-pInfo-parameter" href="#VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-pInfo-parameter"></a> <span class="vuid">VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkPartitionedAccelerationStructureInstancesInputNV">VkPartitionedAccelerationStructureInstancesInputNV</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-pSizeInfo-parameter" href="#VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-pSizeInfo-parameter"></a> <span class="vuid">VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-pSizeInfo-parameter</span><br>
 <code>pSizeInfo</code> <strong>must</strong> be a valid pointer to a <a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkPartitionedAccelerationStructureInstancesInputNV">VkPartitionedAccelerationStructureInstancesInputNV</a> structure is
defined as:</p>
</div>
<div id="VkPartitionedAccelerationStructureInstancesInputNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_partitioned_acceleration_structure
typedef struct VkPartitionedAccelerationStructureInstancesInputNV {
    VkStructureType                         sType;
    void*                                   pNext;
    VkBuildAccelerationStructureFlagsKHR    flags;
    uint32_t                                instanceCount;
    uint32_t                                maxInstancePerPartitionCount;
    uint32_t                                partitionCount;
    uint32_t                                maxInstanceInGlobalPartitionCount;
} VkPartitionedAccelerationStructureInstancesInputNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="resources.html#VkBuildAccelerationStructureFlagsKHR" class="xref page">VkBuildAccelerationStructureFlagsKHR</a>
specifying flags for the PTLAS build operation.</p>
</li>
<li>
<p><code>instanceCount</code> is the number of instances in this PTLAS.</p>
</li>
<li>
<p><code>maxInstancePerPartitionCount</code> is the maximum number of instances
per partition in the PTLAS.</p>
</li>
<li>
<p><code>partitionCount</code> is the number of partitions in the PTLAS.</p>
</li>
<li>
<p><code>maxInstanceInGlobalPartitionCount</code> is maximum number of instances
in the <a href="#ptlas-global-partition">global partition</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the <code>pNext</code> chain includes a
<a href="#VkPartitionedAccelerationStructureFlagsNV">VkPartitionedAccelerationStructureFlagsNV</a> structure, then that
structure specifies additional flags for the PTLAS.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureInstancesInputNV-partitionCount-10535" href="#VUID-VkPartitionedAccelerationStructureInstancesInputNV-partitionCount-10535"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureInstancesInputNV-partitionCount-10535</span><br>

The sum of <code>partitionCount</code> and
<code>maxInstanceInGlobalPartitionCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDevicePartitionedAccelerationStructurePropertiesNV" class="xref page">VkPhysicalDevicePartitionedAccelerationStructurePropertiesNV</a>::<code>maxPartitionCount</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureInstancesInputNV-sType-sType" href="#VUID-VkPartitionedAccelerationStructureInstancesInputNV-sType-sType"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureInstancesInputNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCES_INPUT_NV</code></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureInstancesInputNV-pNext-pNext" href="#VUID-VkPartitionedAccelerationStructureInstancesInputNV-pNext-pNext"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureInstancesInputNV-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code> or a pointer to a valid instance of <a href="#VkPartitionedAccelerationStructureFlagsNV">VkPartitionedAccelerationStructureFlagsNV</a></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureInstancesInputNV-sType-unique" href="#VUID-VkPartitionedAccelerationStructureInstancesInputNV-sType-unique"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureInstancesInputNV-sType-unique</span><br>
 The <code>sType</code> value of each structure in the <code>pNext</code> chain <strong>must</strong> be unique</p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureInstancesInputNV-flags-parameter" href="#VUID-VkPartitionedAccelerationStructureInstancesInputNV-flags-parameter"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureInstancesInputNV-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="resources.html#VkBuildAccelerationStructureFlagBitsKHR" class="xref page">VkBuildAccelerationStructureFlagBitsKHR</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkPartitionedAccelerationStructureFlagsNV">VkPartitionedAccelerationStructureFlagsNV</a> structure is defined as:</p>
</div>
<div id="VkPartitionedAccelerationStructureFlagsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_partitioned_acceleration_structure
typedef struct VkPartitionedAccelerationStructureFlagsNV {
    VkStructureType    sType;
    void*              pNext;
    VkBool32           enablePartitionTranslation;
} VkPartitionedAccelerationStructureFlagsNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>enablePartitionTranslation</code> specifies if a
<a href="#ptlas-partition-translation">partition translation</a> <strong>may</strong> be applied
with
<a href="#VkPartitionedAccelerationStructureWritePartitionTranslationDataNV">VkPartitionedAccelerationStructureWritePartitionTranslationDataNV</a>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureFlagsNV-sType-sType" href="#VUID-VkPartitionedAccelerationStructureFlagsNV-sType-sType"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureFlagsNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_PARTITIONED_ACCELERATION_STRUCTURE_FLAGS_NV</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build a partitioned top level acceleration structure, call:</p>
</div>
<div id="vkCmdBuildPartitionedAccelerationStructuresNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_partitioned_acceleration_structure
void vkCmdBuildPartitionedAccelerationStructuresNV(
    VkCommandBuffer                             commandBuffer,
    const VkBuildPartitionedAccelerationStructureInfoNV* pBuildInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command is
recorded.</p>
</li>
<li>
<p><code>pBuildInfo</code> is a pointer to a
<a href="#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a> structure containing
parameters required for building a PTLAS.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to the acceleration structure scratch memory as identified by the
<a href="#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>scratchData</code> <strong>must</strong>
be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
(<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> |
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>).</p>
</div>
<div class="paragraph">
<p>Accesses to each
<a href="#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>srcAccelerationStructureData</code>
and
<a href="#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>dstAccelerationStructureData</code>
<strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> or
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>, as appropriate.</p>
</div>
<div class="paragraph">
<p>Accesses to memory with input data as identified by any used values of
<a href="#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>srcInfos</code> and
<a href="#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>srcInfosCount</code>
<strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_INDIRECT_COMMAND_READ_BIT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-partitionedAccelerationStructure-10536" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-partitionedAccelerationStructure-10536"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-partitionedAccelerationStructure-10536</span><br>

The <a href="features.html#features-partitionedAccelerationStructure" class="xref page">    <code>VkPhysicalDevicePartitionedAccelerationStructureFeaturesNV</code>::<code>partitionedAccelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10537" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10537"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10537</span><br>

The count specified in <code>pBuildInfo-&gt;input</code>::<code>instanceCount</code> for
the build operation <strong>must</strong> not exceed the value provided in
<code>pInfo-&gt;instanceCount</code> when calling
<a href="#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a> to determine
the memory size</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10538" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10538"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10538</span><br>

The count specified in
<code>pBuildInfo-&gt;input</code>::<code>maxInstancePerPartitionCount</code> for the
build operation <strong>must</strong> not exceed the value provided in
<code>pInfo-&gt;maxInstancePerPartitionCount</code> when calling
<a href="#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a> to determine
the memory size</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10539" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10539"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10539</span><br>

The count specified in <code>pBuildInfo-&gt;input</code>::<code>partitionCount</code> for
the build operation <strong>must</strong> not exceed the value provided in
<code>pInfo-&gt;partitionCount</code> when calling
<a href="#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a> to determine
the memory size</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10540" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10540"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10540</span><br>

The count specified in
<code>pBuildInfo-&gt;input</code>::<code>maxInstanceInGlobalPartitionCount</code> for the
build operation <strong>must</strong> not exceed the value provided in
<code>pInfo-&gt;maxInstanceInGlobalPartitionCount</code> when calling
<a href="#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a> to determine
the memory size</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10541" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10541"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10541</span><br>

The scratch memory for the partitioned acceleration structure build
specified in <code>pBuildInfo-&gt;scratchData</code> <strong>must</strong> be larger than or equal
to the scratch size queried with
<a href="#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10542" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10542"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10542</span><br>

<code>pBuildInfo-&gt;scratchData</code> <strong>must</strong> be aligned to <code>256</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10543" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10543"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10543</span><br>

The destination memory of the partitioned acceleration structure build
specified in <code>pBuildInfo-&gt;dstAccelerationStructureData</code> <strong>must</strong> be
larger than or equal to the size queried with
<a href="#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10544" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10544"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10544</span><br>

<code>pBuildInfo-&gt;srcAccelerationStructureData</code> <strong>must</strong> be aligned to <code>256</code>
bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10545" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10545"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10545</span><br>

<code>pBuildInfo-&gt;dstAccelerationStructureData</code> <strong>must</strong> be aligned to <code>256</code>
bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10546" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10546"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10546</span><br>

The number of inputs specified in <code>pBuildInfo-&gt;srcInfos</code> <strong>must</strong> be
greater than or equal to <code>pBuildInfo-&gt;srcInfosCount</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10547" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10547"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10547</span><br>

The memory region containing the acceleration structure at address
<code>pBuildInfo-&gt;srcAccelerationStructureData</code> <strong>must</strong> not overlap with
scratch memory region at address <code>pBuildInfo-&gt;scratchData</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10548" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10548"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10548</span><br>

The memory region containing the acceleration structure at address
<code>pBuildInfo-&gt;dstAccelerationStructureData</code> <strong>must</strong> not overlap with
scratch memory region at address <code>pBuildInfo-&gt;scratchData</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10549" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10549"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10549</span><br>

The memory regions containing the acceleration structures at addresses
<code>pBuildInfo-&gt;srcAccelerationStructureData</code> and
<code>pBuildInfo-&gt;dstAccelerationStructureData</code> <strong>must</strong> not overlap with
each other</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10550" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10550"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10550</span><br>

The buffer from which the buffer device address for
<code>pBuildInfo-&gt;scratchData</code> is queried <strong>must</strong> have been created with
the <code>VK_BUFFER_USAGE_STORAGE_BUFFER_BIT</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10551" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10551"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10551</span><br>

The buffers from which the buffer device addresses for
<code>pBuildInfo-&gt;srcInfos</code> and <code>pBuildInfo-&gt;srcInfosCount</code> are
queried <strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_BUILD_INPUT_READ_ONLY_BIT_KHR</code>
usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10552" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10552"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10552</span><br>

The buffers from which the buffer device addresses for
<code>pBuildInfo-&gt;srcAccelerationStructureData</code> and
<code>pBuildInfo-&gt;dstAccelerationStructureData</code> are queried <strong>must</strong> have
been created with the
<code>VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_STORAGE_BIT_KHR</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10553" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10553"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10553</span><br>

If <code>pBuildInfo-&gt;srcAccelerationStructureData</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10554" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10554"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10554</span><br>

If <code>pBuildInfo-&gt;dstAccelerationStructureData</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10555" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10555"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10555</span><br>

If <code>pBuildInfo-&gt;scratchData</code> is the address of a non-sparse buffer
then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10556" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10556"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10556</span><br>

If <code>pBuildInfo-&gt;srcInfos</code> is the address of a non-sparse buffer then
it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10557" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10557"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10557</span><br>

If <code>pBuildInfo-&gt;srcInfosCount</code> is the address of a non-sparse buffer
then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-parameter" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-parameter" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-parameter"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-parameter</span><br>
 <code>pBuildInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-recording" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-cmdpool" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-renderpass" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-renderpass"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-videocoding" href="#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-videocoding"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="videocoding.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a> structure is defined
as:</p>
</div>
<div id="VkBuildPartitionedAccelerationStructureInfoNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_partitioned_acceleration_structure
typedef struct VkBuildPartitionedAccelerationStructureInfoNV {
    VkStructureType                                       sType;
    void*                                                 pNext;
    VkPartitionedAccelerationStructureInstancesInputNV    input;
    VkDeviceAddress                                       srcAccelerationStructureData;
    VkDeviceAddress                                       dstAccelerationStructureData;
    VkDeviceAddress                                       scratchData;
    VkDeviceAddress                                       srcInfos;
    VkDeviceAddress                                       srcInfosCount;
} VkBuildPartitionedAccelerationStructureInfoNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>input</code> is a
<a href="#VkPartitionedAccelerationStructureInstancesInputNV">VkPartitionedAccelerationStructureInstancesInputNV</a> structure
describing the instance and partition count information in the PTLAS.</p>
</li>
<li>
<p><code>srcAccelerationStructureData</code> is <code>NULL</code> or an address of a
previously built PTLAS.
If non-<code>NULL</code>, the PTLAS stored at this address is used as a basis to
create new PTLAS.</p>
</li>
<li>
<p><code>dstAccelerationStructureData</code> is the address to store the built
PTLAS.</p>
</li>
<li>
<p><code>scratchData</code> is the device address of scratch memory that will be
used during PTLAS build.</p>
</li>
<li>
<p><code>srcInfos</code> is the device address of an array of
<a href="#VkBuildPartitionedAccelerationStructureIndirectCommandNV">VkBuildPartitionedAccelerationStructureIndirectCommandNV</a>
structures describing the type of operation to perform.</p>
</li>
<li>
<p><code>srcInfosCount</code> is a device address containing the size of
<code>srcInfos</code> array.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Members <code>srcAccelerationStructureData</code> and
<code>dstAccelerationStructureData</code> <strong>may</strong> be the same or different.
If they are the same, the update happens in-place.
Otherwise, the destination acceleration structure is updated and the source
is not modified.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-10558" href="#VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-10558"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-10558</span><br>

<code>scratchData</code> <strong>must</strong> not be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-10559" href="#VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-10559"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-10559</span><br>

Memory at <code>scratchData</code> <strong>must</strong> be equal or larger than the
<a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a>::<code>buildScratchSize</code>
value returned from
<a href="#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a> with the same
build parameters</p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcAccelerationStructureData-10560" href="#VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcAccelerationStructureData-10560"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcAccelerationStructureData-10560</span><br>

If <code>srcAccelerationStructureData</code> is not <code>NULL</code>, it <strong>must</strong> have
previously been built as a PTLAS</p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-10561" href="#VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-10561"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-10561</span><br>

<code>dstAccelerationStructureData</code> <strong>must</strong> not be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-10562" href="#VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-10562"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-10562</span><br>

Memory at <code>dstAccelerationStructureData</code> <strong>must</strong> be equal or larger
than the
<a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a>::<code>accelerationStructureSize</code>
value returned from
<a href="#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a> with the same
build parameters</p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfosCount-10563" href="#VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfosCount-10563"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfosCount-10563</span><br>

<code>srcInfosCount</code> <strong>must</strong> be 4-byte aligned</p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfos-10564" href="#VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfos-10564"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfos-10564</span><br>

Each element of <code>srcInfos</code> array <strong>must</strong> have a unique
<a href="#VkBuildPartitionedAccelerationStructureIndirectCommandNV">VkBuildPartitionedAccelerationStructureIndirectCommandNV</a>::<code>opType</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-sType-sType" href="#VUID-VkBuildPartitionedAccelerationStructureInfoNV-sType-sType"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_BUILD_PARTITIONED_ACCELERATION_STRUCTURE_INFO_NV</code></p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-pNext-pNext" href="#VUID-VkBuildPartitionedAccelerationStructureInfoNV-pNext-pNext"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-input-parameter" href="#VUID-VkBuildPartitionedAccelerationStructureInfoNV-input-parameter"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-input-parameter</span><br>
 <code>input</code> <strong>must</strong> be a valid <a href="#VkPartitionedAccelerationStructureInstancesInputNV">VkPartitionedAccelerationStructureInstancesInputNV</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkBuildPartitionedAccelerationStructureIndirectCommandNV">VkBuildPartitionedAccelerationStructureIndirectCommandNV</a> structure
is defined as:</p>
</div>
<div id="VkBuildPartitionedAccelerationStructureIndirectCommandNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_partitioned_acceleration_structure
typedef struct VkBuildPartitionedAccelerationStructureIndirectCommandNV {
    VkPartitionedAccelerationStructureOpTypeNV    opType;
    uint32_t                                      argCount;
    VkStridedDeviceAddressNV                      argData;
} VkBuildPartitionedAccelerationStructureIndirectCommandNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>opType</code> is a <a href="#VkPartitionedAccelerationStructureOpTypeNV">VkPartitionedAccelerationStructureOpTypeNV</a>
describing the type of operation.</p>
</li>
<li>
<p><code>argCount</code> the number of structures in <code>argData</code> array.</p>
</li>
<li>
<p><code>argData</code> is an array of <a href="#VkStridedDeviceAddressNV">VkStridedDeviceAddressNV</a> structures
containing the write or update data for instances and partitions in the
PTLAS.
The structure is dependent on <code>opType</code> as shown in the table below.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format of <code>argData</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_WRITE_INSTANCE_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#VkPartitionedAccelerationStructureWriteInstanceDataNV">VkPartitionedAccelerationStructureWriteInstanceDataNV</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_UPDATE_INSTANCE_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#VkPartitionedAccelerationStructureUpdateInstanceDataNV">VkPartitionedAccelerationStructureUpdateInstanceDataNV</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_WRITE_PARTITION_TRANSLATION_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#VkPartitionedAccelerationStructureWritePartitionTranslationDataNV">VkPartitionedAccelerationStructureWritePartitionTranslationDataNV</a></p></td>
</tr>
</tbody>
</table>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureIndirectCommandNV-argData-10565" href="#VUID-VkBuildPartitionedAccelerationStructureIndirectCommandNV-argData-10565"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureIndirectCommandNV-argData-10565</span><br>

An instance index <strong>must</strong> not be referenced by more than one structure in
<code>argData</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureIndirectCommandNV-opType-parameter" href="#VUID-VkBuildPartitionedAccelerationStructureIndirectCommandNV-opType-parameter"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureIndirectCommandNV-opType-parameter</span><br>
 <code>opType</code> <strong>must</strong> be a valid <a href="#VkPartitionedAccelerationStructureOpTypeNV">VkPartitionedAccelerationStructureOpTypeNV</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Values which <strong>can</strong> be set in <a href="#VkPartitionedAccelerationStructureOpTypeNV">VkPartitionedAccelerationStructureOpTypeNV</a>
are:</p>
</div>
<div id="VkPartitionedAccelerationStructureOpTypeNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_partitioned_acceleration_structure
typedef enum VkPartitionedAccelerationStructureOpTypeNV {
    VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_WRITE_INSTANCE_NV = 0,
    VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_UPDATE_INSTANCE_NV = 1,
    VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_WRITE_PARTITION_TRANSLATION_NV = 2,
} VkPartitionedAccelerationStructureOpTypeNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_WRITE_INSTANCE_NV</code> is
used to assign a transformed bottom level acceleration structure to an
instance and partition.
This is similar to <a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a> that defines
the properties and transformations for a single instance in
non-partitioned TLAS.
Any partition that contains at least one of the affected instances will
have their internal acceleration structure rebuilt.</p>
</li>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_UPDATE_INSTANCE_NV</code>
indicates that an instance will be updated with a new bottom level
acceleration structure.</p>
</li>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_WRITE_PARTITION_TRANSLATION_NV</code>
indicates that a partition will be assigned a
<a href="#ptlas-partition-translation">translation vector</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkPartitionedAccelerationStructureWriteInstanceDataNV">VkPartitionedAccelerationStructureWriteInstanceDataNV</a> structure is
defined as:</p>
</div>
<div id="VkPartitionedAccelerationStructureWriteInstanceDataNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_partitioned_acceleration_structure
typedef struct VkPartitionedAccelerationStructureWriteInstanceDataNV {
    VkTransformMatrixKHR                                 transform;
    float                                                explicitAABB[6];
    uint32_t                                             instanceID;
    uint32_t                                             instanceMask;
    uint32_t                                             instanceContributionToHitGroupIndex;
    VkPartitionedAccelerationStructureInstanceFlagsNV    instanceFlags;
    uint32_t                                             instanceIndex;
    uint32_t                                             partitionIndex;
    VkDeviceAddress                                      accelerationStructure;
} VkPartitionedAccelerationStructureWriteInstanceDataNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>transform</code> is a <a href="#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure describing the
transformation to be applied to the instance in PTLAS.</p>
</li>
<li>
<p><code>explicitAABB</code> specifies an axis aligned bounding box representing
the maximum extent of any vertex within the used acceleration structure
after applying the instance-to-world transformation.
The <a href="#ptlas-partition-translation">partition translation</a> is not
applied to the bounding box.</p>
</li>
<li>
<p><code>instanceID</code> is a user specified constant assigned to an instance in
the PTLAS.</p>
</li>
<li>
<p><code>instanceMask</code> is a 8-bit mask assigned to the instance that <strong>may</strong> be
used to include or reject group of instances.</p>
</li>
<li>
<p><code>instanceContributionToHitGroupIndex</code> is a 24-bit per application
specified instance value added in the indexing into the shader binding
table to fetch the hit group to use.</p>
</li>
<li>
<p><code>instanceFlags</code> is a bitmask of
<a href="#VkPartitionedAccelerationStructureInstanceFlagsNV">VkPartitionedAccelerationStructureInstanceFlagsNV</a> specifying flags
an instance in the PTLAS.</p>
</li>
<li>
<p><code>instanceIndex</code> is the index of the instance within the PTLAS.</p>
</li>
<li>
<p><code>partitionIndex</code> is the index of the partition to which this
instance belongs.
<a href="#ptlas-global-partition">Global partitions</a> are referred to by
<code>VK_PARTITIONED_ACCELERATION_STRUCTURE_PARTITION_INDEX_GLOBAL_NV</code>.</p>
</li>
<li>
<p><code>accelerationStructure</code> is the device address of the bottom level
acceleration structure or a clustered bottom level acceleration
structure that is being instanced.
This instance is disabled if the device address is <code>0</code>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceMask-10566" href="#VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceMask-10566"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceMask-10566</span><br>

The most significant 24 bits of <code>instanceMask</code> <strong>must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceContributionToHitGroupIndex-10567" href="#VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceContributionToHitGroupIndex-10567"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceContributionToHitGroupIndex-10567</span><br>

The most significant 8 bits of <code>instanceContributionToHitGroupIndex</code>
<strong>must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceIndex-10568" href="#VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceIndex-10568"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceIndex-10568</span><br>

<code>instanceIndex</code> <strong>must</strong> be less than
<a href="#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>input</code>::<code>instanceCount</code></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-partitionIndex-10569" href="#VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-partitionIndex-10569"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-partitionIndex-10569</span><br>

<code>partitionIndex</code> <strong>must</strong> be less than
<a href="#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>input</code>::<code>partitionCount</code></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-explicitAABB-10570" href="#VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-explicitAABB-10570"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-explicitAABB-10570</span><br>

<code>explicitAABB</code> <strong>must</strong> be a valid bounding box if instance was created
with flag
<code>VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_ENABLE_EXPLICIT_BOUNDING_BOX_NV</code>
set</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceFlags-parameter" href="#VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceFlags-parameter"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceFlags-parameter</span><br>
 <code>instanceFlags</code> <strong>must</strong> be a valid combination of <a href="#VkPartitionedAccelerationStructureInstanceFlagBitsNV">VkPartitionedAccelerationStructureInstanceFlagBitsNV</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkPartitionedAccelerationStructureUpdateInstanceDataNV">VkPartitionedAccelerationStructureUpdateInstanceDataNV</a> structure
is defined as:</p>
</div>
<div id="VkPartitionedAccelerationStructureUpdateInstanceDataNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_partitioned_acceleration_structure
typedef struct VkPartitionedAccelerationStructureUpdateInstanceDataNV {
    uint32_t           instanceIndex;
    uint32_t           instanceContributionToHitGroupIndex;
    VkDeviceAddress    accelerationStructure;
} VkPartitionedAccelerationStructureUpdateInstanceDataNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceIndex</code> is the index of the instance being updated.</p>
</li>
<li>
<p><code>instanceContributionToHitGroupIndex</code> is a 24-bit per instance value
added in the indexing into the shader binding table to fetch the hit
group to use.</p>
</li>
<li>
<p><code>accelerationStructure</code> is the device address of the bottom level
acceleration structure or a clustered bottom level acceleration
structure whose instance is being updated.
The instance is disabled if the device address is <code>0</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the instance was originally disabled by specifying a <code>0</code> in
<a href="#VkPartitionedAccelerationStructureWriteInstanceDataNV">VkPartitionedAccelerationStructureWriteInstanceDataNV</a>::<code>accelerationStructure</code>,
it can not be updated to a new acceleration structure as the instance <strong>may</strong>
have been permanently disabled by the implementation.</p>
</div>
<div class="paragraph">
<p>To avoid a refit, the new acceleration structure <strong>must</strong> be within the
bounding box specified by
<a href="#VkPartitionedAccelerationStructureWriteInstanceDataNV">VkPartitionedAccelerationStructureWriteInstanceDataNV</a>::<code>explicitAABB</code>
when the instance was first created.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-instanceContributionToHitGroupIndex-10571" href="#VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-instanceContributionToHitGroupIndex-10571"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-instanceContributionToHitGroupIndex-10571</span><br>

The most significant 8 bits of <code>instanceContributionToHitGroupIndex</code>
<strong>must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-None-10572" href="#VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-None-10572"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-None-10572</span><br>

The instance <strong>must</strong> have either been created with flag
<code>VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_ENABLE_EXPLICIT_BOUNDING_BOX_NV</code>
or did not have an acceleration structure assigned with
<a href="#VkPartitionedAccelerationStructureWriteInstanceDataNV">VkPartitionedAccelerationStructureWriteInstanceDataNV</a></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-instanceIndex-10573" href="#VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-instanceIndex-10573"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-instanceIndex-10573</span><br>

<code>instanceIndex</code> <strong>must</strong> be less than
<a href="#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>input</code>::<code>instanceCount</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong>can</strong> be set in
<a href="#VkPartitionedAccelerationStructureWriteInstanceDataNV">VkPartitionedAccelerationStructureWriteInstanceDataNV</a>::<code>instanceFlags</code>,
specifying flags for instances, are:</p>
</div>
<div id="VkPartitionedAccelerationStructureInstanceFlagBitsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_partitioned_acceleration_structure
typedef enum VkPartitionedAccelerationStructureInstanceFlagBitsNV {
    VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_TRIANGLE_FACING_CULL_DISABLE_BIT_NV = 0x00000001,
    VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_TRIANGLE_FLIP_FACING_BIT_NV = 0x00000002,
    VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_FORCE_OPAQUE_BIT_NV = 0x00000004,
    VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_FORCE_NO_OPAQUE_BIT_NV = 0x00000008,
    VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_ENABLE_EXPLICIT_BOUNDING_BOX_NV = 0x00000010,
} VkPartitionedAccelerationStructureInstanceFlagBitsNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_TRIANGLE_FACING_CULL_DISABLE_BIT_NV</code>
disables face culling for this instance.</p>
</li>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_TRIANGLE_FLIP_FACING_BIT_NV</code>
indicates that the <a href="raytraversal.html#ray-traversal-culling-face" class="xref page">facing determination</a>
for geometry in this instance is inverted.</p>
</li>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_FORCE_OPAQUE_BIT_NV</code>
causes this instance to act as though <code>VK_GEOMETRY_OPAQUE_BIT_KHR</code>
were specified on all geometries referenced by this instance.</p>
</li>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_FORCE_NO_OPAQUE_BIT_NV</code>
causes this instance to act as though <code>VK_GEOMETRY_OPAQUE_BIT_KHR</code>
were not specified on all geometries referenced by this instance.</p>
</li>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_ENABLE_EXPLICIT_BOUNDING_BOX_NV</code>
enables use of an explicit bounding box for this instance.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkPartitionedAccelerationStructureInstanceFlagsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_partitioned_acceleration_structure
typedef VkFlags VkPartitionedAccelerationStructureInstanceFlagsNV;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkPartitionedAccelerationStructureInstanceFlagsNV</code> is a bitmask type
for setting a mask of zero or more
<a href="#VkPartitionedAccelerationStructureInstanceFlagBitsNV">VkPartitionedAccelerationStructureInstanceFlagBitsNV</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="#VkPartitionedAccelerationStructureWritePartitionTranslationDataNV">VkPartitionedAccelerationStructureWritePartitionTranslationDataNV</a>
structure is defined as:</p>
</div>
<div id="VkPartitionedAccelerationStructureWritePartitionTranslationDataNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_partitioned_acceleration_structure
typedef struct VkPartitionedAccelerationStructureWritePartitionTranslationDataNV {
    uint32_t    partitionIndex;
    float       partitionTranslation[3];
} VkPartitionedAccelerationStructureWritePartitionTranslationDataNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>partitionIndex</code> is the index of partition to write.
<a href="#ptlas-global-partition">Global partition</a> is referred to by
<code>VK_PARTITIONED_ACCELERATION_STRUCTURE_PARTITION_INDEX_GLOBAL_NV</code>.</p>
</li>
<li>
<p><code>partitionTranslation</code> sets the <a href="#ptlas-partition-translation">    translation vector</a> for this partition.
When tracing this partition, the contained instances will behave as if
the partition translation was added to the translation component of the
instance transform.
This translation vector is also added to the instances in the partition
that had their bounding box specified.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWritePartitionTranslationDataNV-partitionIndex-10574" href="#VUID-VkPartitionedAccelerationStructureWritePartitionTranslationDataNV-partitionIndex-10574"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWritePartitionTranslationDataNV-partitionIndex-10574</span><br>

<code>partitionIndex</code> <strong>must</strong> be less than
<a href="#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>input</code>::<code>partitionCount</code></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWritePartitionTranslationDataNV-enablePartitionTranslation-10575" href="#VUID-VkPartitionedAccelerationStructureWritePartitionTranslationDataNV-enablePartitionTranslation-10575"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWritePartitionTranslationDataNV-enablePartitionTranslation-10575</span><br>

The partitioned acceleration structure <strong>must</strong> have the
<a href="#VkPartitionedAccelerationStructureFlagsNV">VkPartitionedAccelerationStructureFlagsNV</a>::<code>enablePartitionTranslation</code>
flag set</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="host-acceleration-structure"><a class="anchor" href="#host-acceleration-structure"></a>Host Acceleration Structure Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Implementations are also required to provide host implementations of the
acceleration structure operations if the
<a href="features.html#features-accelerationStructureHostCommands" class="xref page"><code>accelerationStructureHostCommands</code></a> feature is enabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#vkBuildAccelerationStructuresKHR">vkBuildAccelerationStructuresKHR</a> corresponding to
<a href="#vkCmdBuildAccelerationStructuresKHR">vkCmdBuildAccelerationStructuresKHR</a></p>
</li>
<li>
<p><a href="#vkCopyAccelerationStructureKHR">vkCopyAccelerationStructureKHR</a> corresponding to
<a href="#vkCmdCopyAccelerationStructureKHR">vkCmdCopyAccelerationStructureKHR</a></p>
</li>
<li>
<p><a href="#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a> corresponding to
<a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a></p>
</li>
<li>
<p><a href="#vkCopyMemoryToAccelerationStructureKHR">vkCopyMemoryToAccelerationStructureKHR</a> corresponding to
<a href="#vkCmdCopyMemoryToAccelerationStructureKHR">vkCmdCopyMemoryToAccelerationStructureKHR</a></p>
</li>
<li>
<p><a href="#vkWriteAccelerationStructuresPropertiesKHR">vkWriteAccelerationStructuresPropertiesKHR</a> corresponding to
<a href="#vkCmdWriteAccelerationStructuresPropertiesKHR">vkCmdWriteAccelerationStructuresPropertiesKHR</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These commands are functionally equivalent to their device counterparts,
except that they are executed on the host timeline, rather than being
enqueued into command buffers.</p>
</div>
<div class="paragraph">
<p>All acceleration structures used by the host commands <strong>must</strong> be bound to
host-visible memory, and all input data for acceleration structure builds
<strong>must</strong> be referenced using host addresses instead of device addresses.
Applications are not required to map acceleration structure memory when
using the host commands.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="#vkBuildAccelerationStructuresKHR">vkBuildAccelerationStructuresKHR</a> and
<a href="#vkCmdBuildAccelerationStructuresKHR">vkCmdBuildAccelerationStructuresKHR</a> <strong>may</strong> use different algorithms, and
thus are not required to produce identical structures.
The structures produced by these two commands <strong>may</strong> exhibit different memory
footprints or traversal performance, but should strive to be similar where
possible.</p>
</div>
<div class="paragraph">
<p>Apart from these details, the host and device operations are
interchangeable.
For example, an application <strong>can</strong> use <a href="#vkBuildAccelerationStructuresKHR">vkBuildAccelerationStructuresKHR</a>
to build a structure, compact it on the device using
<a href="#vkCmdCopyAccelerationStructureKHR">vkCmdCopyAccelerationStructureKHR</a>, and serialize the result using
<a href="#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For efficient execution, acceleration structures manipulated using these
commands should always be bound to host cached memory, as the implementation
may need to repeatedly read and write this memory during the execution of
the command.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build acceleration structures on the host, call:</p>
</div>
<div id="vkBuildAccelerationStructuresKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
VkResult vkBuildAccelerationStructuresKHR(
    VkDevice                                    device,
    VkDeferredOperationKHR                      deferredOperation,
    uint32_t                                    infoCount,
    const VkAccelerationStructureBuildGeometryInfoKHR* pInfos,
    const VkAccelerationStructureBuildRangeInfoKHR* const* ppBuildRangeInfos);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the <code>VkDevice</code> for which the acceleration structures
are being built.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> to
<a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#deferred-host-operations-requesting" class="xref page">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>infoCount</code> is the number of acceleration structures to build.
It specifies the number of the <code>pInfos</code> structures and
<code>ppBuildRangeInfos</code> pointers that <strong>must</strong> be provided.</p>
</li>
<li>
<p><code>pInfos</code> is a pointer to an array of <code>infoCount</code>
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures defining
the geometry used to build each acceleration structure.</p>
</li>
<li>
<p><code>ppBuildRangeInfos</code> is a pointer to an array of <code>infoCount</code>
pointers to arrays of <a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a>
structures.
Each <code>ppBuildRangeInfos</code>[i] is a pointer to an array of
<code>pInfos</code>[i].<code>geometryCount</code>
<a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures defining
dynamic offsets to the addresses where geometry data is stored, as
defined by <code>pInfos</code>[i].</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="#vkCmdBuildAccelerationStructuresKHR">vkCmdBuildAccelerationStructuresKHR</a> but is executed by the host.</p>
</div>
<div class="paragraph">
<p>The <code>vkBuildAccelerationStructuresKHR</code> command provides the ability to
initiate multiple acceleration structures builds, however there is no
ordering or synchronization implied between any of the individual
acceleration structure builds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This means that an application <strong>cannot</strong> build a top-level acceleration
structure in the same <a href="#vkBuildAccelerationStructuresKHR">vkBuildAccelerationStructuresKHR</a> call as the
associated bottom-level or instance acceleration structures are being built.
There also <strong>cannot</strong> be any memory aliasing between any acceleration structure
memories or scratch memories being used by any of the builds.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-accelerationStructureHostCommands-03581" href="#VUID-vkBuildAccelerationStructuresKHR-accelerationStructureHostCommands-03581"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-accelerationStructureHostCommands-03581</span><br>

The <a href="features.html#features-accelerationStructureHostCommands" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-mode-04628" href="#VUID-vkBuildAccelerationStructuresKHR-mode-04628"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-mode-04628</span><br>

The <code>mode</code> member of each element of <code>pInfos</code> <strong>must</strong> be a valid
<a href="#VkBuildAccelerationStructureModeKHR">VkBuildAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-srcAccelerationStructure-04629" href="#VUID-vkBuildAccelerationStructuresKHR-srcAccelerationStructure-04629"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-srcAccelerationStructure-04629</span><br>

If the <code>srcAccelerationStructure</code> member of any element of
<code>pInfos</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the
<code>srcAccelerationStructure</code> member <strong>must</strong> be a valid
<a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-04630" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-04630"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-04630</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong>must</strong> not be <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03403" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03403"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03403</span><br>

The <code>srcAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03698" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03698"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03698</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03800" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03800"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03800</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03699" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03699"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03699</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong>must</strong> have been created with a
value of <a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03700" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03700"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03700</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong>must</strong> have been created with a
value of <a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03663" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03663"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03663</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>,
<a href="#acceleration-structure-inactive-prims">inactive primitives</a> in its
<code>srcAccelerationStructure</code> member <strong>must</strong> not be made active</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03664" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03664"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03664</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, active primitives
in its <code>srcAccelerationStructure</code> member <strong>must</strong> not be made
<a href="#acceleration-structure-inactive-prims">inactive</a></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-None-03407" href="#VUID-vkBuildAccelerationStructuresKHR-None-03407"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-None-03407</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be referenced by the <code>geometry.instances.data</code> member of
any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other
element of <code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03701" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03701"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03701</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>srcAccelerationStructure</code> member of
any other element of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, which is accessed
by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03702" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03702"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03702</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>dstAccelerationStructure</code> member of
any other element of <code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03703" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03703"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03703</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> (including the same element), which is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-scratchData-03704" href="#VUID-vkBuildAccelerationStructuresKHR-scratchData-03704"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-scratchData-03704</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>scratchData</code> member of any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-scratchData-03705" href="#VUID-vkBuildAccelerationStructuresKHR-scratchData-03705"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-scratchData-03705</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>srcAccelerationStructure</code> member of any element
of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> (including the
same element), which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03706" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03706"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03706</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing any acceleration structure referenced by the
<code>geometry.instances.data</code> member of any element of <code>pGeometries</code>
or <code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03667" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03667"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03667</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong>must</strong> have previously been
constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_KHR</code> set in
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code> in the
build</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03668" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03668"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03668</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> and <code>dstAccelerationStructure</code>
members <strong>must</strong> either be the same <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a>, or
not have any <a href="resources.html#resources-memory-aliasing" class="xref page">memory aliasing</a></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03758" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03758"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03758</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>geometryCount</code> member <strong>must</strong> have the same value which was specified
when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03759" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03759"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03759</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>flags</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03760" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03760"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03760</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>type</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03761" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03761"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03761</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>geometryType</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03762" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03762"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03762</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>flags</code> member
<strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03763" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03763"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03763</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.vertexFormat</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03764" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03764"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03764</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.maxVertex</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03765" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03765"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03765</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.indexType</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03766" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03766"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03766</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03767" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03767"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03767</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was not <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong>must</strong> not be
<code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03768" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03768"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03768</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
then the value of each index referenced <strong>must</strong> be the same as the
corresponding index value when <code>srcAccelerationStructure</code> was last
built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-primitiveCount-03769" href="#VUID-vkBuildAccelerationStructuresKHR-primitiveCount-03769"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-primitiveCount-03769</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, the
<code>primitiveCount</code> member of its corresponding
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structure <strong>must</strong> have the
same value which was specified when <code>srcAccelerationStructure</code> was
last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03801" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03801"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03801</span><br>

For each element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the corresponding
<code>ppBuildRangeInfos</code>[i][j].<code>primitiveCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxInstanceCount</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-10126" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-10126"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-10126</span><br>

For each <code>pInfos</code>[i], <code>dstAccelerationStructure</code> <strong>must</strong> have been
created with a value of
<a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>size</code> greater than or
equal to either:</p>
<div class="ulist">
<ul>
<li>
<p>the memory size required by the build operation, as returned by
<a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with
<span class="eq"><code>pBuildInfo</code> = <code>pInfos</code>[i]</span> and with each element of the
<code>pMaxPrimitiveCounts</code> array greater than or equal to the equivalent
<code>ppBuildRangeInfos</code>[i][j].<code>primitiveCount</code> values for <code>j</code> in
<span class="eq">[0,<code>pInfos</code>[i].<code>geometryCount</code>)</span> or,</p>
</li>
<li>
<p>the result of querying the corresponding
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, if
updating a compacted acceleration structure</p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676" href="#VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676</span><br>

Each element of <code>ppBuildRangeInfos</code>[i] <strong>must</strong> be a valid pointer to
an array of <code>pInfos</code>[i].<code>geometryCount</code>
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structures</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03678" href="#VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03722" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03722"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03722</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstAccelerationStructure</code> member <strong>must</strong> be bound to host-visible
device memory</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03723" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03723"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03723</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> the <code>buffer</code>
used to create its <code>srcAccelerationStructure</code> member <strong>must</strong> be bound
to host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03724" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03724"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03724</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create each
acceleration structure referenced by the <code>geometry.instances.data</code>
member of any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> <strong>must</strong> be
bound to host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03725" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03725"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03725</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.hostAddress</code> and
<code>pInfos</code>[i].<code>scratchData.hostAddress</code> + N - 1 <strong>must</strong> be valid
host memory, where N is given by the <code>buildScratchSize</code> member of
the <a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned
from a call to <a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with an
identical <a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure
and primitive count</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03726" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03726"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03726</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.hostAddress</code> and
<code>pInfos</code>[i].<code>scratchData.hostAddress</code> + N - 1 <strong>must</strong> be valid
host memory, where N is given by the <code>updateScratchSize</code> member of
the <a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned
from a call to <a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with an
identical <a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure
and primitive count</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03771" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03771"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03771</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.hostAddress</code> <strong>must</strong> be a valid host
address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03772" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03772"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03772</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.hostAddress</code> <strong>must</strong> be a valid host
address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03773" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03773"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03773</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.hostAddress</code> is not <code>0</code>, it <strong>must</strong>
be a valid host address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03774" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03774"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03774</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, <code>geometry.aabbs.data.hostAddress</code>
<strong>must</strong> be a valid host address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03775" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03775"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03775</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstAccelerationStructure</code> member <strong>must</strong> be bound to memory that was
not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03776" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03776"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03776</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> the <code>buffer</code>
used to create its <code>srcAccelerationStructure</code> member <strong>must</strong> be bound
to memory that was not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03777" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03777"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03777</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create each
acceleration structure referenced by the <code>geometry.instances.data</code>
member of any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> <strong>must</strong> be
bound to memory that was not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03778" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03778"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03778</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>,
<code>geometry.instances.data.hostAddress</code> <strong>must</strong> be a valid host address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03779" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03779"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03779</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, each
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>accelerationStructureReference</code>
value in <code>geometry.instances.data.hostAddress</code> <strong>must</strong> be a valid
<a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> object</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-04930" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-04930"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-04930</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> with
<code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> set, each
<code>accelerationStructureReference</code> in any structure in
<a href="#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a> value in
<code>geometry.instances.data.hostAddress</code> <strong>must</strong> be a valid
<a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> object</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-device-parameter" href="#VUID-vkBuildAccelerationStructuresKHR-device-parameter"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parameter" href="#VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parameter"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parameter</span><br>
 If <code>deferredOperation</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>deferredOperation</code> <strong>must</strong> be a valid <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-parameter" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-parameter"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-parameter</span><br>
 <code>pInfos</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> valid <a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter" href="#VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter</span><br>
 <code>ppBuildRangeInfos</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> <a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-infoCount-arraylength" href="#VUID-vkBuildAccelerationStructuresKHR-infoCount-arraylength"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-infoCount-arraylength</span><br>
 <code>infoCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parent" href="#VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parent"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parent</span><br>
 If <code>deferredOperation</code> is a valid handle, it <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
<li>
<p><code>VK_OPERATION_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_OPERATION_NOT_DEFERRED_KHR</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy or compact an acceleration structure on the host, call:</p>
</div>
<div id="vkCopyAccelerationStructureKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
VkResult vkCopyAccelerationStructureKHR(
    VkDevice                                    device,
    VkDeferredOperationKHR                      deferredOperation,
    const VkCopyAccelerationStructureInfoKHR*   pInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns the acceleration structures.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> to
<a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#deferred-host-operations-requesting" class="xref page">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <a href="#VkCopyAccelerationStructureInfoKHR">VkCopyAccelerationStructureInfoKHR</a>
structure defining the copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="#vkCmdCopyAccelerationStructureKHR">vkCmdCopyAccelerationStructureKHR</a> but is executed by the host.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-accelerationStructureHostCommands-03582" href="#VUID-vkCopyAccelerationStructureKHR-accelerationStructureHostCommands-03582"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-accelerationStructureHostCommands-03582</span><br>

The <a href="features.html#features-accelerationStructureHostCommands" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-deferredOperation-03678" href="#VUID-vkCopyAccelerationStructureKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03727" href="#VUID-vkCopyAccelerationStructureKHR-buffer-03727"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03727</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03728" href="#VUID-vkCopyAccelerationStructureKHR-buffer-03728"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03728</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03780" href="#VUID-vkCopyAccelerationStructureKHR-buffer-03780"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03780</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03781" href="#VUID-vkCopyAccelerationStructureKHR-buffer-03781"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03781</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-device-parameter" href="#VUID-vkCopyAccelerationStructureKHR-device-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-deferredOperation-parameter" href="#VUID-vkCopyAccelerationStructureKHR-deferredOperation-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-deferredOperation-parameter</span><br>
 If <code>deferredOperation</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>deferredOperation</code> <strong>must</strong> be a valid <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-pInfo-parameter" href="#VUID-vkCopyAccelerationStructureKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkCopyAccelerationStructureInfoKHR">VkCopyAccelerationStructureInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-deferredOperation-parent" href="#VUID-vkCopyAccelerationStructureKHR-deferredOperation-parent"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-deferredOperation-parent</span><br>
 If <code>deferredOperation</code> is a valid handle, it <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
<li>
<p><code>VK_OPERATION_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_OPERATION_NOT_DEFERRED_KHR</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy host accessible memory to an acceleration structure, call:</p>
</div>
<div id="vkCopyMemoryToAccelerationStructureKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
VkResult vkCopyMemoryToAccelerationStructureKHR(
    VkDevice                                    device,
    VkDeferredOperationKHR                      deferredOperation,
    const VkCopyMemoryToAccelerationStructureInfoKHR* pInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns <code>pInfo-&gt;dst</code>.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> to
<a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#deferred-host-operations-requesting" class="xref page">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="#VkCopyMemoryToAccelerationStructureInfoKHR">VkCopyMemoryToAccelerationStructureInfoKHR</a> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="#vkCmdCopyMemoryToAccelerationStructureKHR">vkCmdCopyMemoryToAccelerationStructureKHR</a> but is executed by the host.</p>
</div>
<div class="paragraph">
<p>This command can accept acceleration structures produced by either
<a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a> or
<a href="#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-accelerationStructureHostCommands-03583" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-accelerationStructureHostCommands-03583"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-accelerationStructureHostCommands-03583</span><br>

The <a href="features.html#features-accelerationStructureHostCommands" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03678" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03729" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03729"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03729</span><br>

<code>pInfo-&gt;src.hostAddress</code> <strong>must</strong> be a valid host pointer</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03750" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03750"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03750</span><br>

<code>pInfo-&gt;src.hostAddress</code> <strong>must</strong> be aligned to 16 bytes</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03730" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03730"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03730</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03782" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03782"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03782</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-device-parameter" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-device-parameter"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parameter" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parameter"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parameter</span><br>
 If <code>deferredOperation</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>deferredOperation</code> <strong>must</strong> be a valid <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-parameter" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkCopyMemoryToAccelerationStructureInfoKHR">VkCopyMemoryToAccelerationStructureInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parent" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parent"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parent</span><br>
 If <code>deferredOperation</code> is a valid handle, it <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
<li>
<p><code>VK_OPERATION_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_OPERATION_NOT_DEFERRED_KHR</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy an acceleration structure to host accessible memory, call:</p>
</div>
<div id="vkCopyAccelerationStructureToMemoryKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
VkResult vkCopyAccelerationStructureToMemoryKHR(
    VkDevice                                    device,
    VkDeferredOperationKHR                      deferredOperation,
    const VkCopyAccelerationStructureToMemoryInfoKHR* pInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns <code>pInfo-&gt;src</code>.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> to
<a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#deferred-host-operations-requesting" class="xref page">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="#VkCopyAccelerationStructureToMemoryInfoKHR">VkCopyAccelerationStructureToMemoryInfoKHR</a> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a> but is executed by the host.</p>
</div>
<div class="paragraph">
<p>This command produces the same results as
<a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a>, but writes its result
directly to a host pointer, and is executed on the host rather than the
device.
The output <strong>may</strong> not necessarily be bit-for-bit identical, but it can be
equally used by either <a href="#vkCmdCopyMemoryToAccelerationStructureKHR">vkCmdCopyMemoryToAccelerationStructureKHR</a> or
<a href="#vkCopyMemoryToAccelerationStructureKHR">vkCopyMemoryToAccelerationStructureKHR</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-accelerationStructureHostCommands-03584" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-accelerationStructureHostCommands-03584"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-accelerationStructureHostCommands-03584</span><br>

The <a href="features.html#features-accelerationStructureHostCommands" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03678" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03731" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03731"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03731</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03732" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03732"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03732</span><br>

<code>pInfo-&gt;dst.hostAddress</code> <strong>must</strong> be a valid host pointer</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03751" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03751"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03751</span><br>

<code>pInfo-&gt;dst.hostAddress</code> <strong>must</strong> be aligned to 16 bytes</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03783" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03783"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03783</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-device-parameter" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-device-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parameter" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parameter</span><br>
 If <code>deferredOperation</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>deferredOperation</code> <strong>must</strong> be a valid <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-parameter" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkCopyAccelerationStructureToMemoryInfoKHR">VkCopyAccelerationStructureToMemoryInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parent" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parent"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parent</span><br>
 If <code>deferredOperation</code> is a valid handle, it <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
<li>
<p><code>VK_OPERATION_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_OPERATION_NOT_DEFERRED_KHR</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query acceleration structure size parameters on the host, call:</p>
</div>
<div id="vkWriteAccelerationStructuresPropertiesKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
VkResult vkWriteAccelerationStructuresPropertiesKHR(
    VkDevice                                    device,
    uint32_t                                    accelerationStructureCount,
    const VkAccelerationStructureKHR*           pAccelerationStructures,
    VkQueryType                                 queryType,
    size_t                                      dataSize,
    void*                                       pData,
    size_t                                      stride);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns the acceleration structures in
<code>pAccelerationStructures</code>.</p>
</li>
<li>
<p><code>accelerationStructureCount</code> is the count of acceleration structures
for which to query the property.</p>
</li>
<li>
<p><code>pAccelerationStructures</code> is a pointer to an array of existing
previously built acceleration structures.</p>
</li>
<li>
<p><code>queryType</code> is a <a href="queries.html#VkQueryType" class="xref page">VkQueryType</a> value specifying the property to
be queried.</p>
</li>
<li>
<p><code>dataSize</code> is the size in bytes of the buffer pointed to by
<code>pData</code>.</p>
</li>
<li>
<p><code>pData</code> is a pointer to an application-allocated buffer where the
results will be written.</p>
</li>
<li>
<p><code>stride</code> is the stride in bytes between results for individual
queries within <code>pData</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="#vkCmdWriteAccelerationStructuresPropertiesKHR">vkCmdWriteAccelerationStructuresPropertiesKHR</a> but is executed by the
host.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureHostCommands-03585" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureHostCommands-03585"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureHostCommands-03585</span><br>

The <a href="features.html#features-accelerationStructureHostCommands" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> if
<code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06742" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06742"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06742</span><br>

<code>queryType</code> <strong>must</strong> be
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SIZE_KHR</code>,
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>,
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, or
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03448" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03448"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03448</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, then
<code>stride</code> <strong>must</strong> be a multiple of the size of <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03449" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03449"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03449</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, then
<code>pData</code> <strong>must</strong> point to a <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03450" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03450"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03450</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code>, then
<code>stride</code> <strong>must</strong> be a multiple of the size of <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03451" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03451"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03451</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code>, then
<code>pData</code> <strong>must</strong> point to a <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06731" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06731"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06731</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SIZE_KHR</code>, then <code>stride</code>
<strong>must</strong> be a multiple of the size of <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06732" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06732"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06732</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SIZE_KHR</code>, then <code>pData</code>
<strong>must</strong> point to a <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06733" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06733"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06733</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>,
then <code>stride</code> <strong>must</strong> be a multiple of the size of
<code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06734" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06734"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06734</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>,
then <code>pData</code> <strong>must</strong> point to a <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-03452" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-03452"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-03452</span><br>

<code>dataSize</code> <strong>must</strong> be greater than or equal to
<span class="eq"><code>accelerationStructureCount</code>*<code>stride</code></span></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03733" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03733"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03733</span><br>

The <code>buffer</code> used to create each acceleration structure in
<code>pAccelerationStructures</code> <strong>must</strong> be bound to host-visible device
memory</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03784" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03784"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03784</span><br>

The <code>buffer</code> used to create each acceleration structure in
<code>pAccelerationStructures</code> <strong>must</strong> be bound to memory that was not
allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-device-parameter" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-device-parameter"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter</span><br>
 <code>pAccelerationStructures</code> <strong>must</strong> be a valid pointer to an array of <code>accelerationStructureCount</code> valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handles</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-parameter" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-parameter"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-parameter</span><br>
 <code>queryType</code> <strong>must</strong> be a valid <a href="queries.html#VkQueryType" class="xref page">VkQueryType</a> value</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-pData-parameter" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-pData-parameter"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-pData-parameter</span><br>
 <code>pData</code> <strong>must</strong> be a valid pointer to an array of <code>dataSize</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength</span><br>
 <code>accelerationStructureCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-arraylength" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-arraylength"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-arraylength</span><br>
 <code>dataSize</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parent" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parent"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parent</span><br>
 Each element of <code>pAccelerationStructures</code> <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="https://cdn.jsdelivr.net/pako/1.0.3/pako.min.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
