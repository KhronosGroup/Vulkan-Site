<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Acceleration Structures :: Vulkan Documentation Project Demo</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../.."><img class="navbar-item" alt="Vulkan White Label" src="../../../_/Vulkan_White_Dec16.svg" /></a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label for="search-input"></label><input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../spec/latest/chapters/introduction.html">Vulkan 1.3</a>
            <a class="navbar-item" href="https://registry.khronos.org/OpenGL/specs/gl/GLSLangSpec.4.60.html">GLSL</a>
            <a class="navbar-item" href="/guide/latest/hlsl.html">HLSL</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Education</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../guide/latest/index.html">Vulkan Guide</a>
            <a class="navbar-item" href="../../../tutorial/latest/index.html">Vulkan Tutorial</a>
            <a class="navbar-item" href="../../../samples/latest/README.html">Vulkan Samples</a>
            <a class="navbar-item" href="https://www.youtube.com/c/vulkan">YouTube</a>
            <a class="navbar-item" href="https://vulkan.org">More Info at Vulkan.org</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://reddit.com/r/vulkan">Reddit</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/vulkan">Stack Overflow</a>
            <a class="navbar-item" href="https://twitter.com/vulkanapi">X</a>
            <a class="navbar-item" href="https://fosstodon.org/@vulkan">Mastodon</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="spec" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Vulkan Specification and Proposals</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fundamentals.html">Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="initialization.html">Initialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="devsandqueues.html">Devices and Queues</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cmdbuffers.html">Command Buffers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="synchronization.html">Synchronization and Cache Control</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="renderpass.html">Render Pass</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="shaders.html">Shaders</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pipelines.html">Pipelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="memory.html">Memory Allocation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="resources.html">Resource Creation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="samplers.html">Samplers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="descriptorsets.html">Resource Descriptors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="interfaces.html">Shader Interfaces</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="textures.html">Image Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fragmentdensitymapops.html">Fragment Density Map Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="queries.html">Queries</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="clears.html">Clear Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="copies.html">Copy Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="drawing.html">Drawing Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fxvertex.html">Fixed-Function Vertex Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tessellation.html">Tessellation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="geometry.html">Geometry Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_mesh_shader/mesh.html">Mesh Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_HUAWEI_cluster_culling_shader/clusterculling.html">Cluster Culling Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="vertexpostproc.html">Fixed-Function Vertex Post-Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="primsrast.html">Rasterization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fragops.html">Fragment Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="framebuffer.html">The Framebuffer</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="dispatch.html">Dispatching Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_device_generated_commands/generatedcommands.html">Device-Generated Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="sparsemem.html">Sparse Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_KHR_surface/wsi.html">Window System Integration (WSI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_KHR_deferred_host_operations/deferred_host_operations.html">Deferred Host Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_EXT_private_data.html">Private Data</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="accelstructures.html">Acceleration Structures</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_EXT_opacity_micromap/micromaps.html">Micromap</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="raytraversal.html">Ray Traversal</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="raytracing.html">Ray Tracing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_memory_decompression.html">Memory Decompression</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="video_extensions.html">Video Coding</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_optical_flow/optical_flow.html">Optical Flow</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extensions.html">Extending Vulkan</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="limits.html">Limits</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="formats.html">Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="capabilities.html">Additional Capabilities</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="debugging.html">Debugging</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/spirvenv.html">Vulkan Environment for SPIR-V</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/memorymodel.html">Memory Model</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/compressedtex.html">Compressed Image Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/versions.html">Core Revisions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/extensions.html">Layers &amp; Extensions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/roadmap.html">Vulkan Roadmap Milestones</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/boilerplate.html">API Boilerplate</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/invariance.html">Invariance</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/glossary.html">Lexicon</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/credits.html">Credits (Informative)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../proposals/index.html">Vulkan Proposals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Vulkan Roadmap</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/Roadmap.html">Vulkan Roadmap</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extension Proposals</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_AMD_shader_early_and_late_fragment_tests.html">VK_AMD_shader_early_and_late_fragment_tests</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_attachment_feedback_loop_layout.html">VK_EXT_attachment_feedback_loop_layout</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_graphics_pipeline_library.html">VK_EXT_graphics_pipeline_library</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_image_2d_array_of_3d.html">VK_EXT_image_2d_array_of_3d</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_image_compression_control.html">VK_EXT_image_compression_control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_metal_objects.html">VK_EXT_metal_objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_multisampled_render_to_single_sampled.html">VK_EXT_multisampled_render_to_single_sampled</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_non_seamless_cube_map.html">VK_EXT_non_seamless_cube_map</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_primitives_generated_query.html">VK_EXT_primitives_generated_query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_rasterization_order_attachment_access.html">VK_EXT_rasterization_order_attachment_access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_shader_module_identifier.html">VK_EXT_shader_module_identifier</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_EXT_subpass_merge_feedback.html">VK_EXT_subpass_merge_feedback</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_GOOGLE_surfaceless_query.html">VK_GOOGLE_surfaceless_query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_HUAWEI_invocation_mask.html">VK_HUAWEI_invocation_mask</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_KHR_dynamic_rendering.html">VK_KHR_dynamic_rendering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_KHR_fragment_shader_barycentric.html">VK_KHR_fragment_shader_barycentric</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_KHR_fragment_shading_rate.html">VK_KHR_fragment_shading_rate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_KHR_shader_integer_dot_product.html">VK_KHR_shader_integer_dot_product</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_QCOM_image_processing.html">VK_QCOM_image_processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/VK_QCOM_tile_properties.html">VK_QCOM_tile_properties</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extension Proposal Template</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../proposals/proposals/template.html">Proposal Template</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Vulkan Specification and Proposals</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../tutorial/latest/00_Introduction.html">Khronos Vulkan Tutorial</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tutorial/latest/00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../guide/latest/index.html">Vulkan Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../samples/latest/README.html">Vulkan Samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/latest/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Vulkan Specification and Proposals</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Vulkan Specification and Proposals</a></li>
    <li><a href="accelstructures.html">Acceleration Structures</a></li>
  </ul>
</nav>
    <!--
  <div class="edit-this-page"><a href="https://github.com/KhronosGroup/Vulkan-Docs/edit/main/antora/modules/ROOT/pages/chapters/accelstructures.adoc">Edit this Page</a></div>
      -->
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Acceleration Structures</h1>
<div class="sect1">
<h2 id="acceleration-structure-def"><a class="anchor" href="#acceleration-structure-def"></a>Acceleration Structures</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Acceleration structures</em> are data structures used by the implementation to
efficiently manage scene geometry as it is <a href="raytraversal.html#ray-traversal" class="xref page">traversed duringa ray tracing query</a>.
The application is responsible for managing acceleration structure objects
(see <a href="resources.html#resources-acceleration-structures" class="xref page">Acceleration Structures</a>),
including allocation, destruction, executing builds or updates, and
synchronizing resources used during ray tracing queries.</p>
</div>
<div class="paragraph">
<p>There are two types of acceleration structures, <em>top level acceleration
structures</em> and <em>bottom level acceleration structures</em>.</p>
</div>
<div class="paragraph">
<p>An acceleration structure is considered to be constructed if an
<a href="#acceleration-structure-building">acceleration structure build command</a> or
<a href="#acceleration-structure-copying">copy command</a> has been executed with the
given acceleration structure as the destination.</p>
</div>
<div id="fig-accelstruct" class="imageblock text-center">
<div class="content">
<img src="../_images/accelstruct.svg" alt="accelstruct">
</div>
<div class="title">Figure 1. Acceleration Structure</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Caption</div>
<div class="paragraph">
<p>The diagram shows the relationship between top and bottom level acceleration
structures.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-geometry"><a class="anchor" href="#acceleration-structure-geometry"></a>Geometry</h3>
<div class="paragraph">
<p><em>Geometries</em> refer to a triangle or axis-aligned bounding box.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-top-level"><a class="anchor" href="#acceleration-structure-top-level"></a>Top Level Acceleration Structures</h3>
<div class="paragraph">
<p>Opaque acceleration structure for an array of instances.
The descriptor or device address referencing this is the starting point for
traversal.</p>
</div>
<div class="paragraph">
<p>The top level acceleration structure takes a reference to any bottom level
acceleration structure referenced by its instances.
Those bottom level acceleration structure objects <strong>must</strong> be valid when the
top level acceleration structure is accessed.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-bottom-level"><a class="anchor" href="#acceleration-structure-bottom-level"></a>Bottom Level Acceleration Structures</h3>
<div class="paragraph">
<p>Opaque acceleration structure for an array of geometries.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-update"><a class="anchor" href="#acceleration-structure-update"></a>Acceleration Structure Update Rules</h3>
<div class="paragraph">
<p>The API defines two types of operations to produce acceleration structures
from geometry:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>build</em> operation is used to construct an acceleration structure.</p>
</li>
<li>
<p>An <em>update</em> operation is used to modify an existing acceleration
structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An update operation imposes certain constraints on the input, in exchange
for considerably faster execution.
When performing an update, the application is required to provide a full
description of the acceleration structure, but is prohibited from changing
anything other than instance definitions, transform matrices, and vertex or
AABB positions.
All other aspects of the description <strong>must</strong> exactly match the one from the
original build.</p>
</div>
<div class="paragraph">
<p>More precisely, the application <strong>must</strong> not use an update operation to do any
of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change primitives or instances from <em>active</em> to <em>inactive</em>, or vice
versa (as defined in <a href="#acceleration-structure-inactive-prims">Inactive Primitives and Instances</a>).</p>
</li>
<li>
<p>Change the index or vertex formats of triangle geometry.</p>
</li>
<li>
<p>Change triangle geometry transform pointers from null to non-null or
vice versa.</p>
</li>
<li>
<p>Change the number of geometries or instances in the structure.</p>
</li>
<li>
<p>Change the geometry flags for any geometry in the structure.</p>
</li>
<li>
<p>Change the number of vertices or primitives for any geometry in the
structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using opacity micromaps and
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_DATA_UPDATE_EXT</code>
was set in <code>flags</code>, the application <strong>must</strong> provide the corresponding
micromap information to the update operation.
The application is prohibited from changing anything other than the specific
opacity values assigned to the triangles.</p>
</div>
<div class="paragraph">
<p>More precisely, the application <strong>must</strong> not use an update operation to do any
of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove micromaps or <a href="#VkOpacityMicromapSpecialIndexEXT">VkOpacityMicromapSpecialIndexEXT</a> values from a
geometry which previously had them, or vice versa.</p>
</li>
<li>
<p>Change between use of <a href="#VkOpacityMicromapSpecialIndexEXT">VkOpacityMicromapSpecialIndexEXT</a> values and
explicit micro-map triangles.</p>
</li>
<li>
<p>Change the subdivision level or format of the micromap triangle associated
with any acceleration-structure triangle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using opacity micromaps and
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_UPDATE_EXT</code> was
set in <code>flags</code>, the application <strong>must</strong> provide a micromap to the update
operation.</p>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using opacity micromaps and
neither opacity micromap update flag is set the application <strong>must</strong> provide
the original micromap to the update operation.</p>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using displacement
micromaps and
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_DISPLACEMENT_MICROMAP_UPDATE_NV</code>
was set in <code>flags</code>, the application <strong>must</strong> provide a displacement
micromap to the update operation.</p>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using displacement
micromaps and the displacement micromap update flag is not set the
application <strong>must</strong> provide the original micromap to the update operation.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-inactive-prims"><a class="anchor" href="#acceleration-structure-inactive-prims"></a>Inactive Primitives and Instances</h3>
<div class="paragraph">
<p>Acceleration structures allow the use of particular input values to signal
<em>inactive</em> primitives or instances.</p>
</div>
<div class="paragraph">
<p>An <em>inactive</em> triangle is one for which the first (X) component of any
vertex is NaN.
If any other vertex component is NaN, and the first is not, the behavior is
<strong>undefined</strong>.
If the vertex format does not have a NaN representation, then all triangles
are considered active.</p>
</div>
<div class="paragraph">
<p>An <em>inactive</em> instance is one whose acceleration structure reference is <code>0</code>.</p>
</div>
<div class="paragraph">
<p>An <em>inactive</em> AABB is one for which the minimum X coordinate is NaN.
If any other component is NaN, and the first is not, the behavior is
<strong>undefined</strong>.</p>
</div>
<div class="paragraph">
<p>In the above definitions, &#8220;NaN&#8221; refers to any type of NaN.
Signaling, non-signaling, quiet, loud, or otherwise.</p>
</div>
<div class="paragraph">
<p>An inactive object is considered invisible to all rays, and <strong>should</strong> not be
represented in the acceleration structure.
Implementations <strong>should</strong> ensure that the presence of inactive objects does
not seriously degrade traversal performance.</p>
</div>
<div class="paragraph">
<p>Inactive objects are counted in the auto-generated index sequences which are
provided to shaders via <code>InstanceId</code> and <code>PrimitiveId</code> SPIR-V
decorations.
This allows objects in the scene to change freely between the active and
inactive states, without affecting the layout of any arrays which are being
indexed using the ID values.</p>
</div>
<div class="paragraph">
<p>Any transition between the active and inactive states requires a full
acceleration structure rebuild.
Applications <strong>must</strong> not perform an acceleration structure update where an
object is active in the source acceleration structure but would be inactive
in the destination, or vice versa.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-building"><a class="anchor" href="#acceleration-structure-building"></a>Building Acceleration Structures</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build an acceleration structure call:</p>
</div>
<div id="vkCmdBuildAccelerationStructureNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
void vkCmdBuildAccelerationStructureNV(
    VkCommandBuffer                             commandBuffer,
    const VkAccelerationStructureInfoNV*        pInfo,
    VkBuffer                                    instanceData,
    VkDeviceSize                                instanceOffset,
    VkBool32                                    update,
    VkAccelerationStructureNV                   dst,
    VkAccelerationStructureNV                   src,
    VkBuffer                                    scratch,
    VkDeviceSize                                scratchOffset);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> contains the shared information for the acceleration
structure&#8217;s structure.</p>
</li>
<li>
<p><code>instanceData</code> is the buffer containing an array of
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a> structures defining
acceleration structures.
This parameter <strong>must</strong> be <code>NULL</code> for bottom level acceleration structures.</p>
</li>
<li>
<p><code>instanceOffset</code> is the offset in bytes (relative to the start of
<code>instanceData</code>) at which the instance data is located.</p>
</li>
<li>
<p><code>update</code> specifies whether to update the <code>dst</code> acceleration
structure with the data in <code>src</code>.</p>
</li>
<li>
<p><code>dst</code> is a pointer to the target acceleration structure for the
build.</p>
</li>
<li>
<p><code>src</code> is a pointer to an existing acceleration structure that is to
be used to update the <code>dst</code> acceleration structure.</p>
</li>
<li>
<p><code>scratch</code> is the <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> that will be used as scratch memory
for the build.</p>
</li>
<li>
<p><code>scratchOffset</code> is the offset in bytes relative to the start of
<code>scratch</code> that will be used as a scratch memory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>dst</code>, <code>src</code>, and <code>scratch</code> <strong>must</strong> be
<a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> or
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-geometryCount-02241" href="#VUID-vkCmdBuildAccelerationStructureNV-geometryCount-02241"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-geometryCount-02241</span><br>

<code>geometryCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceRayTracingPropertiesNV" class="xref page">VkPhysicalDeviceRayTracingPropertiesNV</a>::<code>maxGeometryCount</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-dst-02488" href="#VUID-vkCmdBuildAccelerationStructureNV-dst-02488"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-dst-02488</span><br>

<code>dst</code> <strong>must</strong> have been created with compatible
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a> where
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a>::<code>type</code> and
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a>::<code>flags</code> are identical,
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a>::<code>instanceCount</code> and
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a>::<code>geometryCount</code> for <code>dst</code>
are greater than or equal to the build size and each geometry in
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a>::<code>pGeometries</code> for <code>dst</code> has
greater than or equal to the number of vertices, indices, and AABBs</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-02489" href="#VUID-vkCmdBuildAccelerationStructureNV-update-02489"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-02489</span><br>

If <code>update</code> is <code>VK_TRUE</code>, <code>src</code> <strong>must</strong> not be
<a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-02490" href="#VUID-vkCmdBuildAccelerationStructureNV-update-02490"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-02490</span><br>

If <code>update</code> is <code>VK_TRUE</code>, <code>src</code> <strong>must</strong> have previously been
constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_NV</code> set in
<a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a>::<code>flags</code> in the original build</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-02491" href="#VUID-vkCmdBuildAccelerationStructureNV-update-02491"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-02491</span><br>

If <code>update</code> is <code>VK_FALSE</code>, the <code>size</code> member of the
<a href="resources.html#VkMemoryRequirements" class="xref page">VkMemoryRequirements</a> structure returned from a call to
<a href="resources.html#vkGetAccelerationStructureMemoryRequirementsNV" class="xref page">vkGetAccelerationStructureMemoryRequirementsNV</a> with
<a href="resources.html#VkAccelerationStructureMemoryRequirementsInfoNV" class="xref page">VkAccelerationStructureMemoryRequirementsInfoNV</a>::<code>accelerationStructure</code>
set to <code>dst</code> and
<a href="resources.html#VkAccelerationStructureMemoryRequirementsInfoNV" class="xref page">VkAccelerationStructureMemoryRequirementsInfoNV</a>::<code>type</code> set to
<code>VK_ACCELERATION_STRUCTURE_MEMORY_REQUIREMENTS_TYPE_BUILD_SCRATCH_NV</code>
<strong>must</strong> be less than or equal to the size of <code>scratch</code> minus
<code>scratchOffset</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-02492" href="#VUID-vkCmdBuildAccelerationStructureNV-update-02492"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-02492</span><br>

If <code>update</code> is <code>VK_TRUE</code>, the <code>size</code> member of the
<a href="resources.html#VkMemoryRequirements" class="xref page">VkMemoryRequirements</a> structure returned from a call to
<a href="resources.html#vkGetAccelerationStructureMemoryRequirementsNV" class="xref page">vkGetAccelerationStructureMemoryRequirementsNV</a> with
<a href="resources.html#VkAccelerationStructureMemoryRequirementsInfoNV" class="xref page">VkAccelerationStructureMemoryRequirementsInfoNV</a>::<code>accelerationStructure</code>
set to <code>dst</code> and
<a href="resources.html#VkAccelerationStructureMemoryRequirementsInfoNV" class="xref page">VkAccelerationStructureMemoryRequirementsInfoNV</a>::<code>type</code> set to
<code>VK_ACCELERATION_STRUCTURE_MEMORY_REQUIREMENTS_TYPE_UPDATE_SCRATCH_NV</code>
<strong>must</strong> be less than or equal to the size of <code>scratch</code> minus
<code>scratchOffset</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-scratch-03522" href="#VUID-vkCmdBuildAccelerationStructureNV-scratch-03522"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-scratch-03522</span><br>

<code>scratch</code> <strong>must</strong> have been created with
<code>VK_BUFFER_USAGE_RAY_TRACING_BIT_NV</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-instanceData-03523" href="#VUID-vkCmdBuildAccelerationStructureNV-instanceData-03523"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-instanceData-03523</span><br>

If <code>instanceData</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>instanceData</code>
<strong>must</strong> have been created with <code>VK_BUFFER_USAGE_RAY_TRACING_BIT_NV</code>
usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-accelerationStructureReference-03786" href="#VUID-vkCmdBuildAccelerationStructureNV-accelerationStructureReference-03786"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-accelerationStructureReference-03786</span><br>

Each
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>accelerationStructureReference</code>
value in <code>instanceData</code> <strong>must</strong> be a valid device address containing a
value obtained from <a href="resources.html#vkGetAccelerationStructureHandleNV" class="xref page">vkGetAccelerationStructureHandleNV</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-03524" href="#VUID-vkCmdBuildAccelerationStructureNV-update-03524"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-03524</span><br>

If <code>update</code> is <code>VK_TRUE</code>, then objects that were previously
active <strong>must</strong> not be made inactive as per
<a href="#acceleration-structure-inactive-prims">Inactive Primitives and Instances</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-03525" href="#VUID-vkCmdBuildAccelerationStructureNV-update-03525"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-03525</span><br>

If <code>update</code> is <code>VK_TRUE</code>, then objects that were previously
inactive <strong>must</strong> not be made active as per
<a href="#acceleration-structure-inactive-prims">Inactive Primitives and Instances</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-03526" href="#VUID-vkCmdBuildAccelerationStructureNV-update-03526"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-03526</span><br>

If <code>update</code> is <code>VK_TRUE</code>, the <code>src</code> and <code>dst</code> objects
<strong>must</strong> either be the same object or not have any
<a href="resources.html#resources-memory-aliasing" class="xref page">memory aliasing</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-dst-07787" href="#VUID-vkCmdBuildAccelerationStructureNV-dst-07787"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-dst-07787</span><br>

<code>dst</code> <strong>must</strong> be bound completely and contiguously to a single
<code>VkDeviceMemory</code> object via
<a href="resources.html#vkBindAccelerationStructureMemoryNV" class="xref page">vkBindAccelerationStructureMemoryNV</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-parameter" href="#VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-pInfo-parameter" href="#VUID-vkCmdBuildAccelerationStructureNV-pInfo-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="resources.html#VkAccelerationStructureInfoNV" class="xref page">VkAccelerationStructureInfoNV</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-instanceData-parameter" href="#VUID-vkCmdBuildAccelerationStructureNV-instanceData-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-instanceData-parameter</span><br>
 If <code>instanceData</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>instanceData</code> <strong>must</strong> be a valid <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-dst-parameter" href="#VUID-vkCmdBuildAccelerationStructureNV-dst-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-dst-parameter</span><br>
 <code>dst</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureNV" class="xref page">VkAccelerationStructureNV</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-src-parameter" href="#VUID-vkCmdBuildAccelerationStructureNV-src-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-src-parameter</span><br>
 If <code>src</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>src</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureNV" class="xref page">VkAccelerationStructureNV</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-scratch-parameter" href="#VUID-vkCmdBuildAccelerationStructureNV-scratch-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-scratch-parameter</span><br>
 <code>scratch</code> <strong>must</strong> be a valid <a href="resources.html#VkBuffer" class="xref page">VkBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-recording" href="#VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-cmdpool" href="#VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-renderpass" href="#VUID-vkCmdBuildAccelerationStructureNV-renderpass"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-videocoding" href="#VUID-vkCmdBuildAccelerationStructureNV-videocoding"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-commonparent" href="#VUID-vkCmdBuildAccelerationStructureNV-commonparent"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-commonparent</span><br>
 Each of <code>commandBuffer</code>, <code>dst</code>, <code>instanceData</code>, <code>scratch</code>, and <code>src</code> that are valid handles of non-ignored parameters <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="video_extensions.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build acceleration structures call:</p>
</div>
<div id="vkCmdBuildAccelerationStructuresKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
void vkCmdBuildAccelerationStructuresKHR(
    VkCommandBuffer                             commandBuffer,
    uint32_t                                    infoCount,
    const VkAccelerationStructureBuildGeometryInfoKHR* pInfos,
    const VkAccelerationStructureBuildRangeInfoKHR* const* ppBuildRangeInfos);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>infoCount</code> is the number of acceleration structures to build.
It specifies the number of the <code>pInfos</code> structures and
<code>ppBuildRangeInfos</code> pointers that <strong>must</strong> be provided.</p>
</li>
<li>
<p><code>pInfos</code> is a pointer to an array of <code>infoCount</code>
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures defining
the geometry used to build each acceleration structure.</p>
</li>
<li>
<p><code>ppBuildRangeInfos</code> is a pointer to an array of <code>infoCount</code>
pointers to arrays of <a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a>
structures.
Each <code>ppBuildRangeInfos</code>[i] is a pointer to an array of
<code>pInfos</code>[i].<code>geometryCount</code>
<a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures defining
dynamic offsets to the addresses where geometry data is stored, as
defined by <code>pInfos</code>[i].</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>vkCmdBuildAccelerationStructuresKHR</code> command provides the ability
to initiate multiple acceleration structures builds, however there is no
ordering or synchronization implied between any of the individual
acceleration structure builds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>This means that an application <strong>cannot</strong> build a top-level acceleration
structure in the same <a href="#vkCmdBuildAccelerationStructuresKHR">vkCmdBuildAccelerationStructuresKHR</a> call as the
associated bottom-level or instance acceleration structures are being built.
There also <strong>cannot</strong> be any memory aliasing between any acceleration structure
memories or scratch memories being used by any of the builds.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="acceleration-structure-scratch" class="paragraph">
<p>Accesses to the acceleration structure scratch buffers as identified by the
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>scratchData</code> buffer
device addresses <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with
the <code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
(<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> |
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>).
Accesses to each
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>srcAccelerationStructure</code>
and
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>dstAccelerationStructure</code>
<strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> or
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>, as appropriate.</p>
</div>
<div class="paragraph">
<p>Accesses to other input buffers as identified by any used values of
<a href="#VkAccelerationStructureGeometryMotionTrianglesDataNV">VkAccelerationStructureGeometryMotionTrianglesDataNV</a>::<code>vertexData</code>,
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexData</code>,
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>indexData</code>,
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>transformData</code>,
<a href="#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a>::<code>data</code>, and
<a href="#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>data</code> <strong>must</strong> be
<a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_SHADER_READ_BIT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-accelerationStructure-08923" href="#VUID-vkCmdBuildAccelerationStructuresKHR-accelerationStructure-08923"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-accelerationStructure-08923</span><br>

The <a href="features.html#features-accelerationStructure" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-mode-04628" href="#VUID-vkCmdBuildAccelerationStructuresKHR-mode-04628"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-mode-04628</span><br>

The <code>mode</code> member of each element of <code>pInfos</code> <strong>must</strong> be a valid
<a href="#VkBuildAccelerationStructureModeKHR">VkBuildAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-srcAccelerationStructure-04629" href="#VUID-vkCmdBuildAccelerationStructuresKHR-srcAccelerationStructure-04629"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-srcAccelerationStructure-04629</span><br>

If the <code>srcAccelerationStructure</code> member of any element of
<code>pInfos</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the
<code>srcAccelerationStructure</code> member <strong>must</strong> be a valid
<a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-04630" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-04630"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-04630</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong>must</strong> not be <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03403" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03403"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03403</span><br>

The <code>srcAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03698" href="#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03698"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03698</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03800" href="#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03800"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03800</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03699" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03699"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03699</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong>must</strong> have been created with a
value of <a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03700" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03700"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03700</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong>must</strong> have been created with a
value of <a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03663" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03663"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03663</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>,
<a href="#acceleration-structure-inactive-prims">inactive primitives</a> in its
<code>srcAccelerationStructure</code> member <strong>must</strong> not be made active</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03664" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03664"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03664</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, active primitives
in its <code>srcAccelerationStructure</code> member <strong>must</strong> not be made
<a href="#acceleration-structure-inactive-prims">inactive</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-None-03407" href="#VUID-vkCmdBuildAccelerationStructuresKHR-None-03407"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-None-03407</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be referenced by the <code>geometry.instances.data</code> member of
any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other
element of <code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03701" href="#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03701"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03701</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>srcAccelerationStructure</code> member of
any other element of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, which is accessed
by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03702" href="#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03702"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03702</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>dstAccelerationStructure</code> member of
any other element of <code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03703" href="#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03703"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03703</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> (including the same element), which is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03704" href="#VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03704"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03704</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>scratchData</code> member of any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03705" href="#VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03705"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03705</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>srcAccelerationStructure</code> member of any element
of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> (including the
same element), which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03706" href="#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03706"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03706</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing any acceleration structure referenced by the
<code>geometry.instances.data</code> member of any element of <code>pGeometries</code>
or <code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03667" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03667"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03667</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong>must</strong> have previously been
constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_KHR</code> set in
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code> in the
build</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03668" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03668"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03668</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> and <code>dstAccelerationStructure</code>
members <strong>must</strong> either be the same <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a>, or
not have any <a href="resources.html#resources-memory-aliasing" class="xref page">memory aliasing</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03758" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03758"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03758</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>geometryCount</code> member <strong>must</strong> have the same value which was specified
when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03759" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03759"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03759</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>flags</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03760" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03760"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03760</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>type</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03761" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03761"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03761</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>geometryType</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03762" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03762"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03762</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>flags</code> member
<strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03763" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03763"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03763</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.vertexFormat</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03764" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03764"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03764</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.maxVertex</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03765" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03765"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03765</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.indexType</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03766" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03766"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03766</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03767" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03767"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03767</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was not <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong>must</strong> not be
<code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03768" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03768"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03768</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
then the value of each index referenced <strong>must</strong> be the same as the
corresponding index value when <code>srcAccelerationStructure</code> was last
built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-primitiveCount-03769" href="#VUID-vkCmdBuildAccelerationStructuresKHR-primitiveCount-03769"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-primitiveCount-03769</span><br>

For each <code>VkAccelerationStructureBuildRangeInfoKHR</code> referenced by
this command, its <code>primitiveCount</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-firstVertex-03770" href="#VUID-vkCmdBuildAccelerationStructuresKHR-firstVertex-03770"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-firstVertex-03770</span><br>

For each <code>VkAccelerationStructureBuildRangeInfoKHR</code> referenced by
this command, if the corresponding geometry uses indices, its
<code>firstVertex</code> member <strong>must</strong> have the same value which was specified
when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03801" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03801"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03801</span><br>

For each element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the corresponding
<code>ppBuildRangeInfos</code>[i][j].<code>primitiveCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxInstanceCount</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03707" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03707"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03707</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstAccelerationStructure</code> member <strong>must</strong> be bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03708" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03708"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03708</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> the <code>buffer</code>
used to create its <code>srcAccelerationStructure</code> member <strong>must</strong> be bound
to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03709" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03709"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03709</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create each
acceleration structure referenced by the <code>geometry.instances.data</code>
member of any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> <strong>must</strong> be
bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03671" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03671"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03671</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.deviceAddress</code> and
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> +  N - 1 <strong>must</strong> be in
the buffer device address range of the same buffer, where N is given by
the <code>buildScratchSize</code> member of the
<a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned from a
call to <a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with an identical
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure and
primitive count</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03672" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03672"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03672</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.deviceAddress</code> and
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> +  N - 1 <strong>must</strong> be in
the buffer device address range of the same buffer, where N is given by
the <code>updateScratchSize</code> member of the
<a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned from a
call to <a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with an identical
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure and
primitive count</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-geometry-03673" href="#VUID-vkCmdBuildAccelerationStructuresKHR-geometry-03673"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-geometry-03673</span><br>

The buffers from which the buffer device addresses for all of the
<code>geometry.triangles.vertexData</code>, <code>geometry.triangles.indexData</code>,
<code>geometry.triangles.transformData</code>, <code>geometry.aabbs.data</code>, and
<code>geometry.instances.data</code> members of all
<code>pInfos</code>[i].<code>pGeometries</code> and <code>pInfos</code>[i].<code>ppGeometries</code>
are queried <strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_BUILD_INPUT_READ_ONLY_BIT_KHR</code>
usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03674" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03674"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03674</span><br>

The buffer from which the buffer device address
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> is queried <strong>must</strong> have
been created with <code>VK_BUFFER_USAGE_STORAGE_BUFFER_BIT</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03802" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03802"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03802</span><br>

For each element of <code>pInfos</code>, its <code>scratchData.deviceAddress</code>
member <strong>must</strong> be a valid device address obtained from
<a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03803" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03803"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03803</span><br>

For each element of <code>pInfos</code>, if <code>scratchData.deviceAddress</code> is
the address of a non-sparse buffer then it <strong>must</strong> be bound completely and
contiguously to a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03710" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03710"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03710</span><br>

For each element of <code>pInfos</code>, its <code>scratchData.deviceAddress</code>
member <strong>must</strong> be a multiple of
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>minAccelerationStructureScratchOffsetAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03804" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03804"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03804</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.deviceAddress</code> <strong>must</strong> be a valid
device address obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03805" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03805"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03805</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.vertexData.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03711" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03711"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03711</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.deviceAddress</code> <strong>must</strong> be aligned to
the size in bytes of the smallest component of the format in
<code>vertexFormat</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03806" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03806"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03806</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.deviceAddress</code> <strong>must</strong> be a valid device
address obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03807" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03807"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03807</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
if <code>geometry.triangles.indexData.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03712" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03712"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03712</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and with
<code>geometry.triangles.indexType</code> not equal to
<code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.deviceAddress</code> <strong>must</strong> be aligned to the
size in bytes of the type in <code>indexType</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03808" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03808"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03808</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is not <code>0</code>, it
<strong>must</strong> be a valid device address obtained from
<a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03809" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03809"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03809</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03810" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03810"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03810</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is not <code>0</code>, it
<strong>must</strong> be aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03811" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03811"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03811</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>geometry.aabbs.data.deviceAddress</code> <strong>must</strong> be a valid device address
obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03812" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03812"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03812</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, if
<code>geometry.aabbs.data.deviceAddress</code> is the address of a non-sparse
buffer then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03714" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03714"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03714</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>geometry.aabbs.data.deviceAddress</code> <strong>must</strong> be aligned to <code>8</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03715" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03715"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03715</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_FALSE</code>, <code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be
aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03716" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03716"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03716</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_TRUE</code>, <code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be
aligned to <code>8</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03717" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03717"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03717</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_TRUE</code>, each element of
<code>geometry.instances.data.deviceAddress</code> in device memory <strong>must</strong> be
aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03813" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03813"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03813</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>,
<code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be a valid device
address obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03814" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03814"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03814</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if
<code>geometry.instances.data.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-06707" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-06707"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-06707</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, each
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>accelerationStructureReference</code>
value in <code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be a valid
device address containing a value obtained from
<a href="resources.html#vkGetAccelerationStructureDeviceAddressKHR" class="xref page">vkGetAccelerationStructureDeviceAddressKHR</a> or <code>0</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03675" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03675"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03675</span><br>

For each <code>pInfos</code>[i], <code>dstAccelerationStructure</code> <strong>must</strong> have been
created with a value of
<a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>size</code> greater than or
equal to the memory size required by the build operation, as returned by
<a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with <span class="eq"><code>pBuildInfo</code>
= <code>pInfos</code>[i]</span> and with each element of the
<code>pMaxPrimitiveCounts</code> array greater than or equal to the equivalent
<code>ppBuildRangeInfos</code>[i][j].<code>primitiveCount</code> values for <code>j</code> in
<span class="eq">[0,<code>pInfos</code>[i].<code>geometryCount</code>)</span></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676" href="#VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676</span><br>

Each element of <code>ppBuildRangeInfos</code>[i] <strong>must</strong> be a valid pointer to
an array of <code>pInfos</code>[i].<code>geometryCount</code>
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structures</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-parameter" href="#VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-parameter" href="#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-parameter</span><br>
 <code>pInfos</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> valid <a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter" href="#VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter</span><br>
 <code>ppBuildRangeInfos</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> <a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-recording" href="#VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-cmdpool" href="#VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-renderpass" href="#VUID-vkCmdBuildAccelerationStructuresKHR-renderpass"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-videocoding" href="#VUID-vkCmdBuildAccelerationStructuresKHR-videocoding"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-infoCount-arraylength" href="#VUID-vkCmdBuildAccelerationStructuresKHR-infoCount-arraylength"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-infoCount-arraylength</span><br>
 <code>infoCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="video_extensions.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build acceleration structures with some parameters sourced on the device
call:</p>
</div>
<div id="vkCmdBuildAccelerationStructuresIndirectKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
void vkCmdBuildAccelerationStructuresIndirectKHR(
    VkCommandBuffer                             commandBuffer,
    uint32_t                                    infoCount,
    const VkAccelerationStructureBuildGeometryInfoKHR* pInfos,
    const VkDeviceAddress*                      pIndirectDeviceAddresses,
    const uint32_t*                             pIndirectStrides,
    const uint32_t* const*                      ppMaxPrimitiveCounts);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>infoCount</code> is the number of acceleration structures to build.</p>
</li>
<li>
<p><code>pInfos</code> is a pointer to an array of <code>infoCount</code>
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures defining
the geometry used to build each acceleration structure.</p>
</li>
<li>
<p><code>pIndirectDeviceAddresses</code> is a pointer to an array of
<code>infoCount</code> buffer device addresses which point to
<code>pInfos</code>[i].<code>geometryCount</code>
<a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures defining
dynamic offsets to the addresses where geometry data is stored, as
defined by <code>pInfos</code>[i].</p>
</li>
<li>
<p><code>pIndirectStrides</code> is a pointer to an array of <code>infoCount</code> byte
strides between elements of <code>pIndirectDeviceAddresses</code>.</p>
</li>
<li>
<p><code>ppMaxPrimitiveCounts</code> is a pointer to an array of <code>infoCount</code>
pointers to arrays of <code>pInfos</code>[i].<code>geometryCount</code> values
indicating the maximum number of primitives that will be built by this
command for each geometry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to acceleration structures, scratch buffers, vertex buffers, index
buffers, and instance buffers must be synchronized as with
<a href="#acceleration-structure-scratch">vkCmdBuildAccelerationStructuresKHR</a>.</p>
</div>
<div class="paragraph">
<p>Accesses to any element of <code>pIndirectDeviceAddresses</code> <strong>must</strong> be
<a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_INDIRECT_COMMAND_READ_BIT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-accelerationStructureIndirectBuild-03650" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-accelerationStructureIndirectBuild-03650"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-accelerationStructureIndirectBuild-03650</span><br>

The <a href="features.html#features-accelerationStructureIndirectBuild" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureIndirectBuild</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-mode-04628" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-mode-04628"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-mode-04628</span><br>

The <code>mode</code> member of each element of <code>pInfos</code> <strong>must</strong> be a valid
<a href="#VkBuildAccelerationStructureModeKHR">VkBuildAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-srcAccelerationStructure-04629" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-srcAccelerationStructure-04629"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-srcAccelerationStructure-04629</span><br>

If the <code>srcAccelerationStructure</code> member of any element of
<code>pInfos</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the
<code>srcAccelerationStructure</code> member <strong>must</strong> be a valid
<a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-04630" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-04630"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-04630</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong>must</strong> not be <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03403" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03403"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03403</span><br>

The <code>srcAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03698" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03698"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03698</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03800" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03800"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03800</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03699" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03699"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03699</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong>must</strong> have been created with a
value of <a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03700" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03700"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03700</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong>must</strong> have been created with a
value of <a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03663" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03663"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03663</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>,
<a href="#acceleration-structure-inactive-prims">inactive primitives</a> in its
<code>srcAccelerationStructure</code> member <strong>must</strong> not be made active</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03664" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03664"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03664</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, active primitives
in its <code>srcAccelerationStructure</code> member <strong>must</strong> not be made
<a href="#acceleration-structure-inactive-prims">inactive</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-None-03407" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-None-03407"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-None-03407</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be referenced by the <code>geometry.instances.data</code> member of
any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other
element of <code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03701" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03701"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03701</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>srcAccelerationStructure</code> member of
any other element of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, which is accessed
by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03702" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03702"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03702</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>dstAccelerationStructure</code> member of
any other element of <code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03703" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03703"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03703</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> (including the same element), which is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03704" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03704"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03704</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>scratchData</code> member of any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03705" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03705"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03705</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>srcAccelerationStructure</code> member of any element
of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> (including the
same element), which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03706" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03706"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03706</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing any acceleration structure referenced by the
<code>geometry.instances.data</code> member of any element of <code>pGeometries</code>
or <code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03667" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03667"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03667</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong>must</strong> have previously been
constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_KHR</code> set in
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code> in the
build</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03668" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03668"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03668</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> and <code>dstAccelerationStructure</code>
members <strong>must</strong> either be the same <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a>, or
not have any <a href="resources.html#resources-memory-aliasing" class="xref page">memory aliasing</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03758" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03758"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03758</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>geometryCount</code> member <strong>must</strong> have the same value which was specified
when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03759" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03759"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03759</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>flags</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03760" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03760"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03760</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>type</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03761" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03761"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03761</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>geometryType</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03762" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03762"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03762</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>flags</code> member
<strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03763" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03763"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03763</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.vertexFormat</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03764" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03764"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03764</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.maxVertex</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03765" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03765"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03765</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.indexType</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03766" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03766"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03766</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03767" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03767"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03767</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was not <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong>must</strong> not be
<code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03768" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03768"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03768</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
then the value of each index referenced <strong>must</strong> be the same as the
corresponding index value when <code>srcAccelerationStructure</code> was last
built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-primitiveCount-03769" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-primitiveCount-03769"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-primitiveCount-03769</span><br>

For each <code>VkAccelerationStructureBuildRangeInfoKHR</code> referenced by
this command, its <code>primitiveCount</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-firstVertex-03770" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-firstVertex-03770"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-firstVertex-03770</span><br>

For each <code>VkAccelerationStructureBuildRangeInfoKHR</code> referenced by
this command, if the corresponding geometry uses indices, its
<code>firstVertex</code> member <strong>must</strong> have the same value which was specified
when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03801" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03801"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03801</span><br>

For each element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the corresponding
<code>ppMaxPrimitiveCounts</code>[i][j] <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxInstanceCount</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03707" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03707"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03707</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstAccelerationStructure</code> member <strong>must</strong> be bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03708" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03708"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03708</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> the <code>buffer</code>
used to create its <code>srcAccelerationStructure</code> member <strong>must</strong> be bound
to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03709" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03709"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03709</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create each
acceleration structure referenced by the <code>geometry.instances.data</code>
member of any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> <strong>must</strong> be
bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03671" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03671"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03671</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.deviceAddress</code> and
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> +  N - 1 <strong>must</strong> be in
the buffer device address range of the same buffer, where N is given by
the <code>buildScratchSize</code> member of the
<a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned from a
call to <a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with an identical
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure and
primitive count</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03672" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03672"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03672</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.deviceAddress</code> and
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> +  N - 1 <strong>must</strong> be in
the buffer device address range of the same buffer, where N is given by
the <code>updateScratchSize</code> member of the
<a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned from a
call to <a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with an identical
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure and
primitive count</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-geometry-03673" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-geometry-03673"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-geometry-03673</span><br>

The buffers from which the buffer device addresses for all of the
<code>geometry.triangles.vertexData</code>, <code>geometry.triangles.indexData</code>,
<code>geometry.triangles.transformData</code>, <code>geometry.aabbs.data</code>, and
<code>geometry.instances.data</code> members of all
<code>pInfos</code>[i].<code>pGeometries</code> and <code>pInfos</code>[i].<code>ppGeometries</code>
are queried <strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_BUILD_INPUT_READ_ONLY_BIT_KHR</code>
usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03674" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03674"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03674</span><br>

The buffer from which the buffer device address
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> is queried <strong>must</strong> have
been created with <code>VK_BUFFER_USAGE_STORAGE_BUFFER_BIT</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03802" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03802"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03802</span><br>

For each element of <code>pInfos</code>, its <code>scratchData.deviceAddress</code>
member <strong>must</strong> be a valid device address obtained from
<a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03803" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03803"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03803</span><br>

For each element of <code>pInfos</code>, if <code>scratchData.deviceAddress</code> is
the address of a non-sparse buffer then it <strong>must</strong> be bound completely and
contiguously to a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03710" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03710"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03710</span><br>

For each element of <code>pInfos</code>, its <code>scratchData.deviceAddress</code>
member <strong>must</strong> be a multiple of
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>minAccelerationStructureScratchOffsetAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03804" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03804"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03804</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.deviceAddress</code> <strong>must</strong> be a valid
device address obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03805" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03805"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03805</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.vertexData.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03711" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03711"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03711</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.deviceAddress</code> <strong>must</strong> be aligned to
the size in bytes of the smallest component of the format in
<code>vertexFormat</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03806" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03806"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03806</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.deviceAddress</code> <strong>must</strong> be a valid device
address obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03807" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03807"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03807</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
if <code>geometry.triangles.indexData.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03712" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03712"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03712</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and with
<code>geometry.triangles.indexType</code> not equal to
<code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.deviceAddress</code> <strong>must</strong> be aligned to the
size in bytes of the type in <code>indexType</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03808" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03808"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03808</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is not <code>0</code>, it
<strong>must</strong> be a valid device address obtained from
<a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03809" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03809"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03809</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03810" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03810"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03810</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is not <code>0</code>, it
<strong>must</strong> be aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03811" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03811"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03811</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>geometry.aabbs.data.deviceAddress</code> <strong>must</strong> be a valid device address
obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03812" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03812"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03812</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, if
<code>geometry.aabbs.data.deviceAddress</code> is the address of a non-sparse
buffer then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03714" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03714"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03714</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>geometry.aabbs.data.deviceAddress</code> <strong>must</strong> be aligned to <code>8</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03715" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03715"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03715</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_FALSE</code>, <code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be
aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03716" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03716"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03716</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_TRUE</code>, <code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be
aligned to <code>8</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03717" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03717"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03717</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_TRUE</code>, each element of
<code>geometry.instances.data.deviceAddress</code> in device memory <strong>must</strong> be
aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03813" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03813"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03813</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>,
<code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be a valid device
address obtained from <a href="descriptorsets.html#vkGetBufferDeviceAddress" class="xref page">vkGetBufferDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03814" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03814"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03814</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if
<code>geometry.instances.data.deviceAddress</code> is the address of a
non-sparse buffer then it <strong>must</strong> be bound completely and contiguously to
a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-06707" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-06707"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-06707</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, each
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>accelerationStructureReference</code>
value in <code>geometry.instances.data.deviceAddress</code> <strong>must</strong> be a valid
device address containing a value obtained from
<a href="resources.html#vkGetAccelerationStructureDeviceAddressKHR" class="xref page">vkGetAccelerationStructureDeviceAddressKHR</a> or <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03645" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03645"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03645</span><br>

For any element of <code>pIndirectDeviceAddresses</code>, if the buffer from
which it was queried is non-sparse then it <strong>must</strong> be bound completely and
contiguously to a single <a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03646" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03646"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03646</span><br>

For any element of <code>pIndirectDeviceAddresses</code>[i], all device
addresses between <code>pIndirectDeviceAddresses</code>[i] and
<span class="eq"><code>pIndirectDeviceAddresses</code>[i] + 
(<code>pInfos</code>[i].<code>geometryCount</code> × <code>pIndirectStrides</code>[i]) -
1</span> <strong>must</strong> be in the buffer device address range of the same buffer</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03647" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03647"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03647</span><br>

For any element of <code>pIndirectDeviceAddresses</code>, the buffer from which
it was queried <strong>must</strong> have been created with the
<code>VK_BUFFER_USAGE_INDIRECT_BUFFER_BIT</code> bit set</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03648" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03648"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03648</span><br>

Each element of <code>pIndirectDeviceAddresses</code> <strong>must</strong> be a multiple of
<code>4</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-03787" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-03787"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-03787</span><br>

Each element of <code>pIndirectStrides</code> <strong>must</strong> be a multiple of <code>4</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-03649" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-03649"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-03649</span><br>

<code>commandBuffer</code> <strong>must</strong> not be a protected command buffer</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03651" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03651"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03651</span><br>

Each <a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structure referenced
by any element of <code>pIndirectDeviceAddresses</code> <strong>must</strong> be a valid
<a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03652" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03652"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03652</span><br>

<code>pInfos</code>[i].<code>dstAccelerationStructure</code> <strong>must</strong> have been created
with a value of <a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>size</code>
greater than or equal to the memory size required by the build
operation, as returned by <a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a>
with <span class="eq"><code>pBuildInfo</code> = <code>pInfos</code>[i]</span> and
<span class="eq"><code>pMaxPrimitiveCounts</code> = <code>ppMaxPrimitiveCounts</code>[i]</span></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-03653" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-03653"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-03653</span><br>

Each <code>ppMaxPrimitiveCounts</code>[i][j] <strong>must</strong> be greater than or equal to
the <code>primitiveCount</code> value specified by the
<a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structure located at
<span class="eq"><code>pIndirectDeviceAddresses</code>[i] +  (<code>j</code> ×
<code>pIndirectStrides</code>[i])</span></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-parameter" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-parameter" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-parameter</span><br>
 <code>pInfos</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> valid <a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-parameter" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-parameter</span><br>
 <code>pIndirectDeviceAddresses</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> <code>VkDeviceAddress</code> values</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-parameter" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-parameter</span><br>
 <code>pIndirectStrides</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> <code>uint32_t</code> values</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-parameter" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-parameter</span><br>
 <code>ppMaxPrimitiveCounts</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> <code>uint32_t</code> values</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-recording" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-cmdpool" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-renderpass" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-renderpass"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-videocoding" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-videocoding"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-infoCount-arraylength" href="#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-infoCount-arraylength"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-infoCount-arraylength</span><br>
 <code>infoCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="video_extensions.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureBuildGeometryInfoKHR</code> structure is defined
as:</p>
</div>
<div id="VkAccelerationStructureBuildGeometryInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureBuildGeometryInfoKHR {
    VkStructureType                                     sType;
    const void*                                         pNext;
    VkAccelerationStructureTypeKHR                      type;
    VkBuildAccelerationStructureFlagsKHR                flags;
    VkBuildAccelerationStructureModeKHR                 mode;
    VkAccelerationStructureKHR                          srcAccelerationStructure;
    VkAccelerationStructureKHR                          dstAccelerationStructure;
    uint32_t                                            geometryCount;
    const VkAccelerationStructureGeometryKHR*           pGeometries;
    const VkAccelerationStructureGeometryKHR* const*    ppGeometries;
    VkDeviceOrHostAddressKHR                            scratchData;
} VkAccelerationStructureBuildGeometryInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>type</code> is a <a href="resources.html#VkAccelerationStructureTypeKHR" class="xref page">VkAccelerationStructureTypeKHR</a> value specifying
the type of acceleration structure being built.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of
<a href="resources.html#VkBuildAccelerationStructureFlagBitsKHR" class="xref page">VkBuildAccelerationStructureFlagBitsKHR</a> specifying additional
parameters of the acceleration structure.</p>
</li>
<li>
<p><code>mode</code> is a <a href="#VkBuildAccelerationStructureModeKHR">VkBuildAccelerationStructureModeKHR</a> value
specifying the type of operation to perform.</p>
</li>
<li>
<p><code>srcAccelerationStructure</code> is a pointer to an existing acceleration
structure that is to be used to update the <code>dst</code> acceleration
structure when <code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>.</p>
</li>
<li>
<p><code>dstAccelerationStructure</code> is a pointer to the target acceleration
structure for the build.</p>
</li>
<li>
<p><code>geometryCount</code> specifies the number of geometries that will be
built into <code>dstAccelerationStructure</code>.</p>
</li>
<li>
<p><code>pGeometries</code> is a pointer to an array of
<a href="#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structures.</p>
</li>
<li>
<p><code>ppGeometries</code> is a pointer to an array of pointers to
<a href="#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structures.</p>
</li>
<li>
<p><code>scratchData</code> is the device or host address to memory that will be
used as scratch memory for the build.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only one of <code>pGeometries</code> or <code>ppGeometries</code> <strong>can</strong> be a valid pointer,
the other <strong>must</strong> be <code>NULL</code>.
Each element of the non-<code>NULL</code> array describes the data used to build each
acceleration structure geometry.</p>
</div>
<div id="acceleration-structure-geometry-index" class="paragraph">
<p>The index of each element of the <code>pGeometries</code> or <code>ppGeometries</code>
members of <a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> is used as the
<em>geometry index</em> during ray traversal.
The geometry index is available in ray shaders via the
<a href="interfaces.html#interfaces-builtin-variables-raygeometryindex" class="xref page"><code>RayGeometryIndexKHRbuilt</code>-in</a>, and is <a href="raytracing.html#shader-binding-table-hit-shader-indexing" class="xref page">used todetermine hit and intersection shaders executed during traversal</a>.
The geometry index is available to ray queries via the
<code>OpRayQueryGetIntersectionGeometryIndexKHR</code> instruction.</p>
</div>
<div id="acceleration-structure-motion-instances" class="paragraph">
<p>Setting <code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> in <code>flags</code>
indicates that this build is a motion top level acceleration structure.
A motion top level uses instances of format
<a href="#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a> if
<a href="#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>arrayOfPointers</code>
is <code>VK_FALSE</code>.</p>
</div>
<div class="paragraph">
<p>If
<a href="#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>arrayOfPointers</code>
is <code>VK_TRUE</code>, the pointer for each element of the array of instance
pointers consists of 4 bits of
<code>VkAccelerationStructureMotionInstanceTypeNV</code> in the low 4 bits of the
pointer identifying the type of structure at the pointer.
The device address accessed is the value in the array with the low 4 bits
set to zero.
The structure at the pointer is one of
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>,
<a href="#VkAccelerationStructureMatrixMotionInstanceNV">VkAccelerationStructureMatrixMotionInstanceNV</a> or
<a href="#VkAccelerationStructureSRTMotionInstanceNV">VkAccelerationStructureSRTMotionInstanceNV</a>, depending on the type
value encoded in the low 4 bits.</p>
</div>
<div class="paragraph">
<p>A top level acceleration structure with either motion instances or vertex
motion in its instances <strong>must</strong> set
<code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> in <code>flags</code>.</p>
</div>
<div class="paragraph">
<p>Members <code>srcAccelerationStructure</code> and <code>dstAccelerationStructure</code>
<strong>may</strong> be the same or different for an update operation (when <code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>).
If they are the same, the update happens in-place.
Otherwise, the target acceleration structure is updated and the source is
not modified.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03654" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03654"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03654</span><br>

<code>type</code> <strong>must</strong> not be <code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-03788" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-03788"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-03788</span><br>

Only one of <code>pGeometries</code> or <code>ppGeometries</code> <strong>can</strong> be a valid
pointer, the other <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03789" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03789"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03789</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>, the
<code>geometryType</code> member of elements of either <code>pGeometries</code> or
<code>ppGeometries</code> <strong>must</strong> be <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03790" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03790"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03790</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>,
<code>geometryCount</code> <strong>must</strong> be <code>1</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03791" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03791"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03791</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
the <code>geometryType</code> member of elements of either <code>pGeometries</code> or
<code>ppGeometries</code> <strong>must</strong> not be <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03792" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03792"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03792</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
then the <code>geometryType</code> member of each geometry in either
<code>pGeometries</code> or <code>ppGeometries</code> <strong>must</strong> be the same</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03793" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03793"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03793</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
then <code>geometryCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxGeometryCount</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03794" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03794"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03794</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
and the <code>geometryType</code> member of either <code>pGeometries</code> or
<code>ppGeometries</code> is <code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, the total number
of AABBs in all geometries <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxPrimitiveCount</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03795" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03795"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03795</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
and the <code>geometryType</code> member of either <code>pGeometries</code> or
<code>ppGeometries</code> is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, the total
number of triangles in all geometries <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxPrimitiveCount</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-03796" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-03796"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-03796</span><br>

If <code>flags</code> has the
<code>VK_BUILD_ACCELERATION_STRUCTURE_PREFER_FAST_TRACE_BIT_KHR</code> bit set,
then it <strong>must</strong> not have the
<code>VK_BUILD_ACCELERATION_STRUCTURE_PREFER_FAST_BUILD_BIT_KHR</code> bit set</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-dstAccelerationStructure-04927" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-dstAccelerationStructure-04927"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-dstAccelerationStructure-04927</span><br>

If <code>dstAccelerationStructure</code> was created with
<code>VK_ACCELERATION_STRUCTURE_CREATE_MOTION_BIT_NV</code> set in
<a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>flags</code>,
<code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> <strong>must</strong> be set in
<code>flags</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04928" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04928"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04928</span><br>

If <code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> is set in
<code>flags</code>, <code>dstAccelerationStructure</code> <strong>must</strong> have been created with
<code>VK_ACCELERATION_STRUCTURE_CREATE_MOTION_BIT_NV</code> set in
<a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>flags</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04929" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04929"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04929</span><br>

If <code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> is set in
<code>flags</code>, <code>type</code> <strong>must</strong> not be
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-07334" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-07334"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-07334</span><br>

If <code>flags</code> has the
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_UPDATE_EXT</code>
bit set then it <strong>must</strong> not have the
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_DATA_UPDATE_EXT</code>
bit set</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-sType-sType" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_BUILD_GEOMETRY_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-pNext-pNext" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-parameter" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-parameter</span><br>
 <code>type</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureTypeKHR" class="xref page">VkAccelerationStructureTypeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-parameter" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="resources.html#VkBuildAccelerationStructureFlagBitsKHR" class="xref page">VkBuildAccelerationStructureFlagBitsKHR</a> values</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-parameter" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-parameter</span><br>
 If <code>geometryCount</code> is not <code>0</code>, and <code>pGeometries</code> is not <code>NULL</code>, <code>pGeometries</code> <strong>must</strong> be a valid pointer to an array of <code>geometryCount</code> valid <a href="#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-ppGeometries-parameter" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-ppGeometries-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-ppGeometries-parameter</span><br>
 If <code>geometryCount</code> is not <code>0</code>, and <code>ppGeometries</code> is not <code>NULL</code>, <code>ppGeometries</code> <strong>must</strong> be a valid pointer to an array of <code>geometryCount</code> valid pointers to valid <a href="#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-commonparent" href="#VUID-VkAccelerationStructureBuildGeometryInfoKHR-commonparent"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-commonparent</span><br>
 Both of <code>dstAccelerationStructure</code>, and <code>srcAccelerationStructure</code> that are valid handles of non-ignored parameters <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkBuildAccelerationStructureModeKHR</code> enumeration is defined as:</p>
</div>
<div id="VkBuildAccelerationStructureModeKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef enum VkBuildAccelerationStructureModeKHR {
    VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR = 0,
    VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR = 1,
} VkBuildAccelerationStructureModeKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR</code> specifies that the
destination acceleration structure will be built using the specified
geometries.</p>
</li>
<li>
<p><code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> specifies that the
destination acceleration structure will be built using data in a source
acceleration structure, updated by the specified geometries.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkDeviceOrHostAddressKHR</code> union is defined as:</p>
</div>
<div id="VkDeviceOrHostAddressKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef union VkDeviceOrHostAddressKHR {
    VkDeviceAddress    deviceAddress;
    void*              hostAddress;
} VkDeviceOrHostAddressKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>deviceAddress</code> is a buffer device address as returned by the
<a href="descriptorsets.html#vkGetBufferDeviceAddressKHR" class="xref page">vkGetBufferDeviceAddressKHR</a> command.</p>
</li>
<li>
<p><code>hostAddress</code> is a host memory address.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkDeviceOrHostAddressConstKHR</code> union is defined as:</p>
</div>
<div id="VkDeviceOrHostAddressConstKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef union VkDeviceOrHostAddressConstKHR {
    VkDeviceAddress    deviceAddress;
    const void*        hostAddress;
} VkDeviceOrHostAddressConstKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>deviceAddress</code> is a buffer device address as returned by the
<a href="descriptorsets.html#vkGetBufferDeviceAddressKHR" class="xref page">vkGetBufferDeviceAddressKHR</a> command.</p>
</li>
<li>
<p><code>hostAddress</code> is a const host memory address.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryKHR</code> structure is defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureGeometryKHR {
    VkStructureType                           sType;
    const void*                               pNext;
    VkGeometryTypeKHR                         geometryType;
    VkAccelerationStructureGeometryDataKHR    geometry;
    VkGeometryFlagsKHR                        flags;
} VkAccelerationStructureGeometryKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>geometryType</code> describes which type of geometry this
<code>VkAccelerationStructureGeometryKHR</code> refers to.</p>
</li>
<li>
<p><code>geometry</code> is a <a href="#VkAccelerationStructureGeometryDataKHR">VkAccelerationStructureGeometryDataKHR</a> union
describing the geometry data for the relevant geometry type.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="resources.html#VkGeometryFlagBitsKHR" class="xref page">VkGeometryFlagBitsKHR</a> values
describing additional properties of how the geometry should be built.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-sType-sType" href="#VUID-VkAccelerationStructureGeometryKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-pNext-pNext" href="#VUID-VkAccelerationStructureGeometryKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-geometryType-parameter" href="#VUID-VkAccelerationStructureGeometryKHR-geometryType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-geometryType-parameter</span><br>
 <code>geometryType</code> <strong>must</strong> be a valid <a href="resources.html#VkGeometryTypeKHR" class="xref page">VkGeometryTypeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-triangles-parameter" href="#VUID-VkAccelerationStructureGeometryKHR-triangles-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-triangles-parameter</span><br>
 If <code>geometryType</code> is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, the <code>triangles</code> member of <code>geometry</code> <strong>must</strong> be a valid <a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-aabbs-parameter" href="#VUID-VkAccelerationStructureGeometryKHR-aabbs-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-aabbs-parameter</span><br>
 If <code>geometryType</code> is <code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, the <code>aabbs</code> member of <code>geometry</code> <strong>must</strong> be a valid <a href="#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-instances-parameter" href="#VUID-VkAccelerationStructureGeometryKHR-instances-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-instances-parameter</span><br>
 If <code>geometryType</code> is <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the <code>instances</code> member of <code>geometry</code> <strong>must</strong> be a valid <a href="#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-flags-parameter" href="#VUID-VkAccelerationStructureGeometryKHR-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="resources.html#VkGeometryFlagBitsKHR" class="xref page">VkGeometryFlagBitsKHR</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryDataKHR</code> union is defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryDataKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef union VkAccelerationStructureGeometryDataKHR {
    VkAccelerationStructureGeometryTrianglesDataKHR    triangles;
    VkAccelerationStructureGeometryAabbsDataKHR        aabbs;
    VkAccelerationStructureGeometryInstancesDataKHR    instances;
} VkAccelerationStructureGeometryDataKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>triangles</code> is a
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure.</p>
</li>
<li>
<p><code>aabbs</code> is a <a href="#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a>
structure.</p>
</li>
<li>
<p><code>instances</code> is a
<a href="#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a> structure.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryTrianglesDataKHR</code> structure is
defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryTrianglesDataKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureGeometryTrianglesDataKHR {
    VkStructureType                  sType;
    const void*                      pNext;
    VkFormat                         vertexFormat;
    VkDeviceOrHostAddressConstKHR    vertexData;
    VkDeviceSize                     vertexStride;
    uint32_t                         maxVertex;
    VkIndexType                      indexType;
    VkDeviceOrHostAddressConstKHR    indexData;
    VkDeviceOrHostAddressConstKHR    transformData;
} VkAccelerationStructureGeometryTrianglesDataKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>vertexFormat</code> is the <a href="formats.html#VkFormat" class="xref page">VkFormat</a> of each vertex element.</p>
</li>
<li>
<p><code>vertexData</code> is a device or host address to memory containing vertex
data for this geometry.</p>
</li>
<li>
<p><code>maxVertex</code> is the highest index of a vertex that will be addressed
by a build command using this structure.</p>
</li>
<li>
<p><code>vertexStride</code> is the stride in bytes between each vertex.</p>
</li>
<li>
<p><code>indexType</code> is the <a href="drawing.html#VkIndexType" class="xref page">VkIndexType</a> of each index element.</p>
</li>
<li>
<p><code>indexData</code> is a device or host address to memory containing index
data for this geometry.</p>
</li>
<li>
<p><code>transformData</code> is a device or host address to memory containing an
optional reference to a <a href="#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure describing
a transformation from the space in which the vertices in this geometry
are described to the space in which the acceleration structure is
defined.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Unlike the stride for vertex buffers in
<a href="fxvertex.html#VkVertexInputBindingDescription" class="xref page">VkVertexInputBindingDescription</a> for graphics pipelines which must not
exceed <code>maxVertexInputBindingStride</code>, <code>vertexStride</code> for
acceleration structure geometry is instead restricted to being a 32-bit
value.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03735" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03735"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03735</span><br>

<code>vertexStride</code> <strong>must</strong> be a multiple of the size in bytes of the
smallest component of <code>vertexFormat</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03819" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03819"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03819</span><br>

<code>vertexStride</code> <strong>must</strong> be less than or equal to <span class="eq">2<sup>32</sup>-1</span></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-03797" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-03797"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-03797</span><br>

The <a href="resources.html#resources-buffer-view-format-features" class="xref page">format features</a> of
<code>vertexFormat</code> <strong>must</strong> contain
<code>VK_FORMAT_FEATURE_ACCELERATION_STRUCTURE_VERTEX_BUFFER_BIT_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-03798" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-03798"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-03798</span><br>

<code>indexType</code> <strong>must</strong> be <code>VK_INDEX_TYPE_UINT16</code>,
<code>VK_INDEX_TYPE_UINT32</code>, or <code>VK_INDEX_TYPE_NONE_KHR</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-sType" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_TRIANGLES_DATA_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-pNext-pNext" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-pNext-pNext</span><br>
 Each <code>pNext</code> member of any structure (including this one) in the <code>pNext</code> chain <strong>must</strong> be either <code>NULL</code> or a pointer to a valid instance of <a href="#VkAccelerationStructureGeometryMotionTrianglesDataNV">VkAccelerationStructureGeometryMotionTrianglesDataNV</a>, <a href="#VkAccelerationStructureTrianglesDisplacementMicromapNV">VkAccelerationStructureTrianglesDisplacementMicromapNV</a>, or <a href="#VkAccelerationStructureTrianglesOpacityMicromapEXT">VkAccelerationStructureTrianglesOpacityMicromapEXT</a></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-unique" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-unique"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-unique</span><br>
 The <code>sType</code> value of each struct in the <code>pNext</code> chain <strong>must</strong> be unique</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-parameter" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-parameter</span><br>
 <code>vertexFormat</code> <strong>must</strong> be a valid <a href="formats.html#VkFormat" class="xref page">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-parameter" href="#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-parameter</span><br>
 <code>indexType</code> <strong>must</strong> be a valid <a href="drawing.html#VkIndexType" class="xref page">VkIndexType</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryMotionTrianglesDataNV</code> structure is
defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryMotionTrianglesDataNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef struct VkAccelerationStructureGeometryMotionTrianglesDataNV {
    VkStructureType                  sType;
    const void*                      pNext;
    VkDeviceOrHostAddressConstKHR    vertexData;
} VkAccelerationStructureGeometryMotionTrianglesDataNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>vertexData</code> is a pointer to vertex data for this geometry at time
1.0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>VkAccelerationStructureGeometryMotionTrianglesDataNV</code> is included in
the <code>pNext</code> chain of a
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure, the basic
vertex positions are used for the position of the triangles in the geometry
at time 0.0 and the <code>vertexData</code> in
<code>VkAccelerationStructureGeometryMotionTrianglesDataNV</code> is used for the
vertex positions at time 1.0, with positions linearly interpolated at
intermediate times.</p>
</div>
<div class="paragraph">
<p>Indexing for <code>VkAccelerationStructureGeometryMotionTrianglesDataNV</code>
<code>vertexData</code> is equivalent to the basic vertex position data.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryMotionTrianglesDataNV-sType-sType" href="#VUID-VkAccelerationStructureGeometryMotionTrianglesDataNV-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryMotionTrianglesDataNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_MOTION_TRIANGLES_DATA_NV</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureTrianglesOpacityMicromapEXT</code> structure is
defined as:</p>
</div>
<div id="VkAccelerationStructureTrianglesOpacityMicromapEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_opacity_micromap
typedef struct VkAccelerationStructureTrianglesOpacityMicromapEXT {
    VkStructureType                     sType;
    void*                               pNext;
    VkIndexType                         indexType;
    VkDeviceOrHostAddressConstKHR       indexBuffer;
    VkDeviceSize                        indexStride;
    uint32_t                            baseTriangle;
    uint32_t                            usageCountsCount;
    const VkMicromapUsageEXT*           pUsageCounts;
    const VkMicromapUsageEXT* const*    ppUsageCounts;
    VkMicromapEXT                       micromap;
} VkAccelerationStructureTrianglesOpacityMicromapEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>indexType</code> is the type of triangle indices used when indexing this
micromap</p>
</li>
<li>
<p><code>indexBuffer</code> is the address containing the triangle indices</p>
</li>
<li>
<p><code>indexStride</code> is the byte stride between triangle indices</p>
</li>
<li>
<p><code>baseTriangle</code> is the base value added to the non-negative triangle
indices</p>
</li>
<li>
<p><code>usageCountsCount</code> specifies the number of usage counts structures
that will be used to determine the size of this micromap.</p>
</li>
<li>
<p><code>pUsageCounts</code> is a pointer to an array of <a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a>
structures.</p>
</li>
<li>
<p><code>ppUsageCounts</code> is a pointer to an array of pointers to
<a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a> structures.</p>
</li>
<li>
<p><code>micromap</code> is the handle to the micromap object to include in this
geometry</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>VkAccelerationStructureTrianglesOpacityMicromapEXT</code> is included in
the <code>pNext</code> chain of a
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure, that
geometry will reference that micromap.</p>
</div>
<div class="paragraph">
<p>For each triangle in the geometry, the acceleration structure build fetches
an index from <code>indexBuffer</code> using <code>indexType</code> and <code>indexStride</code>.
If that value is the unsigned cast of one of the values from
<a href="#VkOpacityMicromapSpecialIndexEXT">VkOpacityMicromapSpecialIndexEXT</a> then that triangle behaves as
described for that special value in <a href="raytraversal.html#ray-opacity-micromap" class="xref page">Ray OpacityMicromap</a>.
Otherwise that triangle uses the opacity micromap information from
<code>micromap</code> at that index plus <code>baseTriangle</code>.</p>
</div>
<div class="paragraph">
<p>Only one of <code>pUsageCounts</code> or <code>ppUsageCounts</code> <strong>can</strong> be a valid
pointer, the other <strong>must</strong> be <code>NULL</code>.
The elements of the non-<code>NULL</code> array describe the total count used to build
this geometry.
For a given <code>format</code> and <code>subdivisionLevel</code> the number of triangles
in this geometry matching those values after indirection and special index
handling <strong>must</strong> be equal to the sum of matching <code>count</code> provided.</p>
</div>
<div class="paragraph">
<p>If <code>micromap</code> is <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, then every value read from
<code>indexBuffer</code> <strong>must</strong> be one of the values in
<code>VkOpacityMicromapSpecialIndexEXT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-07335" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-07335"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-07335</span><br>

Only one of <code>pUsageCounts</code> or <code>ppUsageCounts</code> <strong>can</strong> be a valid
pointer, the other <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-sType-sType" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_TRIANGLES_OPACITY_MICROMAP_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-parameter" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-parameter</span><br>
 <code>indexType</code> <strong>must</strong> be a valid <a href="drawing.html#VkIndexType" class="xref page">VkIndexType</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-parameter" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-parameter</span><br>
 If <code>usageCountsCount</code> is not <code>0</code>, and <code>pUsageCounts</code> is not <code>NULL</code>, <code>pUsageCounts</code> <strong>must</strong> be a valid pointer to an array of <code>usageCountsCount</code> <a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-ppUsageCounts-parameter" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-ppUsageCounts-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-ppUsageCounts-parameter</span><br>
 If <code>usageCountsCount</code> is not <code>0</code>, and <code>ppUsageCounts</code> is not <code>NULL</code>, <code>ppUsageCounts</code> <strong>must</strong> be a valid pointer to an array of <code>usageCountsCount</code> valid pointers to <a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-micromap-parameter" href="#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-micromap-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-micromap-parameter</span><br>
 If <code>micromap</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>micromap</code> <strong>must</strong> be a valid <a href="resources.html#VkMicromapEXT" class="xref page">VkMicromapEXT</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkOpacityMicromapSpecialIndexEXT</code> enumeration is defined as:</p>
</div>
<div id="VkOpacityMicromapSpecialIndexEXT" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_EXT_opacity_micromap
typedef enum VkOpacityMicromapSpecialIndexEXT {
    VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_TRANSPARENT_EXT = -1,
    VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_OPAQUE_EXT = -2,
    VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_UNKNOWN_TRANSPARENT_EXT = -3,
    VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_UNKNOWN_OPAQUE_EXT = -4,
} VkOpacityMicromapSpecialIndexEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_TRANSPARENT_EXT</code> specifies
that the entire triangle is fully transparent.</p>
</li>
<li>
<p><code>VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_OPAQUE_EXT</code> specifies that
the entire triangle is fully opaque.</p>
</li>
<li>
<p><code>VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_UNKNOWN_TRANSPARENT_EXT</code>
specifies that the entire triangle is unknown-transparent.</p>
</li>
<li>
<p><code>VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_UNKNOWN_OPAQUE_EXT</code>
specifies that the entire triangle is unknown-opaque.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureTrianglesDisplacementMicromapNV</code> structure
is defined as:</p>
</div>
<div id="VkAccelerationStructureTrianglesDisplacementMicromapNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_displacement_micromap
typedef struct VkAccelerationStructureTrianglesDisplacementMicromapNV {
    VkStructureType                     sType;
    void*                               pNext;
    VkFormat                            displacementBiasAndScaleFormat;
    VkFormat                            displacementVectorFormat;
    VkDeviceOrHostAddressConstKHR       displacementBiasAndScaleBuffer;
    VkDeviceSize                        displacementBiasAndScaleStride;
    VkDeviceOrHostAddressConstKHR       displacementVectorBuffer;
    VkDeviceSize                        displacementVectorStride;
    VkDeviceOrHostAddressConstKHR       displacedMicromapPrimitiveFlags;
    VkDeviceSize                        displacedMicromapPrimitiveFlagsStride;
    VkIndexType                         indexType;
    VkDeviceOrHostAddressConstKHR       indexBuffer;
    VkDeviceSize                        indexStride;
    uint32_t                            baseTriangle;
    uint32_t                            usageCountsCount;
    const VkMicromapUsageEXT*           pUsageCounts;
    const VkMicromapUsageEXT* const*    ppUsageCounts;
    VkMicromapEXT                       micromap;
} VkAccelerationStructureTrianglesDisplacementMicromapNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>displacementBiasAndScaleFormat</code> is the format of displacement bias
and scale used in this displacement micromap reference.</p>
</li>
<li>
<p><code>displacementVectorFormat</code> is the format of displacement vector used
in this displacement micromap reference.</p>
</li>
<li>
<p><code>displacementBiasAndScaleBuffer</code> is the address containing the bias
and scale.</p>
</li>
<li>
<p><code>displacementBiasAndScaleStride</code> is the byte stride between bias and
scale values.</p>
</li>
<li>
<p><code>displacementVectorBuffer</code> is the address containing the
displacement vector values.</p>
</li>
<li>
<p><code>displacementVectorStride</code> is the byte stride between displacement
vector values.</p>
</li>
<li>
<p><code>displacedMicromapPrimitiveFlags</code> is the address containing the
primitive flags.</p>
</li>
<li>
<p><code>displacedMicromapPrimitiveFlagsStride</code> is the byte stride between
primitive flag values.</p>
</li>
<li>
<p><code>indexType</code> is the type of triangle indices used when indexing this
micromap.</p>
</li>
<li>
<p><code>indexBuffer</code> is the address containing the triangle indices.</p>
</li>
<li>
<p><code>indexStride</code> is the byte stride between triangle indices.</p>
</li>
<li>
<p><code>baseTriangle</code> is the base value added to the non-negative triangle
indices.</p>
</li>
<li>
<p><code>usageCountsCount</code> specifies the number of usage counts structures
that will be used to determine the size of this micromap.</p>
</li>
<li>
<p><code>pUsageCounts</code> is a pointer to an array of <a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a>
structures.</p>
</li>
<li>
<p><code>ppUsageCounts</code> is a pointer to an array of pointers to
<a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a> structures.</p>
</li>
<li>
<p><code>micromap</code> is the handle to the micromap object to include in this
geometry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>VkAccelerationStructureTrianglesDisplacementMicromapNV</code> is included
in the <code>pNext</code> chain of a
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure, that
geometry will reference that micromap.</p>
</div>
<div class="paragraph">
<p>For each triangle in the geometry, the acceleration structure build fetches
an index from <code>indexBuffer</code> using <code>indexType</code> and <code>indexStride</code>.
That triangle uses the displacement micromap information from <code>micromap</code>
at that index plus <code>baseTriangle</code>.</p>
</div>
<div class="paragraph">
<p>Only one of <code>pUsageCounts</code> or <code>ppUsageCounts</code> <strong>can</strong> be a valid
pointer, the other <strong>must</strong> be <code>NULL</code>.
The elements of the non-<code>NULL</code> array describe the total count used to build
this geometry.
For a given <code>format</code> and <code>subdivisionLevel</code> the number of triangles
in this geometry matching those values after indirection <strong>must</strong> be equal to
the sum of matching <code>count</code> provided.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-07992" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-07992"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-07992</span><br>

Only one of <code>pUsageCounts</code> or <code>ppUsageCounts</code> <strong>can</strong> be a valid
pointer, the other <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-sType-sType" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_TRIANGLES_DISPLACEMENT_MICROMAP_NV</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-parameter" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-parameter</span><br>
 <code>displacementBiasAndScaleFormat</code> <strong>must</strong> be a valid <a href="formats.html#VkFormat" class="xref page">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-parameter" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-parameter</span><br>
 <code>displacementVectorFormat</code> <strong>must</strong> be a valid <a href="formats.html#VkFormat" class="xref page">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-indexType-parameter" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-indexType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-indexType-parameter</span><br>
 <code>indexType</code> <strong>must</strong> be a valid <a href="drawing.html#VkIndexType" class="xref page">VkIndexType</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-parameter" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-parameter</span><br>
 If <code>usageCountsCount</code> is not <code>0</code>, and <code>pUsageCounts</code> is not <code>NULL</code>, <code>pUsageCounts</code> <strong>must</strong> be a valid pointer to an array of <code>usageCountsCount</code> <a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-ppUsageCounts-parameter" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-ppUsageCounts-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-ppUsageCounts-parameter</span><br>
 If <code>usageCountsCount</code> is not <code>0</code>, and <code>ppUsageCounts</code> is not <code>NULL</code>, <code>ppUsageCounts</code> <strong>must</strong> be a valid pointer to an array of <code>usageCountsCount</code> valid pointers to <a href="VK_EXT_opacity_micromap/micromaps.html#VkMicromapUsageEXT" class="xref page">VkMicromapUsageEXT</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-micromap-parameter" href="#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-micromap-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-micromap-parameter</span><br>
 If <code>micromap</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>micromap</code> <strong>must</strong> be a valid <a href="resources.html#VkMicromapEXT" class="xref page">VkMicromapEXT</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkTransformMatrixKHR</code> structure is defined as:</p>
</div>
<div id="VkTransformMatrixKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkTransformMatrixKHR {
    float    matrix[3][4];
} VkTransformMatrixKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkTransformMatrixNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
typedef VkTransformMatrixKHR VkTransformMatrixNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>matrix</code> is a 3x4 row-major affine transformation matrix.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkTransformMatrixKHR-matrix-03799" href="#VUID-VkTransformMatrixKHR-matrix-03799"></a> <span class="vuid">VUID-VkTransformMatrixKHR-matrix-03799</span><br>

The first three columns of <code>matrix</code> <strong>must</strong> define an invertible 3x3
matrix</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryAabbsDataKHR</code> structure is defined
as:</p>
</div>
<div id="VkAccelerationStructureGeometryAabbsDataKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureGeometryAabbsDataKHR {
    VkStructureType                  sType;
    const void*                      pNext;
    VkDeviceOrHostAddressConstKHR    data;
    VkDeviceSize                     stride;
} VkAccelerationStructureGeometryAabbsDataKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>data</code> is a device or host address to memory containing
<a href="#VkAabbPositionsKHR">VkAabbPositionsKHR</a> structures containing position data for each
axis-aligned bounding box in the geometry.</p>
</li>
<li>
<p><code>stride</code> is the stride in bytes between each entry in <code>data</code>.
The stride <strong>must</strong> be a multiple of <code>8</code>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03545" href="#VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03545"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03545</span><br>

<code>stride</code> <strong>must</strong> be a multiple of <code>8</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03820" href="#VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03820"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03820</span><br>

<code>stride</code> <strong>must</strong> be less than or equal to <span class="eq">2<sup>32</sup>-1</span></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryAabbsDataKHR-sType-sType" href="#VUID-VkAccelerationStructureGeometryAabbsDataKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryAabbsDataKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_AABBS_DATA_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryAabbsDataKHR-pNext-pNext" href="#VUID-VkAccelerationStructureGeometryAabbsDataKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryAabbsDataKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAabbPositionsKHR</code> structure is defined as:</p>
</div>
<div id="VkAabbPositionsKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAabbPositionsKHR {
    float    minX;
    float    minY;
    float    minZ;
    float    maxX;
    float    maxY;
    float    maxZ;
} VkAabbPositionsKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkAabbPositionsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
typedef VkAabbPositionsKHR VkAabbPositionsNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>minX</code> is the x position of one opposing corner of a bounding box.</p>
</li>
<li>
<p><code>minY</code> is the y position of one opposing corner of a bounding box.</p>
</li>
<li>
<p><code>minZ</code> is the z position of one opposing corner of a bounding box.</p>
</li>
<li>
<p><code>maxX</code> is the x position of the other opposing corner of a bounding
box.</p>
</li>
<li>
<p><code>maxY</code> is the y position of the other opposing corner of a bounding
box.</p>
</li>
<li>
<p><code>maxZ</code> is the z position of the other opposing corner of a bounding
box.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAabbPositionsKHR-minX-03546" href="#VUID-VkAabbPositionsKHR-minX-03546"></a> <span class="vuid">VUID-VkAabbPositionsKHR-minX-03546</span><br>

<code>minX</code> <strong>must</strong> be less than or equal to <code>maxX</code></p>
</li>
<li>
<p><a id="VUID-VkAabbPositionsKHR-minY-03547" href="#VUID-VkAabbPositionsKHR-minY-03547"></a> <span class="vuid">VUID-VkAabbPositionsKHR-minY-03547</span><br>

<code>minY</code> <strong>must</strong> be less than or equal to <code>maxY</code></p>
</li>
<li>
<p><a id="VUID-VkAabbPositionsKHR-minZ-03548" href="#VUID-VkAabbPositionsKHR-minZ-03548"></a> <span class="vuid">VUID-VkAabbPositionsKHR-minZ-03548</span><br>

<code>minZ</code> <strong>must</strong> be less than or equal to <code>maxZ</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryInstancesDataKHR</code> structure is
defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryInstancesDataKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureGeometryInstancesDataKHR {
    VkStructureType                  sType;
    const void*                      pNext;
    VkBool32                         arrayOfPointers;
    VkDeviceOrHostAddressConstKHR    data;
} VkAccelerationStructureGeometryInstancesDataKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>arrayOfPointers</code> specifies whether <code>data</code> is used as an array
of addresses or just an array.</p>
</li>
<li>
<p><code>data</code> is either the address of an array of device or host addresses
referencing individual <a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>
structures
or packed motion instance information as described in
<a href="#acceleration-structure-motion-instances">motion instances</a>
if <code>arrayOfPointers</code> is <code>VK_TRUE</code>, or the address of an array of
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>
or <a href="#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a>
structures.
Addresses and <a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a> structures are
tightly packed.
<a href="#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a> structures have a stride
of 160 bytes.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryInstancesDataKHR-sType-sType" href="#VUID-VkAccelerationStructureGeometryInstancesDataKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryInstancesDataKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_INSTANCES_DATA_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryInstancesDataKHR-pNext-pNext" href="#VUID-VkAccelerationStructureGeometryInstancesDataKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryInstancesDataKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><em>Acceleration structure instances</em> <strong>can</strong> be built into top-level acceleration
structures.
Each acceleration structure instance is a separate entry in the top-level
acceleration structure which includes all the geometry of a bottom-level
acceleration structure at a transformed location.
Multiple instances <strong>can</strong> point to the same bottom level acceleration
structure.</p>
</div>
<div class="paragraph">
<p>An acceleration structure instance is defined by the structure:</p>
</div>
<div id="VkAccelerationStructureInstanceKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureInstanceKHR {
    VkTransformMatrixKHR          transform;
    uint32_t                      instanceCustomIndex:24;
    uint32_t                      mask:8;
    uint32_t                      instanceShaderBindingTableRecordOffset:24;
    VkGeometryInstanceFlagsKHR    flags:8;
    uint64_t                      accelerationStructureReference;
} VkAccelerationStructureInstanceKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkAccelerationStructureInstanceNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
typedef VkAccelerationStructureInstanceKHR VkAccelerationStructureInstanceNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>transform</code> is a <a href="#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure describing a
transformation to be applied to the acceleration structure.</p>
</li>
<li>
<p><code>instanceCustomIndex</code> is a 24-bit user-specified index value
accessible to ray shaders in the <code>InstanceCustomIndexKHR</code> built-in.</p>
</li>
<li>
<p><code>mask</code> is an 8-bit visibility mask for the geometry.
The instance <strong>may</strong> only be hit if <code>Cull Mask &amp; instance.mask != 0</code></p>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> is a 24-bit offset used in
calculating the hit shader binding table index.</p>
</li>
<li>
<p><code>flags</code> is an 8-bit mask of <a href="#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a>
values to apply to this instance.</p>
</li>
<li>
<p><code>accelerationStructureReference</code> is either:</p>
<div class="ulist">
<ul>
<li>
<p>a device address containing the value obtained from
<a href="resources.html#vkGetAccelerationStructureDeviceAddressKHR" class="xref page">vkGetAccelerationStructureDeviceAddressKHR</a>
or
<a href="resources.html#vkGetAccelerationStructureHandleNV" class="xref page">vkGetAccelerationStructureHandleNV</a>
     (used by device operations which reference acceleration structures) or,</p>
</li>
<li>
<p>a <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> object (used by host operations
which reference acceleration structures).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this struct produces the correct layout with existing
compilers.
The intended bit pattern is for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> and <code>mask</code> occupy the same memory as if a
single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> occupies the 24 least significant bits of
that memory</p>
</li>
<li>
<p><code>mask</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> and <code>flags</code> occupy the
same memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> occupies the 24 least
significant bits of that memory</p>
</li>
<li>
<p><code>flags</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong>must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureInstanceKHR-flags-parameter" href="#VUID-VkAccelerationStructureInstanceKHR-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureInstanceKHR-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Possible values of <code>flags</code> in the instance modifying the behavior of
that instance are:</p>
</div>
<div id="VkGeometryInstanceFlagBitsKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef enum VkGeometryInstanceFlagBitsKHR {
    VK_GEOMETRY_INSTANCE_TRIANGLE_FACING_CULL_DISABLE_BIT_KHR = 0x00000001,
    VK_GEOMETRY_INSTANCE_TRIANGLE_FLIP_FACING_BIT_KHR = 0x00000002,
    VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_KHR = 0x00000004,
    VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_KHR = 0x00000008,
  // Provided by VK_EXT_opacity_micromap
    VK_GEOMETRY_INSTANCE_FORCE_OPACITY_MICROMAP_2_STATE_EXT = 0x00000010,
  // Provided by VK_EXT_opacity_micromap
    VK_GEOMETRY_INSTANCE_DISABLE_OPACITY_MICROMAPS_EXT = 0x00000020,
    VK_GEOMETRY_INSTANCE_TRIANGLE_FRONT_COUNTERCLOCKWISE_BIT_KHR = VK_GEOMETRY_INSTANCE_TRIANGLE_FLIP_FACING_BIT_KHR,
  // Provided by VK_NV_ray_tracing
    VK_GEOMETRY_INSTANCE_TRIANGLE_CULL_DISABLE_BIT_NV = VK_GEOMETRY_INSTANCE_TRIANGLE_FACING_CULL_DISABLE_BIT_KHR,
  // Provided by VK_NV_ray_tracing
    VK_GEOMETRY_INSTANCE_TRIANGLE_FRONT_COUNTERCLOCKWISE_BIT_NV = VK_GEOMETRY_INSTANCE_TRIANGLE_FRONT_COUNTERCLOCKWISE_BIT_KHR,
  // Provided by VK_NV_ray_tracing
    VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_NV = VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_KHR,
  // Provided by VK_NV_ray_tracing
    VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_NV = VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_KHR,
} VkGeometryInstanceFlagBitsKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkGeometryInstanceFlagBitsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
typedef VkGeometryInstanceFlagBitsKHR VkGeometryInstanceFlagBitsNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_GEOMETRY_INSTANCE_TRIANGLE_FACING_CULL_DISABLE_BIT_KHR</code> disables
face culling for this instance.</p>
</li>
<li>
<p><code>VK_GEOMETRY_INSTANCE_TRIANGLE_FLIP_FACING_BIT_KHR</code> indicates that
the <a href="raytraversal.html#ray-traversal-culling-face" class="xref page">facing determination</a> for geometry in
this instance is inverted.
Because the facing is determined in object space, an instance transform
does not change the winding, but a geometry transform does.</p>
</li>
<li>
<p><code>VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_KHR</code> causes this instance to
act as though <code>VK_GEOMETRY_OPAQUE_BIT_KHR</code> were specified on all
geometries referenced by this instance.
This behavior <strong>can</strong> be overridden by the SPIR-V <code>NoOpaqueKHR</code> ray
flag.</p>
</li>
<li>
<p><code>VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_KHR</code> causes this instance
to act as though <code>VK_GEOMETRY_OPAQUE_BIT_KHR</code> were not specified on
all geometries referenced by this instance.
This behavior <strong>can</strong> be overridden by the SPIR-V <code>OpaqueKHR</code> ray flag.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_KHR</code> and
<code>VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_KHR</code> <strong>must</strong> not be used in the
same flag.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkGeometryInstanceFlagsKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef VkFlags VkGeometryInstanceFlagsKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkGeometryInstanceFlagsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
typedef VkGeometryInstanceFlagsKHR VkGeometryInstanceFlagsNV;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkGeometryInstanceFlagsKHR</code> is a bitmask type for setting a mask of
zero or more <a href="#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><em>Acceleration structure motion instances</em> <strong>can</strong> be built into top-level
acceleration structures.
Each acceleration structure instance is a separate entry in the top-level
acceleration structure which includes all the geometry of a bottom-level
acceleration structure at a transformed location including a type of motion
and parameters to determine the motion of the instance over time.</p>
</div>
<div class="paragraph">
<p>An acceleration structure motion instance is defined by the structure:</p>
</div>
<div id="VkAccelerationStructureMotionInstanceNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef struct VkAccelerationStructureMotionInstanceNV {
    VkAccelerationStructureMotionInstanceTypeNV     type;
    VkAccelerationStructureMotionInstanceFlagsNV    flags;
    VkAccelerationStructureMotionInstanceDataNV     data;
} VkAccelerationStructureMotionInstanceNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>type</code> is a <a href="#VkAccelerationStructureMotionInstanceTypeNV">VkAccelerationStructureMotionInstanceTypeNV</a>
enumerant identifying which type of motion instance this is and which
type of the union is valid.</p>
</li>
<li>
<p><code>flags</code> is currently unused, but is required to keep natural
alignment of <code>data</code>.</p>
</li>
<li>
<p><code>data</code> is a <a href="#VkAccelerationStructureMotionInstanceDataNV">VkAccelerationStructureMotionInstanceDataNV</a>
containing motion instance data for this instance.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>If writing this other than with a standard C compiler, note that the final
structure should be 152 bytes in size.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-type-parameter" href="#VUID-VkAccelerationStructureMotionInstanceNV-type-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-type-parameter</span><br>
 <code>type</code> <strong>must</strong> be a valid <a href="#VkAccelerationStructureMotionInstanceTypeNV">VkAccelerationStructureMotionInstanceTypeNV</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-flags-zerobitmask" href="#VUID-VkAccelerationStructureMotionInstanceNV-flags-zerobitmask"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-flags-zerobitmask</span><br>
 <code>flags</code> <strong>must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-staticInstance-parameter" href="#VUID-VkAccelerationStructureMotionInstanceNV-staticInstance-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-staticInstance-parameter</span><br>
 If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_STATIC_NV</code>, the <code>staticInstance</code> member of <code>data</code> <strong>must</strong> be a valid <a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-matrixMotionInstance-parameter" href="#VUID-VkAccelerationStructureMotionInstanceNV-matrixMotionInstance-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-matrixMotionInstance-parameter</span><br>
 If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_MATRIX_MOTION_NV</code>, the <code>matrixMotionInstance</code> member of <code>data</code> <strong>must</strong> be a valid <a href="#VkAccelerationStructureMatrixMotionInstanceNV">VkAccelerationStructureMatrixMotionInstanceNV</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-srtMotionInstance-parameter" href="#VUID-VkAccelerationStructureMotionInstanceNV-srtMotionInstance-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-srtMotionInstance-parameter</span><br>
 If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_SRT_MOTION_NV</code>, the <code>srtMotionInstance</code> member of <code>data</code> <strong>must</strong> be a valid <a href="#VkAccelerationStructureSRTMotionInstanceNV">VkAccelerationStructureSRTMotionInstanceNV</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Acceleration structure motion instance is defined by the union:</p>
</div>
<div id="VkAccelerationStructureMotionInstanceDataNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef union VkAccelerationStructureMotionInstanceDataNV {
    VkAccelerationStructureInstanceKHR               staticInstance;
    VkAccelerationStructureMatrixMotionInstanceNV    matrixMotionInstance;
    VkAccelerationStructureSRTMotionInstanceNV       srtMotionInstance;
} VkAccelerationStructureMotionInstanceDataNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>staticInstance</code> is a <a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>
structure containing data for a static instance.</p>
</li>
<li>
<p><code>matrixMotionInstance</code> is a
<a href="#VkAccelerationStructureMatrixMotionInstanceNV">VkAccelerationStructureMatrixMotionInstanceNV</a> structure containing
data for a matrix motion instance.</p>
</li>
<li>
<p><code>srtMotionInstance</code> is a
<a href="#VkAccelerationStructureSRTMotionInstanceNV">VkAccelerationStructureSRTMotionInstanceNV</a> structure containing
data for an SRT motion instance.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkAccelerationStructureMotionInstanceFlagsNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef VkFlags VkAccelerationStructureMotionInstanceFlagsNV;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkAccelerationStructureMotionInstanceFlagsNV</code> is a bitmask type for
setting a mask, but is currently reserved for future use.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureMotionInstanceTypeNV</code> enumeration is defined
as:</p>
</div>
<div id="VkAccelerationStructureMotionInstanceTypeNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef enum VkAccelerationStructureMotionInstanceTypeNV {
    VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_STATIC_NV = 0,
    VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_MATRIX_MOTION_NV = 1,
    VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_SRT_MOTION_NV = 2,
} VkAccelerationStructureMotionInstanceTypeNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_STATIC_NV</code> specifies
that the instance is a static instance with no instance motion.</p>
</li>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_MATRIX_MOTION_NV</code>
specifies that the instance is a motion instance with motion specified
by interpolation between two matrices.</p>
</li>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_SRT_MOTION_NV</code>
specifies that the instance is a motion instance with motion specified
by interpolation in the SRT decomposition.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>An acceleration structure matrix motion instance is defined by the
structure:</p>
</div>
<div id="VkAccelerationStructureMatrixMotionInstanceNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef struct VkAccelerationStructureMatrixMotionInstanceNV {
    VkTransformMatrixKHR          transformT0;
    VkTransformMatrixKHR          transformT1;
    uint32_t                      instanceCustomIndex:24;
    uint32_t                      mask:8;
    uint32_t                      instanceShaderBindingTableRecordOffset:24;
    VkGeometryInstanceFlagsKHR    flags:8;
    uint64_t                      accelerationStructureReference;
} VkAccelerationStructureMatrixMotionInstanceNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>transformT0</code> is a <a href="#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure describing a
transformation to be applied to the acceleration structure at time 0.</p>
</li>
<li>
<p><code>transformT1</code> is a <a href="#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure describing a
transformation to be applied to the acceleration structure at time 1.</p>
</li>
<li>
<p><code>instanceCustomIndex</code> is a 24-bit user-specified index value
accessible to ray shaders in the <code>InstanceCustomIndexKHR</code> built-in.</p>
</li>
<li>
<p><code>mask</code> is an 8-bit visibility mask for the geometry.
The instance <strong>may</strong> only be hit if <code>Cull Mask &amp; instance.mask != 0</code></p>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> is a 24-bit offset used in
calculating the hit shader binding table index.</p>
</li>
<li>
<p><code>flags</code> is an 8-bit mask of <a href="#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a>
values to apply to this instance.</p>
</li>
<li>
<p><code>accelerationStructureReference</code> is either:</p>
<div class="ulist">
<ul>
<li>
<p>a device address containing the value obtained from
<a href="resources.html#vkGetAccelerationStructureDeviceAddressKHR" class="xref page">vkGetAccelerationStructureDeviceAddressKHR</a>
or
<a href="resources.html#vkGetAccelerationStructureHandleNV" class="xref page">vkGetAccelerationStructureHandleNV</a>
     (used by device operations which reference acceleration structures) or,</p>
</li>
<li>
<p>a <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> object (used by host operations
which reference acceleration structures).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this struct produces the correct layout with existing
compilers.
The intended bit pattern is for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> and <code>mask</code> occupy the same memory as if a
single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> occupies the 24 least significant bits of
that memory</p>
</li>
<li>
<p><code>mask</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> and <code>flags</code> occupy the
same memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> occupies the 24 least
significant bits of that memory</p>
</li>
<li>
<p><code>flags</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong>must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="paragraph">
<p>The transform for a matrix motion instance at a point in time is derived by
component-wise linear interpolation of the two transforms.
That is, for a <code>time</code> in [0,1] the resulting transform is</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>transformT0</code> × (1 - <code>time</code>) + 
<code>transformT1</code> × <code>time</code></span></p>
</dd>
</dl>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureMatrixMotionInstanceNV-flags-parameter" href="#VUID-VkAccelerationStructureMatrixMotionInstanceNV-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMatrixMotionInstanceNV-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>An acceleration structure SRT motion instance is defined by the structure:</p>
</div>
<div id="VkAccelerationStructureSRTMotionInstanceNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef struct VkAccelerationStructureSRTMotionInstanceNV {
    VkSRTDataNV                   transformT0;
    VkSRTDataNV                   transformT1;
    uint32_t                      instanceCustomIndex:24;
    uint32_t                      mask:8;
    uint32_t                      instanceShaderBindingTableRecordOffset:24;
    VkGeometryInstanceFlagsKHR    flags:8;
    uint64_t                      accelerationStructureReference;
} VkAccelerationStructureSRTMotionInstanceNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>transformT0</code> is a <a href="#VkSRTDataNV">VkSRTDataNV</a> structure describing a
transformation to be applied to the acceleration structure at time 0.</p>
</li>
<li>
<p><code>transformT1</code> is a <a href="#VkSRTDataNV">VkSRTDataNV</a> structure describing a
transformation to be applied to the acceleration structure at time 1.</p>
</li>
<li>
<p><code>instanceCustomIndex</code> is a 24-bit user-specified index value
accessible to ray shaders in the <code>InstanceCustomIndexKHR</code> built-in.</p>
</li>
<li>
<p><code>mask</code> is an 8-bit visibility mask for the geometry.
The instance <strong>may</strong> only be hit if <code>Cull Mask &amp; instance.mask != 0</code></p>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> is a 24-bit offset used in
calculating the hit shader binding table index.</p>
</li>
<li>
<p><code>flags</code> is an 8-bit mask of <a href="#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a>
values to apply to this instance.</p>
</li>
<li>
<p><code>accelerationStructureReference</code> is either:</p>
<div class="ulist">
<ul>
<li>
<p>a device address containing the value obtained from
<a href="resources.html#vkGetAccelerationStructureDeviceAddressKHR" class="xref page">vkGetAccelerationStructureDeviceAddressKHR</a>
or
<a href="resources.html#vkGetAccelerationStructureHandleNV" class="xref page">vkGetAccelerationStructureHandleNV</a>
     (used by device operations which reference acceleration structures) or,</p>
</li>
<li>
<p>a <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> object (used by host operations
which reference acceleration structures).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this struct produces the correct layout with existing
compilers.
The intended bit pattern is for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> and <code>mask</code> occupy the same memory as if a
single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> occupies the 24 least significant bits of
that memory</p>
</li>
<li>
<p><code>mask</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> and <code>flags</code> occupy the
same memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> occupies the 24 least
significant bits of that memory</p>
</li>
<li>
<p><code>flags</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong>must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="paragraph">
<p>The transform for a SRT motion instance at a point in time is derived from
component-wise linear interpolation of the two SRT transforms.
That is, for a <code>time</code> in [0,1] the resulting transform is</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>transformT0</code> × (1 - <code>time</code>) + 
<code>transformT1</code> × <code>time</code></span></p>
</dd>
</dl>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureSRTMotionInstanceNV-flags-parameter" href="#VUID-VkAccelerationStructureSRTMotionInstanceNV-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureSRTMotionInstanceNV-flags-parameter</span><br>
 <code>flags</code> <strong>must</strong> be a valid combination of <a href="#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>An acceleration structure SRT transform is defined by the structure:</p>
</div>
<div id="VkSRTDataNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing_motion_blur
typedef struct VkSRTDataNV {
    float    sx;
    float    a;
    float    b;
    float    pvx;
    float    sy;
    float    c;
    float    pvy;
    float    sz;
    float    pvz;
    float    qx;
    float    qy;
    float    qz;
    float    qw;
    float    tx;
    float    ty;
    float    tz;
} VkSRTDataNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sx</code> is the x component of the scale of the transform</p>
</li>
<li>
<p><code>a</code> is one component of the shear for the transform</p>
</li>
<li>
<p><code>b</code> is one component of the shear for the transform</p>
</li>
<li>
<p><code>pvx</code> is the x component of the pivot point of the transform</p>
</li>
<li>
<p><code>sy</code> is the y component of the scale of the transform</p>
</li>
<li>
<p><code>c</code> is one component of the shear for the transform</p>
</li>
<li>
<p><code>pvy</code> is the y component of the pivot point of the transform</p>
</li>
<li>
<p><code>sz</code> is the z component of the scale of the transform</p>
</li>
<li>
<p><code>pvz</code> is the z component of the pivot point of the transform</p>
</li>
<li>
<p><code>qx</code> is the x component of the rotation quaternion</p>
</li>
<li>
<p><code>qy</code> is the y component of the rotation quaternion</p>
</li>
<li>
<p><code>qz</code> is the z component of the rotation quaternion</p>
</li>
<li>
<p><code>qw</code> is the w component of the rotation quaternion</p>
</li>
<li>
<p><code>tx</code> is the x component of the post-rotation translation</p>
</li>
<li>
<p><code>ty</code> is the y component of the post-rotation translation</p>
</li>
<li>
<p><code>tz</code> is the z component of the post-rotation translation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This transform decomposition consists of three elements.
The first is a matrix S, consisting of a scale, shear, and translation,
usually used to define the pivot point of the following rotation.
This matrix is constructed from the parameters above by:</p>
</div>
<div class="stemblock">
  <div class="content halign-center valign-middle" style="padding-top: 1rem">
<svg style="vertical-align: -3.733ex; overflow: visible;" xmlns="http://www.w3.org/2000/svg" width="25.39ex" height="8.597ex" role="img" focusable="false" viewBox="0 -2150 11222.6 3800"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D446" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path></g><g data-mml-node="mo" transform="translate(922.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mrow" transform="translate(1978.6,0)"><g data-mml-node="mo"><path data-c="239B" d="M837 1154Q843 1148 843 1145Q843 1141 818 1106T753 1002T667 841T574 604T494 299Q417 -84 417 -609Q417 -641 416 -647T411 -654Q409 -655 366 -655Q299 -655 297 -654Q292 -652 292 -643T291 -583Q293 -400 304 -242T347 110T432 470T574 813T785 1136Q787 1139 790 1142T794 1147T796 1150T799 1152T802 1153T807 1154T813 1154H819H837Z" transform="translate(0,996)"></path><path data-c="239D" d="M843 -635Q843 -638 837 -644H820Q801 -644 800 -643Q792 -635 785 -626Q684 -503 605 -363T473 -75T385 216T330 518T302 809T291 1093Q291 1144 291 1153T296 1164Q298 1165 366 1165Q409 1165 411 1164Q415 1163 416 1157T417 1119Q417 529 517 109T833 -617Q843 -631 843 -635Z" transform="translate(0,-1006)"></path><svg width="875" height="382" y="59" x="0" viewBox="0 86.3 875 382"><path data-c="239C" d="M413 -9Q412 -9 407 -9T388 -10T354 -10Q300 -10 297 -9Q294 -8 293 -5Q291 5 291 127V300Q291 602 292 605L296 609Q298 610 366 610Q382 610 392 610T407 610T412 609Q416 609 416 592T417 473V127Q417 -9 413 -9Z" transform="scale(1,0.924)"></path></svg></g><g data-mml-node="mtable" transform="translate(875,0)"><g data-mml-node="mtr" transform="translate(0,1400)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g><g data-mml-node="mtd" transform="translate(2256,0)"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g></g><g data-mml-node="mtd" transform="translate(4252.5,0)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g></g><g data-mml-node="mtd" transform="translate(5934,0)"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mi" transform="translate(988,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g></g><g data-mml-node="mtr"><g data-mml-node="mtd" transform="translate(270.5,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(2041,0)"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mtd" transform="translate(4250.5,0)"><g data-mml-node="mi"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g></g><g data-mml-node="mtd" transform="translate(5975,0)"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mi" transform="translate(988,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-1400)"><g data-mml-node="mtd" transform="translate(270.5,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(2270.5,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(4000,0)"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g></g><g data-mml-node="mtd" transform="translate(5987.5,0)"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mi" transform="translate(988,0)"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(8369,0)"><path data-c="239E" d="M31 1143Q31 1154 49 1154H59Q72 1154 75 1152T89 1136Q190 1013 269 873T401 585T489 294T544 -8T572 -299T583 -583Q583 -634 583 -643T577 -654Q575 -655 508 -655Q465 -655 463 -654Q459 -653 458 -647T457 -609Q457 -58 371 340T100 1037Q87 1059 61 1098T31 1143Z" transform="translate(0,996)"></path><path data-c="23A0" d="M56 -644H50Q31 -644 31 -635Q31 -632 37 -622Q69 -579 100 -527Q286 -228 371 170T457 1119Q457 1161 462 1164Q464 1165 520 1165Q575 1165 577 1164Q582 1162 582 1153T583 1093Q581 910 570 752T527 400T442 40T300 -303T89 -626Q78 -640 75 -642T61 -644H56Z" transform="translate(0,-1006)"></path><svg width="875" height="382" y="59" x="0" viewBox="0 86.3 875 382"><path data-c="239F" d="M579 -9Q578 -9 573 -9T554 -10T520 -10Q466 -10 463 -9Q460 -8 459 -5Q457 5 457 127V300Q457 602 458 605L462 609Q464 610 532 610Q548 610 558 610T573 610T578 609Q582 609 582 592T583 473V127Q583 -9 579 -9Z" transform="scale(1,0.924)"></path></svg></g></g></g></g></svg>
  </div>
</div>
<div class="paragraph">
<p>The rotation quaternion is defined as:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>R</code> = [ <code>qx</code>, <code>qy</code>, <code>qz</code>, <code>qw</code> ]</span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This is a rotation around a conceptual normalized axis <span class="eq">[ ax, ay, az ]</span>
of amount <code>theta</code> such that:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq">[ <code>qx</code>, <code>qy</code>, <code>qz</code> ] = sin(<code>theta</code>/2)
× [ <code>ax</code>, <code>ay</code>, <code>az</code> ]</span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>qw</code> = cos(<code>theta</code>/2)</span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Finally, the transform has a translation T constructed from the parameters
above by:</p>
</div>
<div class="stemblock">
  <div class="content halign-center valign-middle" style="padding-top: 1rem">
<svg style="vertical-align: -3.733ex; overflow: visible;" xmlns="http://www.w3.org/2000/svg" width="20.861ex" height="8.597ex" role="img" focusable="false" viewBox="0 -2150 9220.6 3800"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mo" transform="translate(981.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mrow" transform="translate(2037.6,0)"><g data-mml-node="mo"><path data-c="239B" d="M837 1154Q843 1148 843 1145Q843 1141 818 1106T753 1002T667 841T574 604T494 299Q417 -84 417 -609Q417 -641 416 -647T411 -654Q409 -655 366 -655Q299 -655 297 -654Q292 -652 292 -643T291 -583Q293 -400 304 -242T347 110T432 470T574 813T785 1136Q787 1139 790 1142T794 1147T796 1150T799 1152T802 1153T807 1154T813 1154H819H837Z" transform="translate(0,996)"></path><path data-c="239D" d="M843 -635Q843 -638 837 -644H820Q801 -644 800 -643Q792 -635 785 -626Q684 -503 605 -363T473 -75T385 216T330 518T302 809T291 1093Q291 1144 291 1153T296 1164Q298 1165 366 1165Q409 1165 411 1164Q415 1163 416 1157T417 1119Q417 529 517 109T833 -617Q843 -631 843 -635Z" transform="translate(0,-1006)"></path><svg width="875" height="382" y="59" x="0" viewBox="0 86.3 875 382"><path data-c="239C" d="M413 -9Q412 -9 407 -9T388 -10T354 -10Q300 -10 297 -9Q294 -8 293 -5Q291 5 291 127V300Q291 602 292 605L296 609Q298 610 366 610Q382 610 392 610T407 610T412 609Q416 609 416 592T417 473V127Q417 -9 413 -9Z" transform="scale(1,0.924)"></path></svg></g><g data-mml-node="mtable" transform="translate(875,0)"><g data-mml-node="mtr" transform="translate(0,1400)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(4500,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(361,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g></g><g data-mml-node="mtr"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(4541,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(361,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-1400)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(4553.5,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(361,0)"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(6308,0)"><path data-c="239E" d="M31 1143Q31 1154 49 1154H59Q72 1154 75 1152T89 1136Q190 1013 269 873T401 585T489 294T544 -8T572 -299T583 -583Q583 -634 583 -643T577 -654Q575 -655 508 -655Q465 -655 463 -654Q459 -653 458 -647T457 -609Q457 -58 371 340T100 1037Q87 1059 61 1098T31 1143Z" transform="translate(0,996)"></path><path data-c="23A0" d="M56 -644H50Q31 -644 31 -635Q31 -632 37 -622Q69 -579 100 -527Q286 -228 371 170T457 1119Q457 1161 462 1164Q464 1165 520 1165Q575 1165 577 1164Q582 1162 582 1153T583 1093Q581 910 570 752T527 400T442 40T300 -303T89 -626Q78 -640 75 -642T61 -644H56Z" transform="translate(0,-1006)"></path><svg width="875" height="382" y="59" x="0" viewBox="0 86.3 875 382"><path data-c="239F" d="M579 -9Q578 -9 573 -9T554 -10T520 -10Q466 -10 463 -9Q460 -8 459 -5Q457 5 457 127V300Q457 602 458 605L462 609Q464 610 532 610Q548 610 558 610T573 610T578 609Q582 609 582 592T583 473V127Q583 -9 579 -9Z" transform="scale(1,0.924)"></path></svg></g></g></g></g></svg>
  </div>
</div>
<div class="paragraph">
<p>The effective derived transform is then given by</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>T</code> × <code>R</code> × <code>S</code></span></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><code>VkAccelerationStructureBuildRangeInfoKHR</code> is defined as:</p>
</div>
<div id="VkAccelerationStructureBuildRangeInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureBuildRangeInfoKHR {
    uint32_t    primitiveCount;
    uint32_t    primitiveOffset;
    uint32_t    firstVertex;
    uint32_t    transformOffset;
} VkAccelerationStructureBuildRangeInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>primitiveCount</code> defines the number of primitives for a
corresponding acceleration structure geometry.</p>
</li>
<li>
<p><code>primitiveOffset</code> defines an offset in bytes into the memory where
primitive data is defined.</p>
</li>
<li>
<p><code>firstVertex</code> is the index of the first vertex to build from for
triangle geometry.</p>
</li>
<li>
<p><code>transformOffset</code> defines an offset in bytes into the memory where a
transform matrix is defined.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The primitive count and primitive offset are interpreted differently
depending on the <a href="resources.html#VkGeometryTypeKHR" class="xref page">VkGeometryTypeKHR</a> used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For geometries of type <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>primitiveCount</code> is the number of triangles to be built, where each
triangle is treated as 3 vertices.</p>
<div class="ulist">
<ul>
<li>
<p>If the geometry uses indices, <span class="eq"><code>primitiveCount</code> × 3</span>
indices are consumed from
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>indexData</code>,
starting at an offset of <code>primitiveOffset</code>.
The value of <code>firstVertex</code> is added to the index values before
fetching vertices.</p>
</li>
<li>
<p>If the geometry does not use indices, <span class="eq"><code>primitiveCount</code> ×
3</span> vertices are consumed from
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexData</code>,
starting at an offset of <span class="eq"><code>primitiveOffset</code> + 
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexStride</code>
× <code>firstVertex</code></span>.</p>
</li>
<li>
<p>If
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>transformData</code>
is not <code>NULL</code>, a single <a href="#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure is
consumed from
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>transformData</code>,
at an offset of <code>transformOffset</code>.
This matrix describes a transformation from the space in which the
vertices for all triangles in this geometry are described to the space
in which the acceleration structure is defined.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For geometries of type <code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>primitiveCount</code> is the number of axis-aligned bounding boxes.
<code>primitiveCount</code> <a href="#VkAabbPositionsKHR">VkAabbPositionsKHR</a> structures are consumed
from <a href="#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a>::<code>data</code>,
starting at an offset of <code>primitiveOffset</code>.</p>
</li>
<li>
<p>For geometries of type <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>,
<code>primitiveCount</code> is the number of acceleration structures.
<code>primitiveCount</code> <a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>
or <a href="#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a>
structures are consumed from
<a href="#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>data</code>,
starting at an offset of <code>primitiveOffset</code>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03656" href="#VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03656"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03656</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if the
geometry uses indices, the offset <code>primitiveOffset</code> from
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>indexData</code>
<strong>must</strong> be a multiple of the element size of
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>indexType</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03657" href="#VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03657"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03657</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if the
geometry does not use indices, the offset <code>primitiveOffset</code> from
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexData</code>
<strong>must</strong> be a multiple of the component size of
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexFormat</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-transformOffset-03658" href="#VUID-VkAccelerationStructureBuildRangeInfoKHR-transformOffset-03658"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-transformOffset-03658</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, the offset
<code>transformOffset</code> from
<a href="#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>transformData</code>
<strong>must</strong> be a multiple of 16</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03659" href="#VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03659"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03659</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, the offset
<code>primitiveOffset</code> from
<a href="#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a>::<code>data</code> <strong>must</strong> be a
multiple of 8</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03660" href="#VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03660"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03660</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the offset
<code>primitiveOffset</code> from
<a href="#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>data</code> <strong>must</strong>
be a multiple of 16</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-copying"><a class="anchor" href="#acceleration-structure-copying"></a>Copying Acceleration Structures</h3>
<div class="paragraph">
<p>An additional command exists for copying acceleration structures without
updating their contents.
The acceleration structure object <strong>can</strong> be compacted in order to improve
performance.
Before copying, an application <strong>must</strong> query the size of the resulting
acceleration structure.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query acceleration structure size parameters call:</p>
</div>
<div id="vkCmdWriteAccelerationStructuresPropertiesKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
void vkCmdWriteAccelerationStructuresPropertiesKHR(
    VkCommandBuffer                             commandBuffer,
    uint32_t                                    accelerationStructureCount,
    const VkAccelerationStructureKHR*           pAccelerationStructures,
    VkQueryType                                 queryType,
    VkQueryPool                                 queryPool,
    uint32_t                                    firstQuery);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>accelerationStructureCount</code> is the count of acceleration structures
for which to query the property.</p>
</li>
<li>
<p><code>pAccelerationStructures</code> is a pointer to an array of existing
previously built acceleration structures.</p>
</li>
<li>
<p><code>queryType</code> is a <a href="queries.html#VkQueryType" class="xref page">VkQueryType</a> value specifying the type of
queries managed by the pool.</p>
</li>
<li>
<p><code>queryPool</code> is the query pool that will manage the results of the
query.</p>
</li>
<li>
<p><code>firstQuery</code> is the first query index within the query pool that
will contain the <code>accelerationStructureCount</code> number of results.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to any of the acceleration structures listed in
<code>pAccelerationStructures</code> <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, then the
value written out is the number of bytes required by a compacted
acceleration structure.</p>
</li>
<li>
<p>If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code>, then
the value written out is the number of bytes required by a serialized
acceleration structure.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructure-08924" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructure-08924"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructure-08924</span><br>

The <a href="features.html#features-accelerationStructure" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02493" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02493"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02493</span><br>

<code>queryPool</code> <strong>must</strong> have been created with a <code>queryType</code> matching
<code>queryType</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02494" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02494"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02494</span><br>

The queries identified by <code>queryPool</code> and <code>firstQuery</code> <strong>must</strong> be
<em>unavailable</em></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-buffer-03736" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-buffer-03736"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-buffer-03736</span><br>

The <code>buffer</code> used to create each acceleration structure in
<code>pAccelerationStructures</code> <strong>must</strong> be bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-query-04880" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-query-04880"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-query-04880</span><br>

The sum of <code>query</code> plus <code>accelerationStructureCount</code> <strong>must</strong> be
less than or equal to the number of queries in <code>queryPool</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> if
<code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-06742" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-06742"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-06742</span><br>

<code>queryType</code> <strong>must</strong> be
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SIZE_KHR</code>,
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>,
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code> or
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter</span><br>
 <code>pAccelerationStructures</code> <strong>must</strong> be a valid pointer to an array of <code>accelerationStructureCount</code> valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handles</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-parameter</span><br>
 <code>queryType</code> <strong>must</strong> be a valid <a href="queries.html#VkQueryType" class="xref page">VkQueryType</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-parameter</span><br>
 <code>queryPool</code> <strong>must</strong> be a valid <a href="queries.html#VkQueryPool" class="xref page">VkQueryPool</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-recording" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-cmdpool" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-renderpass" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-renderpass"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-videocoding" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-videocoding"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength</span><br>
 <code>accelerationStructureCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commonparent" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commonparent"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commonparent</span><br>
 Each of <code>commandBuffer</code>, <code>queryPool</code>, and the elements of <code>pAccelerationStructures</code> <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="video_extensions.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query acceleration structure size parameters call:</p>
</div>
<div id="vkCmdWriteAccelerationStructuresPropertiesNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
void vkCmdWriteAccelerationStructuresPropertiesNV(
    VkCommandBuffer                             commandBuffer,
    uint32_t                                    accelerationStructureCount,
    const VkAccelerationStructureNV*            pAccelerationStructures,
    VkQueryType                                 queryType,
    VkQueryPool                                 queryPool,
    uint32_t                                    firstQuery);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>accelerationStructureCount</code> is the count of acceleration structures
for which to query the property.</p>
</li>
<li>
<p><code>pAccelerationStructures</code> is a pointer to an array of existing
previously built acceleration structures.</p>
</li>
<li>
<p><code>queryType</code> is a <a href="queries.html#VkQueryType" class="xref page">VkQueryType</a> value specifying the type of
queries managed by the pool.</p>
</li>
<li>
<p><code>queryPool</code> is the query pool that will manage the results of the
query.</p>
</li>
<li>
<p><code>firstQuery</code> is the first query index within the query pool that
will contain the <code>accelerationStructureCount</code> number of results.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to any of the acceleration structures listed in
<code>pAccelerationStructures</code> <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03755" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03755"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03755</span><br>

<code>queryPool</code> <strong>must</strong> have been created with a <code>queryType</code> matching
<code>queryType</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03756" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03756"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03756</span><br>

The queries identified by <code>queryPool</code> and <code>firstQuery</code> <strong>must</strong> be
<em>unavailable</em></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructure-03757" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructure-03757"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructure-03757</span><br>

<code>accelerationStructure</code> <strong>must</strong> be bound completely and contiguously
to a single <code>VkDeviceMemory</code> object via
<a href="resources.html#vkBindAccelerationStructureMemoryNV" class="xref page">vkBindAccelerationStructureMemoryNV</a></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-04958" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-04958"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-04958</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-06215" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-06215"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-06215</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> if
<code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_NV</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-06216" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-06216"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-06216</span><br>

<code>queryType</code> <strong>must</strong> be
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_NV</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-parameter</span><br>
 <code>pAccelerationStructures</code> <strong>must</strong> be a valid pointer to an array of <code>accelerationStructureCount</code> valid <a href="resources.html#VkAccelerationStructureNV" class="xref page">VkAccelerationStructureNV</a> handles</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-parameter</span><br>
 <code>queryType</code> <strong>must</strong> be a valid <a href="queries.html#VkQueryType" class="xref page">VkQueryType</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-parameter" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-parameter</span><br>
 <code>queryPool</code> <strong>must</strong> be a valid <a href="queries.html#VkQueryPool" class="xref page">VkQueryPool</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-recording" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-cmdpool" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-renderpass" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-renderpass"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-videocoding" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-videocoding"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructureCount-arraylength" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructureCount-arraylength"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructureCount-arraylength</span><br>
 <code>accelerationStructureCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commonparent" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commonparent"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commonparent</span><br>
 Each of <code>commandBuffer</code>, <code>queryPool</code>, and the elements of <code>pAccelerationStructures</code> <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="video_extensions.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy an acceleration structure call:</p>
</div>
<div id="vkCmdCopyAccelerationStructureNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
void vkCmdCopyAccelerationStructureNV(
    VkCommandBuffer                             commandBuffer,
    VkAccelerationStructureNV                   dst,
    VkAccelerationStructureNV                   src,
    VkCopyAccelerationStructureModeKHR          mode);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>dst</code> is the target acceleration structure for the copy.</p>
</li>
<li>
<p><code>src</code> is the source acceleration structure for the copy.</p>
</li>
<li>
<p><code>mode</code> is a <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value
specifying additional operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>src</code> and <code>dst</code> <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> or
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code> as appropriate.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-mode-03410" href="#VUID-vkCmdCopyAccelerationStructureNV-mode-03410"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-mode-03410</span><br>

<code>mode</code> <strong>must</strong> be
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code> or
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-src-04963" href="#VUID-vkCmdCopyAccelerationStructureNV-src-04963"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-src-04963</span><br>

The source acceleration structure <code>src</code> <strong>must</strong> have been constructed
prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-src-03411" href="#VUID-vkCmdCopyAccelerationStructureNV-src-03411"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-src-03411</span><br>

If <code>mode</code> is <code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code>,
<code>src</code> <strong>must</strong> have been constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> in the
build</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-buffer-03718" href="#VUID-vkCmdCopyAccelerationStructureNV-buffer-03718"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-buffer-03718</span><br>

The <code>buffer</code> used to create <code>src</code> <strong>must</strong> be bound to device
memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-buffer-03719" href="#VUID-vkCmdCopyAccelerationStructureNV-buffer-03719"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-buffer-03719</span><br>

The <code>buffer</code> used to create <code>dst</code> <strong>must</strong> be bound to device
memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-dst-07791" href="#VUID-vkCmdCopyAccelerationStructureNV-dst-07791"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-dst-07791</span><br>

The range of memory backing <code>dst</code> that is accessed by this command
<strong>must</strong> not overlap the memory backing <code>src</code> that is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-dst-07792" href="#VUID-vkCmdCopyAccelerationStructureNV-dst-07792"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-dst-07792</span><br>

<code>dst</code> <strong>must</strong> be bound completely and contiguously to a single
<code>VkDeviceMemory</code> object via
<a href="resources.html#vkBindAccelerationStructureMemoryNV" class="xref page">vkBindAccelerationStructureMemoryNV</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-parameter" href="#VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-dst-parameter" href="#VUID-vkCmdCopyAccelerationStructureNV-dst-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-dst-parameter</span><br>
 <code>dst</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureNV" class="xref page">VkAccelerationStructureNV</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-src-parameter" href="#VUID-vkCmdCopyAccelerationStructureNV-src-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-src-parameter</span><br>
 <code>src</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureNV" class="xref page">VkAccelerationStructureNV</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-mode-parameter" href="#VUID-vkCmdCopyAccelerationStructureNV-mode-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-mode-parameter</span><br>
 <code>mode</code> <strong>must</strong> be a valid <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-recording" href="#VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-cmdpool" href="#VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-renderpass" href="#VUID-vkCmdCopyAccelerationStructureNV-renderpass"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-videocoding" href="#VUID-vkCmdCopyAccelerationStructureNV-videocoding"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-commonparent" href="#VUID-vkCmdCopyAccelerationStructureNV-commonparent"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-commonparent</span><br>
 Each of <code>commandBuffer</code>, <code>dst</code>, and <code>src</code> <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="video_extensions.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy an acceleration structure call:</p>
</div>
<div id="vkCmdCopyAccelerationStructureKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
void vkCmdCopyAccelerationStructureKHR(
    VkCommandBuffer                             commandBuffer,
    const VkCopyAccelerationStructureInfoKHR*   pInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <a href="#VkCopyAccelerationStructureInfoKHR">VkCopyAccelerationStructureInfoKHR</a>
structure defining the copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command copies the <code>pInfo-&gt;src</code> acceleration structure to the
<code>pInfo-&gt;dst</code> acceleration structure in the manner specified by
<code>pInfo-&gt;mode</code>.</p>
</div>
<div class="paragraph">
<p>Accesses to <code>pInfo-&gt;src</code> and <code>pInfo-&gt;dst</code> <strong>must</strong> be
<a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> or
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code> as appropriate.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-accelerationStructure-08925" href="#VUID-vkCmdCopyAccelerationStructureKHR-accelerationStructure-08925"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-accelerationStructure-08925</span><br>

The <a href="features.html#features-accelerationStructure" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-buffer-03737" href="#VUID-vkCmdCopyAccelerationStructureKHR-buffer-03737"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-buffer-03737</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-buffer-03738" href="#VUID-vkCmdCopyAccelerationStructureKHR-buffer-03738"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-buffer-03738</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
device memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-parameter" href="#VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-pInfo-parameter" href="#VUID-vkCmdCopyAccelerationStructureKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkCopyAccelerationStructureInfoKHR">VkCopyAccelerationStructureInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-recording" href="#VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-cmdpool" href="#VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-renderpass" href="#VUID-vkCmdCopyAccelerationStructureKHR-renderpass"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-videocoding" href="#VUID-vkCmdCopyAccelerationStructureKHR-videocoding"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="video_extensions.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkCopyAccelerationStructureInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkCopyAccelerationStructureInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkCopyAccelerationStructureInfoKHR {
    VkStructureType                       sType;
    const void*                           pNext;
    VkAccelerationStructureKHR            src;
    VkAccelerationStructureKHR            dst;
    VkCopyAccelerationStructureModeKHR    mode;
} VkCopyAccelerationStructureInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>src</code> is the source acceleration structure for the copy.</p>
</li>
<li>
<p><code>dst</code> is the target acceleration structure for the copy.</p>
</li>
<li>
<p><code>mode</code> is a <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value
specifying additional operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-mode-03410" href="#VUID-VkCopyAccelerationStructureInfoKHR-mode-03410"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-mode-03410</span><br>

<code>mode</code> <strong>must</strong> be
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code> or
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-src-04963" href="#VUID-VkCopyAccelerationStructureInfoKHR-src-04963"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-src-04963</span><br>

The source acceleration structure <code>src</code> <strong>must</strong> have been constructed
prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-src-03411" href="#VUID-VkCopyAccelerationStructureInfoKHR-src-03411"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-src-03411</span><br>

If <code>mode</code> is <code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code>,
<code>src</code> <strong>must</strong> have been constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> in the
build</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-buffer-03718" href="#VUID-VkCopyAccelerationStructureInfoKHR-buffer-03718"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-buffer-03718</span><br>

The <code>buffer</code> used to create <code>src</code> <strong>must</strong> be bound to device
memory</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-buffer-03719" href="#VUID-VkCopyAccelerationStructureInfoKHR-buffer-03719"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-buffer-03719</span><br>

The <code>buffer</code> used to create <code>dst</code> <strong>must</strong> be bound to device
memory</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-dst-07791" href="#VUID-VkCopyAccelerationStructureInfoKHR-dst-07791"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-dst-07791</span><br>

The range of memory backing <code>dst</code> that is accessed by this command
<strong>must</strong> not overlap the memory backing <code>src</code> that is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-dst-07792" href="#VUID-VkCopyAccelerationStructureInfoKHR-dst-07792"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-dst-07792</span><br>

<code>dst</code> <strong>must</strong> be bound completely and contiguously to a single
<code>VkDeviceMemory</code> object via
<a href="resources.html#vkBindAccelerationStructureMemoryNV" class="xref page">vkBindAccelerationStructureMemoryNV</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-sType-sType" href="#VUID-VkCopyAccelerationStructureInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_COPY_ACCELERATION_STRUCTURE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-pNext-pNext" href="#VUID-VkCopyAccelerationStructureInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-src-parameter" href="#VUID-VkCopyAccelerationStructureInfoKHR-src-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-src-parameter</span><br>
 <code>src</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-dst-parameter" href="#VUID-VkCopyAccelerationStructureInfoKHR-dst-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-dst-parameter</span><br>
 <code>dst</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-mode-parameter" href="#VUID-VkCopyAccelerationStructureInfoKHR-mode-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-mode-parameter</span><br>
 <code>mode</code> <strong>must</strong> be a valid <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-commonparent" href="#VUID-VkCopyAccelerationStructureInfoKHR-commonparent"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-commonparent</span><br>
 Both of <code>dst</code>, and <code>src</code> <strong>must</strong> have been created, allocated, or retrieved from the same <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Possible values of <code>mode</code> specifying additional operations to perform
during the copy, are:</p>
</div>
<div id="VkCopyAccelerationStructureModeKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef enum VkCopyAccelerationStructureModeKHR {
    VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR = 0,
    VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR = 1,
    VK_COPY_ACCELERATION_STRUCTURE_MODE_SERIALIZE_KHR = 2,
    VK_COPY_ACCELERATION_STRUCTURE_MODE_DESERIALIZE_KHR = 3,
  // Provided by VK_NV_ray_tracing
    VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_NV = VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR,
  // Provided by VK_NV_ray_tracing
    VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_NV = VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR,
} VkCopyAccelerationStructureModeKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkCopyAccelerationStructureModeNV" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_NV_ray_tracing
typedef VkCopyAccelerationStructureModeKHR VkCopyAccelerationStructureModeNV;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR</code> creates a direct
copy of the acceleration structure specified in <code>src</code> into the one
specified by <code>dst</code>.
The <code>dst</code> acceleration structure <strong>must</strong> have been created with the
same parameters as <code>src</code>.
If <code>src</code> contains references to other acceleration structures,
<code>dst</code> will reference the same acceleration structures.</p>
</li>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code> creates a more
compact version of an acceleration structure <code>src</code> into <code>dst</code>.
The acceleration structure <code>dst</code> <strong>must</strong> have been created with a size
at least as large as that returned by
<a href="#vkCmdWriteAccelerationStructuresPropertiesKHR">vkCmdWriteAccelerationStructuresPropertiesKHR</a>
or <a href="#vkWriteAccelerationStructuresPropertiesKHR">vkWriteAccelerationStructuresPropertiesKHR</a>
after the build of the acceleration structure specified by <code>src</code>.
If <code>src</code> contains references to other acceleration structures,
<code>dst</code> will reference the same acceleration structures.</p>
</li>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_SERIALIZE_KHR</code> serializes the
acceleration structure to a semi-opaque format which can be reloaded on
a compatible implementation.</p>
</li>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_DESERIALIZE_KHR</code> deserializes
the semi-opaque serialization format in the buffer to the acceleration
structure.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy an acceleration structure to device memory call:</p>
</div>
<div id="vkCmdCopyAccelerationStructureToMemoryKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
void vkCmdCopyAccelerationStructureToMemoryKHR(
    VkCommandBuffer                             commandBuffer,
    const VkCopyAccelerationStructureToMemoryInfoKHR* pInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> is an a pointer to a
<a href="#VkCopyAccelerationStructureToMemoryInfoKHR">VkCopyAccelerationStructureToMemoryInfoKHR</a> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>pInfo-&gt;src</code> <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code>.
Accesses to the buffer indicated by <code>pInfo-&gt;dst.deviceAddress</code> <strong>must</strong> be
synchronized with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an and an access
type of <code>VK_ACCESS_TRANSFER_WRITE_BIT</code>.</p>
</div>
<div class="paragraph">
<p>This command produces the same results as
<a href="#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>, but writes its result to a
device address, and is executed on the device rather than the host.
The output <strong>may</strong> not necessarily be bit-for-bit identical, but it can be
equally used by either <a href="#vkCmdCopyMemoryToAccelerationStructureKHR">vkCmdCopyMemoryToAccelerationStructureKHR</a> or
<a href="#vkCopyMemoryToAccelerationStructureKHR">vkCopyMemoryToAccelerationStructureKHR</a>.</p>
</div>
<div id="serialized-as-header" class="paragraph">
<p>The defined header structure for the serialized data consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_UUID_SIZE</code> bytes of data matching
<code>VkPhysicalDeviceIDProperties</code>::<code>driverUUID</code></p>
</li>
<li>
<p><code>VK_UUID_SIZE</code> bytes of data identifying the compatibility for
comparison using <a href="#vkGetDeviceAccelerationStructureCompatibilityKHR">vkGetDeviceAccelerationStructureCompatibilityKHR</a></p>
</li>
<li>
<p>A 64-bit integer of the total size matching the value queried using
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
<li>
<p>A 64-bit integer of the deserialized size to be passed in to
<code>VkAccelerationStructureCreateInfoKHR</code>::<code>size</code></p>
</li>
<li>
<p>A 64-bit integer of the count of the number of acceleration structure
handles following.
This value matches the value queried using
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>.
This will be zero for a bottom-level acceleration structure.
For top-level acceleration structures this number is
implementation-dependent; the number of and ordering of the handles may
not match the instance descriptions which were used to build the
acceleration structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The corresponding handles matching the values returned by
<a href="resources.html#vkGetAccelerationStructureDeviceAddressKHR" class="xref page">vkGetAccelerationStructureDeviceAddressKHR</a>
or
<a href="resources.html#vkGetAccelerationStructureHandleNV" class="xref page">vkGetAccelerationStructureHandleNV</a>
are tightly packed in the buffer following the count.
The application is expected to store a mapping between those handles and the
original application-generated bottom-level acceleration structures to
provide when deserializing.
The serialized data is written to the buffer (or read from the buffer)
according to the host endianness.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-accelerationStructure-08926" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-accelerationStructure-08926"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-accelerationStructure-08926</span><br>

The <a href="features.html#features-accelerationStructure" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03739" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03739"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03739</span><br>

<code>pInfo-&gt;dst.deviceAddress</code> <strong>must</strong> be a valid device address for a
buffer bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03740" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03740"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03740</span><br>

<code>pInfo-&gt;dst.deviceAddress</code> <strong>must</strong> be aligned to <code>256</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03741" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03741"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03741</span><br>

If the buffer pointed to by <code>pInfo-&gt;dst.deviceAddress</code> is non-sparse
then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-None-03559" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-None-03559"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-None-03559</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
device memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-parameter" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-parameter" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkCopyAccelerationStructureToMemoryInfoKHR">VkCopyAccelerationStructureToMemoryInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-recording" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-cmdpool" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-renderpass" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-renderpass"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-videocoding" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-videocoding"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="video_extensions.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkCopyAccelerationStructureToMemoryInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkCopyAccelerationStructureToMemoryInfoKHR {
    VkStructureType                       sType;
    const void*                           pNext;
    VkAccelerationStructureKHR            src;
    VkDeviceOrHostAddressKHR              dst;
    VkCopyAccelerationStructureModeKHR    mode;
} VkCopyAccelerationStructureToMemoryInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>src</code> is the source acceleration structure for the copy</p>
</li>
<li>
<p><code>dst</code> is the device or host address to memory which is the target
for the copy</p>
</li>
<li>
<p><code>mode</code> is a <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value
specifying additional operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-04959" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-04959"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-04959</span><br>

The source acceleration structure <code>src</code> <strong>must</strong> have been constructed
prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-dst-03561" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-dst-03561"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-dst-03561</span><br>

The memory pointed to by <code>dst</code> <strong>must</strong> be at least as large as the
serialization size of <code>src</code>, as reported by
<a href="#vkWriteAccelerationStructuresPropertiesKHR">vkWriteAccelerationStructuresPropertiesKHR</a> or
<a href="#vkCmdWriteAccelerationStructuresPropertiesKHR">vkCmdWriteAccelerationStructuresPropertiesKHR</a> with a query type of
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-03412" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-03412"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-03412</span><br>

<code>mode</code> <strong>must</strong> be
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_SERIALIZE_KHR</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-sType-sType" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_COPY_ACCELERATION_STRUCTURE_TO_MEMORY_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-pNext-pNext" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-parameter" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-parameter</span><br>
 <code>src</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-parameter" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-parameter</span><br>
 <code>mode</code> <strong>must</strong> be a valid <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy device memory to an acceleration structure call:</p>
</div>
<div id="vkCmdCopyMemoryToAccelerationStructureKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
void vkCmdCopyMemoryToAccelerationStructureKHR(
    VkCommandBuffer                             commandBuffer,
    const VkCopyMemoryToAccelerationStructureInfoKHR* pInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="#VkCopyMemoryToAccelerationStructureInfoKHR">VkCopyMemoryToAccelerationStructureInfoKHR</a> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>pInfo-&gt;dst</code> <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>.
Accesses to the buffer indicated by <code>pInfo-&gt;src.deviceAddress</code> <strong>must</strong> be
synchronized with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an access type of
<code>VK_ACCESS_TRANSFER_READ_BIT</code>.</p>
</div>
<div class="paragraph">
<p>This command can accept acceleration structures produced by either
<a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a> or
<a href="#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>.</p>
</div>
<div class="paragraph">
<p>The structure provided as input to deserialize is as described in
<a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a>, with any acceleration
structure handles filled in with the newly-queried handles to bottom level
acceleration structures created before deserialization.
These do not need to be built at deserialize time, but <strong>must</strong> be created.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-accelerationStructure-08927" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-accelerationStructure-08927"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-accelerationStructure-08927</span><br>

The <a href="features.html#features-accelerationStructure" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03742" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03742"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03742</span><br>

<code>pInfo-&gt;src.deviceAddress</code> <strong>must</strong> be a valid device address for a
buffer bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03743" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03743"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03743</span><br>

<code>pInfo-&gt;src.deviceAddress</code> <strong>must</strong> be aligned to <code>256</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03744" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03744"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03744</span><br>

If the buffer pointed to by <code>pInfo-&gt;src.deviceAddress</code> is non-sparse
then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-buffer-03745" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-buffer-03745"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-buffer-03745</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
device memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-parameter" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong>must</strong> be a valid <a href="cmdbuffers.html#VkCommandBuffer" class="xref page">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-parameter" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkCopyMemoryToAccelerationStructureInfoKHR">VkCopyMemoryToAccelerationStructureInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-recording" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong>must</strong> be in the <a href="cmdbuffers.html#commandbuffers-lifecycle" class="xref page">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-cmdpool" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> support compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-renderpass" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-renderpass"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-renderpass</span><br>
 This command <strong>must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-videocoding" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-videocoding"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-videocoding</span><br>
 This command <strong>must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong>must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong>must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="cmdbuffers.html#VkCommandBufferLevel" class="xref page">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="renderpass.html#vkCmdBeginRenderPass" class="xref page">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="video_extensions.html#vkCmdBeginVideoCodingKHR" class="xref page">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="devsandqueues.html#VkQueueFlagBits" class="xref page">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="fundamentals.html#fundamentals-queueoperation-command-types" class="xref page">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkCopyMemoryToAccelerationStructureInfoKHR</code> structure is defined
as:</p>
</div>
<div id="VkCopyMemoryToAccelerationStructureInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkCopyMemoryToAccelerationStructureInfoKHR {
    VkStructureType                       sType;
    const void*                           pNext;
    VkDeviceOrHostAddressConstKHR         src;
    VkAccelerationStructureKHR            dst;
    VkCopyAccelerationStructureModeKHR    mode;
} VkCopyMemoryToAccelerationStructureInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>src</code> is the device or host address to memory containing the source
data for the copy.</p>
</li>
<li>
<p><code>dst</code> is the target acceleration structure for the copy.</p>
</li>
<li>
<p><code>mode</code> is a <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value
specifying additional operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-src-04960" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-src-04960"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-src-04960</span><br>

The source memory pointed to by <code>src</code> <strong>must</strong> contain data previously
serialized using <a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a>,
potentially modified to relocate acceleration structure references as
described in that command</p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-03413" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-03413"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-03413</span><br>

<code>mode</code> <strong>must</strong> be
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_DESERIALIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pInfo-03414" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pInfo-03414"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pInfo-03414</span><br>

The data in <code>src</code> <strong>must</strong> have a format compatible with the
destination physical device as returned by
<a href="#vkGetDeviceAccelerationStructureCompatibilityKHR">vkGetDeviceAccelerationStructureCompatibilityKHR</a></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-03746" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-03746"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-03746</span><br>

<code>dst</code> <strong>must</strong> have been created with a <code>size</code> greater than or
equal to that used to serialize the data in <code>src</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-sType-sType" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_COPY_MEMORY_TO_ACCELERATION_STRUCTURE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pNext-pNext" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-parameter" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-parameter"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-parameter</span><br>
 <code>dst</code> <strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-parameter" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-parameter"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-parameter</span><br>
 <code>mode</code> <strong>must</strong> be a valid <a href="#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To check if a serialized acceleration structure is compatible with the
current device call:</p>
</div>
<div id="vkGetDeviceAccelerationStructureCompatibilityKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
void vkGetDeviceAccelerationStructureCompatibilityKHR(
    VkDevice                                    device,
    const VkAccelerationStructureVersionInfoKHR* pVersionInfo,
    VkAccelerationStructureCompatibilityKHR*    pCompatibility);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device to check the version against.</p>
</li>
<li>
<p><code>pVersionInfo</code> is a pointer to a
<a href="#VkAccelerationStructureVersionInfoKHR">VkAccelerationStructureVersionInfoKHR</a> structure specifying version
information to check against the device.</p>
</li>
<li>
<p><code>pCompatibility</code> is a pointer to a
<a href="#VkAccelerationStructureCompatibilityKHR">VkAccelerationStructureCompatibilityKHR</a> value in which
compatibility information is returned.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-accelerationStructure-08928" href="#VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-accelerationStructure-08928"></a> <span class="vuid">VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-accelerationStructure-08928</span><br>

The <a href="features.html#features-accelerationStructure" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-device-parameter" href="#VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-device-parameter"></a> <span class="vuid">VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pVersionInfo-parameter" href="#VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pVersionInfo-parameter"></a> <span class="vuid">VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pVersionInfo-parameter</span><br>
 <code>pVersionInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkAccelerationStructureVersionInfoKHR">VkAccelerationStructureVersionInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pCompatibility-parameter" href="#VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pCompatibility-parameter"></a> <span class="vuid">VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pCompatibility-parameter</span><br>
 <code>pCompatibility</code> <strong>must</strong> be a valid pointer to a <a href="#VkAccelerationStructureCompatibilityKHR">VkAccelerationStructureCompatibilityKHR</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureVersionInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkAccelerationStructureVersionInfoKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef struct VkAccelerationStructureVersionInfoKHR {
    VkStructureType    sType;
    const void*        pNext;
    const uint8_t*     pVersionData;
} VkAccelerationStructureVersionInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>pVersionData</code> is a pointer to the version header of an acceleration
structure as defined in <a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p><code>pVersionData</code> is a <em>pointer</em> to an array of 2×<code>VK_UUID_SIZE</code>
<code>uint8_t</code> values instead of two <code>VK_UUID_SIZE</code> arrays as the expected
use case for this member is to be pointed at the header of a previously
serialized acceleration structure (via
<a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a> or
<a href="#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>) that is loaded in memory.
Using arrays would necessitate extra memory copies of the UUIDs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureVersionInfoKHR-sType-sType" href="#VUID-VkAccelerationStructureVersionInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureVersionInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong>must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_VERSION_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureVersionInfoKHR-pNext-pNext" href="#VUID-VkAccelerationStructureVersionInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureVersionInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureVersionInfoKHR-pVersionData-parameter" href="#VUID-VkAccelerationStructureVersionInfoKHR-pVersionData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureVersionInfoKHR-pVersionData-parameter</span><br>
 <code>pVersionData</code> <strong>must</strong> be a valid pointer to an array of <span class="steminline"> <svg style="vertical-align: -0.215ex; overflow: visible;" xmlns="http://www.w3.org/2000/svg" width="18.15ex" height="1.722ex" role="img" focusable="false" viewBox="0 -666 8022.4 761"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1722.4,0)"><g data-mml-node="mi"><path data-c="1D685" d="M19 578Q19 585 20 590T23 598T29 604T38 608T48 610T62 611T78 612T97 611T119 611H195Q210 602 213 596T217 573Q217 561 216 555T206 542T179 535H164Q166 529 188 435T235 231T261 94L262 84V88Q263 91 263 94Q265 121 289 231T336 438L360 535H345Q308 535 308 566V573Q308 586 308 590T314 600T330 611H484Q499 602 502 595T505 573Q505 560 504 554T493 541T465 535H447L384 278Q321 19 319 14Q309 -7 278 -7H262H246Q215 -7 205 14Q203 19 140 278L78 535H59Q45 535 38 536T25 547T19 573V578Z"></path><path data-c="1D67A" d="M18 549T18 573T29 604T70 611H118H193Q207 603 210 596T214 573Q214 549 198 538Q191 535 172 535H152V421Q152 344 152 326T153 309L242 422L329 534Q327 535 322 536T314 538T308 542T303 548T300 558T298 573Q298 600 316 608Q322 611 392 611H463Q477 602 481 595T485 573Q485 535 446 535H441H420L281 357L436 77L454 76Q473 75 478 73Q495 62 495 38Q495 10 473 1H345Q334 5 329 11T324 21T323 38Q323 51 324 56T332 68T355 77L233 296L152 192V76H172Q191 76 198 73Q214 63 214 38Q214 9 193 1H41Q18 8 18 38Q18 61 35 73Q42 76 61 76H81V535H61Q42 535 35 538Q18 549 18 573Z" transform="translate(525,0)"></path></g><g data-mml-node="mi" transform="translate(1050,0)"><path data-c="5F" d="M57 -60Q57 -33 86 -25H438Q468 -34 468 -60T438 -95H86Q57 -86 57 -60Z"></path></g><g data-mml-node="mi" transform="translate(1575,0)"><path data-c="1D684" d="M-3 573Q-3 597 8 604T50 612Q57 612 77 612T111 611H200Q214 602 218 595T222 573Q222 549 205 538Q198 535 175 535H151V359Q151 333 151 291Q152 177 156 162Q157 160 157 159Q165 123 193 95T262 66Q303 66 330 94T367 159Q371 175 371 191T373 359V535H349H339Q328 535 322 537T309 548T303 573T306 595T325 611H506Q520 602 524 595T528 573Q528 549 511 538Q504 535 481 535H457V364Q457 189 456 182Q448 101 394 45T262 -11Q189 -11 132 43T68 182Q67 189 67 364V535H43H33Q22 535 16 537T3 548T-3 573Z"></path><path data-c="1D684" d="M-3 573Q-3 597 8 604T50 612Q57 612 77 612T111 611H200Q214 602 218 595T222 573Q222 549 205 538Q198 535 175 535H151V359Q151 333 151 291Q152 177 156 162Q157 160 157 159Q165 123 193 95T262 66Q303 66 330 94T367 159Q371 175 371 191T373 359V535H349H339Q328 535 322 537T309 548T303 573T306 595T325 611H506Q520 602 524 595T528 573Q528 549 511 538Q504 535 481 535H457V364Q457 189 456 182Q448 101 394 45T262 -11Q189 -11 132 43T68 182Q67 189 67 364V535H43H33Q22 535 16 537T3 548T-3 573Z" transform="translate(525,0)"></path><path data-c="1D678" d="M400 76Q431 76 441 69T452 38Q452 29 452 26T450 18T443 9T430 1H95Q84 6 79 12T73 23T72 38Q72 65 90 73Q96 76 157 76H220V535H157H124Q93 535 83 542T72 573Q72 603 93 610Q97 611 264 611H430Q432 609 436 607T444 602T449 594Q452 588 452 573Q452 546 434 538Q428 535 367 535H304V76H367H400Z" transform="translate(1050,0)"></path><path data-c="1D673" d="M38 1Q16 8 16 38Q16 62 32 73Q39 76 58 76H78V535H58Q40 535 32 538Q16 548 16 573Q16 587 17 591Q23 604 34 607T83 611H166H176Q188 611 209 611T239 612Q299 612 337 597T415 530Q485 438 485 300Q485 180 431 100T301 3L291 1H38ZM400 301Q400 363 385 410T346 482T303 519T267 534Q261 535 210 535H162V76H214L267 77Q323 89 361 148T400 301Z" transform="translate(1575,0)"></path></g><g data-mml-node="mi" transform="translate(3675,0)"><path data-c="5F" d="M57 -60Q57 -33 86 -25H438Q468 -34 468 -60T438 -95H86Q57 -86 57 -60Z"></path></g><g data-mml-node="mi" transform="translate(4200,0)"><path data-c="1D682" d="M52 454Q52 524 107 572T229 621Q266 621 274 620Q326 610 360 588L371 581Q377 594 379 598T386 610T397 619T412 622Q433 622 439 610T446 570Q446 563 446 545T445 515V479Q445 441 444 432T436 417Q428 408 403 408T370 417Q361 424 361 434Q361 439 360 448T351 476T331 509T295 535T238 546Q194 546 163 522T132 458Q132 435 148 412Q155 401 166 393T192 380T218 371T247 364T270 359Q341 342 349 339Q389 325 418 296T461 229Q472 201 472 164Q469 92 417 41T287 -11Q240 -11 200 -1T143 19L126 29Q117 6 109 -2Q100 -11 84 -11Q64 -11 58 1T51 42Q51 49 51 66T52 95V135Q52 173 53 180T61 194Q70 203 95 203Q119 203 127 194Q136 186 136 168Q143 66 284 66H290Q325 66 350 85Q391 115 391 165Q391 204 369 228T322 260Q320 260 255 275T185 293Q123 309 88 355T52 454Z"></path><path data-c="1D678" d="M400 76Q431 76 441 69T452 38Q452 29 452 26T450 18T443 9T430 1H95Q84 6 79 12T73 23T72 38Q72 65 90 73Q96 76 157 76H220V535H157H124Q93 535 83 542T72 573Q72 603 93 610Q97 611 264 611H430Q432 609 436 607T444 602T449 594Q452 588 452 573Q452 546 434 538Q428 535 367 535H304V76H367H400Z" transform="translate(525,0)"></path><path data-c="1D689" d="M71 1Q60 5 55 11T49 23T48 39V46Q48 56 58 73T131 183Q171 242 197 282L366 535H144V501Q144 470 143 464T135 450Q127 442 102 442H94Q71 442 62 461Q60 466 60 527L61 589Q70 607 83 610H88Q93 610 102 610T124 610T154 610T188 611T227 611T270 611H454Q456 609 461 606T467 601T471 597T474 591T475 584T476 572V565Q476 555 466 538T393 428Q353 369 327 329L158 76H397V120V146Q397 169 405 179T439 189Q470 189 479 169Q481 164 481 95V48Q481 24 478 16T459 1H71Z" transform="translate(1050,0)"></path><path data-c="1D674" d="M374 271Q374 241 367 232T332 223Q307 223 299 231Q290 240 290 263V279H173V76H418V118V144Q418 167 426 176T460 186Q491 186 500 166Q502 161 502 93V52Q502 25 499 17T480 1H41Q19 9 19 32V38Q19 63 36 73Q42 76 65 76H89V535H65H55Q44 535 38 537T25 548T19 573Q19 602 41 610H47Q53 610 63 610T88 610T121 610T160 611T204 611T251 611H458Q460 609 465 606T471 602T475 598T478 593T479 586T480 576T480 562V526V488Q480 452 462 444Q458 442 438 442Q413 442 405 450Q398 457 397 463T396 501V535H173V355H290V371Q290 394 299 403T332 412Q363 412 372 392Q374 387 374 317V271Z" transform="translate(1575,0)"></path></g></g></g></g></svg> </span> <code>uint8_t</code> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Possible values of <code>pCompatibility</code> returned by
<a href="#vkGetDeviceAccelerationStructureCompatibilityKHR">vkGetDeviceAccelerationStructureCompatibilityKHR</a> are:</p>
</div>
<div id="VkAccelerationStructureCompatibilityKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
typedef enum VkAccelerationStructureCompatibilityKHR {
    VK_ACCELERATION_STRUCTURE_COMPATIBILITY_COMPATIBLE_KHR = 0,
    VK_ACCELERATION_STRUCTURE_COMPATIBILITY_INCOMPATIBLE_KHR = 1,
} VkAccelerationStructureCompatibilityKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_COMPATIBILITY_COMPATIBLE_KHR</code> if the
<code>pVersionData</code> version acceleration structure is compatible with
<code>device</code>.</p>
</li>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_COMPATIBILITY_INCOMPATIBLE_KHR</code> if the
<code>pVersionData</code> version acceleration structure is not compatible with
<code>device</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="host-acceleration-structure"><a class="anchor" href="#host-acceleration-structure"></a>Host Acceleration Structure Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Implementations are also required to provide host implementations of the
acceleration structure operations if the
<a href="features.html#features-accelerationStructureHostCommands" class="xref page"><code>accelerationStructureHostCommands</code></a> feature is enabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#vkBuildAccelerationStructuresKHR">vkBuildAccelerationStructuresKHR</a> corresponding to
<a href="#vkCmdBuildAccelerationStructuresKHR">vkCmdBuildAccelerationStructuresKHR</a></p>
</li>
<li>
<p><a href="#vkCopyAccelerationStructureKHR">vkCopyAccelerationStructureKHR</a> corresponding to
<a href="#vkCmdCopyAccelerationStructureKHR">vkCmdCopyAccelerationStructureKHR</a></p>
</li>
<li>
<p><a href="#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a> corresponding to
<a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a></p>
</li>
<li>
<p><a href="#vkCopyMemoryToAccelerationStructureKHR">vkCopyMemoryToAccelerationStructureKHR</a> corresponding to
<a href="#vkCmdCopyMemoryToAccelerationStructureKHR">vkCmdCopyMemoryToAccelerationStructureKHR</a></p>
</li>
<li>
<p><a href="#vkWriteAccelerationStructuresPropertiesKHR">vkWriteAccelerationStructuresPropertiesKHR</a> corresponding to
<a href="#vkCmdWriteAccelerationStructuresPropertiesKHR">vkCmdWriteAccelerationStructuresPropertiesKHR</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These commands are functionally equivalent to their device counterparts,
except that they are executed on the host timeline, rather than being
enqueued into command buffers.</p>
</div>
<div class="paragraph">
<p>All acceleration structures used by the host commands <strong>must</strong> be bound to
host-visible memory, and all input data for acceleration structure builds
<strong>must</strong> be referenced using host addresses instead of device addresses.
Applications are not required to map acceleration structure memory when
using the host commands.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The <a href="#vkBuildAccelerationStructuresKHR">vkBuildAccelerationStructuresKHR</a> and
<a href="#vkCmdBuildAccelerationStructuresKHR">vkCmdBuildAccelerationStructuresKHR</a> <strong>may</strong> use different algorithms, and
thus are not required to produce identical structures.
The structures produced by these two commands <strong>may</strong> exhibit different memory
footprints or traversal performance, but should strive to be similar where
possible.</p>
</div>
<div class="paragraph">
<p>Apart from these details, the host and device operations are
interchangeable.
For example, an application <strong>can</strong> use <a href="#vkBuildAccelerationStructuresKHR">vkBuildAccelerationStructuresKHR</a>
to build a structure, compact it on the device using
<a href="#vkCmdCopyAccelerationStructureKHR">vkCmdCopyAccelerationStructureKHR</a>, and serialize the result using
<a href="#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>For efficient execution, acceleration structures manipulated using these
commands should always be bound to host cached memory, as the implementation
may need to repeatedly read and write this memory during the execution of
the command.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build acceleration structures on the host, call:</p>
</div>
<div id="vkBuildAccelerationStructuresKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
VkResult vkBuildAccelerationStructuresKHR(
    VkDevice                                    device,
    VkDeferredOperationKHR                      deferredOperation,
    uint32_t                                    infoCount,
    const VkAccelerationStructureBuildGeometryInfoKHR* pInfos,
    const VkAccelerationStructureBuildRangeInfoKHR* const* ppBuildRangeInfos);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the <code>VkDevice</code> for which the acceleration structures
are being built.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> to
<a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#deferred-host-operations-requesting" class="xref page">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>infoCount</code> is the number of acceleration structures to build.
It specifies the number of the <code>pInfos</code> structures and
<code>ppBuildRangeInfos</code> pointers that <strong>must</strong> be provided.</p>
</li>
<li>
<p><code>pInfos</code> is a pointer to an array of <code>infoCount</code>
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures defining
the geometry used to build each acceleration structure.</p>
</li>
<li>
<p><code>ppBuildRangeInfos</code> is a pointer to an array of <code>infoCount</code>
pointers to arrays of <a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a>
structures.
Each <code>ppBuildRangeInfos</code>[i] is a pointer to an array of
<code>pInfos</code>[i].<code>geometryCount</code>
<a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures defining
dynamic offsets to the addresses where geometry data is stored, as
defined by <code>pInfos</code>[i].</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="#vkCmdBuildAccelerationStructuresKHR">vkCmdBuildAccelerationStructuresKHR</a> but is executed by the host.</p>
</div>
<div class="paragraph">
<p>The <code>vkBuildAccelerationStructuresKHR</code> command provides the ability to
initiate multiple acceleration structures builds, however there is no
ordering or synchronization implied between any of the individual
acceleration structure builds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>This means that an application <strong>cannot</strong> build a top-level acceleration
structure in the same <a href="#vkBuildAccelerationStructuresKHR">vkBuildAccelerationStructuresKHR</a> call as the
associated bottom-level or instance acceleration structures are being built.
There also <strong>cannot</strong> be any memory aliasing between any acceleration structure
memories or scratch memories being used by any of the builds.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-accelerationStructureHostCommands-03581" href="#VUID-vkBuildAccelerationStructuresKHR-accelerationStructureHostCommands-03581"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-accelerationStructureHostCommands-03581</span><br>

The <a href="features.html#features-accelerationStructureHostCommands" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-mode-04628" href="#VUID-vkBuildAccelerationStructuresKHR-mode-04628"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-mode-04628</span><br>

The <code>mode</code> member of each element of <code>pInfos</code> <strong>must</strong> be a valid
<a href="#VkBuildAccelerationStructureModeKHR">VkBuildAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-srcAccelerationStructure-04629" href="#VUID-vkBuildAccelerationStructuresKHR-srcAccelerationStructure-04629"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-srcAccelerationStructure-04629</span><br>

If the <code>srcAccelerationStructure</code> member of any element of
<code>pInfos</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the
<code>srcAccelerationStructure</code> member <strong>must</strong> be a valid
<a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-04630" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-04630"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-04630</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong>must</strong> not be <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03403" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03403"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03403</span><br>

The <code>srcAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03698" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03698"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03698</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03800" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03800"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03800</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> be a valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03699" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03699"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03699</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong>must</strong> have been created with a
value of <a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03700" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03700"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03700</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong>must</strong> have been created with a
value of <a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03663" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03663"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03663</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>,
<a href="#acceleration-structure-inactive-prims">inactive primitives</a> in its
<code>srcAccelerationStructure</code> member <strong>must</strong> not be made active</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03664" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03664"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03664</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, active primitives
in its <code>srcAccelerationStructure</code> member <strong>must</strong> not be made
<a href="#acceleration-structure-inactive-prims">inactive</a></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-None-03407" href="#VUID-vkBuildAccelerationStructuresKHR-None-03407"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-None-03407</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be referenced by the <code>geometry.instances.data</code> member of
any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other
element of <code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03701" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03701"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03701</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>srcAccelerationStructure</code> member of
any other element of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, which is accessed
by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03702" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03702"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03702</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>dstAccelerationStructure</code> member of
any other element of <code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03703" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03703"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03703</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> (including the same element), which is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-scratchData-03704" href="#VUID-vkBuildAccelerationStructuresKHR-scratchData-03704"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-scratchData-03704</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>scratchData</code> member of any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-scratchData-03705" href="#VUID-vkBuildAccelerationStructuresKHR-scratchData-03705"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-scratchData-03705</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>srcAccelerationStructure</code> member of any element
of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> (including the
same element), which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03706" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03706"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03706</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing any acceleration structure referenced by the
<code>geometry.instances.data</code> member of any element of <code>pGeometries</code>
or <code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03667" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03667"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03667</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong>must</strong> have previously been
constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_KHR</code> set in
<a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code> in the
build</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03668" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03668"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03668</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> and <code>dstAccelerationStructure</code>
members <strong>must</strong> either be the same <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a>, or
not have any <a href="resources.html#resources-memory-aliasing" class="xref page">memory aliasing</a></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03758" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03758"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03758</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>geometryCount</code> member <strong>must</strong> have the same value which was specified
when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03759" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03759"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03759</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>flags</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03760" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03760"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03760</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>type</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03761" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03761"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03761</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>geometryType</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03762" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03762"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03762</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>flags</code> member
<strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03763" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03763"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03763</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.vertexFormat</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03764" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03764"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03764</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.maxVertex</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03765" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03765"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03765</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.indexType</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03766" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03766"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03766</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03767" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03767"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03767</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was not <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong>must</strong> not be
<code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03768" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03768"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03768</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
then the value of each index referenced <strong>must</strong> be the same as the
corresponding index value when <code>srcAccelerationStructure</code> was last
built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-primitiveCount-03769" href="#VUID-vkBuildAccelerationStructuresKHR-primitiveCount-03769"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-primitiveCount-03769</span><br>

For each <code>VkAccelerationStructureBuildRangeInfoKHR</code> referenced by
this command, its <code>primitiveCount</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-firstVertex-03770" href="#VUID-vkBuildAccelerationStructuresKHR-firstVertex-03770"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-firstVertex-03770</span><br>

For each <code>VkAccelerationStructureBuildRangeInfoKHR</code> referenced by
this command, if the corresponding geometry uses indices, its
<code>firstVertex</code> member <strong>must</strong> have the same value which was specified
when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03801" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03801"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03801</span><br>

For each element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the corresponding
<code>ppBuildRangeInfos</code>[i][j].<code>primitiveCount</code> <strong>must</strong> be less than or equal to
<a href="limits.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR" class="xref page">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxInstanceCount</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03675" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03675"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03675</span><br>

For each <code>pInfos</code>[i], <code>dstAccelerationStructure</code> <strong>must</strong> have been
created with a value of
<a href="resources.html#VkAccelerationStructureCreateInfoKHR" class="xref page">VkAccelerationStructureCreateInfoKHR</a>::<code>size</code> greater than or
equal to the memory size required by the build operation, as returned by
<a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with <span class="eq"><code>pBuildInfo</code>
= <code>pInfos</code>[i]</span> and with each element of the
<code>pMaxPrimitiveCounts</code> array greater than or equal to the equivalent
<code>ppBuildRangeInfos</code>[i][j].<code>primitiveCount</code> values for <code>j</code> in
<span class="eq">[0,<code>pInfos</code>[i].<code>geometryCount</code>)</span></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676" href="#VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676</span><br>

Each element of <code>ppBuildRangeInfos</code>[i] <strong>must</strong> be a valid pointer to
an array of <code>pInfos</code>[i].<code>geometryCount</code>
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structures</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03677" href="#VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03677"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03677</span><br>

If <code>deferredOperation</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, it <strong>must</strong> be a
valid <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> object</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03678" href="#VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03722" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03722"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03722</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstAccelerationStructure</code> member <strong>must</strong> be bound to host-visible
device memory</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03723" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03723"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03723</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> the <code>buffer</code>
used to create its <code>srcAccelerationStructure</code> member <strong>must</strong> be bound
to host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03724" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03724"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03724</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create each
acceleration structure referenced by the <code>geometry.instances.data</code>
member of any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> <strong>must</strong> be
bound to host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03725" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03725"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03725</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.hostAddress</code> and
<code>pInfos</code>[i].<code>scratchData.hostAddress</code> + N - 1 <strong>must</strong> be valid
host memory, where N is given by the <code>buildScratchSize</code> member of
the <a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned
from a call to <a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with an
identical <a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure
and primitive count</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03726" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03726"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03726</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.hostAddress</code> and
<code>pInfos</code>[i].<code>scratchData.hostAddress</code> + N - 1 <strong>must</strong> be valid
host memory, where N is given by the <code>updateScratchSize</code> member of
the <a href="resources.html#VkAccelerationStructureBuildSizesInfoKHR" class="xref page">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned
from a call to <a href="resources.html#vkGetAccelerationStructureBuildSizesKHR" class="xref page">vkGetAccelerationStructureBuildSizesKHR</a> with an
identical <a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure
and primitive count</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03771" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03771"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03771</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.hostAddress</code> <strong>must</strong> be a valid host
address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03772" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03772"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03772</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.hostAddress</code> <strong>must</strong> be a valid host
address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03773" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03773"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03773</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.hostAddress</code> is not <code>0</code>, it <strong>must</strong>
be a valid host address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03774" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03774"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03774</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, <code>geometry.aabbs.data.hostAddress</code>
<strong>must</strong> be a valid host address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03775" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03775"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03775</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstAccelerationStructure</code> member <strong>must</strong> be bound to memory that was
not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03776" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03776"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03776</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> the <code>buffer</code>
used to create its <code>srcAccelerationStructure</code> member <strong>must</strong> be bound
to memory that was not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03777" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03777"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03777</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create each
acceleration structure referenced by the <code>geometry.instances.data</code>
member of any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> <strong>must</strong> be
bound to memory that was not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03778" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03778"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03778</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>,
<code>geometry.instances.data.hostAddress</code> <strong>must</strong> be a valid host address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03779" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03779"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03779</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, each
<a href="#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>accelerationStructureReference</code>
value in <code>geometry.instances.data.hostAddress</code> must be a valid
<a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> object</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-04930" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-04930"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-04930</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> with
<code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> set, each
<code>accelerationStructureReference</code> in any structure in
<a href="#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a> value in
<code>geometry.instances.data.hostAddress</code> must be a valid
<a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> object</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-device-parameter" href="#VUID-vkBuildAccelerationStructuresKHR-device-parameter"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parameter" href="#VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parameter"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parameter</span><br>
 If <code>deferredOperation</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>deferredOperation</code> <strong>must</strong> be a valid <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-parameter" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-parameter"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-parameter</span><br>
 <code>pInfos</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> valid <a href="#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter" href="#VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter</span><br>
 <code>ppBuildRangeInfos</code> <strong>must</strong> be a valid pointer to an array of <code>infoCount</code> <a href="#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-infoCount-arraylength" href="#VUID-vkBuildAccelerationStructuresKHR-infoCount-arraylength"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-infoCount-arraylength</span><br>
 <code>infoCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parent" href="#VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parent"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parent</span><br>
 If <code>deferredOperation</code> is a valid handle, it <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
<li>
<p><code>VK_OPERATION_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_OPERATION_NOT_DEFERRED_KHR</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy or compact an acceleration structure on the host, call:</p>
</div>
<div id="vkCopyAccelerationStructureKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
VkResult vkCopyAccelerationStructureKHR(
    VkDevice                                    device,
    VkDeferredOperationKHR                      deferredOperation,
    const VkCopyAccelerationStructureInfoKHR*   pInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns the acceleration structures.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> to
<a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#deferred-host-operations-requesting" class="xref page">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <a href="#VkCopyAccelerationStructureInfoKHR">VkCopyAccelerationStructureInfoKHR</a>
structure defining the copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="#vkCmdCopyAccelerationStructureKHR">vkCmdCopyAccelerationStructureKHR</a> but is executed by the host.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-accelerationStructureHostCommands-03582" href="#VUID-vkCopyAccelerationStructureKHR-accelerationStructureHostCommands-03582"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-accelerationStructureHostCommands-03582</span><br>

The <a href="features.html#features-accelerationStructureHostCommands" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-deferredOperation-03677" href="#VUID-vkCopyAccelerationStructureKHR-deferredOperation-03677"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-deferredOperation-03677</span><br>

If <code>deferredOperation</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, it <strong>must</strong> be a
valid <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> object</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-deferredOperation-03678" href="#VUID-vkCopyAccelerationStructureKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03727" href="#VUID-vkCopyAccelerationStructureKHR-buffer-03727"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03727</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03728" href="#VUID-vkCopyAccelerationStructureKHR-buffer-03728"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03728</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
host-visible device memory feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03780" href="#VUID-vkCopyAccelerationStructureKHR-buffer-03780"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03780</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03781" href="#VUID-vkCopyAccelerationStructureKHR-buffer-03781"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03781</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-device-parameter" href="#VUID-vkCopyAccelerationStructureKHR-device-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-deferredOperation-parameter" href="#VUID-vkCopyAccelerationStructureKHR-deferredOperation-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-deferredOperation-parameter</span><br>
 If <code>deferredOperation</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>deferredOperation</code> <strong>must</strong> be a valid <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-pInfo-parameter" href="#VUID-vkCopyAccelerationStructureKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkCopyAccelerationStructureInfoKHR">VkCopyAccelerationStructureInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-deferredOperation-parent" href="#VUID-vkCopyAccelerationStructureKHR-deferredOperation-parent"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-deferredOperation-parent</span><br>
 If <code>deferredOperation</code> is a valid handle, it <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
<li>
<p><code>VK_OPERATION_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_OPERATION_NOT_DEFERRED_KHR</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy host accessible memory to an acceleration structure, call:</p>
</div>
<div id="vkCopyMemoryToAccelerationStructureKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
VkResult vkCopyMemoryToAccelerationStructureKHR(
    VkDevice                                    device,
    VkDeferredOperationKHR                      deferredOperation,
    const VkCopyMemoryToAccelerationStructureInfoKHR* pInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns <code>pInfo-&gt;dst</code>.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> to
<a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#deferred-host-operations-requesting" class="xref page">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="#VkCopyMemoryToAccelerationStructureInfoKHR">VkCopyMemoryToAccelerationStructureInfoKHR</a> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="#vkCmdCopyMemoryToAccelerationStructureKHR">vkCmdCopyMemoryToAccelerationStructureKHR</a> but is executed by the host.</p>
</div>
<div class="paragraph">
<p>This command can accept acceleration structures produced by either
<a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a> or
<a href="#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-accelerationStructureHostCommands-03583" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-accelerationStructureHostCommands-03583"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-accelerationStructureHostCommands-03583</span><br>

The <a href="features.html#features-accelerationStructureHostCommands" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03677" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03677"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03677</span><br>

If <code>deferredOperation</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, it <strong>must</strong> be a
valid <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> object</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03678" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03729" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03729"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03729</span><br>

<code>pInfo-&gt;src.hostAddress</code> <strong>must</strong> be a valid host pointer</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03750" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03750"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03750</span><br>

<code>pInfo-&gt;src.hostAddress</code> <strong>must</strong> be aligned to 16 bytes</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03730" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03730"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03730</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03782" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03782"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03782</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-device-parameter" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-device-parameter"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parameter" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parameter"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parameter</span><br>
 If <code>deferredOperation</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>deferredOperation</code> <strong>must</strong> be a valid <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-parameter" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkCopyMemoryToAccelerationStructureInfoKHR">VkCopyMemoryToAccelerationStructureInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parent" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parent"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parent</span><br>
 If <code>deferredOperation</code> is a valid handle, it <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
<li>
<p><code>VK_OPERATION_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_OPERATION_NOT_DEFERRED_KHR</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy an acceleration structure to host accessible memory, call:</p>
</div>
<div id="vkCopyAccelerationStructureToMemoryKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
VkResult vkCopyAccelerationStructureToMemoryKHR(
    VkDevice                                    device,
    VkDeferredOperationKHR                      deferredOperation,
    const VkCopyAccelerationStructureToMemoryInfoKHR* pInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns <code>pInfo-&gt;src</code>.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> to
<a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#deferred-host-operations-requesting" class="xref page">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="#VkCopyAccelerationStructureToMemoryInfoKHR">VkCopyAccelerationStructureToMemoryInfoKHR</a> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a> but is executed by the host.</p>
</div>
<div class="paragraph">
<p>This command produces the same results as
<a href="#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a>, but writes its result
directly to a host pointer, and is executed on the host rather than the
device.
The output <strong>may</strong> not necessarily be bit-for-bit identical, but it can be
equally used by either <a href="#vkCmdCopyMemoryToAccelerationStructureKHR">vkCmdCopyMemoryToAccelerationStructureKHR</a> or
<a href="#vkCopyMemoryToAccelerationStructureKHR">vkCopyMemoryToAccelerationStructureKHR</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-accelerationStructureHostCommands-03584" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-accelerationStructureHostCommands-03584"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-accelerationStructureHostCommands-03584</span><br>

The <a href="features.html#features-accelerationStructureHostCommands" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03677" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03677"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03677</span><br>

If <code>deferredOperation</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, it <strong>must</strong> be a
valid <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> object</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03678" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03731" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03731"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03731</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03732" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03732"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03732</span><br>

<code>pInfo-&gt;dst.hostAddress</code> <strong>must</strong> be a valid host pointer</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03751" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03751"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03751</span><br>

<code>pInfo-&gt;dst.hostAddress</code> <strong>must</strong> be aligned to 16 bytes</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03783" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03783"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03783</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-device-parameter" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-device-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parameter" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parameter</span><br>
 If <code>deferredOperation</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, <code>deferredOperation</code> <strong>must</strong> be a valid <a href="VK_KHR_deferred_host_operations/deferred_host_operations.html#VkDeferredOperationKHR" class="xref page">VkDeferredOperationKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-parameter" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong>must</strong> be a valid pointer to a valid <a href="#VkCopyAccelerationStructureToMemoryInfoKHR">VkCopyAccelerationStructureToMemoryInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parent" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parent"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parent</span><br>
 If <code>deferredOperation</code> is a valid handle, it <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
<li>
<p><code>VK_OPERATION_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_OPERATION_NOT_DEFERRED_KHR</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query acceleration structure size parameters on the host, call:</p>
</div>
<div id="vkWriteAccelerationStructuresPropertiesKHR" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Provided by VK_KHR_acceleration_structure
VkResult vkWriteAccelerationStructuresPropertiesKHR(
    VkDevice                                    device,
    uint32_t                                    accelerationStructureCount,
    const VkAccelerationStructureKHR*           pAccelerationStructures,
    VkQueryType                                 queryType,
    size_t                                      dataSize,
    void*                                       pData,
    size_t                                      stride);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns the acceleration structures in
<code>pAccelerationStructures</code>.</p>
</li>
<li>
<p><code>accelerationStructureCount</code> is the count of acceleration structures
for which to query the property.</p>
</li>
<li>
<p><code>pAccelerationStructures</code> is a pointer to an array of existing
previously built acceleration structures.</p>
</li>
<li>
<p><code>queryType</code> is a <a href="queries.html#VkQueryType" class="xref page">VkQueryType</a> value specifying the property to
be queried.</p>
</li>
<li>
<p><code>dataSize</code> is the size in bytes of the buffer pointed to by
<code>pData</code>.</p>
</li>
<li>
<p><code>pData</code> is a pointer to a user-allocated buffer where the results
will be written.</p>
</li>
<li>
<p><code>stride</code> is the stride in bytes between results for individual
queries within <code>pData</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="#vkCmdWriteAccelerationStructuresPropertiesKHR">vkCmdWriteAccelerationStructuresPropertiesKHR</a> but is executed by the
host.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureHostCommands-03585" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureHostCommands-03585"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureHostCommands-03585</span><br>

The <a href="features.html#features-accelerationStructureHostCommands" class="xref page">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> if
<code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06742" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06742"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06742</span><br>

<code>queryType</code> <strong>must</strong> be
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SIZE_KHR</code>,
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>,
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code> or
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03448" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03448"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03448</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, then
<code>stride</code> <strong>must</strong> be a multiple of the size of <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03449" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03449"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03449</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, then
<code>pData</code> <strong>must</strong> point to a <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03450" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03450"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03450</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code>, then
<code>stride</code> <strong>must</strong> be a multiple of the size of <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03451" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03451"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03451</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code>, then
<code>pData</code> <strong>must</strong> point to a <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06731" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06731"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06731</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SIZE_KHR</code>, then <code>stride</code>
<strong>must</strong> be a multiple of the size of <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06732" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06732"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06732</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SIZE_KHR</code>, then <code>pData</code>
<strong>must</strong> point to a <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06733" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06733"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06733</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>,
then <code>stride</code> <strong>must</strong> be a multiple of the size of
<code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06734" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06734"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06734</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>,
then <code>pData</code> <strong>must</strong> point to a <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-03452" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-03452"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-03452</span><br>

<code>dataSize</code> <strong>must</strong> be greater than or equal to
<span class="eq"><code>accelerationStructureCount</code>*<code>stride</code></span></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03733" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03733"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03733</span><br>

The <code>buffer</code> used to create each acceleration structure in
<code>pAccelerationStructures</code> <strong>must</strong> be bound to host-visible device
memory</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03784" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03784"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03784</span><br>

The <code>buffer</code> used to create each acceleration structure in
<code>pAccelerationStructures</code> <strong>must</strong> be bound to memory that was not
allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-device-parameter" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-device-parameter"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-device-parameter</span><br>
 <code>device</code> <strong>must</strong> be a valid <a href="devsandqueues.html#VkDevice" class="xref page">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter</span><br>
 <code>pAccelerationStructures</code> <strong>must</strong> be a valid pointer to an array of <code>accelerationStructureCount</code> valid <a href="resources.html#VkAccelerationStructureKHR" class="xref page">VkAccelerationStructureKHR</a> handles</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-parameter" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-parameter"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-parameter</span><br>
 <code>queryType</code> <strong>must</strong> be a valid <a href="queries.html#VkQueryType" class="xref page">VkQueryType</a> value</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-pData-parameter" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-pData-parameter"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-pData-parameter</span><br>
 <code>pData</code> <strong>must</strong> be a valid pointer to an array of <code>dataSize</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength</span><br>
 <code>accelerationStructureCount</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-arraylength" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-arraylength"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-arraylength</span><br>
 <code>dataSize</code> <strong>must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parent" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parent"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parent</span><br>
 Each element of <code>pAccelerationStructures</code> <strong>must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-successcodes" class="xref page">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="fundamentals.html#fundamentals-errorcodes" class="xref page">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
    <!--
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
    -->
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
