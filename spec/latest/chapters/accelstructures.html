<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Acceleration Structures :: Vulkan Documentation Project</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../_/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../_/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../_/img/favicon-16x16.png">
    <link rel="manifest" href="../../../_/static/site.webmanifest">
    <link rel="mask-icon" href="../../../_/img/safari-pinned-tab.svg" color="#a41e22">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../.."><img class="navbar-item" alt="Vulkan White Label" src="../../../_/Vulkan_Docs.svg" /></a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field has-filter">
          <label for="search-input"></label>
          <input id="search-input" type="text" placeholder="Search the docs">
          <label class="filter checkbox">
            <input type="checkbox" data-facet-filter="component:spec" checked> In this component
          </label>
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../spec/latest/chapters/introduction.html">Vulkan 1.3</a>
            <a class="navbar-item" href="https://registry.khronos.org/OpenGL/specs/gl/GLSLangSpec.4.60.html">GLSL</a>
            <a class="navbar-item" href="../../../guide/latest/hlsl.html">HLSL</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Education</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../features/latest/features/index.html">Vulkan Feature Descriptions</a>
            <a class="navbar-item" href="../../../guide/latest/index.html">Vulkan Guide</a>
            <a class="navbar-item" href="../../../samples/latest/README.html">Vulkan Samples</a>
            <a class="navbar-item" href="../../../tutorial/latest/index.html">Vulkan Tutorial</a>
            <a class="navbar-item" href="https://www.youtube.com/c/vulkan">YouTube</a>
            <a class="navbar-item" href="https://vulkan.org">More Info at Vulkan.org</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Feedback</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://github.com/KhronosGroup/Vulkan-Site/issues/new/choose" target="_blank">Report a Problem</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://reddit.com/r/vulkan">Reddit</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/vulkan">Stack Overflow</a>
            <a class="navbar-item" href="https://fosstodon.org/@vulkan">Mastodon</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="spec" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Vulkan Specification</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fundamentals.html">Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="initialization.html">Initialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="devsandqueues.html">Devices and Queues</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cmdbuffers.html">Command Buffers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="synchronization.html">Synchronization and Cache Control</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="renderpass.html">Render Pass</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="shaders.html">Shaders</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pipelines.html">Pipelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="memory.html">Memory Allocation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="resources.html">Resource Creation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="samplers.html">Samplers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="descriptorsets.html">Resource Descriptors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="interfaces.html">Shader Interfaces</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="textures.html">Image Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fragmentdensitymapops.html">Fragment Density Map Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="queries.html">Queries</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="clears.html">Clear Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="copies.html">Copy Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="drawing.html">Drawing Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fxvertex.html">Fixed-Function Vertex Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tessellation.html">Tessellation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="geometry.html">Geometry Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_mesh_shader/mesh.html">Mesh Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_HUAWEI_cluster_culling_shader/clusterculling.html">Cluster Culling Shading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="vertexpostproc.html">Fixed-Function Vertex Post-Processing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="primsrast.html">Rasterization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fragops.html">Fragment Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="framebuffer.html">The Framebuffer</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="dispatch.html">Dispatching Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="device_generated_commands/generatedcommands.html">Device-Generated Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="sparsemem.html">Sparse Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_KHR_surface/wsi.html">Window System Integration (WSI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_KHR_deferred_host_operations/deferred_host_operations.html">Deferred Host Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_EXT_private_data.html">Private Data</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="accelstructures.html">Acceleration Structures</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_EXT_opacity_micromap/micromaps.html">Micromap</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="raytraversal.html">Ray Traversal</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="raytracing.html">Ray Tracing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_memory_decompression.html">Memory Decompression</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="videocoding.html">Video Coding</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="VK_NV_optical_flow/optical_flow.html">Optical Flow</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="executiongraphs.html">Execution Graphs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extensions.html">Extending Vulkan</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="limits.html">Limits</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="formats.html">Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="capabilities.html">Additional Capabilities</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="debugging.html">Debugging</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/spirvenv.html">Vulkan Environment for SPIR-V</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/memorymodel.html">Memory Model</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/compressedtex.html">Compressed Image Formats</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/versions.html">Core Revisions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/extensions.html">Layers &amp; Extensions (Informative)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/roadmap.html">Vulkan Roadmap Milestones</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/boilerplate.html">API Boilerplate</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/invariance.html">Invariance</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/glossary.html">Lexicon</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendices/credits.html">Credits (Informative)</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Vulkan Specification</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../tutorial/latest/00_Introduction.html">Khronos Vulkan Tutorial</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tutorial/latest/00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../features/latest/features/index.html">Vulkan Feature Descriptions</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../features/latest/features/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../guide/latest/index.html">Vulkan Guide</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../samples/latest/README.html">Vulkan Samples</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/latest/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../index.html">Vulkan Specification</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Vulkan Specification</a></li>
    <li><a href="accelstructures.html">Acceleration Structures</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Acceleration Structures</h1>
<div class="sect1">
<h2 id="acceleration-structure-def"><a class="anchor" href="#acceleration-structure-def"></a>Acceleration Structures</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Acceleration structures</em> are data structures used by the implementation to
efficiently manage scene geometry as it is <a href="#ray-traversal">traversed during a ray tracing query</a>.
The application is responsible for managing acceleration structure objects
(see <a href="#resources-acceleration-structures">Acceleration Structures</a>),
including allocation, destruction, executing builds or updates, and
synchronizing resources used during ray tracing queries.</p>
</div>
<div class="paragraph">
<p>There are two types of acceleration structures, <em>top level acceleration
structures</em> and <em>bottom level acceleration structures</em>.</p>
</div>
<div class="paragraph">
<p>An acceleration structure is considered to be constructed if an
<a href="#acceleration-structure-building">acceleration structure build command</a> or
<a href="#acceleration-structure-copying">copy command</a> has been executed with the
given acceleration structure as the destination.</p>
</div>
<div id="fig-accelstruct" class="imageblock text-center">
<div class="content">
<img src="../_images/accelstruct.svg" alt="accelstruct">
</div>
<div class="title">Figure 1. Acceleration Structure</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Caption</div>
<div class="paragraph">
<p>The diagram shows the relationship between top and bottom level acceleration
structures.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-geometry"><a class="anchor" href="#acceleration-structure-geometry"></a>Geometry</h3>
<div class="paragraph">
<p><em>Geometries</em> refer to a triangle or axis-aligned bounding box.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-top-level"><a class="anchor" href="#acceleration-structure-top-level"></a>Top Level Acceleration Structures</h3>
<div class="paragraph">
<p>Opaque acceleration structure for an array of instances.
The descriptor or device address referencing this is the starting point for
traversal.</p>
</div>
<div class="paragraph">
<p>The top level acceleration structure takes a reference to any bottom level
acceleration structure referenced by its instances.
Those bottom level acceleration structure objects <strong>must</strong> be valid when the
top level acceleration structure is accessed.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-bottom-level"><a class="anchor" href="#acceleration-structure-bottom-level"></a>Bottom Level Acceleration Structures</h3>
<div class="paragraph">
<p>Opaque acceleration structure for an array of geometries.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-update"><a class="anchor" href="#acceleration-structure-update"></a>Acceleration Structure Update Rules</h3>
<div class="paragraph">
<p>The API defines two types of operations to produce acceleration structures
from geometry:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>build</em> operation is used to construct an acceleration structure.</p>
</li>
<li>
<p>An <em>update</em> operation is used to modify an existing acceleration
structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An update operation imposes certain constraints on the input, in exchange
for considerably faster execution.
When performing an update, the application is required to provide a full
description of the acceleration structure, but is prohibited from changing
anything other than instance definitions, transform matrices, and vertex or
AABB positions.
All other aspects of the description <strong>must</strong> exactly match the one from the
original build.</p>
</div>
<div class="paragraph">
<p>More precisely, the application <strong>must</strong> not use an update operation to do any
of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change primitives or instances from <em>active</em> to <em>inactive</em>, or vice
versa (as defined in <a href="#acceleration-structure-inactive-prims">Inactive Primitives and Instances</a>).</p>
</li>
<li>
<p>Change the index or vertex formats of triangle geometry.</p>
</li>
<li>
<p>Change triangle geometry transform pointers from null to non-null or
vice versa.</p>
</li>
<li>
<p>Change the number of geometries or instances in the structure.</p>
</li>
<li>
<p>Change the geometry flags for any geometry in the structure.</p>
</li>
<li>
<p>Change the number of vertices or primitives for any geometry in the
structure.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-inactive-prims"><a class="anchor" href="#acceleration-structure-inactive-prims"></a>Inactive Primitives and Instances</h3>
<div class="paragraph">
<p>Acceleration structures allow the use of particular input values to signal
<em>inactive</em> primitives or instances.</p>
</div>
<div class="paragraph">
<p>An <em>inactive</em> triangle is one for which the first (X) component of any
vertex is NaN.
If any other vertex component is NaN, and the first is not, the behavior is
<strong>undefined</strong>.
If the vertex format does not have a NaN representation, then all triangles
are considered active.</p>
</div>
<div class="paragraph">
<p>An <em>inactive</em> instance is one whose acceleration structure reference is <code>0</code>.</p>
</div>
<div class="paragraph">
<p>An <em>inactive</em> AABB is one for which the minimum X coordinate is NaN.
If any other component is NaN, and the first is not, the behavior is
<strong>undefined</strong>.</p>
</div>
<div class="paragraph">
<p>In the above definitions, &#8220;NaN&#8221; refers to any type of NaN.
Signaling, non-signaling, quiet, loud, or otherwise.</p>
</div>
<div class="paragraph">
<p>An inactive object is considered invisible to all rays, and <strong>should</strong> not be
represented in the acceleration structure.
Implementations <strong>should</strong> ensure that the presence of inactive objects does
not seriously degrade traversal performance.</p>
</div>
<div class="paragraph">
<p>Inactive objects are counted in the auto-generated index sequences which are
provided to shaders via <code>InstanceId</code> and <code>PrimitiveId</code> SPIR-V
decorations.
This allows objects in the scene to change freely between the active and
inactive states, without affecting the layout of any arrays which are being
indexed using the ID values.</p>
</div>
<div class="paragraph">
<p>Any transition between the active and inactive states requires a full
acceleration structure rebuild.
Applications <strong>must</strong> not perform an acceleration structure update where an
object is active in the source acceleration structure but would be inactive
in the destination, or vice versa.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-degenerate-prims"><a class="anchor" href="#acceleration-structure-degenerate-prims"></a>Degenerate Primitives and Instances</h3>
<div class="paragraph">
<p><em>Degenerate</em> primitives and instances behave differently to
<a href="#acceleration-structure-inactive-prims">inactive primitives and instances</a>,
and are defined as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>triangles that have one or more vertices whose respective (X), (Y), (Z)
components are identical, or have three vertices that have at least two
of the (X), (Y), or (Z) components identical, therefore forming a line
or point.
Degenerate triangles do not generate any intersections.</p>
</li>
<li>
<p>AABBs whose <code>minX</code>=<code>maxX</code>, <code>minY</code>=<code>maxY</code>, and
<code>minZ</code>=<code>maxZ</code>.
Degenerate AABBs <strong>may</strong> invoke the intersection shader.</p>
</li>
<li>
<p>instances that reference bottom level acceleration structures that
contain no active primitives.
When building an acceleration structure, implementations <strong>should</strong> treat
degenerate instances as though they are a point at the instance origin,
specified by <code>VkAccelerationStructureInstanceKHR</code>::<code>transform</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unlike <em>inactive</em> primitives and instances, <em>degenerate</em> primitives and
instances <strong>may</strong> transition from the degenerate to the non-degenerate state,
or vice versa, when performing an acceleration structure update.</p>
</div>
<div class="paragraph">
<p>If an acceleration structure is built without
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_KHR</code> set in
<code>VkAccelerationStructureBuildGeometryInfoKHR</code>::<code>flags</code>, degenerate
primitives <strong>may</strong> be discarded.
Primitives that are defined with the same index value for more than one
vertex <strong>can</strong> always be discarded.</p>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-building"><a class="anchor" href="#acceleration-structure-building"></a>Building Acceleration Structures</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkTransformMatrixKHR</code> structure is defined as:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/structs/VkTransformMatrixKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>matrix</code> is a 3x4 row-major affine transformation matrix.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/structs/VkTransformMatrixKHR.adoc[]</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkTransformMatrixKHR-matrix-03799" href="#VUID-VkTransformMatrixKHR-matrix-03799"></a> <span class="vuid">VUID-VkTransformMatrixKHR-matrix-03799</span><br>

The first three columns of <code>matrix</code> <strong>must</strong> define an invertible 3x3
matrix</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAabbPositionsKHR</code> structure is defined as:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/structs/VkAabbPositionsKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>minX</code> is the x position of one opposing corner of a bounding box.</p>
</li>
<li>
<p><code>minY</code> is the y position of one opposing corner of a bounding box.</p>
</li>
<li>
<p><code>minZ</code> is the z position of one opposing corner of a bounding box.</p>
</li>
<li>
<p><code>maxX</code> is the x position of the other opposing corner of a bounding
box.</p>
</li>
<li>
<p><code>maxY</code> is the y position of the other opposing corner of a bounding
box.</p>
</li>
<li>
<p><code>maxZ</code> is the z position of the other opposing corner of a bounding
box.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAabbPositionsKHR-minX-03546" href="#VUID-VkAabbPositionsKHR-minX-03546"></a> <span class="vuid">VUID-VkAabbPositionsKHR-minX-03546</span><br>

<code>minX</code> <strong>must</strong> be less than or equal to <code>maxX</code></p>
</li>
<li>
<p><a id="VUID-VkAabbPositionsKHR-minY-03547" href="#VUID-VkAabbPositionsKHR-minY-03547"></a> <span class="vuid">VUID-VkAabbPositionsKHR-minY-03547</span><br>

<code>minY</code> <strong>must</strong> be less than or equal to <code>maxY</code></p>
</li>
<li>
<p><a id="VUID-VkAabbPositionsKHR-minZ-03548" href="#VUID-VkAabbPositionsKHR-minZ-03548"></a> <span class="vuid">VUID-VkAabbPositionsKHR-minZ-03548</span><br>

<code>minZ</code> <strong>must</strong> be less than or equal to <code>maxZ</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/structs/VkAabbPositionsKHR.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><em>Acceleration structure instances</em> <strong>can</strong> be built into top-level acceleration
structures.
Each acceleration structure instance is a separate entry in the top-level
acceleration structure which includes all the geometry of a bottom-level
acceleration structure at a transformed location.
Multiple instances <strong>can</strong> point to the same bottom level acceleration
structure.</p>
</div>
<div class="paragraph">
<p>An acceleration structure instance is defined by the structure:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/structs/VkAccelerationStructureInstanceKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>transform</code> is a <code>VkTransformMatrixKHR</code> structure describing a
transformation to be applied to the acceleration structure.</p>
</li>
<li>
<p><code>instanceCustomIndex</code> is a 24-bit application-specified index value
accessible to ray shaders in the <code>InstanceCustomIndexKHR</code> built-in.</p>
</li>
<li>
<p><code>mask</code> is an 8-bit visibility mask for the geometry.
The instance <strong>may</strong> only be hit if <code>Cull Mask &amp; instance.mask != 0</code></p>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> is a 24-bit offset used in
calculating the hit shader binding table index.</p>
</li>
<li>
<p><code>flags</code> is an 8-bit mask of <code>VkGeometryInstanceFlagBitsKHR</code>
values to apply to this instance.</p>
</li>
<li>
<p><code>accelerationStructureReference</code> is either:</p>
<div class="ulist">
<ul>
<li>
<p>a device address containing the value obtained from
(used by device operations which reference acceleration structures) or,</p>
</li>
<li>
<p>a <code>VkAccelerationStructureKHR</code> object (used by host operations
which reference acceleration structures).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this struct produces the correct layout with existing
compilers.
The intended bit pattern is for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> and <code>mask</code> occupy the same memory as if a
single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> occupies the 24 least significant bits of
that memory</p>
</li>
<li>
<p><code>mask</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> and <code>flags</code> occupy the
same memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> occupies the 24 least
significant bits of that memory</p>
</li>
<li>
<p><code>flags</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong>must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/structs/VkAccelerationStructureInstanceKHR.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Possible values of <code>flags</code> in the instance modifying the behavior of
that instance are:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/enums/VkGeometryInstanceFlagBitsKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_GEOMETRY_INSTANCE_TRIANGLE_FACING_CULL_DISABLE_BIT_KHR</code> disables
face culling for this instance.</p>
</li>
<li>
<p><code>VK_GEOMETRY_INSTANCE_TRIANGLE_FLIP_FACING_BIT_KHR</code> indicates that
the <a href="#ray-traversal-culling-face">facing determination</a> for geometry in
this instance is inverted.
Because the facing is determined in object space, an instance transform
does not change the winding, but a geometry transform does.</p>
</li>
<li>
<p><code>VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_KHR</code> causes this instance to
act as though <code>VK_GEOMETRY_OPAQUE_BIT_KHR</code> were specified on all
geometries referenced by this instance.
This behavior <strong>can</strong> be overridden by the SPIR-V <code>NoOpaqueKHR</code> ray
flag.</p>
</li>
<li>
<p><code>VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_KHR</code> causes this instance
to act as though <code>VK_GEOMETRY_OPAQUE_BIT_KHR</code> were not specified on
all geometries referenced by this instance.
This behavior <strong>can</strong> be overridden by the SPIR-V <code>OpaqueKHR</code> ray flag.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_KHR</code> and
<code>VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_KHR</code> <strong>must</strong> not be used in the
same flag.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/flags/VkGeometryInstanceFlagsKHR.adoc[]</p>
</div>
<div class="paragraph">
<p><code>VkGeometryInstanceFlagsKHR</code> is a bitmask type for setting a mask of
zero or more <code>VkGeometryInstanceFlagBitsKHR</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="acceleration-structure-copying"><a class="anchor" href="#acceleration-structure-copying"></a>Copying Acceleration Structures</h3>
<div class="paragraph">
<p>An additional command exists for copying acceleration structures without
updating their contents.
The acceleration structure object <strong>can</strong> be compacted in order to improve
performance.
Before copying, an application <strong>must</strong> query the size of the resulting
acceleration structure.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query acceleration structure size parameters call:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>accelerationStructureCount</code> is the count of acceleration structures
for which to query the property.</p>
</li>
<li>
<p><code>pAccelerationStructures</code> is a pointer to an array of existing
previously built acceleration structures.</p>
</li>
<li>
<p><code>queryType</code> is a <a href="queries.html#VkQueryType" class="xref page">VkQueryType</a> value specifying the type of
queries managed by the pool.</p>
</li>
<li>
<p><code>queryPool</code> is the query pool that will manage the results of the
query.</p>
</li>
<li>
<p><code>firstQuery</code> is the first query index within the query pool that
will contain the <code>accelerationStructureCount</code> number of results.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to any of the acceleration structures listed in
<code>pAccelerationStructures</code> <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, then the
value written out is the number of bytes required by a compacted
acceleration structure.</p>
</li>
<li>
<p>If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code>, then
the value written out is the number of bytes required by a serialized
acceleration structure.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructure-08924" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructure-08924"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructure-08924</span><br>

The <a href="#features-accelerationStructure">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02493" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02493"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02493</span><br>

<code>queryPool</code> <strong>must</strong> have been created with a <code>queryType</code> matching
<code>queryType</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02494" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02494"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02494</span><br>

The queries identified by <code>queryPool</code> and <code>firstQuery</code> <strong>must</strong> be
<em>unavailable</em></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-buffer-03736" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-buffer-03736"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-buffer-03736</span><br>

The <code>buffer</code> used to create each acceleration structure in
<code>pAccelerationStructures</code> <strong>must</strong> be bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-query-04880" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-query-04880"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-query-04880</span><br>

The sum of <code>firstQuery</code> plus <code>accelerationStructureCount</code> <strong>must</strong>
be less than or equal to the number of queries in <code>queryPool</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> if
<code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-06742" href="#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-06742"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-06742</span><br>

<code>queryType</code> <strong>must</strong> be
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, or
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/protos/vkCmdWriteAccelerationStructuresPropertiesKHR.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Possible values of <code>mode</code> specifying additional operations to perform
during the copy, are:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/enums/VkCopyAccelerationStructureModeKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR</code> creates a direct
copy of the acceleration structure specified in <code>src</code> into the one
specified by <code>dst</code>.
The <code>dst</code> acceleration structure <strong>must</strong> have been created with the
same parameters as <code>src</code>.
If <code>src</code> contains references to other acceleration structures,
<code>dst</code> will reference the same acceleration structures.</p>
</li>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code> creates a more
compact version of an acceleration structure <code>src</code> into <code>dst</code>.
The acceleration structure <code>dst</code> <strong>must</strong> have been created with a size
at least as large as that returned by
<code>vkCmdWriteAccelerationStructuresPropertiesKHR</code>
after the build of the acceleration structure specified by <code>src</code>.
If <code>src</code> contains references to other acceleration structures,
<code>dst</code> will reference the same acceleration structures.</p>
</li>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_SERIALIZE_KHR</code> serializes the
acceleration structure to a semi-opaque format which can be reloaded on
a compatible implementation.</p>
</li>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_DESERIALIZE_KHR</code> deserializes
the semi-opaque serialization format in the buffer to the acceleration
structure.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy an acceleration structure to device memory call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/protos/vkCmdCopyAccelerationStructureToMemoryKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> is an a pointer to a
<code>VkCopyAccelerationStructureToMemoryInfoKHR</code> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>pInfo-&gt;src</code> <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code>.
Accesses to the buffer indicated by <code>pInfo-&gt;dst.deviceAddress</code> <strong>must</strong> be
synchronized with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an and an access
type of <code>VK_ACCESS_TRANSFER_WRITE_BIT</code>.</p>
</div>
<div class="paragraph">
<p>This command produces the same results as
<code>vkCopyAccelerationStructureToMemoryKHR</code>, but writes its result to a
device address, and is executed on the device rather than the host.
The output <strong>may</strong> not necessarily be bit-for-bit identical, but it can be
equally used by either <code>vkCmdCopyMemoryToAccelerationStructureKHR</code> or
<code>vkCopyMemoryToAccelerationStructureKHR</code>.</p>
</div>
<div id="serialized-as-header" class="paragraph">
<p>The defined header structure for the serialized data consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_UUID_SIZE</code> bytes of data matching
<code>VkPhysicalDeviceIDProperties</code>::<code>driverUUID</code></p>
</li>
<li>
<p><code>VK_UUID_SIZE</code> bytes of data identifying the compatibility for
comparison using <code>vkGetDeviceAccelerationStructureCompatibilityKHR</code></p>
</li>
<li>
<p>A 64-bit integer of the total size matching the value queried using
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
<li>
<p>A 64-bit integer of the deserialized size to be passed in to
<code>VkAccelerationStructureCreateInfoKHR</code>::<code>size</code></p>
</li>
<li>
<p>A 64-bit integer of the count of the number of acceleration structure
handles following.
This will be zero for a bottom-level acceleration structure.
For top-level acceleration structures this number is
implementation-dependent; the number of and ordering of the handles may
not match the instance descriptions which were used to build the
acceleration structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The corresponding handles matching the values returned by
are tightly packed in the buffer following the count.
The application is expected to store a mapping between those handles and the
original application-generated bottom-level acceleration structures to
provide when deserializing.
The serialized data is written to the buffer (or read from the buffer)
according to the host endianness.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-accelerationStructure-08926" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-accelerationStructure-08926"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-accelerationStructure-08926</span><br>

The <a href="#features-accelerationStructure">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03739" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03739"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03739</span><br>

<code>pInfo-&gt;dst.deviceAddress</code> <strong>must</strong> be a valid device address for a
buffer bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03740" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03740"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03740</span><br>

<code>pInfo-&gt;dst.deviceAddress</code> <strong>must</strong> be aligned to <code>256</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03741" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03741"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03741</span><br>

If the buffer pointed to by <code>pInfo-&gt;dst.deviceAddress</code> is non-sparse
then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-None-03559" href="#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-None-03559"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-None-03559</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
device memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/protos/vkCmdCopyAccelerationStructureToMemoryKHR.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/structs/VkCopyAccelerationStructureToMemoryInfoKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>src</code> is the source acceleration structure for the copy</p>
</li>
<li>
<p><code>dst</code> is the device or host address to memory which is the target
for the copy</p>
</li>
<li>
<p><code>mode</code> is a <code>VkCopyAccelerationStructureModeKHR</code> value
specifying additional operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-04959" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-04959"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-04959</span><br>

The source acceleration structure <code>src</code> <strong>must</strong> have been constructed
prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-dst-03561" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-dst-03561"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-dst-03561</span><br>

The memory pointed to by <code>dst</code> <strong>must</strong> be at least as large as the
serialization size of <code>src</code>, as reported by
<code>vkWriteAccelerationStructuresPropertiesKHR</code> or
<code>vkCmdWriteAccelerationStructuresPropertiesKHR</code> with a query type of
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-03412" href="#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-03412"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-03412</span><br>

<code>mode</code> <strong>must</strong> be
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_SERIALIZE_KHR</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/structs/VkCopyAccelerationStructureToMemoryInfoKHR.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy device memory to an acceleration structure call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/protos/vkCmdCopyMemoryToAccelerationStructureKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<code>VkCopyMemoryToAccelerationStructureInfoKHR</code> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>pInfo-&gt;dst</code> <strong>must</strong> be <a href="synchronization.html#synchronization-dependencies" class="xref page">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an
<a href="synchronization.html#synchronization-access-types" class="xref page">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>.
Accesses to the buffer indicated by <code>pInfo-&gt;src.deviceAddress</code> <strong>must</strong> be
synchronized with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="synchronization.html#synchronization-pipeline-stages" class="xref page">pipeline stage</a>, and an access type of
<code>VK_ACCESS_TRANSFER_READ_BIT</code>.</p>
</div>
<div class="paragraph">
<p>This command can accept acceleration structures produced by either
<code>vkCmdCopyAccelerationStructureToMemoryKHR</code> or
<code>vkCopyAccelerationStructureToMemoryKHR</code>.</p>
</div>
<div class="paragraph">
<p>The structure provided as input to deserialize is as described in
<code>vkCmdCopyAccelerationStructureToMemoryKHR</code>, with any acceleration
structure handles filled in with the newly-queried handles to bottom level
acceleration structures created before deserialization.
These do not need to be built at deserialize time, but <strong>must</strong> be created.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-accelerationStructure-08927" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-accelerationStructure-08927"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-accelerationStructure-08927</span><br>

The <a href="#features-accelerationStructure">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03742" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03742"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03742</span><br>

<code>pInfo-&gt;src.deviceAddress</code> <strong>must</strong> be a valid device address for a
buffer bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03743" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03743"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03743</span><br>

<code>pInfo-&gt;src.deviceAddress</code> <strong>must</strong> be aligned to <code>256</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03744" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03744"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03744</span><br>

If the buffer pointed to by <code>pInfo-&gt;src.deviceAddress</code> is non-sparse
then it <strong>must</strong> be bound completely and contiguously to a single
<a href="memory.html#VkDeviceMemory" class="xref page">VkDeviceMemory</a> object</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-buffer-03745" href="#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-buffer-03745"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-buffer-03745</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
device memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/protos/vkCmdCopyMemoryToAccelerationStructureKHR.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkCopyMemoryToAccelerationStructureInfoKHR</code> structure is defined
as:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/structs/VkCopyMemoryToAccelerationStructureInfoKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>src</code> is the device or host address to memory containing the source
data for the copy.</p>
</li>
<li>
<p><code>dst</code> is the target acceleration structure for the copy.</p>
</li>
<li>
<p><code>mode</code> is a <code>VkCopyAccelerationStructureModeKHR</code> value
specifying additional operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-src-04960" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-src-04960"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-src-04960</span><br>

The source memory pointed to by <code>src</code> <strong>must</strong> contain data previously
serialized using <code>vkCmdCopyAccelerationStructureToMemoryKHR</code>,
potentially modified to relocate acceleration structure references as
described in that command</p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-03413" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-03413"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-03413</span><br>

<code>mode</code> <strong>must</strong> be
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_DESERIALIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pInfo-03414" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pInfo-03414"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pInfo-03414</span><br>

The data in <code>src</code> <strong>must</strong> have a format compatible with the
destination physical device as returned by
<code>vkGetDeviceAccelerationStructureCompatibilityKHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-03746" href="#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-03746"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-03746</span><br>

<code>dst</code> <strong>must</strong> have been created with a <code>size</code> greater than or
equal to that used to serialize the data in <code>src</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/structs/VkCopyMemoryToAccelerationStructureInfoKHR.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To check if a serialized acceleration structure is compatible with the
current device call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/protos/vkGetDeviceAccelerationStructureCompatibilityKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device to check the version against.</p>
</li>
<li>
<p><code>pVersionInfo</code> is a pointer to a
<code>VkAccelerationStructureVersionInfoKHR</code> structure specifying version
information to check against the device.</p>
</li>
<li>
<p><code>pCompatibility</code> is a pointer to a
<code>VkAccelerationStructureCompatibilityKHR</code> value in which
compatibility information is returned.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-accelerationStructure-08928" href="#VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-accelerationStructure-08928"></a> <span class="vuid">VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-accelerationStructure-08928</span><br>

The <a href="#features-accelerationStructure">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/protos/vkGetDeviceAccelerationStructureCompatibilityKHR.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureVersionInfoKHR</code> structure is defined as:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/structs/VkAccelerationStructureVersionInfoKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="fundamentals.html#VkStructureType" class="xref page">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>pVersionData</code> is a pointer to the version header of an acceleration
structure as defined in <code>vkCmdCopyAccelerationStructureToMemoryKHR</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>pVersionData</code> is a <em>pointer</em> to an array of 2<code>VK_UUID_SIZE</code>
<code>uint8_t</code> values instead of two <code>VK_UUID_SIZE</code> arrays as the expected
use case for this member is to be pointed at the header of a previously
serialized acceleration structure (via
<code>vkCmdCopyAccelerationStructureToMemoryKHR</code> or
<code>vkCopyAccelerationStructureToMemoryKHR</code>) that is loaded in memory.
Using arrays would necessitate extra memory copies of the UUIDs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/structs/VkAccelerationStructureVersionInfoKHR.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Possible values of <code>pCompatibility</code> returned by
<code>vkGetDeviceAccelerationStructureCompatibilityKHR</code> are:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/enums/VkAccelerationStructureCompatibilityKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_COMPATIBILITY_COMPATIBLE_KHR</code> if the
<code>pVersionData</code> version acceleration structure is compatible with
<code>device</code>.</p>
</li>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_COMPATIBILITY_INCOMPATIBLE_KHR</code> if the
<code>pVersionData</code> version acceleration structure is not compatible with
<code>device</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="host-acceleration-structure"><a class="anchor" href="#host-acceleration-structure"></a>Host Acceleration Structure Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Implementations are also required to provide host implementations of the
acceleration structure operations if the
<a href="#features-accelerationStructureHostCommands"><code>accelerationStructureHostCommands</code></a> feature is enabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>vkBuildAccelerationStructuresKHR</code> corresponding to
<code>vkCmdBuildAccelerationStructuresKHR</code></p>
</li>
<li>
<p><code>vkCopyAccelerationStructureKHR</code> corresponding to
<code>vkCmdCopyAccelerationStructureKHR</code></p>
</li>
<li>
<p><code>vkCopyAccelerationStructureToMemoryKHR</code> corresponding to
<code>vkCmdCopyAccelerationStructureToMemoryKHR</code></p>
</li>
<li>
<p><code>vkCopyMemoryToAccelerationStructureKHR</code> corresponding to
<code>vkCmdCopyMemoryToAccelerationStructureKHR</code></p>
</li>
<li>
<p><code>vkWriteAccelerationStructuresPropertiesKHR</code> corresponding to
<code>vkCmdWriteAccelerationStructuresPropertiesKHR</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These commands are functionally equivalent to their device counterparts,
except that they are executed on the host timeline, rather than being
enqueued into command buffers.</p>
</div>
<div class="paragraph">
<p>All acceleration structures used by the host commands <strong>must</strong> be bound to
host-visible memory, and all input data for acceleration structure builds
<strong>must</strong> be referenced using host addresses instead of device addresses.
Applications are not required to map acceleration structure memory when
using the host commands.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>vkBuildAccelerationStructuresKHR</code> and
<code>vkCmdBuildAccelerationStructuresKHR</code> <strong>may</strong> use different algorithms, and
thus are not required to produce identical structures.
The structures produced by these two commands <strong>may</strong> exhibit different memory
footprints or traversal performance, but should strive to be similar where
possible.</p>
</div>
<div class="paragraph">
<p>Apart from these details, the host and device operations are
interchangeable.
For example, an application <strong>can</strong> use <code>vkBuildAccelerationStructuresKHR</code>
to build a structure, compact it on the device using
<code>vkCmdCopyAccelerationStructureKHR</code>, and serialize the result using
<code>vkCopyAccelerationStructureToMemoryKHR</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For efficient execution, acceleration structures manipulated using these
commands should always be bound to host cached memory, as the implementation
may need to repeatedly read and write this memory during the execution of
the command.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build acceleration structures on the host, call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/protos/vkBuildAccelerationStructuresKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the <code>VkDevice</code> for which the acceleration structures
are being built.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <code>VkDeferredOperationKHR</code> to
<a href="#deferred-host-operations-requesting">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>infoCount</code> is the number of acceleration structures to build.
It specifies the number of the <code>pInfos</code> structures and
<code>ppBuildRangeInfos</code> pointers that <strong>must</strong> be provided.</p>
</li>
<li>
<p><code>pInfos</code> is a pointer to an array of <code>infoCount</code>
<code>VkAccelerationStructureBuildGeometryInfoKHR</code> structures defining
the geometry used to build each acceleration structure.</p>
</li>
<li>
<p><code>ppBuildRangeInfos</code> is a pointer to an array of <code>infoCount</code>
pointers to arrays of <code>VkAccelerationStructureBuildRangeInfoKHR</code>
structures.
Each <code>ppBuildRangeInfos</code>[i] is a pointer to an array of
<code>pInfos</code>[i].<code>geometryCount</code>
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structures defining
dynamic offsets to the addresses where geometry data is stored, as
defined by <code>pInfos</code>[i].</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<code>vkCmdBuildAccelerationStructuresKHR</code> but is executed by the host.</p>
</div>
<div class="paragraph">
<p>The <code>vkBuildAccelerationStructuresKHR</code> command provides the ability to
initiate multiple acceleration structures builds, however there is no
ordering or synchronization implied between any of the individual
acceleration structure builds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This means that an application <strong>cannot</strong> build a top-level acceleration
structure in the same <code>vkBuildAccelerationStructuresKHR</code> call as the
associated bottom-level or instance acceleration structures are being built.
There also <strong>cannot</strong> be any memory aliasing between any acceleration structure
memories or scratch memories being used by any of the builds.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-accelerationStructureHostCommands-03581" href="#VUID-vkBuildAccelerationStructuresKHR-accelerationStructureHostCommands-03581"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-accelerationStructureHostCommands-03581</span><br>

The <a href="#features-accelerationStructureHostCommands">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-mode-04628" href="#VUID-vkBuildAccelerationStructuresKHR-mode-04628"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-mode-04628</span><br>

The <code>mode</code> member of each element of <code>pInfos</code> <strong>must</strong> be a valid
<code>VkBuildAccelerationStructureModeKHR</code> value</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-srcAccelerationStructure-04629" href="#VUID-vkBuildAccelerationStructuresKHR-srcAccelerationStructure-04629"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-srcAccelerationStructure-04629</span><br>

If the <code>srcAccelerationStructure</code> member of any element of
<code>pInfos</code> is not <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a>, the
<code>srcAccelerationStructure</code> member <strong>must</strong> be a valid
<code>VkAccelerationStructureKHR</code> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-04630" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-04630"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-04630</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong>must</strong> not be <a href="../appendices/boilerplate.html#VK_NULL_HANDLE" class="xref page">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03403" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03403"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03403</span><br>

The <code>srcAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03698" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03698"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03698</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03800" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03800"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03800</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> be a valid <code>VkAccelerationStructureKHR</code> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03699" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03699"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03699</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong>must</strong> have been created with a
value of <code>VkAccelerationStructureCreateInfoKHR</code>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03700" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03700"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03700</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong>must</strong> have been created with a
value of <code>VkAccelerationStructureCreateInfoKHR</code>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03663" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03663"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03663</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>,
<a href="#acceleration-structure-inactive-prims">inactive primitives</a> in its
<code>srcAccelerationStructure</code> member <strong>must</strong> not be made active</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03664" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03664"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03664</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, active primitives
in its <code>srcAccelerationStructure</code> member <strong>must</strong> not be made
<a href="#acceleration-structure-inactive-prims">inactive</a></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-None-03407" href="#VUID-vkBuildAccelerationStructuresKHR-None-03407"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-None-03407</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong>must</strong> not be referenced by the <code>geometry.instances.data</code> member of
any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other
element of <code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03701" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03701"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03701</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>srcAccelerationStructure</code> member of
any other element of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, which is accessed
by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03702" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03702"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03702</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>dstAccelerationStructure</code> member of
any other element of <code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03703" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03703"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03703</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> (including the same element), which is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-scratchData-03704" href="#VUID-vkBuildAccelerationStructuresKHR-scratchData-03704"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-scratchData-03704</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>scratchData</code> member of any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-scratchData-03705" href="#VUID-vkBuildAccelerationStructuresKHR-scratchData-03705"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-scratchData-03705</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong>must</strong> not overlap the
memory backing the <code>srcAccelerationStructure</code> member of any element
of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> (including the
same element), which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03706" href="#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03706"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03706</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong>must</strong> not
overlap the memory backing any acceleration structure referenced by the
<code>geometry.instances.data</code> member of any element of <code>pGeometries</code>
or <code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03667" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03667"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03667</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong>must</strong> have previously been
constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_KHR</code> set in
<code>VkAccelerationStructureBuildGeometryInfoKHR</code>::<code>flags</code> in the
build</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03668" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03668"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03668</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> and <code>dstAccelerationStructure</code>
members <strong>must</strong> either be the same <code>VkAccelerationStructureKHR</code>, or
not have any <a href="resources.html#resources-memory-aliasing" class="xref page">memory aliasing</a></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03758" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03758"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03758</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>geometryCount</code> member <strong>must</strong> have the same value which was specified
when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03759" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03759"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03759</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>flags</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03760" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03760"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03760</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>type</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03761" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03761"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03761</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>geometryType</code>
member <strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03762" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03762"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03762</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>flags</code> member
<strong>must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03763" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03763"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03763</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.vertexFormat</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03764" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03764"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03764</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.maxVertex</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03765" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03765"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03765</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.indexType</code> member <strong>must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03766" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03766"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03766</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong>must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03767" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03767"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03767</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was not <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong>must</strong> not be
<code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03768" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03768"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03768</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
then the value of each index referenced <strong>must</strong> be the same as the
corresponding index value when <code>srcAccelerationStructure</code> was last
built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-primitiveCount-03769" href="#VUID-vkBuildAccelerationStructuresKHR-primitiveCount-03769"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-primitiveCount-03769</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, the
<code>primitiveCount</code> member of its corresponding
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structure <strong>must</strong> have the
same value which was specified when <code>srcAccelerationStructure</code> was
last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03801" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03801"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03801</span><br>

For each element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the corresponding
<code>ppBuildRangeInfos</code>[i][j].<code>primitiveCount</code> <strong>must</strong> be less than or equal to
<code>VkPhysicalDeviceAccelerationStructurePropertiesKHR</code>::<code>maxInstanceCount</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-10126" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-10126"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-10126</span><br>

For each <code>pInfos</code>[i], <code>dstAccelerationStructure</code> <strong>must</strong> have been
created with a value of
<code>VkAccelerationStructureCreateInfoKHR</code>::<code>size</code> greater than or
equal to either:</p>
<div class="ulist">
<ul>
<li>
<p>the memory size required by the build operation, as returned by
<code>vkGetAccelerationStructureBuildSizesKHR</code> with
<span class="eq"><code>pBuildInfo</code> = <code>pInfos</code>[i]</span> and with each element of the
<code>pMaxPrimitiveCounts</code> array greater than or equal to the equivalent
<code>ppBuildRangeInfos</code>[i][j].<code>primitiveCount</code> values for <code>j</code> in
<span class="eq">[0,<code>pInfos</code>[i].<code>geometryCount</code>)</span> or,</p>
</li>
<li>
<p>the result of querying the corresponding
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, if
updating a compacted acceleration structure</p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676" href="#VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676</span><br>

Each element of <code>ppBuildRangeInfos</code>[i] <strong>must</strong> be a valid pointer to
an array of <code>pInfos</code>[i].<code>geometryCount</code>
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structures</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03678" href="#VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03722" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03722"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03722</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstAccelerationStructure</code> member <strong>must</strong> be bound to host-visible
device memory</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03723" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03723"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03723</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> the <code>buffer</code>
used to create its <code>srcAccelerationStructure</code> member <strong>must</strong> be bound
to host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03724" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03724"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03724</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create each
acceleration structure referenced by the <code>geometry.instances.data</code>
member of any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> <strong>must</strong> be
bound to host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03725" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03725"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03725</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.hostAddress</code> and
<code>pInfos</code>[i].<code>scratchData.hostAddress</code> + N - 1 <strong>must</strong> be valid
host memory, where N is given by the <code>buildScratchSize</code> member of
the <code>VkAccelerationStructureBuildSizesInfoKHR</code> structure returned
from a call to <code>vkGetAccelerationStructureBuildSizesKHR</code> with an
identical <code>VkAccelerationStructureBuildGeometryInfoKHR</code> structure
and primitive count</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03726" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03726"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03726</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.hostAddress</code> and
<code>pInfos</code>[i].<code>scratchData.hostAddress</code> + N - 1 <strong>must</strong> be valid
host memory, where N is given by the <code>updateScratchSize</code> member of
the <code>VkAccelerationStructureBuildSizesInfoKHR</code> structure returned
from a call to <code>vkGetAccelerationStructureBuildSizesKHR</code> with an
identical <code>VkAccelerationStructureBuildGeometryInfoKHR</code> structure
and primitive count</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03771" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03771"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03771</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.hostAddress</code> <strong>must</strong> be a valid host
address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03772" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03772"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03772</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.hostAddress</code> <strong>must</strong> be a valid host
address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03773" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03773"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03773</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.hostAddress</code> is not <code>0</code>, it <strong>must</strong>
be a valid host address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03774" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03774"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03774</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, <code>geometry.aabbs.data.hostAddress</code>
<strong>must</strong> be a valid host address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03775" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03775"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03775</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstAccelerationStructure</code> member <strong>must</strong> be bound to memory that was
not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03776" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03776"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03776</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> the <code>buffer</code>
used to create its <code>srcAccelerationStructure</code> member <strong>must</strong> be bound
to memory that was not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03777" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03777"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03777</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create each
acceleration structure referenced by the <code>geometry.instances.data</code>
member of any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> <strong>must</strong> be
bound to memory that was not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03778" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03778"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03778</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>,
<code>geometry.instances.data.hostAddress</code> <strong>must</strong> be a valid host address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03779" href="#VUID-vkBuildAccelerationStructuresKHR-pInfos-03779"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03779</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, each
<code>VkAccelerationStructureInstanceKHR</code>::<code>accelerationStructureReference</code>
value in <code>geometry.instances.data.hostAddress</code> <strong>must</strong> be a valid
<code>VkAccelerationStructureKHR</code> object</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/protos/vkBuildAccelerationStructuresKHR.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy or compact an acceleration structure on the host, call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/protos/vkCopyAccelerationStructureKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns the acceleration structures.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <code>VkDeferredOperationKHR</code> to
<a href="#deferred-host-operations-requesting">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <code>VkCopyAccelerationStructureInfoKHR</code>
structure defining the copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<code>vkCmdCopyAccelerationStructureKHR</code> but is executed by the host.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-accelerationStructureHostCommands-03582" href="#VUID-vkCopyAccelerationStructureKHR-accelerationStructureHostCommands-03582"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-accelerationStructureHostCommands-03582</span><br>

The <a href="#features-accelerationStructureHostCommands">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-deferredOperation-03678" href="#VUID-vkCopyAccelerationStructureKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03727" href="#VUID-vkCopyAccelerationStructureKHR-buffer-03727"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03727</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03728" href="#VUID-vkCopyAccelerationStructureKHR-buffer-03728"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03728</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03780" href="#VUID-vkCopyAccelerationStructureKHR-buffer-03780"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03780</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03781" href="#VUID-vkCopyAccelerationStructureKHR-buffer-03781"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03781</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/protos/vkCopyAccelerationStructureKHR.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy host accessible memory to an acceleration structure, call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/protos/vkCopyMemoryToAccelerationStructureKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns <code>pInfo-&gt;dst</code>.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <code>VkDeferredOperationKHR</code> to
<a href="#deferred-host-operations-requesting">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<code>VkCopyMemoryToAccelerationStructureInfoKHR</code> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<code>vkCmdCopyMemoryToAccelerationStructureKHR</code> but is executed by the host.</p>
</div>
<div class="paragraph">
<p>This command can accept acceleration structures produced by either
<code>vkCmdCopyAccelerationStructureToMemoryKHR</code> or
<code>vkCopyAccelerationStructureToMemoryKHR</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-accelerationStructureHostCommands-03583" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-accelerationStructureHostCommands-03583"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-accelerationStructureHostCommands-03583</span><br>

The <a href="#features-accelerationStructureHostCommands">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03678" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03729" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03729"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03729</span><br>

<code>pInfo-&gt;src.hostAddress</code> <strong>must</strong> be a valid host pointer</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03750" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03750"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03750</span><br>

<code>pInfo-&gt;src.hostAddress</code> <strong>must</strong> be aligned to 16 bytes</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03730" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03730"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03730</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03782" href="#VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03782"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03782</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/protos/vkCopyMemoryToAccelerationStructureKHR.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy an acceleration structure to host accessible memory, call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/protos/vkCopyAccelerationStructureToMemoryKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns <code>pInfo-&gt;src</code>.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <code>VkDeferredOperationKHR</code> to
<a href="#deferred-host-operations-requesting">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<code>VkCopyAccelerationStructureToMemoryInfoKHR</code> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<code>vkCmdCopyAccelerationStructureToMemoryKHR</code> but is executed by the host.</p>
</div>
<div class="paragraph">
<p>This command produces the same results as
<code>vkCmdCopyAccelerationStructureToMemoryKHR</code>, but writes its result
directly to a host pointer, and is executed on the host rather than the
device.
The output <strong>may</strong> not necessarily be bit-for-bit identical, but it can be
equally used by either <code>vkCmdCopyMemoryToAccelerationStructureKHR</code> or
<code>vkCopyMemoryToAccelerationStructureKHR</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-accelerationStructureHostCommands-03584" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-accelerationStructureHostCommands-03584"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-accelerationStructureHostCommands-03584</span><br>

The <a href="#features-accelerationStructureHostCommands">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03678" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong>must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03731" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03731"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03731</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03732" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03732"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03732</span><br>

<code>pInfo-&gt;dst.hostAddress</code> <strong>must</strong> be a valid host pointer</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03751" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03751"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03751</span><br>

<code>pInfo-&gt;dst.hostAddress</code> <strong>must</strong> be aligned to 16 bytes</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03783" href="#VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03783"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03783</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong>must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/protos/vkCopyAccelerationStructureToMemoryKHR.adoc[]</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query acceleration structure size parameters on the host, call:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/api/protos/vkWriteAccelerationStructuresPropertiesKHR.adoc[]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns the acceleration structures in
<code>pAccelerationStructures</code>.</p>
</li>
<li>
<p><code>accelerationStructureCount</code> is the count of acceleration structures
for which to query the property.</p>
</li>
<li>
<p><code>pAccelerationStructures</code> is a pointer to an array of existing
previously built acceleration structures.</p>
</li>
<li>
<p><code>queryType</code> is a <a href="queries.html#VkQueryType" class="xref page">VkQueryType</a> value specifying the property to
be queried.</p>
</li>
<li>
<p><code>dataSize</code> is the size in bytes of the buffer pointed to by
<code>pData</code>.</p>
</li>
<li>
<p><code>pData</code> is a pointer to an application-allocated buffer where the
results will be written.</p>
</li>
<li>
<p><code>stride</code> is the stride in bytes between results for individual
queries within <code>pData</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<code>vkCmdWriteAccelerationStructuresPropertiesKHR</code> but is executed by the
host.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureHostCommands-03585" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureHostCommands-03585"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureHostCommands-03585</span><br>

The <a href="#features-accelerationStructureHostCommands">    <code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong>must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong>must</strong> have
been built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> if
<code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06742" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06742"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06742</span><br>

<code>queryType</code> <strong>must</strong> be
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, or
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03448" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03448"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03448</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, then
<code>stride</code> <strong>must</strong> be a multiple of the size of <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03449" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03449"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03449</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, then
<code>pData</code> <strong>must</strong> point to a <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03450" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03450"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03450</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code>, then
<code>stride</code> <strong>must</strong> be a multiple of the size of <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03451" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03451"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03451</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code>, then
<code>pData</code> <strong>must</strong> point to a <code>VkDeviceSize</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-03452" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-03452"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-03452</span><br>

<code>dataSize</code> <strong>must</strong> be greater than or equal to
<span class="eq"><code>accelerationStructureCount</code>*<code>stride</code></span></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03733" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03733"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03733</span><br>

The <code>buffer</code> used to create each acceleration structure in
<code>pAccelerationStructures</code> <strong>must</strong> be bound to host-visible device
memory</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03784" href="#VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03784"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03784</span><br>

The <code>buffer</code> used to create each acceleration structure in
<code>pAccelerationStructures</code> <strong>must</strong> be bound to memory that was not
allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/chapters/accelstructures.adoc - include::partial$gen/validity/protos/vkWriteAccelerationStructuresPropertiesKHR.adoc[]</p>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
