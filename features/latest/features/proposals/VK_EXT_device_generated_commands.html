<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VK_EXT_device_generated_commands :: Vulkan Documentation Project</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../_/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../_/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../_/img/favicon-16x16.png">
    <link rel="manifest" href="../../../../_/static/site.webmanifest">
    <link rel="mask-icon" href="../../../../_/img/safari-pinned-tab.svg" color="#a41e22">
    <meta name="msapplication-TileColor" content="#ffc40d">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../.."><img class="navbar-item" alt="Vulkan White Label" src="../../../../_/Vulkan_Docs.svg" /></a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field has-filter">
          <label for="search-input"></label>
          <input id="search-input" type="text" placeholder="Search the docs">
          <label class="filter checkbox">
            <input type="checkbox" data-facet-filter="component:features" checked> In this component
          </label>
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../spec/latest/chapters/introduction.html">Vulkan API</a>
            <a class="navbar-item" href="../../../../glsl/latest/index.html">GLSL</a>
            <a class="navbar-item" href="../../../../guide/latest/hlsl.html">HLSL</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Education</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../features/latest/features/index.html">Vulkan Feature Descriptions</a>
            <a class="navbar-item" href="../../../../guide/latest/index.html">Vulkan Guide</a>
            <a class="navbar-item" href="../../../../samples/latest/README.html">Vulkan Samples</a>
            <a class="navbar-item" href="../../../../tutorial/latest/index.html">Vulkan Tutorial</a>
            <a class="navbar-item" href="https://www.youtube.com/c/vulkan">YouTube</a>
            <a class="navbar-item" href="https://vulkan.org">More Info at Vulkan.org</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Feedback</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://github.com/KhronosGroup/Vulkan-Site/issues/new/choose" target="_blank">Report a Problem</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://reddit.com/r/vulkan">Reddit</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/vulkan">Stack Overflow</a>
            <a class="navbar-item" href="https://fosstodon.org/@vulkan">Mastodon</a>
          </div>
        </div>
      </div>
    </div>
    <label class="theme-toggler">
      <input type="checkbox" id="switch-theme-checkbox" name="switch-theme-checkbox"/>
      <span class="icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="moon" class="svg-inline--fa fa-moon moon" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"></path>
        </svg>
        <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="sun" class="svg-inline--fa fa-sun sun" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"></path>
        </svg></span>
      <span class="text">light</span>
    </label>
  </nav>
</header>
<script>
  !function() {
    let e = document.getElementById("switch-theme-checkbox")
    e.checked = document.documentElement.classList.contains("dark-theme")
    e.addEventListener("change", function() {
      if (document.documentElement.classList.contains("light")) {
        document.documentElement.classList.remove("light")
        document.documentElement.classList.add("dark")
      } else if (document.documentElement.classList.contains("dark")) {
        document.documentElement.classList.remove("dark")
        document.documentElement.classList.add("light")
      } else {
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          document.documentElement.classList.add("dark")
        } else {
          document.documentElement.classList.add("light")
        }
      }
      document.documentElement.classList.toggle("dark-theme", this.checked), document.documentElement.setAttribute("data-theme", this.checked ? "dark" : "light"),
        function(e) {
          window.localStorage && window.localStorage.setItem("theme", e)
        }(this.checked ? "dark" : "light"), this.checked ? this.parentElement.classList.add("active") : this.parentElement.classList.remove("active")
    }.bind(e))
  }();
</script>
<div class="body">
<div class="nav-container" data-component="features" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Vulkan Feature Descriptions</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Vulkan Roadmap and Feature Descriptions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Roadmap.html">Vulkan Roadmap</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Feature Descriptions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_AMDX_shader_enqueue.html">VK_AMDX_shader_enqueue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_AMD_anti_lag.html">VK_AMD_anti_lag</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_AMD_shader_early_and_late_fragment_tests.html">VK_AMD_shader_early_and_late_fragment_tests</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_ANDROID_external_format_resolve.html">VK_ANDROID_external_format_resolve</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_ARM_render_pass_striped.html">VK_ARM_render_pass_striped</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_attachment_feedback_loop_dynamic_state.html">VK_EXT_attachment_feedback_loop_dynamic_state</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_attachment_feedback_loop_layout.html">VK_EXT_attachment_feedback_loop_layout</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_calibrated_timestamps.html">VK_EXT_calibrated_timestamps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_depth_bias_control.html">VK_EXT_depth_bias_control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_depth_clamp_control.html">VK_EXT_depth_clamp_control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_descriptor_buffer.html">VK_EXT_descriptor_buffer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_device_fault.html">VK_EXT_device_fault</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="VK_EXT_device_generated_commands.html">VK_EXT_device_generated_commands</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_dynamic_rendering_unused_attachments.html">VK_EXT_dynamic_rendering_unused_attachments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_extended_dynamic_state3.html">VK_EXT_extended_dynamic_state3</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_external_memory_acquire_unmodified.html">VK_EXT_external_memory_acquire_unmodified</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_frame_boundary.html">Proposal: <code>VK_EXT_frame_boundary</code></a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_graphics_pipeline_library.html">VK_EXT_graphics_pipeline_library</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_host_image_copy.html">VK_EXT_host_image_copy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_image_2d_array_of_3d.html">VK_EXT_image_2d_array_of_3d</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_image_compression_control.html">VK_EXT_image_compression_control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_image_sliced_view_of_3d.html">VK_EXT_image_sliced_view_of_3d</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_layer_settings.html">VK_EXT_layer_settings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_legacy_dithering.html">VK_EXT_legacy_dithering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_legacy_vertex_attributes.html">VK_EXT_legacy_vertex_attributes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_map_memory_placed.html">VK_EXT_map_memory_placed</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_mesh_shader.html">VK_EXT_mesh_shader</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_metal_objects.html">VK_EXT_metal_objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_multisampled_render_to_single_sampled.html">VK_EXT_multisampled_render_to_single_sampled</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_mutable_descriptor_type.html">VK_EXT_mutable_descriptor_type</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_non_seamless_cube_map.html">VK_EXT_non_seamless_cube_map</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_opacity_micromap.html">VK_EXT_opacity_micromap</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_pipeline_library_group_handles.html">VK_EXT_pipeline_library_group_handles</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_pipeline_protected_access.html">VK_EXT_pipeline_protected_access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_present_mode_fifo_latest_ready.html">VK_EXT_present_mode_fifo_latest_ready</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_primitives_generated_query.html">VK_EXT_primitives_generated_query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_rasterization_order_attachment_access.html">VK_EXT_rasterization_order_attachment_access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_shader_module_identifier.html">VK_EXT_shader_module_identifier</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_shader_object.html">VK_EXT_shader_object</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_shader_replicated_composites.html">VK_EXT_shader_replicated_composites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_shader_tile_image.html">VK_EXT_shader_tile_image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_subpass_merge_feedback.html">VK_EXT_subpass_merge_feedback</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_surface_maintenance1.html">VK_EXT_surface_maintenance1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_swapchain_maintenance1.html">VK_EXT_swapchain_maintenance1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_GOOGLE_surfaceless_query.html">VK_GOOGLE_surfaceless_query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_HUAWEI_cluster_culling_shader.html">VK_HUAWEI_cluster_culling_shader</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_HUAWEI_invocation_mask.html">VK_HUAWEI_invocation_mask</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_compute_shader_derivatives.html">VK_KHR_compute_shader_derivatives</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_cooperative_matrix.html">VK_KHR_cooperative_matrix</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_dynamic_rendering.html">VK_KHR_dynamic_rendering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_dynamic_rendering_local_read.html">VK_KHR_dynamic_rendering_local_read</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_fragment_shader_barycentric.html">VK_KHR_fragment_shader_barycentric</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_fragment_shading_rate.html">VK_KHR_fragment_shading_rate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_load_store_op_none.html">VK_KHR_load_store_op_none</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_maintenance5.html">VK_KHR_maintenance5</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_maintenance6.html">VK_KHR_maintenance6</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_maintenance7.html">VK_KHR_maintenance7</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_map_memory2.html">VK_KHR_map_memory2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_pipeline_binary.html">VK_KHR_pipeline_binary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_ray_tracing_position_fetch.html">VK_KHR_ray_tracing_position_fetch</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_expect_assume.html">VK_KHR_shader_expect_assume</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_float_controls2.html">VK_KHR_shader_float_controls2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_integer_dot_product.html">VK_KHR_shader_integer_dot_product</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_maximal_reconvergence.html">VK_KHR_shader_maximal_reconvergence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_quad_control.html">VK_KHR_shader_quad_control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_relaxed_extended_instruction.html">VK_KHR_shader_relaxed_extended_instruction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_subgroup_rotate.html">Subgroup rotation instruction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_vertex_attribute_divisor.html">VK_KHR_vertex_attribute_divisor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_decode_av1.html">VK_KHR_video_decode_av1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_decode_h264.html">VK_KHR_video_decode_h264</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_decode_h265.html">VK_KHR_video_decode_h265</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_decode_queue.html">VK_KHR_video_decode_queue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_encode_av1.html">VK_KHR_video_encode_av1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_encode_h264.html">VK_KHR_video_encode_h264</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_encode_h265.html">VK_KHR_video_encode_h265</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_encode_quantization_map.html">VK_KHR_video_encode_quantization_map</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_encode_queue.html">VK_KHR_video_encode_queue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_maintenance1.html">VK_KHR_video_maintenance1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_queue.html">VK_KHR_video_queue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_LUNARG_direct_driver_loading.html">VK_LUNARG_direct_driver_loading</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_MSFT_layered_driver.html">VK_MSFT_layered_driver</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_NV_cooperative_matrix2.html">VK_NV_cooperative_matrix2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_NV_display_stereo.html">VK_NV_display_stereo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_NV_ray_tracing_validation.html">VK_NV_ray_tracing_validation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_QCOM_image_processing.html">VK_QCOM_image_processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_QCOM_tile_properties.html">VK_QCOM_tile_properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_VERSION_1_4.html">Vulkan 1.4</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Vulkan Feature Descriptions</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../../tutorial/latest/00_Introduction.html">Khronos Vulkan Tutorial</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../tutorial/latest/00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../../glsl/latest/index.html">OpenGL Shading Language Specification</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../glsl/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../index.html">Vulkan Feature Descriptions</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../../guide/latest/index.html">Vulkan Guide</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../../samples/latest/README.html">Vulkan Samples</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../samples/latest/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../../spec/latest/index.html">Vulkan Specification</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../spec/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../spec/latest/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Vulkan Feature Descriptions</a></li>
    <li>Feature Descriptions</li>
    <li><a href="VK_EXT_device_generated_commands.html">VK_EXT_device_generated_commands</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">VK_EXT_device_generated_commands</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_problem_statement">1. Problem Statement</a></li>
<li><a href="#_solution_space">2. Solution Space</a>
<ul class="sectlevel2">
<li><a href="#_goals">2.1. Goals</a></li>
<li><a href="#_current_implementations">2.2. Current implementations</a></li>
<li><a href="#_command_representation">2.3. Command representation</a></li>
</ul>
</li>
<li><a href="#_proposal">3. Proposal</a>
<ul class="sectlevel2">
<li><a href="#_key_differences_with_vk_nv_device_generated_commands">3.1. Key differences with <code>VK_NV_device_generated_commands</code></a></li>
<li><a href="#_indirect_execution_sets">3.2. Indirect Execution Sets</a></li>
<li><a href="#_indirect_commands_layout">3.3. Indirect Commands Layout</a></li>
<li><a href="#_indirect_commands">3.4. Indirect Commands</a></li>
<li><a href="#_preprocess_buffer">3.5. Preprocess Buffer</a></li>
<li><a href="#_command_buffer">3.6. Command Buffer</a></li>
<li><a href="#_features">3.7. Features</a></li>
<li><a href="#_properties">3.8. Properties</a></li>
<li><a href="#_d3d12_emulation">3.9. D3D12 Emulation</a></li>
</ul>
</li>
<li><a href="#_examples">4. Examples</a></li>
<li><a href="#_issues">5. Issues</a>
<ul class="sectlevel2">
<li><a href="#_unresolved_how_will_future_commands_be_added">5.1. UNRESOLVED: How will future commands be added?</a></li>
<li><a href="#_resolved_should_additional_state_be_included">5.2. RESOLVED: Should additional state be included?</a></li>
<li><a href="#_resolved_what_shader_stages_or_pipeline_states_should_be_allowed_to_change">5.3. RESOLVED: What shader stages or pipeline states should be allowed to change?</a></li>
<li><a href="#_unresolved_should_indirect_execution_sets_be_merged_with_either_shader_binding_tables_or_indirect_object_sets">5.4. UNRESOLVED: Should Indirect execution sets be merged with either Shader Binding Tables or Indirect Object Sets?</a></li>
<li><a href="#_resolved_should_additional_alignment_properties_be_added">5.5. RESOLVED: Should additional alignment properties be added?</a></li>
<li><a href="#_resolved_should_index_type_values_be_remappable">5.6. RESOLVED: Should index type values be remappable?</a></li>
<li><a href="#_resolved_should_indirect_buffers_be_reusable">5.7. RESOLVED: Should indirect buffers be reusable?</a></li>
<li><a href="#_resolved_how_should_commands_with_less_than_32_bits_of_data_be_handled">5.8. RESOLVED: How should commands with less than 32-bits of data be handled?</a></li>
<li><a href="#_resolved_how_should_applications_provide_data_to_the_preprocess_command_in_order_for_drivers_to_optimize_indirect_execution">5.9. RESOLVED: How should applications provide data to the preprocess command in order for drivers to optimize indirect execution?</a></li>
</ul>
</li>
<li><a href="#_further_functionality">6. Further Functionality</a></li>
<li><a href="#_todo">7. TODO</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document details API design for indirect execution of device generated commands, improving performance by eliminating unnecessary host and device work.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_problem_statement"><a class="anchor" href="#_problem_statement"></a>1. Problem Statement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Device-driven rendering is increasingly used to manage large and complex environments.  Scene management in particular is well suited for execution on device and is responsible for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Traversing the scene</p>
</li>
<li>
<p>Managing LoD</p>
</li>
<li>
<p>Performing various culling algorithms</p>
</li>
<li>
<p>Generating work to render the visible result</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Graphics APIs differ in their expressiveness but most have limitations for device-driven scene management that result in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unnecessary state changes</p>
</li>
<li>
<p>Wasted memory for worst-case allocations for intermediate results</p>
</li>
<li>
<p>Round-tripping through memory instead of staying on chip</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This proposal focuses on reducing unnecessary state changes.  For example, enabling a device to use compute shaders to launch other compute shaders rather than requiring explicit dispatch commands to be recorded.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_solution_space"><a class="anchor" href="#_solution_space"></a>2. Solution Space</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several approaches to reduce unnecessary state changes.  Here are some potential solutions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>No API changes</p>
<div class="ulist">
<ul>
<li>
<p>Work is done on the host to determine the set of shaders that are potentially visible.  This might be a simpler problem than object/triangle culling.</p>
</li>
<li>
<p>Potentially duplicates work done by the device.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Work Graphs</p>
<div class="ulist">
<ul>
<li>
<p>D3D12 supports Work Graphs, which are a more powerful method of moving work generation to the GPU</p>
</li>
<li>
<p>Standardization and cross-vendor support of this advanced functionality takes a long time to achieve ecosystem adoption</p>
</li>
</ul>
</div>
</li>
<li>
<p>Predicated/Conditional Rendering</p>
<div class="ulist">
<ul>
<li>
<p>Commands are optionally executed depending on a condition evaluated on the device timeline.</p>
</li>
<li>
<p>Exposed in D3D12 as <code>ID3D12GraphicsCommandList::SetPredication</code></p>
</li>
<li>
<p>Host encoding overhead of binding the shaders still exists.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Indirect Command Buffers (Host)</p>
<div class="ulist">
<ul>
<li>
<p>Similar to secondary command buffers but with different restrictions and inheritance rules.</p>
</li>
<li>
<p>Create multiple indirect command buffers (e.g. one per pipeline).</p>
</li>
<li>
<p>Indirect execution of multiple indirect command buffers.</p>
</li>
<li>
<p>May require patching/fast updating of objects referenced by the indirect command buffer.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Indirect Command Buffers (Device)</p>
<div class="ulist">
<ul>
<li>
<p>Created in a compute shader.</p>
</li>
<li>
<p>Can be re-created every frame avoiding multiple execution complexity or patching.</p>
</li>
<li>
<p>Requires extensive shading language support.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enhanced Indirect</p>
<div class="ulist">
<ul>
<li>
<p>Add support to execute multiple types of operations in a sequence.</p>
</li>
<li>
<p>Limited state changes and operations compared to what is available for primary or secondary command buffers.</p>
</li>
<li>
<p>Should be able to represent most work in a "pass" (e.g. drawing shadows or opaque geometry)</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Many graphics APIs have more expressive indirect capabilities.  This proposal pursues that approach to address both the problem statement and provide an emulation target.</p>
</div>
<div class="sect2">
<h3 id="_goals"><a class="anchor" href="#_goals"></a>2.1. Goals</h3>
<div class="paragraph">
<p>These are the primary goals for the proposal:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Efficient implementation for many-draws and many-dispatches per set of shaders.</p>
</li>
<li>
<p>Device-side binding of shaders.</p>
</li>
<li>
<p>Changing shaders for indirect dispatch during application lifetime.</p>
</li>
<li>
<p>Emulation of D3D12 indirect execution.</p>
</li>
<li>
<p>Emulation of D3D12 work graphs.</p>
</li>
<li>
<p>Transition existing uses of <code>NV_device_generated_commands</code> and <code>NV_device_generated_commands_compute</code>.</p>
</li>
<li>
<p>Single framework for all execution-based indirect commands.  Other indirect operations (e.g. building acceleration structures) have very different setup and argument management.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_current_implementations"><a class="anchor" href="#_current_implementations"></a>2.2. Current implementations</h3>
<div class="sect3">
<h4 id="_vulkan"><a class="anchor" href="#_vulkan"></a>2.2.1. Vulkan</h4>
<div class="paragraph">
<p>Indirect execution in Vulkan typically support only a single type of command:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>vkCmdDrawIndirect</code></p>
</li>
<li>
<p><code>vkCmdDrawIndexedIndirect</code></p>
</li>
<li>
<p><code>vkCmdDispatchIndirect</code></p>
</li>
<li>
<p><code>vkCmdDrawIndirectCount</code> (Vulkan 1.2)</p>
</li>
<li>
<p><code>vkCmdDrawIndexedIndirectCount</code> (Vulkan 1.2)</p>
</li>
<li>
<p><code>vkCmdDrawMeshTasksIndirectNV</code> (VK_NV_mesh_shader)</p>
</li>
<li>
<p><code>vkCmdDrawMeshTasksIndirectCountNV</code> (VK_NV_mesh_shader)</p>
</li>
<li>
<p><code>vkCmdBuildAccelerationStructuresIndirectKHR</code> (VK_KHR_acceleration_structure)</p>
</li>
<li>
<p><code>vkCmdTraceRaysIndirectKHR</code> (VK_KHR_ray_tracing_pipeline)</p>
</li>
<li>
<p><code>vkCmdDrawMeshTasksIndirectEXT</code> (VK_EXT_mesh_shader)</p>
</li>
<li>
<p><code>vkCmdDrawMeshTasksIndirectCountEXT</code> (VK_EXT_mesh_shader)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>VK_NV_device_generated_commands</code> extension enables a more expressive model supporting multiple commands in a sequence that may change the following state:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Shaders</p>
</li>
<li>
<p>Primitive winding</p>
</li>
<li>
<p>Index and vertex buffers</p>
</li>
<li>
<p>Push constants</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and perform the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Indexed and non-indexed draws</p>
</li>
<li>
<p>Mesh tasks</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_d3d12"><a class="anchor" href="#_d3d12"></a>2.2.2. D3D12</h4>
<div class="paragraph">
<p>D3D12 indirect execution is similar in expressivity to both <code>VK_NV_device_generated_commands</code> and <code>VK_NV_device_generated_commands_compute</code> but offers no mechanism for changing graphics shaders or pipelines.  It is currently possible to emulate D3D12 behavior on top of <code>VK_NV_device_generated_commands</code> and other base Vulkan functionality so it is important to not lose any features required for emulation with this proposal.</p>
</div>
<div class="paragraph">
<p>D3D12 work graphs are more powerful in certain aspects than indirect execution but are not yet officially supported in Vulkan.</p>
</div>
</div>
<div class="sect3">
<h4 id="_metal"><a class="anchor" href="#_metal"></a>2.2.3. Metal</h4>
<div class="paragraph">
<p>Metal is similar in expressivity to <code>VK_NV_device_generated_commands</code> and supports full pipeline changes as well as the equivalent of binding descriptor sets.</p>
</div>
<div class="paragraph">
<p>Indirect buffer layout is opaque and can be encoded on host through the API or on device using a compute shader.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">​struct arguments { command_buffer cmd_buffer; };​
​
kernel void producer(device arguments&amp; args, ushort cmd_idx [[thread_position_in_grid]])​
{​
    render_command cmd(args.cmd_buffer, cmd_idx);​
    cmd.set_render_pipeline_state(...);​
    cmd.set_vertex_buffer(...);​
    cmd.draw_primitives(...);​
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_command_representation"><a class="anchor" href="#_command_representation"></a>2.3. Command representation</h3>
<div class="paragraph">
<p>Supporting multiple commands in an indirect buffer can either be done with a homogeneous structure where the layout is fixed and the same pattern of operations is executed.  Another alternative is a heterogeneous structure where there is no restriction on command ordering.  For heterogeneous layout, the size of the arguments for each command may also vary.</p>
</div>
<div class="paragraph">
<p>This proposal uses a homogeneous structure which matches D3D12, Metal, and <code>VK_NV_device_generated_commands</code>.  This restricted model simplifies construction and interpretation of the data while also introducing an optimization challenge.</p>
</div>
<div class="paragraph">
<p>Consider a sequence of <code>Bind Shaders/Draw</code> that binds the same shaders multiple times.  If the command buffer is constructed on the host,  draw calls with the same shaders can be grouped together creating a heterogeneous structure.  There are several options to with a homogeneous structure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On-device optimization.  The implementation could detect/remove duplicates during pre-processing or execution.  This may be difficult or impractical for a device to implement.</p>
</li>
<li>
<p>Multi-level indirect.  One of the indirect operations could be another indirect execution.  For example, a two-level solution could be used with low-frequency operations in the first indirect buffer and high-frequency operations in the second indirect buffer.</p>
</li>
<li>
<p>IndirectCount commands.  Vulkan has pre-existing indirect commands that execute multiple operations with a device-specified count.  This is equivalent to a heavily constrained multi-level indirect solution.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This proposal does not expect significant on-device optimization and uses IndirectCount commands which are capable of representing many common application scenarios.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proposal"><a class="anchor" href="#_proposal"></a>3. Proposal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This proposal targets Vulkan 1.3 building on functionality from <code>NV_device_generated_commands</code> to address the problem statement and also provide an emulation target for other APIs.</p>
</div>
<div class="paragraph">
<p>Indirect buffers contain work elements (sequences) of uniform structure.  The memory layout of a sequence is described by an Indirect Commands Layout that specifies a fixed number of command buffer operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Shaders</p>
</li>
<li>
<p>Push constants</p>
</li>
<li>
<p>Index and vertex buffers</p>
</li>
<li>
<p>Draws and dispatches</p>
</li>
<li>
<p>Multi-draws with device-specified count</p>
</li>
<li>
<p>Trace rays</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The extension provides a common framework for all existing and future indirect commands. An implementation does not need to support every command (see the Features section for more detail).</p>
</div>
<div class="paragraph">
<p>Sequences of compute commands that change shaders must refer to elements of an Indirect Execution Set, a table that references multiple shaders of similar state.</p>
</div>
<div class="paragraph">
<p>Implementations may also require a preprocess buffer to translate to a device-specific format.  With Multi-draw commands being available, optimization of the preprocess buffer to remove duplicates is not expected.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/proposals/VK_EXT_device_generated_commands_overview.svg" alt="VK EXT device generated commands overview">
</div>
</div>
<div class="paragraph">
<p>The generation of device generated commands uses the following principle steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define via <code>VkIndirectCommandsLayoutEXT</code> the sequence of commands which can be generated.</p>
</li>
<li>
<p>Optionally create and update an <code>VkIndirectExecutionSetEXT</code> to support changing shaders.</p>
</li>
<li>
<p>Retrieve device addresses and handles for objects stored in indirect buffers.</p>
</li>
<li>
<p>Fill a <code>VkBuffer</code> with the content that matches the indirect command layout.</p>
</li>
<li>
<p>Create a preprocess <code>VkBuffer</code> that satisfies the allocation information from <code>vkGetGeneratedCommandsMemoryRequirementsEXT</code>.</p>
</li>
<li>
<p>Optionally preprocess the input data using <code>vkCmdPreprocessGeneratedCommandsEXT</code> in a separate action.</p>
</li>
<li>
<p>Generate and execute the actual commands via <code>vkCmdExecuteGeneratedCommandsEXT</code> passing all required data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>vkCmdPreprocessGeneratedCommandsEXT</code> executes in a separate logical pipeline from either graphics or compute. When preprocessing commands in a separate step they must be explicitly synchronized against the command execution. When not preprocessing, the preprocessing is automatically synchronized against the command execution.</p>
</div>
<div class="sect2">
<h3 id="_key_differences_with_vk_nv_device_generated_commands"><a class="anchor" href="#_key_differences_with_vk_nv_device_generated_commands"></a>3.1. Key differences with <code>VK_NV_device_generated_commands</code></h3>
<div class="ulist">
<ul>
<li>
<p>Common indirect commands under one unified framework (graphics, compute, and ray tracing)</p>
</li>
<li>
<p>Incremental update of shaders available for use</p>
</li>
<li>
<p>Adds IndirectCount commands</p>
</li>
<li>
<p>Adds compute dispatch support</p>
</li>
<li>
<p>Single-interleaved stream</p>
</li>
<li>
<p>VK_EXT_shader_object support</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_indirect_execution_sets"><a class="anchor" href="#_indirect_execution_sets"></a>3.2. Indirect Execution Sets</h3>
<div class="paragraph">
<p>Indirect buffers that bind shaders reference shaders (pipelines or shader objects) managed by a collection represented by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">VK_DEFINE_NON_DISPATCHABLE_HANDLE(VkIndirectExecutionSetEXT)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Indirect execution sets group both pipelines with the same <code>VkPipelineLayout</code> and shader stages with matching per-stage descriptor layouts.</p>
</div>
<div class="paragraph">
<p>Indirect execution sets contain a maximum number of N execution slots that can be updated when not referenced by indirect buffers currently in flight. Drivers should ensure that updating a set is a pretty cheap operation as it is expected to be modified as application content changes.</p>
</div>
<div class="paragraph">
<p>Modifications to an indirect execution set may change the sizing requirements of the preprocess buffer.  Applications must call <code>vkGetGeneratedCommandsMemoryRequirementsEXT</code> and update the preprocess buffer if needed when modifications are complete.</p>
</div>
<div class="sect3">
<h4 id="_creation_and_deletion"><a class="anchor" href="#_creation_and_deletion"></a>3.2.1. Creation and Deletion</h4>
<div class="paragraph">
<p>Indirect execution sets are created by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">VKAPI_ATTR VkResult VKAPI_CALL vkCreateIndirectExecutionSetEXT(
    VkDevice                                   device,
    const VkIndirectExecutionSetCreateInfoEXT* pCreateInfo,
    const VkAllocationCallbacks*               pAllocator,
    VkIndirectExecutionSetEXT*                 pIndirectExecutionSet);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that creates the indirect execution set.</p>
</li>
<li>
<p><code>pCreateInfo</code> is a pointer to a <code>VkIndirectExecutionSetCreateInfoEXT</code> structure containing parameters affecting creation of the indirect execution set.</p>
</li>
<li>
<p><code>pAllocator</code> controls host memory allocation as described in the Memory Allocation chapter.</p>
</li>
<li>
<p><code>pIndirectExecutionSet</code> is a pointer to a <code>VkIndirectExecutionSetEXT</code> handle in which the resulting indirect execution set is returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>VkIndirectExecutionSetCreateInfoEXT</code> structure is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkIndirectExecutionSetCreateInfoEXT {
    VkStructureType                         sType;
    const void*                             pNext;
    VkIndirectExecutionSetInfoTypeEXT       type;
    VkIndirectExecutionSetInfoEXT           info;
} VkIndirectExecutionSetCreateInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>type</code> is a <code>VkIndirectExecutionSetInfoTypeEXT</code> describing the type of set being created and determining which field of the info union will be used.</p>
</li>
<li>
<p><code>info</code> is a <code>VkIndirectExecutionSetInfoEXT</code> union containing layout information for the indirect execution set.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The VkIndirectExecutionSetInfoTypeEXT enum is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef enum VkIndirectExecutionSetInfoTypeEXT
{
    VK_INDIRECT_EXECUTION_SET_INFO_TYPE_PIPELINES_EXT = 0x00000001,
    VK_INDIRECT_EXECUTION_SET_INFO_TYPE_SHADER_OBJECTS_EXT = 0x00000002,
} VkIndirectExecutionSetInfoTypeEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_INDIRECT_EXECUTION_SET_INFO_TYPE_PIPELINES_EXT</code> indicates that the <code>VkIndirectExecutionSetEXT</code> contains <code>VkPipeline</code> objects.</p>
</li>
<li>
<p><code>VK_INDIRECT_EXECUTION_SET_INFO_TYPE_SHADER_OBJECTS_EXT</code> indicates that the <code>VkIndirectExecutionSetEXT</code> contains <code>VkShaderEXT</code> objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>VkIndirectExecutionSetInfoEXT</code> union is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef union VkIndirectExecutionSetInfoEXT {
    const VkIndirectExecutionSetPipelineInfoEXT *pPipelineInfo;
    const VkIndirectExecutionSetShaderInfoEXT   *pShaderInfo;
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pPipelineInfo</code> is a pointer to a <code>VkIndirectExecutionSetPipelineInfoEXT</code> struct containing pipeline layout information for the indirect execution set.</p>
</li>
<li>
<p><code>pShaderInfo</code> is a pointer to a <code>VkIndirectExecutionSetShaderInfoEXT</code> struct containing shader object layout information for the indirect execution set.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>VkIndirectExecutionSetPipelineInfoEXT</code> structure is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkIndirectExecutionSetPipelineInfoEXT {
    VkStructureType                         sType;
    const void*                             pNext;
    VkPipeline                              initialPipeline;
    uint32_t                                maxPipelineCount;
} VkIndirectExecutionSetPipelineInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initialPipeline</code> is the pipeline to validate other pipelines in the set against. Its state will be used for validation even if it is removed from the set.
This pipeline will be automatically added to the set at index <code>0</code>.
The bind point must be supported by <code>VkPhysicalDeviceDeviceGeneratedCommandsPropertiesEXT::supportedIndirectCommandsShaderStagesPipelineBinding</code>.</p>
</li>
<li>
<p><code>maxPipelineCount</code> is the maximum number of pipelines stored in the set.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>VkIndirectExecutionSetShaderInfoEXT</code> structure is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkIndirectExecutionSetShaderInfoEXT {
    VkStructureType                         sType;
    const void*                             pNext;
    uint32_t                                shaderCount;
    const VkShaderEXT                      *pInitialShaders;
    const VkIndirectExecutionSetShaderLayoutInfoEXT *pSetLayoutInfos;
    uint32_t                                maxShaderCount;
    uint32_t                                pushConstantRangeCount;
    const VkPushConstantRange              *pPushConstantRanges;
} VkIndirectExecutionSetShaderInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>shaderCount</code> is the number of members in the <code>pInitialShaders</code> and <code>pSetLayoutInfos</code> arrays.</p>
</li>
<li>
<p><code>pInitialShaders</code> is a pointer to an array containing a <code>VkShaderEXT</code> object for each shader stage that will be used in the set.
These shaders will be used to validate other shaders in the set against. Their state will be used for validation even if they are removed from the set.
These shaders will be automatically added to the set beginning at index <code>0</code>.
The stages of the shaders must be supported by <code>VkPhysicalDeviceDeviceGeneratedCommandsPropertiesEXT::supportedIndirectCommandsShaderStagesShaderBinding</code>.</p>
</li>
<li>
<p><code>pSetLayoutInfos</code> is a pointer to array containing <code>VkIndirectExecutionSetShaderLayoutInfoEXT</code> infos used by each corresponding <code>pInitialShaders</code> shader stage in the set.</p>
</li>
<li>
<p><code>maxShaderCount</code> is the maximum number of corresponding shader objects stored in the set.</p>
</li>
<li>
<p><code>pushConstantRangeCount</code> is the number of members in the <code>pPushConstantRanges</code> array.</p>
</li>
<li>
<p><code>pPushConstantRanges</code> is a pointer to the array of <code>VkPushConstantRange</code> ranges used by all shaders in the set.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>VkIndirectExecutionSetShaderLayoutInfoEXT</code> structure is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkIndirectExecutionSetShaderLayoutInfoEXT {
    uint32_t                     setLayoutCount;
    const VkDescriptorSetLayout *pSetLayouts;
} VkIndirectExecutionSetShaderLayoutInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>setLayoutCount</code> is the number of <code>VkDescriptorSetLayout</code> in the <code>pSetLayouts</code> array.</p>
</li>
<li>
<p><code>pSetLayouts</code> is a pointer to an array containing <code>VkDescriptorSetLayout</code> objects used by a given shader stage.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Indirect execution sets are destroyed by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">VKAPI_ATTR void VKAPI_CALL vkDestroyIndirectExecutionSetEXT(
    VkDevice                      device,
    VkIndirectExecutionSetEXT     indirectExecutionSet,
    const VkAllocationCallbacks*  pAllocator);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the indirect execution set.</p>
</li>
<li>
<p><code>indirectExecutionSet</code> is the indirect execution set to destroy.</p>
</li>
<li>
<p><code>pAllocator</code> controls host memory allocation as described in the Memory Allocation chapter.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_updates"><a class="anchor" href="#_updates"></a>3.2.2. Updates</h4>
<div class="paragraph">
<p>Once created, execution slots in indirect execution sets can be updated with one of the following functions depending on how it was created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">VKAPI_ATTR void VKAPI_CALL vkUpdateIndirectExecutionSetPipelineEXT(
    VkDevice                              device,
    VkIndirectExecutionSetEXT             indirectExecutionSet,
    uint32_t                              executionSetWriteCount,
    const VkWriteIndirectExecutionSetPipelineEXT* pExecutionSetWrites);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the indirect execution set.</p>
</li>
<li>
<p><code>indirectExecutionSet</code> is the indirect execution set to update.</p>
</li>
<li>
<p><code>executionSetWriteCount</code> is the number of elements in <code>pExecutionSetWrites</code>.</p>
</li>
<li>
<p><code>pExecutionSetWrites</code> is a pointer to a <code>VkWriteIndirectExecutionSetPipelineEXT</code> structure describing the elements to update.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">VKAPI_ATTR void VKAPI_CALL vkUpdateIndirectExecutionSetShaderEXT(
    VkDevice                              device,
    VkIndirectExecutionSetEXT             indirectExecutionSet,
    uint32_t                              executionSetWriteCount,
    const VkWriteIndirectExecutionSetShaderEXT* pExecutionSetWrites);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the indirect execution set.</p>
</li>
<li>
<p><code>indirectExecutionSet</code> is the indirect execution set to update.</p>
</li>
<li>
<p><code>executionSetWriteCount</code> is the number of elements in <code>pExecutionSetWrites</code>.</p>
</li>
<li>
<p><code>pExecutionSetWrites</code> is a pointer to a <code>VkWriteIndirectExecutionSetShaderEXT</code> structure describing the elements to update.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is legal to update an indirect execution set that is used in flight as long as the slot indices in <code>VkWriteIndirectExecutionSetEXT</code> are not in use.  Any change to an indirect execution set requires recalculating memory requirements by calling <code>vkGetGeneratedCommandsMemoryRequirementsEXT</code> for commands that use that modified state.  Commands that are in flight or those not using the changed state are safe.</p>
</div>
<div class="paragraph">
<p>The <code>VkWriteIndirectExecutionSetPipelineEXT</code> struct is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkWriteIndirectExecutionSetPipelineEXT {
    VkStructureType                      sType;
    const void*                          pNext;
    uint32_t                             index;
    VkPipeline                           pipeline;
} VkWriteIndirectExecutionSetPipelineEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>index</code> is the execution slot to update</p>
</li>
<li>
<p><code>pipeline</code> is the pipeline to store in the indirect execution set</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>VkWriteIndirectExecutionSetShaderEXT</code> struct is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkWriteIndirectExecutionSetShaderEXT {
    VkStructureType                      sType;
    const void*                          pNext;
    uint32_t                             index;
    VkShaderEXT                          shader;
} VkWriteIndirectExecutionSetShaderEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>index</code> is the execution slot to update</p>
</li>
<li>
<p><code>shader</code> is the shader object to store in the indirect execution set</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_indirect_commands_layout"><a class="anchor" href="#_indirect_commands_layout"></a>3.3. Indirect Commands Layout</h3>
<div class="paragraph">
<p>The device-side command generation happens through an iterative processing of an atomic sequence comprised of command tokens, which are represented by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">VK_DEFINE_NON_DISPATCHABLE_HANDLE(VkIndirectCommandsLayoutEXT)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_creation_and_deletion_2"><a class="anchor" href="#_creation_and_deletion_2"></a>3.3.1. Creation and Deletion</h4>
<div class="paragraph">
<p>Indirect command layouts are created by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">VKAPI_ATTR VkResult VKAPI_CALL vkCreateIndirectCommandsLayoutEXT(
    VkDevice                                     device,
    const VkIndirectCommandsLayoutCreateInfoEXT* pCreateInfo,
    const VkAllocationCallbacks*                 pAllocator,
    VkIndirectCommandsLayoutEXT*                 pIndirectCommandsLayout);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that creates the indirect command layout.</p>
</li>
<li>
<p><code>pCreateInfo</code> is a pointer to a <code>VkIndirectCommandsLayoutCreateInfoEXT</code> structure containing parameters affecting creation of the indirect command layout.</p>
</li>
<li>
<p><code>pAllocator</code> controls host memory allocation as described in the Memory Allocation chapter.</p>
</li>
<li>
<p><code>pIndirectCommandsLayout</code> is a pointer to a <code>VkIndirectCommandsLayoutEXT</code> handle in which the resulting indirect command layout is returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>VkIndirectCommandsLayoutCreateInfoEXT</code> structure is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkIndirectCommandsLayoutCreateInfoEXT {
    VkStructureType                         sType;
    const void*                             pNext;
    VkIndirectCommandsLayoutUsageFlagsEXT   flags;
    VkShaderStageFlags                      shaderStages;
    uint32_t                                indirectStride;
    VkPipelineLayout                        pipelineLayout;
    uint32_t                                tokenCount;
    const VkIndirectCommandsLayoutTokenEXT* pTokens;
} VkIndirectCommandsLayoutCreateInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>flags</code> is a bitmask of <code>VkIndirectCommandsLayoutUsageFlagBitsEXT</code> specifying usage rules for this layout.</p>
</li>
<li>
<p><code>shaderStages</code> is the <code>VkShaderStageFlags</code> that this layout supports.</p>
</li>
<li>
<p><code>indirectStride</code> is the stride of the indirect buffer.</p>
</li>
<li>
<p><code>pipelineLayout</code> is the <code>VkPipelineLayout</code> that this layout supports. If a <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_PUSH_CONSTANT_EXT</code> or <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_SEQUENCE_INDEX_EXT</code> is used by the layout, it must not be <code>VK_NULL_HANDLE</code>.</p>
</li>
<li>
<p><code>tokenCount</code> is the length of the individual command sequence.</p>
</li>
<li>
<p><code>pTokens</code> is an array describing each command token in detail.  See <code>VkIndirectCommandsTokenTypeEXT</code> and <code>VkIndirectCommandsLayoutTokenEXT</code> below for details.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <code>VkPipelineLayoutCreateInfo</code> can be passed in <code>pNext</code> if the <code>dynamicGeneratedPipelineLayout</code> feature is enabled.</p>
</div>
<div class="paragraph">
<p>Bits which can be set in <code>VkIndirectCommandsLayoutCreateInfoEXT::flags</code>, specifying usage rules of an indirect command layout, are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef enum VkIndirectCommandsLayoutUsageFlagBitsEXT
{
    VK_INDIRECT_COMMANDS_LAYOUT_USAGE_EXPLICIT_PREPROCESS_BIT_EXT = 0x00000001,
    VK_INDIRECT_COMMANDS_LAYOUT_USAGE_UNORDERED_SEQUENCES_BIT_EXT = 0x00000002,
} VkIndirectCommandsLayoutUsageFlagBitsEXT;
typedef VkFlags VkIndirectCommandsLayoutUsageFlagsEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_INDIRECT_COMMANDS_LAYOUT_USAGE_EXPLICIT_PREPROCESS_BIT_EXT</code> specifies that the layout is always used with the manual preprocessing step through calling <code>vkCmdPreprocessGeneratedCommandsEXT</code> and executed by <code>vkCmdExecuteGeneratedCommandsEXT</code> when <code>isPreprocessed</code> set to <code>VK_TRUE</code>.</p>
</li>
<li>
<p><code>VK_INDIRECT_COMMANDS_LAYOUT_USAGE_UNORDERED_SEQUENCES_BIT_EXT</code> specifies that <a href="https://docs.vulkan.org/spec/latest/chapters/synchronization.html#synchronization-submission-order">submission order</a> is not affected by the ordering of sequences, and sequences may be processed in any order.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Indirect command layouts are destroyed by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">VKAPI_ATTR void VKAPI_CALL vkDestroyIndirectCommandsLayoutEXT(
    VkDevice                     device,
    VkIndirectCommandsLayoutEXT  indirectCommandsLayout,
    const VkAllocationCallbacks* pAllocator);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the layout.</p>
</li>
<li>
<p><code>indirectCommandsLayout</code> is the layout to destroy.</p>
</li>
<li>
<p><code>pAllocator</code> controls host memory allocation as described in the Memory Allocation chapter.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_token_layout"><a class="anchor" href="#_token_layout"></a>3.3.2. Token layout</h4>
<div class="paragraph">
<p>Each sequence of commands in the indirect buffer has the same memory layout.  The data can contain raw <code>uint32_t</code> values, existing indirect command such as <code>VkDrawIndirectCommand</code>, or additional commands listed in the next section.</p>
</div>
<div class="paragraph">
<p>The <code>VkIndirectCommandsLayoutTokenEXT</code> structure specifies details to the commands that need to be known at layout creation time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkIndirectCommandsLayoutTokenEXT {
    VkStructureType                sType;
    const void*                    pNext;
    VkIndirectCommandsTokenTypeEXT type;
    VkIndirectCommandsTokenDataEXT data;
    uint32_t                       offset;
} VkIndirectCommandsLayoutTokenEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>type</code> specifies the token command type.</p>
</li>
<li>
<p><code>data</code> specifies token specific details for command execution.</p>
</li>
<li>
<p><code>offset</code> is the relative byte offset for the token within one sequence of the indirect buffer.  The data stored at that offset is the command data for the token, e.g. <code>VkDispatchIndirectCommand</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Token data is a union of additional information specific to the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef union VkIndirectCommandsTokenDataEXT {
    const VkIndirectCommandsPushConstantTokenEXT          *pPushConstant;
    const VkIndirectCommandsVertexBufferTokenEXT          *pVertexBuffer;
    const VkIndirectCommandsIndexBufferTokenEXT           *pIndexBuffer;
    const VkIndirectCommandsExecutionSetTokenEXT          *pExecutionSet;
} VkIndirectCommandsTokenDataEXT;</code></pre>
</div>
</div>
<div class="paragraph">
<p>These structures are described in the next section.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_indirect_commands"><a class="anchor" href="#_indirect_commands"></a>3.4. Indirect Commands</h3>
<div class="paragraph">
<p>This extension defines the following commands for state changes and operations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Common Tokens</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Command Data</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_EXECUTION_SET_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint32_t[]</code> array of indices into the indirect execution set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_PUSH_CONSTANT_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint32_t[]</code> raw data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Compute Tokens</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DISPATCH_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkDispatchIndirectCommand</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Ray Tracing Tokens</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_TRACE_RAYS2_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkTraceRaysIndirectCommand2KHR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Graphics State Tokens</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_INDEX_BUFFER_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkBindIndexBufferIndirectCommandEXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_VERTEX_BUFFER_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkBindVertexBufferIndirectCommandEXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Graphics Draw Tokens</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_INDEXED_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkDrawIndexedIndirectCommand</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkDrawIndirectCommand</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkDrawMeshTasksIndirectCommandEXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_NV_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkDrawMeshTasksIndirectCommandNV</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Graphics Draw Count Tokens</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_INDEXED_COUNT_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkDrawIndirectCountIndirectCommandEXT</code> with <code>VkDrawIndexedIndirectCommand</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_COUNT_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkDrawIndirectCountIndirectCommandEXT</code> with <code>VkDrawIndirectCommand</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_COUNT_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkDrawIndirectCountIndirectCommandEXT</code> with <code>VkDrawMeshTasksIndirectCommandEXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_COUNT_NV_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkDrawIndirectCountIndirectCommandEXT</code> with <code>VkDrawMeshTasksIndirectCommandNV</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All commands can be stored 4-byte aligned, independent of 64-bit alignment of structures due to use of <code>VkDeviceAddress</code>.  This provides binary compatibility with D3D12.</p>
</div>
<div class="paragraph">
<p>The type of tokens in a sequence is specified by <code>VkIndirectCommandsTokenTypeEXT</code> which must be one of the values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef enum VkIndirectCommandsTokenTypeEXT {
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_EXECUTION_SET_EXT,
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_PUSH_CONSTANT_EXT,
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_SEQUENCE_INDEX_EXT,
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_INDEX_BUFFER_EXT,
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_VERTEX_BUFFER_EXT,
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_INDEXED_EXT,
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_EXT,
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_EXT,
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_NV_EXT,
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_INDEXED_COUNT_EXT,
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_COUNT_EXT,
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_COUNT_EXT,
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_COUNT_NV_EXT,
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_DISPATCH_EXT,
    VK_INDIRECT_COMMANDS_TOKEN_TYPE_TRACE_RAYS2_EXT,
} VkIndirectCommandsTokenTypeEXT;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_bind_execution_command"><a class="anchor" href="#_bind_execution_command"></a>3.4.1. Bind Execution Command</h4>
<div class="paragraph">
<p>An array of 32-bit unsigned integer values are the input data for the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_EXECUTION_SET_EXT</code> token.
Each value is an index, specified in canonical pipeline order, into the Indirect Execution Set.
One index value must be passed for each bit set in VkIndirectCommandsExecutionSetTokenEXT::shaderStages.</p>
</div>
<div class="paragraph">
<p>The <code>VkIndirectCommandsExecutionSetTokenEXT</code> structure specifies additional info used when creating the layout object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">struct VkIndirectCommandsExecutionSetTokenEXT {
    VkIndirectExecutionSetInfoTypeEXT      type;
    VkShaderStageFlags                     shaderStages;
};</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>type</code> must be either <code>VK_INDIRECT_EXECUTION_SET_INFO_TYPE_PIPELINES_EXT</code> or <code>VK_INDIRECT_EXECUTION_SET_INFO_TYPE_SHADER_OBJECTS_EXT</code>.</p>
</li>
<li>
<p><code>shaderStages</code> specifies the shaders that will be changed by this token.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This must be the first command in a sequence when used.</p>
</div>
<div class="paragraph">
<p>Pipelines and shaders bound in indirect buffers must be flagged at creation time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#define VK_PIPELINE_CREATE_2_INDIRECT_BINDABLE_BIT_EXT            ((VkPipelineCreateFlagBits)0x4000000000ULL)
#define VK_SHADER_CREATE_INDIRECT_BINDABLE_BIT_EXT                ((VkShaderCreateFlagBitsEXT)0x00000080)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_push_constants_command"><a class="anchor" href="#_push_constants_command"></a>3.4.2. Push Constants Command</h4>
<div class="paragraph">
<p>Raw 32-bit values are the input data for the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_PUSH_CONSTANT_EXT</code> token.</p>
</div>
<div class="paragraph">
<p>Interpretation of the data is specified at layout creation time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkIndirectCommandsPushConstantTokenEXT {
    VkPushConstantRange             updateRange;
} VkIndirectCommandsPushConstantTokenEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>updateRange</code> is the range of push constant data to update.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_sequence_index_command"><a class="anchor" href="#_sequence_index_command"></a>3.4.3. Sequence Index Command</h4>
<div class="paragraph">
<p>There is a single <code>uint32_t</code> of placeholder data for the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_SEQUENCE_INDEX_EXT</code> token which is not accessed by the shader. It writes a single 32-bit value containing the current sequence index to the specified push constant range.</p>
</div>
<div class="paragraph">
<p>Interpretation of the data is specified at layout creation time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkIndirectCommandsPushConstantTokenEXT {
    VkPushConstantRange             updateRange;
} VkIndirectCommandsPushConstantTokenEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>updateRange</code> is the range of push constant data to update. <code>updateRange.size</code> must be 4.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_bind_index_buffer_command"><a class="anchor" href="#_bind_index_buffer_command"></a>3.4.4. Bind Index Buffer Command</h4>
<div class="paragraph">
<p>The <code>VkBindIndexBufferIndirectCommandEXT</code> structure specifies the input data for the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_INDEX_BUFFER_EXT</code> token.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkBindIndexBufferIndirectCommandEXT {
    VkDeviceAddress bufferAddress;
    uint32_t        size;
    VkIndexType     indexType;
} VkBindIndexBufferIndirectCommandEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bufferAddress</code> specifies a physical address of the <code>VkBuffer</code> used as an index buffer.</p>
</li>
<li>
<p><code>size</code> is the byte size range which is available for this operation from the provided address.</p>
</li>
<li>
<p><code>indexType</code> is a <code>VkIndexType</code> value specifying how indices are treated.  Instead of the Vulkan enum values, custom <code>uint32_t</code> values can be mapped to an <code>VkIndexType</code> as described below.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The index buffer is bound as specified at layout creation time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkIndirectCommandsIndexBufferTokenEXT {
    VkIndirectCommandsInputModeFlagsEXT mode;
} VkIndirectCommandsIndexBufferTokenEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mode</code> is a single <code>VkIndirectCommandsInputModeFlagBitsEXT</code> value specifying the mode to be used with this token.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The VkIndirectCommandsInputModeFlagsEXT enum is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef enum VkIndirectCommandsInputModeFlagBitsEXT
{
    VK_INDIRECT_COMMANDS_INPUT_MODE_VULKAN_INDEX_BUFFER_EXT = 0x00000001,
    VK_INDIRECT_COMMANDS_INPUT_MODE_DXGI_INDEX_BUFFER_EXT = 0x00000002,
} VkIndirectCommandsInputModeFlagBitsEXT;
typedef VkFlags VkIndirectCommandsInputModeFlagsEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_INDIRECT_COMMANDS_INPUT_MODE_VULKAN_INDEX_BUFFER_EXT</code> indicates that the indirect buffer contains <code>VkBindIndexBufferIndirectCommandEXT</code>.</p>
</li>
<li>
<p><code>VK_INDIRECT_COMMANDS_INPUT_MODE_DXGI_INDEX_BUFFER_EXT</code> indicates that the indirect buffer contains <code>D3D12_INDEX_BUFFER_VIEW</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This allows for easy layering of Vulkan atop other APIs.  When <code>VK_INDIRECT_COMMANDS_INPUT_MODE_DXGI_INDEX_BUFFER_EXT</code> is specified, the indirect buffer can contain a <code>D3D12_INDEX_BUFFER_VIEW</code> instead of <code>VkBindIndexBufferIndirectCommandEXT</code> as D3D&#8217;s DXGI format value is mapped to the <code>VkIndexType</code>. It works as both structs are otherwise binary compatible.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bind_vertex_buffer_command"><a class="anchor" href="#_bind_vertex_buffer_command"></a>3.4.5. Bind Vertex Buffer Command</h4>
<div class="paragraph">
<p>The <code>VkBindVertexBufferIndirectCommandEXT</code> structure specifies the input data for the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_VERTEX_BUFFER_EXT</code> token.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkBindVertexBufferIndirectCommandEXT {
    VkDeviceAddress bufferAddress;
    uint32_t        size;
    uint32_t        stride;
} VkBindVertexBufferIndirectCommandEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bufferAddress</code> specifies a physical address of the <code>VkBuffer</code> used as a vertex input binding.</p>
</li>
<li>
<p><code>size</code> is the byte size range which is available for this operation from the provided address.</p>
</li>
<li>
<p><code>stride</code> is the byte size stride for this vertex input binding as in <code>VkVertexInputBindingDescription::stride</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The vertex buffer is bound as specified at layout creation time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkIndirectCommandsVertexBufferTokenEXT {
    uint32_t            vertexBindingUnit;
} VkIndirectCommandsVertexBufferTokenEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>vertexBindingUnit</code> is the vertex input binding number to be bound.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both  <code>VkBindVertexBufferIndirectCommandEXT</code> and <code>D3D12_VERTEX_BUFFER_VIEW</code> structs are binary compatible.</p>
</div>
</div>
<div class="sect3">
<h4 id="_draw_commands"><a class="anchor" href="#_draw_commands"></a>3.4.6. Draw Commands</h4>
<div class="paragraph">
<p>Draws can be executed with following commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>VkDrawIndexedIndirectCommand</code> structure specifies the inputs data for the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_INDEXED_EXT</code> token.</p>
</li>
<li>
<p>The <code>VkDrawIndirectCommand</code> structure specifies the input data for the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_EXT</code> token.</p>
</li>
<li>
<p>If <code>EXT_mesh_shader</code> is enabled, the <code>VkDrawMeshTasksIndirectCommandEXT</code> structure specifies the input data for the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_EXT</code> token.</p>
</li>
<li>
<p>If <code>NV_mesh_shader</code> is enabled, the <code>VkDrawMeshTasksIndirectCommandNV</code> structure specifies the input data for the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_NV_EXT</code> token.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_multi_draw_commands"><a class="anchor" href="#_multi_draw_commands"></a>3.4.7. Multi-draw Commands</h4>
<div class="paragraph">
<p>Multiple draws can be executed using the following commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Indexed draws with the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_INDEXED_COUNT_EXT</code> token.</p>
</li>
<li>
<p>Non-indexed draws with the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_COUNT_EXT</code> token.</p>
</li>
<li>
<p>If <code>EXT_mesh_shader</code> is enabled, mesh tasks with the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_COUNT_EXT</code> token.</p>
</li>
<li>
<p>If <code>NV_mesh_shader</code> is enabled, mesh tasks with the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_COUNT_NV_EXT</code> token.</p>
</li>
<li>
<p>The <code>DrawIndex</code> shader variable is zero-indexed for each multi-draw token.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All multi-draw commands use <code>VkDrawIndirectCountIndirectCommandEXT</code> data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkDrawIndirectCountIndirectCommandEXT {
    VkDeviceAddress bufferAddress;
    uint32_t        stride;
    uint32_t        commandCount;
} VkDrawIndirectCountIndirectCommandEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bufferAddress</code> specifies a physical address of the <code>VkBuffer</code> used for draw commands.</p>
</li>
<li>
<p><code>stride</code> is the byte size stride for the command arguments</p>
</li>
<li>
<p><code>commandCount</code> is the number of commands to execute</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The data in <code>bufferAddress</code> depends on the token:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VkDrawIndexedIndirectCommand</code> for <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_INDEXED_COUNT_EXT</code>.</p>
</li>
<li>
<p><code>VkDrawIndirectCommand</code> for <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_COUNT_EXT</code> .</p>
</li>
<li>
<p><code>VkDrawMeshTasksIndirectCommandEXT</code> for <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_COUNT_EXT</code>.</p>
</li>
<li>
<p><code>VkDrawMeshTasksIndirectCommandNV</code> for <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_COUNT_NV_EXT</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_dispatch_command"><a class="anchor" href="#_dispatch_command"></a>3.4.8. Dispatch Command</h4>
<div class="paragraph">
<p>The <code>VkDispatchIndirectCommand</code> structure specifies the input data for the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DISPATCH_EXT</code> token.</p>
</div>
</div>
<div class="sect3">
<h4 id="_trace_rays_command"><a class="anchor" href="#_trace_rays_command"></a>3.4.9. Trace Rays Command</h4>
<div class="paragraph">
<p>If <code>VK_KHR_ray_tracing_maintenance1</code> is enabled, the <code>VkTraceRaysIndirectCommand2KHR</code> structure specifies the input data for the <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_TRACE_RAYS2_EXT</code> token.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_preprocess_buffer"><a class="anchor" href="#_preprocess_buffer"></a>3.5. Preprocess Buffer</h3>
<div class="paragraph">
<p>The generation of commands on the device may require a preprocess buffer.  Implementations may use this for the storage of device-specific commands or scratch memory.</p>
</div>
<div class="paragraph">
<p>To retrieve the memory size and alignment requirements of a particular execution state call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">VKAPI_ATTR void VKAPI_CALL vkGetGeneratedCommandsMemoryRequirementsEXT(
    VkDevice                                            device,
    const VkGeneratedCommandsMemoryRequirementsInfoEXT* pInfo,
    VkMemoryRequirements2*                              pMemoryRequirements);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that will create the buffer.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <code>VkGeneratedCommandsMemoryRequirementsInfoEXT</code> structure containing parameters required for the memory requirements query.</p>
</li>
<li>
<p><code>pMemoryRequirements</code> is a pointer to a <code>VkMemoryRequirements2</code> structure in which the memory requirements of the buffer object are returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>pMemoryRequirements&#8594;memoryRequirements.size</code> is zero then preprocessing is not required.</p>
</div>
<div class="paragraph">
<p>The <code>VkGeneratedCommandsMemoryRequirementsInfoEXT</code> structure is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkGeneratedCommandsMemoryRequirementsInfoEXT {
    VkStructureType              sType;
    const void*                  pNext;
    VkIndirectExecutionSetEXT    indirectExecutionSet;
    VkIndirectCommandsLayoutEXT  indirectCommandsLayout;
    uint32_t                     maxSequenceCount;
    uint32_t                     maxDrawCount;
} VkGeneratedCommandsMemoryRequirementsInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>shaderStages</code> is the mask of shader stages that this buffer memory is intended to be used with during the execution.</p>
</li>
<li>
<p><code>indirectExecutionSet</code> is the indirect execution set to be used for binding shaders.  If the token sequence will contain a <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_EXECUTION_SET_EXT</code> token, it must not be <code>VK_NULL_HANDLE</code>.</p>
</li>
<li>
<p><code>indirectCommandsLayout</code> is the <code>VkIndirectCommandsLayoutEXT</code> that this buffer memory is intended to be used with.</p>
</li>
<li>
<p><code>maxSequenceCount</code> is the maximum number of sequences that this buffer memory can be used with.</p>
</li>
<li>
<p><code>maxDrawCount</code> is the maximum number of indirect draws that can be executed by any COUNT-type multi-draw indirect tokens (equivalent to <code>maxDrawCount</code> in <code>vkCmdDrawIndirectCount</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Preprocess buffer memory can be recycled with different execution/preprocessing operations, but must be synchronized using barriers with <code>VK_PIPELINE_STAGE_COMMAND_PREPROCESS_BIT_EXT</code> and <code>VK_ACCESS_COMMAND_PREPROCESS_WRITE/READ_BIT_EXT</code>.</p>
</div>
<div class="paragraph">
<p>The contents and the layout of this buffer is opaque to applications and must not be modified or copied to another buffer for reuse.</p>
</div>
<div class="paragraph">
<p>If <code>indirectExecutionSet</code> is <code>VK_NULL_HANDLE</code>, pipeline or shader info must be passed through the pNext pointer using either a <code>VkGeneratedCommandsPipelineInfoEXT</code> or <code>VkGeneratedCommandsShaderInfoEXT</code> struct.</p>
</div>
<div class="paragraph">
<p>The <code>VkGeneratedCommandsPipelineInfoEXT</code> structure is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkGeneratedCommandsPipelineInfoEXT {
    VkStructureType              sType;
    const void*                  pNext;
    VkPipeline                   pipeline;
} VkGeneratedCommandsPipelineInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pipeline</code> is a pipeline comprised of shaders that are compatible with the ones which will be used with the resulting indirect buffer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>VkGeneratedCommandsShaderInfoEXT</code> structure is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkGeneratedCommandsShaderInfoEXT {
    VkStructureType              sType;
    const void*                  pNext;
    uint32_t                     shaderCount;
    const VkShaderExt           *pShaders;
} VkGeneratedCommandsShaderInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>shaderCount</code> is the number of members in the <code>pShaders</code> array.</p>
</li>
<li>
<p><code>pShaders</code> is a pointer to an array of shaders that are compatible with the ones which will be used with the resulting indirect buffer.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_command_buffer"><a class="anchor" href="#_command_buffer"></a>3.6. Command Buffer</h3>
<div class="sect3">
<h4 id="_synchronization"><a class="anchor" href="#_synchronization"></a>3.6.1. Synchronization</h4>
<div class="paragraph">
<p>Synchronization of preprocessing via <code>vkCmdPreprocessGeneratedCommandsEXT</code> and generation/execution via <code>vkCmdExecuteGeneratedCommandsEXT</code> is supported with a new stage and access flags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#define VK_PIPELINE_STAGE_COMMAND_PREPROCESS_BIT_EXT  ((VkPipelineStageFlagBits)0x00020000)

#define VK_ACCESS_COMMAND_PREPROCESS_READ_BIT_EXT     ((VkAccessFlagBits)0x00020000)
#define VK_ACCESS_COMMAND_PREPROCESS_WRITE_BIT_EXT    ((VkAccessFlagBits)0x00040000)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_PIPELINE_STAGE_COMMAND_PREPROCESS_BIT_EXT</code> specifies the stage of the pipeline where device-side preprocessing for generated commands via <code>vkCmdPreprocessGeneratedCommandsEXT</code> is handled.</p>
</li>
<li>
<p><code>VK_ACCESS_COMMAND_PREPROCESS_READ_BIT_EXT</code> specifies reads from buffer inputs to <code>vkCmdPreprocessGeneratedCommandsEXT</code>. Such access occurs in the <code>VK_PIPELINE_STAGE_COMMAND_PREPROCESS_BIT_EXT</code> pipeline stage.</p>
</li>
<li>
<p><code>VK_ACCESS_COMMAND_PREPROCESS_WRITE_BIT_EXT</code> specifies writes to preprocess outputs from <code>vkCmdPreprocessGeneratedCommandsEXT</code>. Such access occurs in the <code>VK_PIPELINE_STAGE_COMMAND_PREPROCESS_BIT_EXT</code> pipeline stage.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_generated_commands"><a class="anchor" href="#_generated_commands"></a>3.6.2. Generated Commands</h4>
<div class="paragraph">
<p>Device-generated commands are specified by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkGeneratedCommandsInfoEXT {
    VkStructureType                  sType;
    const void*                      pNext;
    VkShaderStageFlags               shaderStages;
    VkIndirectExecutionSetEXT        indirectExecutionSet;
    VkIndirectCommandsLayoutEXT      indirectCommandsLayout;
    VkDeviceAddress                  indirectAddress;
    VkDeviceSize                     indirectAddressSize;
    VkDeviceAddress                  preprocessAddress;
    VkDeviceSize                     preprocessSize;
    uint32_t                         maxSequenceCount;
    VkDeviceAddress                  sequenceCountAddress;
    uint32_t                         maxDrawCount;
} VkGeneratedCommandsInfoEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>shaderStages</code> is the mask of shader stages used by the commands.</p>
</li>
<li>
<p><code>indirectExecutionSet</code> is the indirect execution set to be used for binding shaders.  If the token sequence contains a <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_EXECUTION_SET_EXT</code> token, it must not be <code>VK_NULL_HANDLE</code>.</p>
</li>
<li>
<p><code>indirectCommandsLayout</code> is the <code>VkIndirectCommandsLayoutEXT</code> that specifies the command sequence data.</p>
</li>
<li>
<p><code>indirectAddress</code> is an address that holds the indirect buffer data.</p>
</li>
<li>
<p><code>indirectAddressSize</code> is the size of the address space that holds the indirect buffer data.</p>
</li>
<li>
<p><code>preprocessAddress</code> specifies a physical address of the <code>VkBuffer</code> used for preprocessing the input data for execution.  It must not be <code>0</code> if <code>vkGetGeneratedCommandsMemoryRequirementsEXT</code> returns non-zero size.</p>
</li>
<li>
<p><code>preprocessSize</code> is the maximum byte size within the <code>preprocessAddress</code> that is available for preprocessing.</p>
</li>
<li>
<p><code>maxSequenceCount</code> is used to determine the number of sequences to execute.  If <code>sequenceCountAddress</code> is not <code>NULL</code>, then <code>maxSequenceCount</code> is the maximum number of sequences that can be executed. The actual number is <code>min(maxSequenceCount, *sequenceCountAddress)</code>.  Otherwise if <code>sequenceCountAddress</code> is <code>NULL</code>, then <code>maxSequenceCount</code> is the exact number of sequences to execute.</p>
</li>
<li>
<p><code>sequenceCountAddress</code> specifies an optional physical address of a single <code>uint32_t</code> value containing the requested number of sequences to execute.</p>
</li>
<li>
<p><code>maxDrawCount</code> is the maximum number of indirect draws that can be executed by any COUNT-type multi-draw indirect tokens (equivalent to <code>maxDrawCount</code> in <code>vkCmdDrawIndirectCount</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When preprocessing, if <code>indirectExecutionSet</code> is <code>VK_NULL_HANDLE</code> then pipeline or shader info must be passed through the pNext pointer using either a <code>VkGeneratedCommandsPipelineInfoEXT</code> or <code>VkGeneratedCommandsShaderInfoEXT</code> struct.</p>
</div>
<div class="paragraph">
<p>The actual generation of commands as well as their execution on the device is handled as single action with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">VKAPI_ATTR void VKAPI_CALL vkCmdExecuteGeneratedCommandsEXT(
    VkCommandBuffer                   commandBuffer,
    VkBool32                          isPreprocessed,
    const VkGeneratedCommandsInfoEXT* pGeneratedCommandsInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command is recorded.</p>
</li>
<li>
<p><code>isPreprocessed</code> represents whether the input data has been previously preprocessed on the device. If it is <code>VK_TRUE</code>, <code>vkCmdPreprocessGeneratedCommandsEXT</code> must have been previously called. If it is <code>VK_FALSE</code>, any necessary processing will be performed as part of this command.</p>
</li>
<li>
<p><code>pGeneratedCommandsInfo</code> is a pointer to a <code>VkGeneratedCommandsInfoEXT</code> structure containing parameters affecting the generation of commands.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All state affected by executed tokens is undefined after this command. The view mask of an active rendering pass must be zero.</p>
</div>
<div class="paragraph">
<p>Commands can be preprocessed prior execution using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">VKAPI_ATTR void VKAPI_CALL vkCmdPreprocessGeneratedCommandsEXT(
    VkCommandBuffer commandBuffer,
    const VkGeneratedCommandsInfoEXT* pGeneratedCommandsInfo,
    VkCommandBuffer stateCommandBuffer);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer which does the preprocessing.</p>
</li>
<li>
<p><code>pGeneratedCommandsInfo</code> is a pointer to a <code>VkGeneratedCommandsInfoEXT</code> structure containing parameters affecting the preprocessing step.</p>
</li>
<li>
<p><code>stateCommandBuffer</code> is an command buffer from which to pull state affecting the preprocessing step.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Explicitly preprocessing the indirect buffer provides more control over the scheduling of work.  If not performed, the implementation may still have additional work to do that is deferred to execution time.
The bound state in <code>stateCommandBuffer</code> must be identical to the state bound at the time <code>vkCmdExecuteGeneratedCommandsEXT</code> is recorded.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_features"><a class="anchor" href="#_features"></a>3.7. Features</h3>
<div class="paragraph">
<p>The following features are exposed by this extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkPhysicalDeviceDeviceGeneratedCommandsFeaturesEXT
{
    VkStructureType sType;
    const void*     pNext;
    VkBool32        deviceGeneratedCommands;
    VkBool32        dynamicGeneratedPipelineLayout;
} VkPhysicalDeviceDeviceGeneratedCommandsFeaturesEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>deviceGeneratedCommands</code> is the core feature enabling the extension</p>
</li>
<li>
<p><code>dynamicGeneratedPipelineLayout</code> enables passing a <code>VkPipelineLayoutCreateInfo</code> in the <code>pNext</code> of <code>VkIndirectCommandsLayoutCreateInfoEXT</code> with a <code>VK_NULL_HANDLE</code> <code>pipelineLayout</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_properties"><a class="anchor" href="#_properties"></a>3.8. Properties</h3>
<div class="paragraph">
<p>The following properties are exposed by this extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkPhysicalDeviceDeviceGeneratedCommandsPropertiesEXT
{
    VkStructureType sType;
    const void*     pNext;
    uint32_t        maxIndirectPipelineCount;
    uint32_t        maxIndirectShaderObjectCount;
    uint32_t        maxIndirectSequenceCount;
    uint32_t        maxIndirectCommandsTokenCount;
    uint32_t        maxIndirectCommandsTokenOffset;
    uint32_t        maxIndirectCommandsIndirectStride;
    VkIndirectCommandsInputModeFlagsEXT supportedIndirectCommandsInputModes;
    VkShaderStageFlags supportedIndirectCommandsShaderStages;
    VkShaderStageFlags supportedIndirectCommandsShaderStagesPipelineBinding;
    VkShaderStageFlags supportedIndirectCommandsShaderStagesShaderBinding;
    VkBool32        deviceGeneratedCommandsTransformFeedback;
    VkBool32        deviceGeneratedCommandsMultiDrawIndirectCount;
} VkPhysicalDeviceDeviceGeneratedCommandsPropertiesEXT;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following limits affect indirect execution set creation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>maxIndirectPipelineCount</code> indicates the maximum number of pipelines that can be stored in an indirect execution set.</p>
</li>
<li>
<p><code>maxIndirectShaderObjectCount</code> indicates the maximum number of shader objects that can be stored in an indirect execution set.</p>
</li>
<li>
<p><code>supportedIndirectCommandsShaderStagesPipelineBinding</code> is a bitmask of the shader stages which can be used within indirect execution sets comprised of pipelines.</p>
</li>
<li>
<p><code>supportedIndirectCommandsShaderStagesShaderBinding</code> is a bitmask of the shader stages which can be used within indirect execution sets comprised of shader objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following limits affect indirect command layout creation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>maxIndirectCommandsTokenCount</code> indicates the maximum number of tokens in a sequence.</p>
</li>
<li>
<p><code>maxIndirectCommandsTokenOffset</code> indicates the maximum byte offset of a token within a sequence.</p>
</li>
<li>
<p><code>supportedIndirectCommandsInputModes</code> indicates the supported index buffer modes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following limits affect indirect command execution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>maxIndirectSequenceCount</code> indicates the maximum number of sequences that can executed.</p>
</li>
<li>
<p><code>maxIndirectCommandsIndirectStride</code> indicates the maximum stride that can be used for the indirect buffer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>VK_EXT_transform_feedback</code> is also enabled, <code>deviceGeneratedCommandsTransformFeedback</code> enables the use of Transform Feedback with indirect execution.</p>
</div>
<div class="paragraph">
<p><code>supportedIndirectCommandsShaderStages</code> is a bitmask of the shader stages which can be active while executing indirect commands as well as the use of certain tokens.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_PUSH_CONSTANT_EXT</code> and <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_SEQUENCE_INDEX_EXT</code> are always supported for the specified stages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>VK_SHADER_STAGE_VERTEX_BIT | VK_SHADER_STAGE_FRAGMENT_BIT</code> enables use of these tokens:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_INDEX_BUFFER_EXT</code></p>
</li>
<li>
<p><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_VERTEX_BUFFER_EXT</code></p>
</li>
<li>
<p><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_INDEXED_EXT</code></p>
</li>
<li>
<p><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_EXT</code></p>
</li>
<li>
<p><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_INDEXED_COUNT_EXT</code> if <code>deviceGeneratedCommandsMultiDrawIndirectCount</code> is supported</p>
</li>
<li>
<p><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_COUNT_EXT</code> if <code>deviceGeneratedCommandsMultiDrawIndirectCount</code> is supported</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>EXT_mesh_shader</code> extension is also enabled, <code>VK_SHADER_STAGE_FRAGMENT_BIT | VK_SHADER_STAGE_MESH_BIT_EXT</code> enables use of these tokens:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_EXT</code></p>
</li>
<li>
<p><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_COUNT_EXT</code> if <code>deviceGeneratedCommandsMultiDrawIndirectCount</code> is supported</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>NV_mesh_shader</code> extension is also enabled, <code>VK_SHADER_STAGE_FRAGMENT_BIT | VK_SHADER_STAGE_MESH_BIT_NV</code> enables use of these tokens:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_NV_EXT</code></p>
</li>
<li>
<p><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_COUNT_NV_EXT</code> if <code>deviceGeneratedCommandsMultiDrawIndirectCount</code> is supported</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>VK_SHADER_STAGE_COMPUTE_BIT</code> enables use of these tokens:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DISPATCH_EXT</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>VK_KHR_ray_tracing_maintenance1</code> is also enabled, the presence of ray tracing stages enables use of these tokens:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_TRACE_RAYS2_EXT</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_d3d12_emulation"><a class="anchor" href="#_d3d12_emulation"></a>3.9. D3D12 Emulation</h3>
<div class="sect3">
<h4 id="_argument_structures"><a class="anchor" href="#_argument_structures"></a>3.9.1. Argument Structures</h4>
<div class="paragraph">
<p>Most structures have direct equivalents:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>D3D12 type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Vulkan type</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_DRAW_ARGUMENTS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkDrawIndirectCommand</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_DRAW_INDEXED_ARGUMENTS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkDrawIndexedIndirectCommand</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_DISPATCH_ARGUMENTS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkDispatchIndirectCommand</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_INDEX_BUFFER_VIEW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkBindIndexBufferIndirectCommandEXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_VERTEX_BUFFER_VIEW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VkBindVertexBufferIndirectCommandEXT</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Binding of views or constants require translation due to mismatches between the APIs.</p>
</div>
</div>
<div class="sect3">
<h4 id="_indirect_argument_type"><a class="anchor" href="#_indirect_argument_type"></a>3.9.2. Indirect Argument Type</h4>
<div class="paragraph">
<p>Maps to <code>VkIndirectCommandsTokenTypeEXT</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>D3D12 value</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Vulkan value</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_INDIRECT_ARGUMENT_TYPE_DRAW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_EXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_INDIRECT_ARGUMENT_TYPE_DRAW_INDEXED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_INDEXED_EXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_INDIRECT_ARGUMENT_TYPE_DISPATCH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DISPATCH_EXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_INDIRECT_ARGUMENT_TYPE_VERTEX_BUFFER_VIEW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_VERTEX_BUFFER_EXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_INDIRECT_ARGUMENT_TYPE_INDEX_BUFFER_VIEW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_INDEX_BUFFER_EXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_INDIRECT_ARGUMENT_TYPE_CONSTANT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_PUSH_CONSTANT_EXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_INDIRECT_ARGUMENT_TYPE_CONSTANT_BUFFER_VIEW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_PUSH_CONSTANT_EXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_INDIRECT_ARGUMENT_TYPE_SHADER_RESOURCE_VIEW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_PUSH_CONSTANT_EXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_INDIRECT_ARGUMENT_TYPE_UNORDERED_ACCESS_VIEW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_PUSH_CONSTANT_EXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_INDIRECT_ARGUMENT_TYPE_DISPATCH_RAYS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_TRACE_RAYS2_EXT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D3D12_INDIRECT_ARGUMENT_TYPE_DISPATCH_MESH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_DRAW_MESH_TASKS_EXT</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A root descriptor in D3D12 is a 64-bit virtual address to a raw buffer. To implement this, <code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_PUSH_CONSTANT_EXT</code> tokens can be used to update buffer device addresses stored in push constants rather than interacting with the descriptor binding model. Similar techniques can be used to update non-root descriptors as well.</p>
</div>
<div class="paragraph">
<p><code>VK_INDIRECT_COMMANDS_TOKEN_TYPE_SEQUENCE_INDEX_EXT</code> can be used to mimic D3D12 DGC TIER_1_1 support.</p>
</div>
</div>
<div class="sect3">
<h4 id="_command_signature"><a class="anchor" href="#_command_signature"></a>3.9.3. Command Signature</h4>
<div class="ulist">
<ul>
<li>
<p><code>ByteStride</code> is specified at execution time with <code>VkGeneratedCommandsInfoEXT::indirectAddressRegion.stride</code>.</p>
</li>
<li>
<p>Set <code>VkIndirectCommandsIndexBufferTokenEXT::mode</code> to <code>VK_INDIRECT_COMMANDS_INPUT_MODE_DXGI_INDEX_BUFFER_EXT</code> to remap <code>DXGI_FORMAT</code> values.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_alignment"><a class="anchor" href="#_alignment"></a>3.9.4. Alignment</h4>
<div class="paragraph">
<p>Alignment requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ByteStride</code> is 4 byte aligned</p>
</li>
<li>
<p><code>CountBufferOffset</code> is 4 byte aligned</p>
</li>
<li>
<p><code>ArgumentBufferOffset</code> is 4 byte aligned</p>
</li>
<li>
<p><code>tokenOffset</code> is 4 byte aligned</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples"><a class="anchor" href="#_examples"></a>4. Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_issues"><a class="anchor" href="#_issues"></a>5. Issues</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_unresolved_how_will_future_commands_be_added"><a class="anchor" href="#_unresolved_how_will_future_commands_be_added"></a>5.1. UNRESOLVED: How will future commands be added?</h3>
<div class="paragraph">
<p>New pointer members will be added to <code>VkIndirectCommandsTokenDataEXT</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_additional_state_be_included"><a class="anchor" href="#_resolved_should_additional_state_be_included"></a>5.2. RESOLVED: Should additional state be included?</h3>
<div class="paragraph">
<p>No additional state changes are permitted in order to enable fast and broad adoption.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_what_shader_stages_or_pipeline_states_should_be_allowed_to_change"><a class="anchor" href="#_resolved_what_shader_stages_or_pipeline_states_should_be_allowed_to_change"></a>5.3. RESOLVED: What shader stages or pipeline states should be allowed to change?</h3>
<div class="paragraph">
<p>All implementation-supported shader stagess can be changed indirectly. No pipeline state may be changed. Future extensions may expose additional functionality.</p>
</div>
</div>
<div class="sect2">
<h3 id="_unresolved_should_indirect_execution_sets_be_merged_with_either_shader_binding_tables_or_indirect_object_sets"><a class="anchor" href="#_unresolved_should_indirect_execution_sets_be_merged_with_either_shader_binding_tables_or_indirect_object_sets"></a>5.4. UNRESOLVED: Should Indirect execution sets be merged with either Shader Binding Tables or Indirect Object Sets?</h3>
<div class="ulist">
<ul>
<li>
<p>Significant overlap in functionality with Shader Binding Tables</p>
</li>
<li>
<p>Indirect Object Sets would allow for indirect dynamic state groups.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_additional_alignment_properties_be_added"><a class="anchor" href="#_resolved_should_additional_alignment_properties_be_added"></a>5.5. RESOLVED: Should additional alignment properties be added?</h3>
<div class="paragraph">
<p>Recent extensions have been using fixed rather than queryable alignment rules. It makes sense to use fixed alignments here too.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_index_type_values_be_remappable"><a class="anchor" href="#_resolved_should_index_type_values_be_remappable"></a>5.6. RESOLVED: Should index type values be remappable?</h3>
<div class="paragraph">
<p><code>D3D12_INDEX_BUFFER_VIEW</code> and <code>VkBindIndexBufferIndirectCommandEXT</code> have the same memory layout but <code>DXGI_FORMAT</code> and <code>VkIndexType</code> do not have equivalent values.  Providing the ability to remap index type values in the layout simplifies API emulation.</p>
</div>
<div class="paragraph">
<p>There is explicit mapping from data values to <code>VkIndexType</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_indirect_buffers_be_reusable"><a class="anchor" href="#_resolved_should_indirect_buffers_be_reusable"></a>5.7. RESOLVED: Should indirect buffers be reusable?</h3>
<div class="paragraph">
<p>Yes, indirect buffers can be reused.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_how_should_commands_with_less_than_32_bits_of_data_be_handled"><a class="anchor" href="#_resolved_how_should_commands_with_less_than_32_bits_of_data_be_handled"></a>5.8. RESOLVED: How should commands with less than 32-bits of data be handled?</h3>
<div class="paragraph">
<p>No such commands are provided.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_how_should_applications_provide_data_to_the_preprocess_command_in_order_for_drivers_to_optimize_indirect_execution"><a class="anchor" href="#_resolved_how_should_applications_provide_data_to_the_preprocess_command_in_order_for_drivers_to_optimize_indirect_execution"></a>5.9. RESOLVED: How should applications provide data to the preprocess command in order for drivers to optimize indirect execution?</h3>
<div class="paragraph">
<p>A <code>stateCommandBuffer</code> is added to <code>vkCmdPreprocessGeneratedCommandsEXT</code> with the requirement that all state must match between this command buffer and the one used to record <code>vkCmdExecuteGeneratedCommandsEXT</code>.
This guarantees that all pipeline state and, specifically for draw commands, other state (e.g., vertex buffers, index buffers) is available at preprocess time.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_further_functionality"><a class="anchor" href="#_further_functionality"></a>6. Further Functionality</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Support for Multi-dispatch (needs something like <code>gl_drawID</code> for compute shaders).</p>
</li>
<li>
<p>Multi-level indirect execution through a command that is equivalent to <code>vkCmdExecuteGeneratedCommandsEXT</code>.</p>
</li>
<li>
<p>Indirect command buffers.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_todo"><a class="anchor" href="#_todo"></a>7. TODO</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Example section</p>
</li>
</ul>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
  </body>
</html>
